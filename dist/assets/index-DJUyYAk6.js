(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))l(u);new MutationObserver(u=>{for(const d of u)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&l(h)}).observe(document,{childList:!0,subtree:!0});function i(u){const d={};return u.integrity&&(d.integrity=u.integrity),u.referrerPolicy&&(d.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?d.credentials="include":u.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(u){if(u.ep)return;u.ep=!0;const d=i(u);fetch(u.href,d)}})();var jsxRuntime={exports:{}},reactJsxRuntime_production={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var e=Symbol.for("react.transitional.element"),o=Symbol.for("react.fragment");function i(l,u,d){var h=null;if(d!==void 0&&(h=""+d),u.key!==void 0&&(h=""+u.key),"key"in u){d={};for(var m in u)m!=="key"&&(d[m]=u[m])}else d=u;return u=d.ref,{$$typeof:e,type:l,key:h,ref:u!==void 0?u:null,props:d}}return reactJsxRuntime_production.Fragment=o,reactJsxRuntime_production.jsx=i,reactJsxRuntime_production.jsxs=i,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),react={exports:{}},react_production={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var e=Symbol.for("react.transitional.element"),o=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),h=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),w=Symbol.iterator;function D(S){return S===null||typeof S!="object"?null:(S=w&&S[w]||S["@@iterator"],typeof S=="function"?S:null)}var O={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},k=Object.assign,N={};function C(S,$,J){this.props=S,this.context=$,this.refs=N,this.updater=J||O}C.prototype.isReactComponent={},C.prototype.setState=function(S,$){if(typeof S!="object"&&typeof S!="function"&&S!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,S,$,"setState")},C.prototype.forceUpdate=function(S){this.updater.enqueueForceUpdate(this,S,"forceUpdate")};function V(){}V.prototype=C.prototype;function U(S,$,J){this.props=S,this.context=$,this.refs=N,this.updater=J||O}var Y=U.prototype=new V;Y.constructor=U,k(Y,C.prototype),Y.isPureReactComponent=!0;var W=Array.isArray,P={H:null,A:null,T:null,S:null,V:null},F=Object.prototype.hasOwnProperty;function H(S,$,J,X,re,le){return J=le.ref,{$$typeof:e,type:S,key:$,ref:J!==void 0?J:null,props:le}}function ee(S,$){return H(S.type,$,void 0,void 0,void 0,S.props)}function Q(S){return typeof S=="object"&&S!==null&&S.$$typeof===e}function te(S){var $={"=":"=0",":":"=2"};return"$"+S.replace(/[=:]/g,function(J){return $[J]})}var ae=/\/+/g;function K(S,$){return typeof S=="object"&&S!==null&&S.key!=null?te(""+S.key):$.toString(36)}function I(){}function me(S){switch(S.status){case"fulfilled":return S.value;case"rejected":throw S.reason;default:switch(typeof S.status=="string"?S.then(I,I):(S.status="pending",S.then(function($){S.status==="pending"&&(S.status="fulfilled",S.value=$)},function($){S.status==="pending"&&(S.status="rejected",S.reason=$)})),S.status){case"fulfilled":return S.value;case"rejected":throw S.reason}}throw S}function ce(S,$,J,X,re){var le=typeof S;(le==="undefined"||le==="boolean")&&(S=null);var se=!1;if(S===null)se=!0;else switch(le){case"bigint":case"string":case"number":se=!0;break;case"object":switch(S.$$typeof){case e:case o:se=!0;break;case v:return se=S._init,ce(se(S._payload),$,J,X,re)}}if(se)return re=re(S),se=X===""?"."+K(S,0):X,W(re)?(J="",se!=null&&(J=se.replace(ae,"$&/")+"/"),ce(re,$,J,"",function(fe){return fe})):re!=null&&(Q(re)&&(re=ee(re,J+(re.key==null||S&&S.key===re.key?"":(""+re.key).replace(ae,"$&/")+"/")+se)),$.push(re)),1;se=0;var Le=X===""?".":X+":";if(W(S))for(var ve=0;ve<S.length;ve++)X=S[ve],le=Le+K(X,ve),se+=ce(X,$,J,le,re);else if(ve=D(S),typeof ve=="function")for(S=ve.call(S),ve=0;!(X=S.next()).done;)X=X.value,le=Le+K(X,ve++),se+=ce(X,$,J,le,re);else if(le==="object"){if(typeof S.then=="function")return ce(me(S),$,J,X,re);throw $=String(S),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return se}function z(S,$,J){if(S==null)return S;var X=[],re=0;return ce(S,X,"","",function(le){return $.call(J,le,re++)}),X}function Z(S){if(S._status===-1){var $=S._result;$=$(),$.then(function(J){(S._status===0||S._status===-1)&&(S._status=1,S._result=J)},function(J){(S._status===0||S._status===-1)&&(S._status=2,S._result=J)}),S._status===-1&&(S._status=0,S._result=$)}if(S._status===1)return S._result.default;throw S._result}var L=typeof reportError=="function"?reportError:function(S){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof S=="object"&&S!==null&&typeof S.message=="string"?String(S.message):String(S),error:S});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",S);return}console.error(S)};function ne(){}return react_production.Children={map:z,forEach:function(S,$,J){z(S,function(){$.apply(this,arguments)},J)},count:function(S){var $=0;return z(S,function(){$++}),$},toArray:function(S){return z(S,function($){return $})||[]},only:function(S){if(!Q(S))throw Error("React.Children.only expected to receive a single React element child.");return S}},react_production.Component=C,react_production.Fragment=i,react_production.Profiler=u,react_production.PureComponent=U,react_production.StrictMode=l,react_production.Suspense=g,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=P,react_production.__COMPILER_RUNTIME={__proto__:null,c:function(S){return P.H.useMemoCache(S)}},react_production.cache=function(S){return function(){return S.apply(null,arguments)}},react_production.cloneElement=function(S,$,J){if(S==null)throw Error("The argument must be a React element, but you passed "+S+".");var X=k({},S.props),re=S.key,le=void 0;if($!=null)for(se in $.ref!==void 0&&(le=void 0),$.key!==void 0&&(re=""+$.key),$)!F.call($,se)||se==="key"||se==="__self"||se==="__source"||se==="ref"&&$.ref===void 0||(X[se]=$[se]);var se=arguments.length-2;if(se===1)X.children=J;else if(1<se){for(var Le=Array(se),ve=0;ve<se;ve++)Le[ve]=arguments[ve+2];X.children=Le}return H(S.type,re,void 0,void 0,le,X)},react_production.createContext=function(S){return S={$$typeof:h,_currentValue:S,_currentValue2:S,_threadCount:0,Provider:null,Consumer:null},S.Provider=S,S.Consumer={$$typeof:d,_context:S},S},react_production.createElement=function(S,$,J){var X,re={},le=null;if($!=null)for(X in $.key!==void 0&&(le=""+$.key),$)F.call($,X)&&X!=="key"&&X!=="__self"&&X!=="__source"&&(re[X]=$[X]);var se=arguments.length-2;if(se===1)re.children=J;else if(1<se){for(var Le=Array(se),ve=0;ve<se;ve++)Le[ve]=arguments[ve+2];re.children=Le}if(S&&S.defaultProps)for(X in se=S.defaultProps,se)re[X]===void 0&&(re[X]=se[X]);return H(S,le,void 0,void 0,null,re)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(S){return{$$typeof:m,render:S}},react_production.isValidElement=Q,react_production.lazy=function(S){return{$$typeof:v,_payload:{_status:-1,_result:S},_init:Z}},react_production.memo=function(S,$){return{$$typeof:b,type:S,compare:$===void 0?null:$}},react_production.startTransition=function(S){var $=P.T,J={};P.T=J;try{var X=S(),re=P.S;re!==null&&re(J,X),typeof X=="object"&&X!==null&&typeof X.then=="function"&&X.then(ne,L)}catch(le){L(le)}finally{P.T=$}},react_production.unstable_useCacheRefresh=function(){return P.H.useCacheRefresh()},react_production.use=function(S){return P.H.use(S)},react_production.useActionState=function(S,$,J){return P.H.useActionState(S,$,J)},react_production.useCallback=function(S,$){return P.H.useCallback(S,$)},react_production.useContext=function(S){return P.H.useContext(S)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(S,$){return P.H.useDeferredValue(S,$)},react_production.useEffect=function(S,$,J){var X=P.H;if(typeof J=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return X.useEffect(S,$)},react_production.useId=function(){return P.H.useId()},react_production.useImperativeHandle=function(S,$,J){return P.H.useImperativeHandle(S,$,J)},react_production.useInsertionEffect=function(S,$){return P.H.useInsertionEffect(S,$)},react_production.useLayoutEffect=function(S,$){return P.H.useLayoutEffect(S,$)},react_production.useMemo=function(S,$){return P.H.useMemo(S,$)},react_production.useOptimistic=function(S,$){return P.H.useOptimistic(S,$)},react_production.useReducer=function(S,$,J){return P.H.useReducer(S,$,J)},react_production.useRef=function(S){return P.H.useRef(S)},react_production.useState=function(S){return P.H.useState(S)},react_production.useSyncExternalStore=function(S,$,J){return P.H.useSyncExternalStore(S,$,J)},react_production.useTransition=function(){return P.H.useTransition()},react_production.version="19.1.1",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactExports=requireReact(),client={exports:{}},reactDomClient_production={},scheduler={exports:{}},scheduler_production={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,(function(e){function o(z,Z){var L=z.length;z.push(Z);e:for(;0<L;){var ne=L-1>>>1,S=z[ne];if(0<u(S,Z))z[ne]=Z,z[L]=S,L=ne;else break e}}function i(z){return z.length===0?null:z[0]}function l(z){if(z.length===0)return null;var Z=z[0],L=z.pop();if(L!==Z){z[0]=L;e:for(var ne=0,S=z.length,$=S>>>1;ne<$;){var J=2*(ne+1)-1,X=z[J],re=J+1,le=z[re];if(0>u(X,L))re<S&&0>u(le,X)?(z[ne]=le,z[re]=L,ne=re):(z[ne]=X,z[J]=L,ne=J);else if(re<S&&0>u(le,L))z[ne]=le,z[re]=L,ne=re;else break e}}return Z}function u(z,Z){var L=z.sortIndex-Z.sortIndex;return L!==0?L:z.id-Z.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;e.unstable_now=function(){return d.now()}}else{var h=Date,m=h.now();e.unstable_now=function(){return h.now()-m}}var g=[],b=[],v=1,w=null,D=3,O=!1,k=!1,N=!1,C=!1,V=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,Y=typeof setImmediate<"u"?setImmediate:null;function W(z){for(var Z=i(b);Z!==null;){if(Z.callback===null)l(b);else if(Z.startTime<=z)l(b),Z.sortIndex=Z.expirationTime,o(g,Z);else break;Z=i(b)}}function P(z){if(N=!1,W(z),!k)if(i(g)!==null)k=!0,F||(F=!0,K());else{var Z=i(b);Z!==null&&ce(P,Z.startTime-z)}}var F=!1,H=-1,ee=5,Q=-1;function te(){return C?!0:!(e.unstable_now()-Q<ee)}function ae(){if(C=!1,F){var z=e.unstable_now();Q=z;var Z=!0;try{e:{k=!1,N&&(N=!1,U(H),H=-1),O=!0;var L=D;try{t:{for(W(z),w=i(g);w!==null&&!(w.expirationTime>z&&te());){var ne=w.callback;if(typeof ne=="function"){w.callback=null,D=w.priorityLevel;var S=ne(w.expirationTime<=z);if(z=e.unstable_now(),typeof S=="function"){w.callback=S,W(z),Z=!0;break t}w===i(g)&&l(g),W(z)}else l(g);w=i(g)}if(w!==null)Z=!0;else{var $=i(b);$!==null&&ce(P,$.startTime-z),Z=!1}}break e}finally{w=null,D=L,O=!1}Z=void 0}}finally{Z?K():F=!1}}}var K;if(typeof Y=="function")K=function(){Y(ae)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,me=I.port2;I.port1.onmessage=ae,K=function(){me.postMessage(null)}}else K=function(){V(ae,0)};function ce(z,Z){H=V(function(){z(e.unstable_now())},Z)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(z){z.callback=null},e.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ee=0<z?Math.floor(1e3/z):5},e.unstable_getCurrentPriorityLevel=function(){return D},e.unstable_next=function(z){switch(D){case 1:case 2:case 3:var Z=3;break;default:Z=D}var L=D;D=Z;try{return z()}finally{D=L}},e.unstable_requestPaint=function(){C=!0},e.unstable_runWithPriority=function(z,Z){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var L=D;D=z;try{return Z()}finally{D=L}},e.unstable_scheduleCallback=function(z,Z,L){var ne=e.unstable_now();switch(typeof L=="object"&&L!==null?(L=L.delay,L=typeof L=="number"&&0<L?ne+L:ne):L=ne,z){case 1:var S=-1;break;case 2:S=250;break;case 5:S=1073741823;break;case 4:S=1e4;break;default:S=5e3}return S=L+S,z={id:v++,callback:Z,priorityLevel:z,startTime:L,expirationTime:S,sortIndex:-1},L>ne?(z.sortIndex=L,o(b,z),i(g)===null&&z===i(b)&&(N?(U(H),H=-1):N=!0,ce(P,L-ne))):(z.sortIndex=S,o(g,z),k||O||(k=!0,F||(F=!0,K()))),z},e.unstable_shouldYield=te,e.unstable_wrapCallback=function(z){var Z=D;return function(){var L=D;D=Z;try{return z.apply(this,arguments)}finally{D=L}}}})(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}var reactDom={exports:{}},reactDom_production={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var e=requireReact();function o(g){var b="https://react.dev/errors/"+g;if(1<arguments.length){b+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)b+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+g+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var l={d:{f:i,r:function(){throw Error(o(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},u=Symbol.for("react.portal");function d(g,b,v){var w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:w==null?null:""+w,children:g,containerInfo:b,implementation:v}}var h=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function m(g,b){if(g==="font")return"";if(typeof b=="string")return b==="use-credentials"?b:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=l,reactDom_production.createPortal=function(g,b){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!b||b.nodeType!==1&&b.nodeType!==9&&b.nodeType!==11)throw Error(o(299));return d(g,b,null,v)},reactDom_production.flushSync=function(g){var b=h.T,v=l.p;try{if(h.T=null,l.p=2,g)return g()}finally{h.T=b,l.p=v,l.d.f()}},reactDom_production.preconnect=function(g,b){typeof g=="string"&&(b?(b=b.crossOrigin,b=typeof b=="string"?b==="use-credentials"?b:"":void 0):b=null,l.d.C(g,b))},reactDom_production.prefetchDNS=function(g){typeof g=="string"&&l.d.D(g)},reactDom_production.preinit=function(g,b){if(typeof g=="string"&&b&&typeof b.as=="string"){var v=b.as,w=m(v,b.crossOrigin),D=typeof b.integrity=="string"?b.integrity:void 0,O=typeof b.fetchPriority=="string"?b.fetchPriority:void 0;v==="style"?l.d.S(g,typeof b.precedence=="string"?b.precedence:void 0,{crossOrigin:w,integrity:D,fetchPriority:O}):v==="script"&&l.d.X(g,{crossOrigin:w,integrity:D,fetchPriority:O,nonce:typeof b.nonce=="string"?b.nonce:void 0})}},reactDom_production.preinitModule=function(g,b){if(typeof g=="string")if(typeof b=="object"&&b!==null){if(b.as==null||b.as==="script"){var v=m(b.as,b.crossOrigin);l.d.M(g,{crossOrigin:v,integrity:typeof b.integrity=="string"?b.integrity:void 0,nonce:typeof b.nonce=="string"?b.nonce:void 0})}}else b==null&&l.d.M(g)},reactDom_production.preload=function(g,b){if(typeof g=="string"&&typeof b=="object"&&b!==null&&typeof b.as=="string"){var v=b.as,w=m(v,b.crossOrigin);l.d.L(g,v,{crossOrigin:w,integrity:typeof b.integrity=="string"?b.integrity:void 0,nonce:typeof b.nonce=="string"?b.nonce:void 0,type:typeof b.type=="string"?b.type:void 0,fetchPriority:typeof b.fetchPriority=="string"?b.fetchPriority:void 0,referrerPolicy:typeof b.referrerPolicy=="string"?b.referrerPolicy:void 0,imageSrcSet:typeof b.imageSrcSet=="string"?b.imageSrcSet:void 0,imageSizes:typeof b.imageSizes=="string"?b.imageSizes:void 0,media:typeof b.media=="string"?b.media:void 0})}},reactDom_production.preloadModule=function(g,b){if(typeof g=="string")if(b){var v=m(b.as,b.crossOrigin);l.d.m(g,{as:typeof b.as=="string"&&b.as!=="script"?b.as:void 0,crossOrigin:v,integrity:typeof b.integrity=="string"?b.integrity:void 0})}else l.d.m(g)},reactDom_production.requestFormReset=function(g){l.d.r(g)},reactDom_production.unstable_batchedUpdates=function(g,b){return g(b)},reactDom_production.useFormState=function(g,b,v){return h.H.useFormState(g,b,v)},reactDom_production.useFormStatus=function(){return h.H.useHostTransitionStatus()},reactDom_production.version="19.1.1",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(o){console.error(o)}}return e(),reactDom.exports=requireReactDom_production(),reactDom.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var e=requireScheduler(),o=requireReact(),i=requireReactDom();function l(n){var a="https://react.dev/errors/"+n;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)a+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+n+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function u(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function d(n){var a=n,r=n;if(n.alternate)for(;a.return;)a=a.return;else{n=a;do a=n,(a.flags&4098)!==0&&(r=a.return),n=a.return;while(n)}return a.tag===3?r:null}function h(n){if(n.tag===13){var a=n.memoizedState;if(a===null&&(n=n.alternate,n!==null&&(a=n.memoizedState)),a!==null)return a.dehydrated}return null}function m(n){if(d(n)!==n)throw Error(l(188))}function g(n){var a=n.alternate;if(!a){if(a=d(n),a===null)throw Error(l(188));return a!==n?null:n}for(var r=n,s=a;;){var c=r.return;if(c===null)break;var p=c.alternate;if(p===null){if(s=c.return,s!==null){r=s;continue}break}if(c.child===p.child){for(p=c.child;p;){if(p===r)return m(c),n;if(p===s)return m(c),a;p=p.sibling}throw Error(l(188))}if(r.return!==s.return)r=c,s=p;else{for(var f=!1,y=c.child;y;){if(y===r){f=!0,r=c,s=p;break}if(y===s){f=!0,s=c,r=p;break}y=y.sibling}if(!f){for(y=p.child;y;){if(y===r){f=!0,r=p,s=c;break}if(y===s){f=!0,s=p,r=c;break}y=y.sibling}if(!f)throw Error(l(189))}}if(r.alternate!==s)throw Error(l(190))}if(r.tag!==3)throw Error(l(188));return r.stateNode.current===r?n:a}function b(n){var a=n.tag;if(a===5||a===26||a===27||a===6)return n;for(n=n.child;n!==null;){if(a=b(n),a!==null)return a;n=n.sibling}return null}var v=Object.assign,w=Symbol.for("react.element"),D=Symbol.for("react.transitional.element"),O=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),V=Symbol.for("react.provider"),U=Symbol.for("react.consumer"),Y=Symbol.for("react.context"),W=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),H=Symbol.for("react.memo"),ee=Symbol.for("react.lazy"),Q=Symbol.for("react.activity"),te=Symbol.for("react.memo_cache_sentinel"),ae=Symbol.iterator;function K(n){return n===null||typeof n!="object"?null:(n=ae&&n[ae]||n["@@iterator"],typeof n=="function"?n:null)}var I=Symbol.for("react.client.reference");function me(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===I?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case k:return"Fragment";case C:return"Profiler";case N:return"StrictMode";case P:return"Suspense";case F:return"SuspenseList";case Q:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case O:return"Portal";case Y:return(n.displayName||"Context")+".Provider";case U:return(n._context.displayName||"Context")+".Consumer";case W:var a=n.render;return n=n.displayName,n||(n=a.displayName||a.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case H:return a=n.displayName||null,a!==null?a:me(n.type)||"Memo";case ee:a=n._payload,n=n._init;try{return me(n(a))}catch{}}return null}var ce=Array.isArray,z=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L={pending:!1,data:null,method:null,action:null},ne=[],S=-1;function $(n){return{current:n}}function J(n){0>S||(n.current=ne[S],ne[S]=null,S--)}function X(n,a){S++,ne[S]=n.current,n.current=a}var re=$(null),le=$(null),se=$(null),Le=$(null);function ve(n,a){switch(X(se,a),X(le,n),X(re,null),a.nodeType){case 9:case 11:n=(n=a.documentElement)&&(n=n.namespaceURI)?Eu(n):0;break;default:if(n=a.tagName,a=a.namespaceURI)a=Eu(a),n=Ou(a,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}J(re),X(re,n)}function fe(){J(re),J(le),J(se)}function _e(n){n.memoizedState!==null&&X(Le,n);var a=re.current,r=Ou(a,n.type);a!==r&&(X(le,n),X(re,r))}function Je(n){le.current===n&&(J(re),J(le)),Le.current===n&&(J(Le),To._currentValue=L)}var Ae=Object.prototype.hasOwnProperty,Ee=e.unstable_scheduleCallback,et=e.unstable_cancelCallback,tt=e.unstable_shouldYield,Oe=e.unstable_requestPaint,Re=e.unstable_now,Rt=e.unstable_getCurrentPriorityLevel,Ct=e.unstable_ImmediatePriority,$t=e.unstable_UserBlockingPriority,kt=e.unstable_NormalPriority,Kn=e.unstable_LowPriority,La=e.unstable_IdlePriority,Ju=e.log,Iu=e.unstable_setDisableYieldValue,Na=null,dt=null;function rn(n){if(typeof Ju=="function"&&Iu(n),dt&&typeof dt.setStrictMode=="function")try{dt.setStrictMode(Na,n)}catch{}}var ft=Math.clz32?Math.clz32:ed,Pu=Math.log,Wu=Math.LN2;function ed(n){return n>>>=0,n===0?32:31-(Pu(n)/Wu|0)|0}var ko=256,Lo=4194304;function zn(n){var a=n&42;if(a!==0)return a;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function No(n,a,r){var s=n.pendingLanes;if(s===0)return 0;var c=0,p=n.suspendedLanes,f=n.pingedLanes;n=n.warmLanes;var y=s&134217727;return y!==0?(s=y&~p,s!==0?c=zn(s):(f&=y,f!==0?c=zn(f):r||(r=y&~n,r!==0&&(c=zn(r))))):(y=s&~p,y!==0?c=zn(y):f!==0?c=zn(f):r||(r=s&~n,r!==0&&(c=zn(r)))),c===0?0:a!==0&&a!==c&&(a&p)===0&&(p=c&-c,r=a&-a,p>=r||p===32&&(r&4194048)!==0)?a:c}function qa(n,a){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&a)===0}function td(n,a){switch(n){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ic(){var n=ko;return ko<<=1,(ko&4194048)===0&&(ko=256),n}function cc(){var n=Lo;return Lo<<=1,(Lo&62914560)===0&&(Lo=4194304),n}function Kr(n){for(var a=[],r=0;31>r;r++)a.push(n);return a}function $a(n,a){n.pendingLanes|=a,a!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function nd(n,a,r,s,c,p){var f=n.pendingLanes;n.pendingLanes=r,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=r,n.entangledLanes&=r,n.errorRecoveryDisabledLanes&=r,n.shellSuspendCounter=0;var y=n.entanglements,A=n.expirationTimes,T=n.hiddenUpdates;for(r=f&~r;0<r;){var q=31-ft(r),G=1<<q;y[q]=0,A[q]=-1;var M=T[q];if(M!==null)for(T[q]=null,q=0;q<M.length;q++){var R=M[q];R!==null&&(R.lane&=-536870913)}r&=~G}s!==0&&lc(n,s,0),p!==0&&c===0&&n.tag!==0&&(n.suspendedLanes|=p&~(f&~a))}function lc(n,a,r){n.pendingLanes|=a,n.suspendedLanes&=~a;var s=31-ft(a);n.entangledLanes|=a,n.entanglements[s]=n.entanglements[s]|1073741824|r&4194090}function pc(n,a){var r=n.entangledLanes|=a;for(n=n.entanglements;r;){var s=31-ft(r),c=1<<s;c&a|n[s]&a&&(n[s]|=a),r&=~c}}function Jr(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function Ir(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function uc(){var n=Z.p;return n!==0?n:(n=window.event,n===void 0?32:Fu(n.type))}function od(n,a){var r=Z.p;try{return Z.p=n,a()}finally{Z.p=r}}var sn=Math.random().toString(36).slice(2),nt="__reactFiber$"+sn,st="__reactProps$"+sn,Jn="__reactContainer$"+sn,Pr="__reactEvents$"+sn,rd="__reactListeners$"+sn,cd="__reactHandles$"+sn,dc="__reactResources$"+sn,Ba="__reactMarker$"+sn;function Wr(n){delete n[nt],delete n[st],delete n[Pr],delete n[rd],delete n[cd]}function In(n){var a=n[nt];if(a)return a;for(var r=n.parentNode;r;){if(a=r[Jn]||r[nt]){if(r=a.alternate,a.child!==null||r!==null&&r.child!==null)for(n=Tu(n);n!==null;){if(r=n[nt])return r;n=Tu(n)}return a}n=r,r=n.parentNode}return null}function Pn(n){if(n=n[nt]||n[Jn]){var a=n.tag;if(a===5||a===6||a===13||a===26||a===27||a===3)return n}return null}function Ua(n){var a=n.tag;if(a===5||a===26||a===27||a===6)return n.stateNode;throw Error(l(33))}function Wn(n){var a=n[dc];return a||(a=n[dc]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Ve(n){n[Ba]=!0}var fc=new Set,hc={};function Rn(n,a){ea(n,a),ea(n+"Capture",a)}function ea(n,a){for(hc[n]=a,n=0;n<a.length;n++)fc.add(a[n])}var ld=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),mc={},gc={};function pd(n){return Ae.call(gc,n)?!0:Ae.call(mc,n)?!1:ld.test(n)?gc[n]=!0:(mc[n]=!0,!1)}function qo(n,a,r){if(pd(a))if(r===null)n.removeAttribute(a);else{switch(typeof r){case"undefined":case"function":case"symbol":n.removeAttribute(a);return;case"boolean":var s=a.toLowerCase().slice(0,5);if(s!=="data-"&&s!=="aria-"){n.removeAttribute(a);return}}n.setAttribute(a,""+r)}}function $o(n,a,r){if(r===null)n.removeAttribute(a);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(a);return}n.setAttribute(a,""+r)}}function Ft(n,a,r,s){if(s===null)n.removeAttribute(r);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(r);return}n.setAttributeNS(a,r,""+s)}}var es,xc;function ta(n){if(es===void 0)try{throw Error()}catch(r){var a=r.stack.trim().match(/\n( *(at )?)/);es=a&&a[1]||"",xc=-1<r.stack.indexOf(`
    at`)?" (<anonymous>)":-1<r.stack.indexOf("@")?"@unknown:0:0":""}return`
`+es+n+xc}var ts=!1;function ns(n,a){if(!n||ts)return"";ts=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var s={DetermineComponentFrameRoot:function(){try{if(a){var G=function(){throw Error()};if(Object.defineProperty(G.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(G,[])}catch(R){var M=R}Reflect.construct(n,[],G)}else{try{G.call()}catch(R){M=R}n.call(G.prototype)}}else{try{throw Error()}catch(R){M=R}(G=n())&&typeof G.catch=="function"&&G.catch(function(){})}}catch(R){if(R&&M&&typeof R.stack=="string")return[R.stack,M.stack]}return[null,null]}};s.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(s.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(s.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var p=s.DetermineComponentFrameRoot(),f=p[0],y=p[1];if(f&&y){var A=f.split(`
`),T=y.split(`
`);for(c=s=0;s<A.length&&!A[s].includes("DetermineComponentFrameRoot");)s++;for(;c<T.length&&!T[c].includes("DetermineComponentFrameRoot");)c++;if(s===A.length||c===T.length)for(s=A.length-1,c=T.length-1;1<=s&&0<=c&&A[s]!==T[c];)c--;for(;1<=s&&0<=c;s--,c--)if(A[s]!==T[c]){if(s!==1||c!==1)do if(s--,c--,0>c||A[s]!==T[c]){var q=`
`+A[s].replace(" at new "," at ");return n.displayName&&q.includes("<anonymous>")&&(q=q.replace("<anonymous>",n.displayName)),q}while(1<=s&&0<=c);break}}}finally{ts=!1,Error.prepareStackTrace=r}return(r=n?n.displayName||n.name:"")?ta(r):""}function ud(n){switch(n.tag){case 26:case 27:case 5:return ta(n.type);case 16:return ta("Lazy");case 13:return ta("Suspense");case 19:return ta("SuspenseList");case 0:case 15:return ns(n.type,!1);case 11:return ns(n.type.render,!1);case 1:return ns(n.type,!0);case 31:return ta("Activity");default:return""}}function yc(n){try{var a="";do a+=ud(n),n=n.return;while(n);return a}catch(r){return`
Error generating stack: `+r.message+`
`+r.stack}}function St(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function bc(n){var a=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function dd(n){var a=bc(n)?"checked":"value",r=Object.getOwnPropertyDescriptor(n.constructor.prototype,a),s=""+n[a];if(!n.hasOwnProperty(a)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var c=r.get,p=r.set;return Object.defineProperty(n,a,{configurable:!0,get:function(){return c.call(this)},set:function(f){s=""+f,p.call(this,f)}}),Object.defineProperty(n,a,{enumerable:r.enumerable}),{getValue:function(){return s},setValue:function(f){s=""+f},stopTracking:function(){n._valueTracker=null,delete n[a]}}}}function Bo(n){n._valueTracker||(n._valueTracker=dd(n))}function vc(n){if(!n)return!1;var a=n._valueTracker;if(!a)return!0;var r=a.getValue(),s="";return n&&(s=bc(n)?n.checked?"true":"false":n.value),n=s,n!==r?(a.setValue(n),!0):!1}function Uo(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var fd=/[\n"\\]/g;function Et(n){return n.replace(fd,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function as(n,a,r,s,c,p,f,y){n.name="",f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"?n.type=f:n.removeAttribute("type"),a!=null?f==="number"?(a===0&&n.value===""||n.value!=a)&&(n.value=""+St(a)):n.value!==""+St(a)&&(n.value=""+St(a)):f!=="submit"&&f!=="reset"||n.removeAttribute("value"),a!=null?os(n,f,St(a)):r!=null?os(n,f,St(r)):s!=null&&n.removeAttribute("value"),c==null&&p!=null&&(n.defaultChecked=!!p),c!=null&&(n.checked=c&&typeof c!="function"&&typeof c!="symbol"),y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"?n.name=""+St(y):n.removeAttribute("name")}function wc(n,a,r,s,c,p,f,y){if(p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"&&(n.type=p),a!=null||r!=null){if(!(p!=="submit"&&p!=="reset"||a!=null))return;r=r!=null?""+St(r):"",a=a!=null?""+St(a):r,y||a===n.value||(n.value=a),n.defaultValue=a}s=s??c,s=typeof s!="function"&&typeof s!="symbol"&&!!s,n.checked=y?n.checked:!!s,n.defaultChecked=!!s,f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"&&(n.name=f)}function os(n,a,r){a==="number"&&Uo(n.ownerDocument)===n||n.defaultValue===""+r||(n.defaultValue=""+r)}function na(n,a,r,s){if(n=n.options,a){a={};for(var c=0;c<r.length;c++)a["$"+r[c]]=!0;for(r=0;r<n.length;r++)c=a.hasOwnProperty("$"+n[r].value),n[r].selected!==c&&(n[r].selected=c),c&&s&&(n[r].defaultSelected=!0)}else{for(r=""+St(r),a=null,c=0;c<n.length;c++){if(n[c].value===r){n[c].selected=!0,s&&(n[c].defaultSelected=!0);return}a!==null||n[c].disabled||(a=n[c])}a!==null&&(a.selected=!0)}}function Ac(n,a,r){if(a!=null&&(a=""+St(a),a!==n.value&&(n.value=a),r==null)){n.defaultValue!==a&&(n.defaultValue=a);return}n.defaultValue=r!=null?""+St(r):""}function Sc(n,a,r,s){if(a==null){if(s!=null){if(r!=null)throw Error(l(92));if(ce(s)){if(1<s.length)throw Error(l(93));s=s[0]}r=s}r==null&&(r=""),a=r}r=St(a),n.defaultValue=r,s=n.textContent,s===r&&s!==""&&s!==null&&(n.value=s)}function aa(n,a){if(a){var r=n.firstChild;if(r&&r===n.lastChild&&r.nodeType===3){r.nodeValue=a;return}}n.textContent=a}var hd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ec(n,a,r){var s=a.indexOf("--")===0;r==null||typeof r=="boolean"||r===""?s?n.setProperty(a,""):a==="float"?n.cssFloat="":n[a]="":s?n.setProperty(a,r):typeof r!="number"||r===0||hd.has(a)?a==="float"?n.cssFloat=r:n[a]=(""+r).trim():n[a]=r+"px"}function Oc(n,a,r){if(a!=null&&typeof a!="object")throw Error(l(62));if(n=n.style,r!=null){for(var s in r)!r.hasOwnProperty(s)||a!=null&&a.hasOwnProperty(s)||(s.indexOf("--")===0?n.setProperty(s,""):s==="float"?n.cssFloat="":n[s]="");for(var c in a)s=a[c],a.hasOwnProperty(c)&&r[c]!==s&&Ec(n,c,s)}else for(var p in a)a.hasOwnProperty(p)&&Ec(n,p,a[p])}function rs(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var md=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),gd=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Go(n){return gd.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}var ss=null;function is(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var oa=null,ra=null;function jc(n){var a=Pn(n);if(a&&(n=a.stateNode)){var r=n[st]||null;e:switch(n=a.stateNode,a.type){case"input":if(as(n,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),a=r.name,r.type==="radio"&&a!=null){for(r=n;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+Et(""+a)+'"][type="radio"]'),a=0;a<r.length;a++){var s=r[a];if(s!==n&&s.form===n.form){var c=s[st]||null;if(!c)throw Error(l(90));as(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(a=0;a<r.length;a++)s=r[a],s.form===n.form&&vc(s)}break e;case"textarea":Ac(n,r.value,r.defaultValue);break e;case"select":a=r.value,a!=null&&na(n,!!r.multiple,a,!1)}}}var cs=!1;function Dc(n,a,r){if(cs)return n(a,r);cs=!0;try{var s=n(a);return s}finally{if(cs=!1,(oa!==null||ra!==null)&&(_r(),oa&&(a=oa,n=ra,ra=oa=null,jc(a),n)))for(a=0;a<n.length;a++)jc(n[a])}}function Ga(n,a){var r=n.stateNode;if(r===null)return null;var s=r[st]||null;if(s===null)return null;r=s[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(n=n.type,s=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!s;break e;default:n=!1}if(n)return null;if(r&&typeof r!="function")throw Error(l(231,a,typeof r));return r}var Xt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ps=!1;if(Xt)try{var Ya={};Object.defineProperty(Ya,"passive",{get:function(){ps=!0}}),window.addEventListener("test",Ya,Ya),window.removeEventListener("test",Ya,Ya)}catch{ps=!1}var cn=null,us=null,Yo=null;function _c(){if(Yo)return Yo;var n,a=us,r=a.length,s,c="value"in cn?cn.value:cn.textContent,p=c.length;for(n=0;n<r&&a[n]===c[n];n++);var f=r-n;for(s=1;s<=f&&a[r-s]===c[p-s];s++);return Yo=c.slice(n,1<s?1-s:void 0)}function Ho(n){var a=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&a===13&&(n=13)):n=a,n===10&&(n=13),32<=n||n===13?n:0}function Fo(){return!0}function Tc(){return!1}function it(n){function a(r,s,c,p,f){this._reactName=r,this._targetInst=c,this.type=s,this.nativeEvent=p,this.target=f,this.currentTarget=null;for(var y in n)n.hasOwnProperty(y)&&(r=n[y],this[y]=r?r(p):p[y]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?Fo:Tc,this.isPropagationStopped=Tc,this}return v(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Fo)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Fo)},persist:function(){},isPersistent:Fo}),a}var Cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xo=it(Cn),Ha=v({},Cn,{view:0,detail:0}),xd=it(Ha),ds,fs,Fa,Vo=v({},Ha,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ms,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Fa&&(Fa&&n.type==="mousemove"?(ds=n.screenX-Fa.screenX,fs=n.screenY-Fa.screenY):fs=ds=0,Fa=n),ds)},movementY:function(n){return"movementY"in n?n.movementY:fs}}),Mc=it(Vo),yd=v({},Vo,{dataTransfer:0}),vd=it(yd),wd=v({},Ha,{relatedTarget:0}),hs=it(wd),Ad=v({},Cn,{animationName:0,elapsedTime:0,pseudoElement:0}),Sd=it(Ad),Ed=v({},Cn,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Od=it(Ed),jd=v({},Cn,{data:0}),zc=it(jd),Dd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_d={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Td={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Md(n){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(n):(n=Td[n])?!!a[n]:!1}function ms(){return Md}var zd=v({},Ha,{key:function(n){if(n.key){var a=Dd[n.key]||n.key;if(a!=="Unidentified")return a}return n.type==="keypress"?(n=Ho(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?_d[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ms,charCode:function(n){return n.type==="keypress"?Ho(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Ho(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Rd=it(zd),Cd=v({},Vo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rc=it(Cd),kd=v({},Ha,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ms}),Ld=it(kd),Nd=v({},Cn,{propertyName:0,elapsedTime:0,pseudoElement:0}),qd=it(Nd),$d=v({},Vo,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Bd=it($d),Ud=v({},Cn,{newState:0,oldState:0}),Gd=it(Ud),Yd=[9,13,27,32],gs=Xt&&"CompositionEvent"in window,Xa=null;Xt&&"documentMode"in document&&(Xa=document.documentMode);var Hd=Xt&&"TextEvent"in window&&!Xa,Cc=Xt&&(!gs||Xa&&8<Xa&&11>=Xa),kc=" ",Lc=!1;function Nc(n,a){switch(n){case"keyup":return Yd.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qc(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var sa=!1;function Fd(n,a){switch(n){case"compositionend":return qc(a);case"keypress":return a.which!==32?null:(Lc=!0,kc);case"textInput":return n=a.data,n===kc&&Lc?null:n;default:return null}}function Xd(n,a){if(sa)return n==="compositionend"||!gs&&Nc(n,a)?(n=_c(),Yo=us=cn=null,sa=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Cc&&a.locale!=="ko"?null:a.data;default:return null}}var Vd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $c(n){var a=n&&n.nodeName&&n.nodeName.toLowerCase();return a==="input"?!!Vd[n.type]:a==="textarea"}function Bc(n,a,r,s){oa?ra?ra.push(s):ra=[s]:oa=s,a=kr(a,"onChange"),0<a.length&&(r=new Xo("onChange","change",null,r,s),n.push({event:r,listeners:a}))}var Va=null,Za=null;function Zd(n){bu(n,0)}function Zo(n){var a=Ua(n);if(vc(a))return n}function Uc(n,a){if(n==="change")return a}var Gc=!1;if(Xt){var xs;if(Xt){var ys="oninput"in document;if(!ys){var Yc=document.createElement("div");Yc.setAttribute("oninput","return;"),ys=typeof Yc.oninput=="function"}xs=ys}else xs=!1;Gc=xs&&(!document.documentMode||9<document.documentMode)}function Hc(){Va&&(Va.detachEvent("onpropertychange",Fc),Za=Va=null)}function Fc(n){if(n.propertyName==="value"&&Zo(Za)){var a=[];Bc(a,Za,n,is(n)),Dc(Zd,a)}}function Qd(n,a,r){n==="focusin"?(Hc(),Va=a,Za=r,Va.attachEvent("onpropertychange",Fc)):n==="focusout"&&Hc()}function Kd(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Zo(Za)}function Jd(n,a){if(n==="click")return Zo(a)}function Id(n,a){if(n==="input"||n==="change")return Zo(a)}function Pd(n,a){return n===a&&(n!==0||1/n===1/a)||n!==n&&a!==a}var gt=typeof Object.is=="function"?Object.is:Pd;function Qa(n,a){if(gt(n,a))return!0;if(typeof n!="object"||n===null||typeof a!="object"||a===null)return!1;var r=Object.keys(n),s=Object.keys(a);if(r.length!==s.length)return!1;for(s=0;s<r.length;s++){var c=r[s];if(!Ae.call(a,c)||!gt(n[c],a[c]))return!1}return!0}function Xc(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Vc(n,a){var r=Xc(n);n=0;for(var s;r;){if(r.nodeType===3){if(s=n+r.textContent.length,n<=a&&s>=a)return{node:r,offset:a-n};n=s}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Xc(r)}}function Zc(n,a){return n&&a?n===a?!0:n&&n.nodeType===3?!1:a&&a.nodeType===3?Zc(n,a.parentNode):"contains"in n?n.contains(a):n.compareDocumentPosition?!!(n.compareDocumentPosition(a)&16):!1:!1}function Qc(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var a=Uo(n.document);a instanceof n.HTMLIFrameElement;){try{var r=typeof a.contentWindow.location.href=="string"}catch{r=!1}if(r)n=a.contentWindow;else break;a=Uo(n.document)}return a}function bs(n){var a=n&&n.nodeName&&n.nodeName.toLowerCase();return a&&(a==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||a==="textarea"||n.contentEditable==="true")}var Wd=Xt&&"documentMode"in document&&11>=document.documentMode,ia=null,vs=null,Ka=null,ws=!1;function Kc(n,a,r){var s=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;ws||ia==null||ia!==Uo(s)||(s=ia,"selectionStart"in s&&bs(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Ka&&Qa(Ka,s)||(Ka=s,s=kr(vs,"onSelect"),0<s.length&&(a=new Xo("onSelect","select",null,a,r),n.push({event:a,listeners:s}),a.target=ia)))}function kn(n,a){var r={};return r[n.toLowerCase()]=a.toLowerCase(),r["Webkit"+n]="webkit"+a,r["Moz"+n]="moz"+a,r}var ca={animationend:kn("Animation","AnimationEnd"),animationiteration:kn("Animation","AnimationIteration"),animationstart:kn("Animation","AnimationStart"),transitionrun:kn("Transition","TransitionRun"),transitionstart:kn("Transition","TransitionStart"),transitioncancel:kn("Transition","TransitionCancel"),transitionend:kn("Transition","TransitionEnd")},As={},Jc={};Xt&&(Jc=document.createElement("div").style,"AnimationEvent"in window||(delete ca.animationend.animation,delete ca.animationiteration.animation,delete ca.animationstart.animation),"TransitionEvent"in window||delete ca.transitionend.transition);function Ln(n){if(As[n])return As[n];if(!ca[n])return n;var a=ca[n],r;for(r in a)if(a.hasOwnProperty(r)&&r in Jc)return As[n]=a[r];return n}var Ic=Ln("animationend"),Pc=Ln("animationiteration"),Wc=Ln("animationstart"),ef=Ln("transitionrun"),tf=Ln("transitionstart"),nf=Ln("transitioncancel"),el=Ln("transitionend"),tl=new Map,Ss="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ss.push("scrollEnd");function Lt(n,a){tl.set(n,a),Rn(a,[n])}var nl=new WeakMap;function Ot(n,a){if(typeof n=="object"&&n!==null){var r=nl.get(n);return r!==void 0?r:(a={value:n,source:a,stack:yc(a)},nl.set(n,a),a)}return{value:n,source:a,stack:yc(a)}}var jt=[],la=0,Es=0;function Qo(){for(var n=la,a=Es=la=0;a<n;){var r=jt[a];jt[a++]=null;var s=jt[a];jt[a++]=null;var c=jt[a];jt[a++]=null;var p=jt[a];if(jt[a++]=null,s!==null&&c!==null){var f=s.pending;f===null?c.next=c:(c.next=f.next,f.next=c),s.pending=c}p!==0&&al(r,c,p)}}function Ko(n,a,r,s){jt[la++]=n,jt[la++]=a,jt[la++]=r,jt[la++]=s,Es|=s,n.lanes|=s,n=n.alternate,n!==null&&(n.lanes|=s)}function Os(n,a,r,s){return Ko(n,a,r,s),Jo(n)}function pa(n,a){return Ko(n,null,null,a),Jo(n)}function al(n,a,r){n.lanes|=r;var s=n.alternate;s!==null&&(s.lanes|=r);for(var c=!1,p=n.return;p!==null;)p.childLanes|=r,s=p.alternate,s!==null&&(s.childLanes|=r),p.tag===22&&(n=p.stateNode,n===null||n._visibility&1||(c=!0)),n=p,p=p.return;return n.tag===3?(p=n.stateNode,c&&a!==null&&(c=31-ft(r),n=p.hiddenUpdates,s=n[c],s===null?n[c]=[a]:s.push(a),a.lane=r|536870912),p):null}function Jo(n){if(50<wo)throw wo=0,zi=null,Error(l(185));for(var a=n.return;a!==null;)n=a,a=n.return;return n.tag===3?n.stateNode:null}var ua={};function af(n,a,r,s){this.tag=n,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xt(n,a,r,s){return new af(n,a,r,s)}function js(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Vt(n,a){var r=n.alternate;return r===null?(r=xt(n.tag,a,n.key,n.mode),r.elementType=n.elementType,r.type=n.type,r.stateNode=n.stateNode,r.alternate=n,n.alternate=r):(r.pendingProps=a,r.type=n.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=n.flags&65011712,r.childLanes=n.childLanes,r.lanes=n.lanes,r.child=n.child,r.memoizedProps=n.memoizedProps,r.memoizedState=n.memoizedState,r.updateQueue=n.updateQueue,a=n.dependencies,r.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},r.sibling=n.sibling,r.index=n.index,r.ref=n.ref,r.refCleanup=n.refCleanup,r}function ol(n,a){n.flags&=65011714;var r=n.alternate;return r===null?(n.childLanes=0,n.lanes=a,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=r.childLanes,n.lanes=r.lanes,n.child=r.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=r.memoizedProps,n.memoizedState=r.memoizedState,n.updateQueue=r.updateQueue,n.type=r.type,a=r.dependencies,n.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),n}function Io(n,a,r,s,c,p){var f=0;if(s=n,typeof n=="function")js(n)&&(f=1);else if(typeof n=="string")f=ih(n,r,re.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case Q:return n=xt(31,r,a,c),n.elementType=Q,n.lanes=p,n;case k:return Nn(r.children,c,p,a);case N:f=8,c|=24;break;case C:return n=xt(12,r,a,c|2),n.elementType=C,n.lanes=p,n;case P:return n=xt(13,r,a,c),n.elementType=P,n.lanes=p,n;case F:return n=xt(19,r,a,c),n.elementType=F,n.lanes=p,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case V:case Y:f=10;break e;case U:f=9;break e;case W:f=11;break e;case H:f=14;break e;case ee:f=16,s=null;break e}f=29,r=Error(l(130,n===null?"null":typeof n,"")),s=null}return a=xt(f,r,a,c),a.elementType=n,a.type=s,a.lanes=p,a}function Nn(n,a,r,s){return n=xt(7,n,s,a),n.lanes=r,n}function Ds(n,a,r){return n=xt(6,n,null,a),n.lanes=r,n}function _s(n,a,r){return a=xt(4,n.children!==null?n.children:[],n.key,a),a.lanes=r,a.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},a}var da=[],fa=0,Po=null,Wo=0,Dt=[],_t=0,qn=null,Zt=1,Qt="";function $n(n,a){da[fa++]=Wo,da[fa++]=Po,Po=n,Wo=a}function rl(n,a,r){Dt[_t++]=Zt,Dt[_t++]=Qt,Dt[_t++]=qn,qn=n;var s=Zt;n=Qt;var c=32-ft(s)-1;s&=~(1<<c),r+=1;var p=32-ft(a)+c;if(30<p){var f=c-c%5;p=(s&(1<<f)-1).toString(32),s>>=f,c-=f,Zt=1<<32-ft(a)+c|r<<c|s,Qt=p+n}else Zt=1<<p|r<<c|s,Qt=n}function Ts(n){n.return!==null&&($n(n,1),rl(n,1,0))}function Ms(n){for(;n===Po;)Po=da[--fa],da[fa]=null,Wo=da[--fa],da[fa]=null;for(;n===qn;)qn=Dt[--_t],Dt[_t]=null,Qt=Dt[--_t],Dt[_t]=null,Zt=Dt[--_t],Dt[_t]=null}var rt=null,$e=null,Se=!1,Bn=null,Bt=!1,zs=Error(l(519));function Un(n){var a=Error(l(418,""));throw Pa(Ot(a,n)),zs}function sl(n){var a=n.stateNode,r=n.type,s=n.memoizedProps;switch(a[nt]=n,a[st]=s,r){case"dialog":ye("cancel",a),ye("close",a);break;case"iframe":case"object":case"embed":ye("load",a);break;case"video":case"audio":for(r=0;r<So.length;r++)ye(So[r],a);break;case"source":ye("error",a);break;case"img":case"image":case"link":ye("error",a),ye("load",a);break;case"details":ye("toggle",a);break;case"input":ye("invalid",a),wc(a,s.value,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name,!0),Bo(a);break;case"select":ye("invalid",a);break;case"textarea":ye("invalid",a),Sc(a,s.value,s.defaultValue,s.children),Bo(a)}r=s.children,typeof r!="string"&&typeof r!="number"&&typeof r!="bigint"||a.textContent===""+r||s.suppressHydrationWarning===!0||Su(a.textContent,r)?(s.popover!=null&&(ye("beforetoggle",a),ye("toggle",a)),s.onScroll!=null&&ye("scroll",a),s.onScrollEnd!=null&&ye("scrollend",a),s.onClick!=null&&(a.onclick=Lr),a=!0):a=!1,a||Un(n)}function il(n){for(rt=n.return;rt;)switch(rt.tag){case 5:case 13:Bt=!1;return;case 27:case 3:Bt=!0;return;default:rt=rt.return}}function Ja(n){if(n!==rt)return!1;if(!Se)return il(n),Se=!0,!1;var a=n.tag,r;if((r=a!==3&&a!==27)&&((r=a===5)&&(r=n.type,r=!(r!=="form"&&r!=="button")||Zi(n.type,n.memoizedProps)),r=!r),r&&$e&&Un(n),il(n),a===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(l(317));e:{for(n=n.nextSibling,a=0;n;){if(n.nodeType===8)if(r=n.data,r==="/$"){if(a===0){$e=qt(n.nextSibling);break e}a--}else r!=="$"&&r!=="$!"&&r!=="$?"||a++;n=n.nextSibling}$e=null}}else a===27?(a=$e,On(n.type)?(n=Ii,Ii=null,$e=n):$e=a):$e=rt?qt(n.stateNode.nextSibling):null;return!0}function Ia(){$e=rt=null,Se=!1}function cl(){var n=Bn;return n!==null&&(ut===null?ut=n:ut.push.apply(ut,n),Bn=null),n}function Pa(n){Bn===null?Bn=[n]:Bn.push(n)}var Rs=$(null),Gn=null,Kt=null;function pn(n,a,r){X(Rs,a._currentValue),a._currentValue=r}function Jt(n){n._currentValue=Rs.current,J(Rs)}function Cs(n,a,r){for(;n!==null;){var s=n.alternate;if((n.childLanes&a)!==a?(n.childLanes|=a,s!==null&&(s.childLanes|=a)):s!==null&&(s.childLanes&a)!==a&&(s.childLanes|=a),n===r)break;n=n.return}}function ks(n,a,r,s){var c=n.child;for(c!==null&&(c.return=n);c!==null;){var p=c.dependencies;if(p!==null){var f=c.child;p=p.firstContext;e:for(;p!==null;){var y=p;p=c;for(var A=0;A<a.length;A++)if(y.context===a[A]){p.lanes|=r,y=p.alternate,y!==null&&(y.lanes|=r),Cs(p.return,r,n),s||(f=null);break e}p=y.next}}else if(c.tag===18){if(f=c.return,f===null)throw Error(l(341));f.lanes|=r,p=f.alternate,p!==null&&(p.lanes|=r),Cs(f,r,n),f=null}else f=c.child;if(f!==null)f.return=c;else for(f=c;f!==null;){if(f===n){f=null;break}if(c=f.sibling,c!==null){c.return=f.return,f=c;break}f=f.return}c=f}}function Wa(n,a,r,s){n=null;for(var c=a,p=!1;c!==null;){if(!p){if((c.flags&524288)!==0)p=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var f=c.alternate;if(f===null)throw Error(l(387));if(f=f.memoizedProps,f!==null){var y=c.type;gt(c.pendingProps.value,f.value)||(n!==null?n.push(y):n=[y])}}else if(c===Le.current){if(f=c.alternate,f===null)throw Error(l(387));f.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(n!==null?n.push(To):n=[To])}c=c.return}n!==null&&ks(a,n,r,s),a.flags|=262144}function er(n){for(n=n.firstContext;n!==null;){if(!gt(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function Yn(n){Gn=n,Kt=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function ot(n){return ll(Gn,n)}function tr(n,a){return Gn===null&&Yn(n),ll(n,a)}function ll(n,a){var r=a._currentValue;if(a={context:a,memoizedValue:r,next:null},Kt===null){if(n===null)throw Error(l(308));Kt=a,n.dependencies={lanes:0,firstContext:a},n.flags|=524288}else Kt=Kt.next=a;return r}var rf=typeof AbortController<"u"?AbortController:function(){var n=[],a=this.signal={aborted:!1,addEventListener:function(r,s){n.push(s)}};this.abort=function(){a.aborted=!0,n.forEach(function(r){return r()})}},sf=e.unstable_scheduleCallback,cf=e.unstable_NormalPriority,Fe={$$typeof:Y,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ls(){return{controller:new rf,data:new Map,refCount:0}}function eo(n){n.refCount--,n.refCount===0&&sf(cf,function(){n.controller.abort()})}var to=null,Ns=0,ha=0,ma=null;function lf(n,a){if(to===null){var r=to=[];Ns=0,ha=$i(),ma={status:"pending",value:void 0,then:function(s){r.push(s)}}}return Ns++,a.then(pl,pl),a}function pl(){if(--Ns===0&&to!==null){ma!==null&&(ma.status="fulfilled");var n=to;to=null,ha=0,ma=null;for(var a=0;a<n.length;a++)(0,n[a])()}}function pf(n,a){var r=[],s={status:"pending",value:null,reason:null,then:function(c){r.push(c)}};return n.then(function(){s.status="fulfilled",s.value=a;for(var c=0;c<r.length;c++)(0,r[c])(a)},function(c){for(s.status="rejected",s.reason=c,c=0;c<r.length;c++)(0,r[c])(void 0)}),s}var ul=z.S;z.S=function(n,a){typeof a=="object"&&a!==null&&typeof a.then=="function"&&lf(n,a),ul!==null&&ul(n,a)};var Hn=$(null);function qs(){var n=Hn.current;return n!==null?n:ke.pooledCache}function nr(n,a){a===null?X(Hn,Hn.current):X(Hn,a.pool)}function dl(){var n=qs();return n===null?null:{parent:Fe._currentValue,pool:n}}var no=Error(l(460)),fl=Error(l(474)),ar=Error(l(542)),$s={then:function(){}};function hl(n){return n=n.status,n==="fulfilled"||n==="rejected"}function rr(){}function ml(n,a,r){switch(r=n[r],r===void 0?n.push(a):r!==a&&(a.then(rr,rr),a=r),a.status){case"fulfilled":return a.value;case"rejected":throw n=a.reason,xl(n),n;default:if(typeof a.status=="string")a.then(rr,rr);else{if(n=ke,n!==null&&100<n.shellSuspendCounter)throw Error(l(482));n=a,n.status="pending",n.then(function(s){if(a.status==="pending"){var c=a;c.status="fulfilled",c.value=s}},function(s){if(a.status==="pending"){var c=a;c.status="rejected",c.reason=s}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw n=a.reason,xl(n),n}throw ao=a,no}}var ao=null;function gl(){if(ao===null)throw Error(l(459));var n=ao;return ao=null,n}function xl(n){if(n===no||n===ar)throw Error(l(483))}var un=!1;function Bs(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Us(n,a){n=n.updateQueue,a.updateQueue===n&&(a.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function dn(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function fn(n,a,r){var s=n.updateQueue;if(s===null)return null;if(s=s.shared,(je&2)!==0){var c=s.pending;return c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a,a=Jo(n),al(n,null,r),a}return Ko(n,s,a,r),Jo(n)}function oo(n,a,r){if(a=a.updateQueue,a!==null&&(a=a.shared,(r&4194048)!==0)){var s=a.lanes;s&=n.pendingLanes,r|=s,a.lanes=r,pc(n,r)}}function Gs(n,a){var r=n.updateQueue,s=n.alternate;if(s!==null&&(s=s.updateQueue,r===s)){var c=null,p=null;if(r=r.firstBaseUpdate,r!==null){do{var f={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};p===null?c=p=f:p=p.next=f,r=r.next}while(r!==null);p===null?c=p=a:p=p.next=a}else c=p=a;r={baseState:s.baseState,firstBaseUpdate:c,lastBaseUpdate:p,shared:s.shared,callbacks:s.callbacks},n.updateQueue=r;return}n=r.lastBaseUpdate,n===null?r.firstBaseUpdate=a:n.next=a,r.lastBaseUpdate=a}var Ys=!1;function ro(){if(Ys){var n=ma;if(n!==null)throw n}}function so(n,a,r,s){Ys=!1;var c=n.updateQueue;un=!1;var p=c.firstBaseUpdate,f=c.lastBaseUpdate,y=c.shared.pending;if(y!==null){c.shared.pending=null;var A=y,T=A.next;A.next=null,f===null?p=T:f.next=T,f=A;var q=n.alternate;q!==null&&(q=q.updateQueue,y=q.lastBaseUpdate,y!==f&&(y===null?q.firstBaseUpdate=T:y.next=T,q.lastBaseUpdate=A))}if(p!==null){var G=c.baseState;f=0,q=T=A=null,y=p;do{var M=y.lane&-536870913,R=M!==y.lane;if(R?(be&M)===M:(s&M)===M){M!==0&&M===ha&&(Ys=!0),q!==null&&(q=q.next={lane:0,tag:y.tag,payload:y.payload,callback:null,next:null});e:{var de=n,pe=y;M=a;var ze=r;switch(pe.tag){case 1:if(de=pe.payload,typeof de=="function"){G=de.call(ze,G,M);break e}G=de;break e;case 3:de.flags=de.flags&-65537|128;case 0:if(de=pe.payload,M=typeof de=="function"?de.call(ze,G,M):de,M==null)break e;G=v({},G,M);break e;case 2:un=!0}}M=y.callback,M!==null&&(n.flags|=64,R&&(n.flags|=8192),R=c.callbacks,R===null?c.callbacks=[M]:R.push(M))}else R={lane:M,tag:y.tag,payload:y.payload,callback:y.callback,next:null},q===null?(T=q=R,A=G):q=q.next=R,f|=M;if(y=y.next,y===null){if(y=c.shared.pending,y===null)break;R=y,y=R.next,R.next=null,c.lastBaseUpdate=R,c.shared.pending=null}}while(!0);q===null&&(A=G),c.baseState=A,c.firstBaseUpdate=T,c.lastBaseUpdate=q,p===null&&(c.shared.lanes=0),wn|=f,n.lanes=f,n.memoizedState=G}}function yl(n,a){if(typeof n!="function")throw Error(l(191,n));n.call(a)}function bl(n,a){var r=n.callbacks;if(r!==null)for(n.callbacks=null,n=0;n<r.length;n++)yl(r[n],a)}var ga=$(null),sr=$(0);function vl(n,a){n=an,X(sr,n),X(ga,a),an=n|a.baseLanes}function Hs(){X(sr,an),X(ga,ga.current)}function Fs(){an=sr.current,J(ga),J(sr)}var hn=0,he=null,Te=null,Ye=null,ir=!1,xa=!1,Fn=!1,lr=0,io=0,ya=null,uf=0;function Ue(){throw Error(l(321))}function Xs(n,a){if(a===null)return!1;for(var r=0;r<a.length&&r<n.length;r++)if(!gt(n[r],a[r]))return!1;return!0}function Vs(n,a,r,s,c,p){return hn=p,he=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,z.H=n===null||n.memoizedState===null?ap:op,Fn=!1,p=r(s,c),Fn=!1,xa&&(p=Al(a,r,s,c)),wl(n),p}function wl(n){z.H=mr;var a=Te!==null&&Te.next!==null;if(hn=0,Ye=Te=he=null,ir=!1,io=0,ya=null,a)throw Error(l(300));n===null||Ze||(n=n.dependencies,n!==null&&er(n)&&(Ze=!0))}function Al(n,a,r,s){he=n;var c=0;do{if(xa&&(ya=null),io=0,xa=!1,25<=c)throw Error(l(301));if(c+=1,Ye=Te=null,n.updateQueue!=null){var p=n.updateQueue;p.lastEffect=null,p.events=null,p.stores=null,p.memoCache!=null&&(p.memoCache.index=0)}z.H=yf,p=a(r,s)}while(xa);return p}function df(){var n=z.H,a=n.useState()[0];return a=typeof a.then=="function"?co(a):a,n=n.useState()[0],(Te!==null?Te.memoizedState:null)!==n&&(he.flags|=1024),a}function Zs(){var n=lr!==0;return lr=0,n}function Qs(n,a,r){a.updateQueue=n.updateQueue,a.flags&=-2053,n.lanes&=~r}function Ks(n){if(ir){for(n=n.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}ir=!1}hn=0,Ye=Te=he=null,xa=!1,io=lr=0,ya=null}function ct(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ye===null?he.memoizedState=Ye=n:Ye=Ye.next=n,Ye}function He(){if(Te===null){var n=he.alternate;n=n!==null?n.memoizedState:null}else n=Te.next;var a=Ye===null?he.memoizedState:Ye.next;if(a!==null)Ye=a,Te=n;else{if(n===null)throw he.alternate===null?Error(l(467)):Error(l(310));Te=n,n={memoizedState:Te.memoizedState,baseState:Te.baseState,baseQueue:Te.baseQueue,queue:Te.queue,next:null},Ye===null?he.memoizedState=Ye=n:Ye=Ye.next=n}return Ye}function Js(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function co(n){var a=io;return io+=1,ya===null&&(ya=[]),n=ml(ya,n,a),a=he,(Ye===null?a.memoizedState:Ye.next)===null&&(a=a.alternate,z.H=a===null||a.memoizedState===null?ap:op),n}function pr(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return co(n);if(n.$$typeof===Y)return ot(n)}throw Error(l(438,String(n)))}function Is(n){var a=null,r=he.updateQueue;if(r!==null&&(a=r.memoCache),a==null){var s=he.alternate;s!==null&&(s=s.updateQueue,s!==null&&(s=s.memoCache,s!=null&&(a={data:s.data.map(function(c){return c.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),r===null&&(r=Js(),he.updateQueue=r),r.memoCache=a,r=a.data[a.index],r===void 0)for(r=a.data[a.index]=Array(n),s=0;s<n;s++)r[s]=te;return a.index++,r}function It(n,a){return typeof a=="function"?a(n):a}function ur(n){var a=He();return Ps(a,Te,n)}function Ps(n,a,r){var s=n.queue;if(s===null)throw Error(l(311));s.lastRenderedReducer=r;var c=n.baseQueue,p=s.pending;if(p!==null){if(c!==null){var f=c.next;c.next=p.next,p.next=f}a.baseQueue=c=p,s.pending=null}if(p=n.baseState,c===null)n.memoizedState=p;else{a=c.next;var y=f=null,A=null,T=a,q=!1;do{var G=T.lane&-536870913;if(G!==T.lane?(be&G)===G:(hn&G)===G){var M=T.revertLane;if(M===0)A!==null&&(A=A.next={lane:0,revertLane:0,action:T.action,hasEagerState:T.hasEagerState,eagerState:T.eagerState,next:null}),G===ha&&(q=!0);else if((hn&M)===M){T=T.next,M===ha&&(q=!0);continue}else G={lane:0,revertLane:T.revertLane,action:T.action,hasEagerState:T.hasEagerState,eagerState:T.eagerState,next:null},A===null?(y=A=G,f=p):A=A.next=G,he.lanes|=M,wn|=M;G=T.action,Fn&&r(p,G),p=T.hasEagerState?T.eagerState:r(p,G)}else M={lane:G,revertLane:T.revertLane,action:T.action,hasEagerState:T.hasEagerState,eagerState:T.eagerState,next:null},A===null?(y=A=M,f=p):A=A.next=M,he.lanes|=G,wn|=G;T=T.next}while(T!==null&&T!==a);if(A===null?f=p:A.next=y,!gt(p,n.memoizedState)&&(Ze=!0,q&&(r=ma,r!==null)))throw r;n.memoizedState=p,n.baseState=f,n.baseQueue=A,s.lastRenderedState=p}return c===null&&(s.lanes=0),[n.memoizedState,s.dispatch]}function Ws(n){var a=He(),r=a.queue;if(r===null)throw Error(l(311));r.lastRenderedReducer=n;var s=r.dispatch,c=r.pending,p=a.memoizedState;if(c!==null){r.pending=null;var f=c=c.next;do p=n(p,f.action),f=f.next;while(f!==c);gt(p,a.memoizedState)||(Ze=!0),a.memoizedState=p,a.baseQueue===null&&(a.baseState=p),r.lastRenderedState=p}return[p,s]}function Sl(n,a,r){var s=he,c=He(),p=Se;if(p){if(r===void 0)throw Error(l(407));r=r()}else r=a();var f=!gt((Te||c).memoizedState,r);f&&(c.memoizedState=r,Ze=!0),c=c.queue;var y=jl.bind(null,s,c,n);if(lo(2048,8,y,[n]),c.getSnapshot!==a||f||Ye!==null&&Ye.memoizedState.tag&1){if(s.flags|=2048,ba(9,dr(),Ol.bind(null,s,c,r,a),null),ke===null)throw Error(l(349));p||(hn&124)!==0||El(s,a,r)}return r}function El(n,a,r){n.flags|=16384,n={getSnapshot:a,value:r},a=he.updateQueue,a===null?(a=Js(),he.updateQueue=a,a.stores=[n]):(r=a.stores,r===null?a.stores=[n]:r.push(n))}function Ol(n,a,r,s){a.value=r,a.getSnapshot=s,Dl(a)&&_l(n)}function jl(n,a,r){return r(function(){Dl(a)&&_l(n)})}function Dl(n){var a=n.getSnapshot;n=n.value;try{var r=a();return!gt(n,r)}catch{return!0}}function _l(n){var a=pa(n,2);a!==null&&At(a,n,2)}function ei(n){var a=ct();if(typeof n=="function"){var r=n;if(n=r(),Fn){rn(!0);try{r()}finally{rn(!1)}}}return a.memoizedState=a.baseState=n,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:It,lastRenderedState:n},a}function Tl(n,a,r,s){return n.baseState=r,Ps(n,Te,typeof s=="function"?s:It)}function ff(n,a,r,s,c){if(hr(n))throw Error(l(485));if(n=a.action,n!==null){var p={payload:c,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(f){p.listeners.push(f)}};z.T!==null?r(!0):p.isTransition=!1,s(p),r=a.pending,r===null?(p.next=a.pending=p,Ml(a,p)):(p.next=r.next,a.pending=r.next=p)}}function Ml(n,a){var r=a.action,s=a.payload,c=n.state;if(a.isTransition){var p=z.T,f={};z.T=f;try{var y=r(c,s),A=z.S;A!==null&&A(f,y),zl(n,a,y)}catch(T){ti(n,a,T)}finally{z.T=p}}else try{p=r(c,s),zl(n,a,p)}catch(T){ti(n,a,T)}}function zl(n,a,r){r!==null&&typeof r=="object"&&typeof r.then=="function"?r.then(function(s){Rl(n,a,s)},function(s){return ti(n,a,s)}):Rl(n,a,r)}function Rl(n,a,r){a.status="fulfilled",a.value=r,Cl(a),n.state=r,a=n.pending,a!==null&&(r=a.next,r===a?n.pending=null:(r=r.next,a.next=r,Ml(n,r)))}function ti(n,a,r){var s=n.pending;if(n.pending=null,s!==null){s=s.next;do a.status="rejected",a.reason=r,Cl(a),a=a.next;while(a!==s)}n.action=null}function Cl(n){n=n.listeners;for(var a=0;a<n.length;a++)(0,n[a])()}function kl(n,a){return a}function Ll(n,a){if(Se){var r=ke.formState;if(r!==null){e:{var s=he;if(Se){if($e){t:{for(var c=$e,p=Bt;c.nodeType!==8;){if(!p){c=null;break t}if(c=qt(c.nextSibling),c===null){c=null;break t}}p=c.data,c=p==="F!"||p==="F"?c:null}if(c){$e=qt(c.nextSibling),s=c.data==="F!";break e}}Un(s)}s=!1}s&&(a=r[0])}}return r=ct(),r.memoizedState=r.baseState=a,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:kl,lastRenderedState:a},r.queue=s,r=ep.bind(null,he,s),s.dispatch=r,s=ei(!1),p=si.bind(null,he,!1,s.queue),s=ct(),c={state:a,dispatch:null,action:n,pending:null},s.queue=c,r=ff.bind(null,he,c,p,r),c.dispatch=r,s.memoizedState=n,[a,r,!1]}function Nl(n){var a=He();return ql(a,Te,n)}function ql(n,a,r){if(a=Ps(n,a,kl)[0],n=ur(It)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var s=co(a)}catch(f){throw f===no?ar:f}else s=a;a=He();var c=a.queue,p=c.dispatch;return r!==a.memoizedState&&(he.flags|=2048,ba(9,dr(),hf.bind(null,c,r),null)),[s,p,n]}function hf(n,a){n.action=a}function $l(n){var a=He(),r=Te;if(r!==null)return ql(a,r,n);He(),a=a.memoizedState,r=He();var s=r.queue.dispatch;return r.memoizedState=n,[a,s,!1]}function ba(n,a,r,s){return n={tag:n,create:r,deps:s,inst:a,next:null},a=he.updateQueue,a===null&&(a=Js(),he.updateQueue=a),r=a.lastEffect,r===null?a.lastEffect=n.next=n:(s=r.next,r.next=n,n.next=s,a.lastEffect=n),n}function dr(){return{destroy:void 0,resource:void 0}}function Bl(){return He().memoizedState}function fr(n,a,r,s){var c=ct();s=s===void 0?null:s,he.flags|=n,c.memoizedState=ba(1|a,dr(),r,s)}function lo(n,a,r,s){var c=He();s=s===void 0?null:s;var p=c.memoizedState.inst;Te!==null&&s!==null&&Xs(s,Te.memoizedState.deps)?c.memoizedState=ba(a,p,r,s):(he.flags|=n,c.memoizedState=ba(1|a,p,r,s))}function Ul(n,a){fr(8390656,8,n,a)}function Gl(n,a){lo(2048,8,n,a)}function Yl(n,a){return lo(4,2,n,a)}function Hl(n,a){return lo(4,4,n,a)}function Fl(n,a){if(typeof a=="function"){n=n();var r=a(n);return function(){typeof r=="function"?r():a(null)}}if(a!=null)return n=n(),a.current=n,function(){a.current=null}}function Xl(n,a,r){r=r!=null?r.concat([n]):null,lo(4,4,Fl.bind(null,a,n),r)}function ni(){}function Vl(n,a){var r=He();a=a===void 0?null:a;var s=r.memoizedState;return a!==null&&Xs(a,s[1])?s[0]:(r.memoizedState=[n,a],n)}function Zl(n,a){var r=He();a=a===void 0?null:a;var s=r.memoizedState;if(a!==null&&Xs(a,s[1]))return s[0];if(s=n(),Fn){rn(!0);try{n()}finally{rn(!1)}}return r.memoizedState=[s,a],s}function ai(n,a,r){return r===void 0||(hn&1073741824)!==0?n.memoizedState=a:(n.memoizedState=r,n=Jp(),he.lanes|=n,wn|=n,r)}function Ql(n,a,r,s){return gt(r,a)?r:ga.current!==null?(n=ai(n,r,s),gt(n,a)||(Ze=!0),n):(hn&42)===0?(Ze=!0,n.memoizedState=r):(n=Jp(),he.lanes|=n,wn|=n,a)}function Kl(n,a,r,s,c){var p=Z.p;Z.p=p!==0&&8>p?p:8;var f=z.T,y={};z.T=y,si(n,!1,a,r);try{var A=c(),T=z.S;if(T!==null&&T(y,A),A!==null&&typeof A=="object"&&typeof A.then=="function"){var q=pf(A,s);po(n,a,q,wt(n))}else po(n,a,s,wt(n))}catch(G){po(n,a,{then:function(){},status:"rejected",reason:G},wt())}finally{Z.p=p,z.T=f}}function mf(){}function oi(n,a,r,s){if(n.tag!==5)throw Error(l(476));var c=Jl(n).queue;Kl(n,c,a,L,r===null?mf:function(){return Il(n),r(s)})}function Jl(n){var a=n.memoizedState;if(a!==null)return a;a={memoizedState:L,baseState:L,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:It,lastRenderedState:L},next:null};var r={};return a.next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:It,lastRenderedState:r},next:null},n.memoizedState=a,n=n.alternate,n!==null&&(n.memoizedState=a),a}function Il(n){var a=Jl(n).next.queue;po(n,a,{},wt())}function ri(){return ot(To)}function Pl(){return He().memoizedState}function Wl(){return He().memoizedState}function gf(n){for(var a=n.return;a!==null;){switch(a.tag){case 24:case 3:var r=wt();n=dn(r);var s=fn(a,n,r);s!==null&&(At(s,a,r),oo(s,a,r)),a={cache:Ls()},n.payload=a;return}a=a.return}}function xf(n,a,r){var s=wt();r={lane:s,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null},hr(n)?tp(a,r):(r=Os(n,a,r,s),r!==null&&(At(r,n,s),np(r,a,s)))}function ep(n,a,r){var s=wt();po(n,a,r,s)}function po(n,a,r,s){var c={lane:s,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null};if(hr(n))tp(a,c);else{var p=n.alternate;if(n.lanes===0&&(p===null||p.lanes===0)&&(p=a.lastRenderedReducer,p!==null))try{var f=a.lastRenderedState,y=p(f,r);if(c.hasEagerState=!0,c.eagerState=y,gt(y,f))return Ko(n,a,c,0),ke===null&&Qo(),!1}catch{}finally{}if(r=Os(n,a,c,s),r!==null)return At(r,n,s),np(r,a,s),!0}return!1}function si(n,a,r,s){if(s={lane:2,revertLane:$i(),action:s,hasEagerState:!1,eagerState:null,next:null},hr(n)){if(a)throw Error(l(479))}else a=Os(n,r,s,2),a!==null&&At(a,n,2)}function hr(n){var a=n.alternate;return n===he||a!==null&&a===he}function tp(n,a){xa=ir=!0;var r=n.pending;r===null?a.next=a:(a.next=r.next,r.next=a),n.pending=a}function np(n,a,r){if((r&4194048)!==0){var s=a.lanes;s&=n.pendingLanes,r|=s,a.lanes=r,pc(n,r)}}var mr={readContext:ot,use:pr,useCallback:Ue,useContext:Ue,useEffect:Ue,useImperativeHandle:Ue,useLayoutEffect:Ue,useInsertionEffect:Ue,useMemo:Ue,useReducer:Ue,useRef:Ue,useState:Ue,useDebugValue:Ue,useDeferredValue:Ue,useTransition:Ue,useSyncExternalStore:Ue,useId:Ue,useHostTransitionStatus:Ue,useFormState:Ue,useActionState:Ue,useOptimistic:Ue,useMemoCache:Ue,useCacheRefresh:Ue},ap={readContext:ot,use:pr,useCallback:function(n,a){return ct().memoizedState=[n,a===void 0?null:a],n},useContext:ot,useEffect:Ul,useImperativeHandle:function(n,a,r){r=r!=null?r.concat([n]):null,fr(4194308,4,Fl.bind(null,a,n),r)},useLayoutEffect:function(n,a){return fr(4194308,4,n,a)},useInsertionEffect:function(n,a){fr(4,2,n,a)},useMemo:function(n,a){var r=ct();a=a===void 0?null:a;var s=n();if(Fn){rn(!0);try{n()}finally{rn(!1)}}return r.memoizedState=[s,a],s},useReducer:function(n,a,r){var s=ct();if(r!==void 0){var c=r(a);if(Fn){rn(!0);try{r(a)}finally{rn(!1)}}}else c=a;return s.memoizedState=s.baseState=c,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:c},s.queue=n,n=n.dispatch=xf.bind(null,he,n),[s.memoizedState,n]},useRef:function(n){var a=ct();return n={current:n},a.memoizedState=n},useState:function(n){n=ei(n);var a=n.queue,r=ep.bind(null,he,a);return a.dispatch=r,[n.memoizedState,r]},useDebugValue:ni,useDeferredValue:function(n,a){var r=ct();return ai(r,n,a)},useTransition:function(){var n=ei(!1);return n=Kl.bind(null,he,n.queue,!0,!1),ct().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,a,r){var s=he,c=ct();if(Se){if(r===void 0)throw Error(l(407));r=r()}else{if(r=a(),ke===null)throw Error(l(349));(be&124)!==0||El(s,a,r)}c.memoizedState=r;var p={value:r,getSnapshot:a};return c.queue=p,Ul(jl.bind(null,s,p,n),[n]),s.flags|=2048,ba(9,dr(),Ol.bind(null,s,p,r,a),null),r},useId:function(){var n=ct(),a=ke.identifierPrefix;if(Se){var r=Qt,s=Zt;r=(s&~(1<<32-ft(s)-1)).toString(32)+r,a=""+a+"R"+r,r=lr++,0<r&&(a+="H"+r.toString(32)),a+=""}else r=uf++,a=""+a+"r"+r.toString(32)+"";return n.memoizedState=a},useHostTransitionStatus:ri,useFormState:Ll,useActionState:Ll,useOptimistic:function(n){var a=ct();a.memoizedState=a.baseState=n;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=r,a=si.bind(null,he,!0,r),r.dispatch=a,[n,a]},useMemoCache:Is,useCacheRefresh:function(){return ct().memoizedState=gf.bind(null,he)}},op={readContext:ot,use:pr,useCallback:Vl,useContext:ot,useEffect:Gl,useImperativeHandle:Xl,useInsertionEffect:Yl,useLayoutEffect:Hl,useMemo:Zl,useReducer:ur,useRef:Bl,useState:function(){return ur(It)},useDebugValue:ni,useDeferredValue:function(n,a){var r=He();return Ql(r,Te.memoizedState,n,a)},useTransition:function(){var n=ur(It)[0],a=He().memoizedState;return[typeof n=="boolean"?n:co(n),a]},useSyncExternalStore:Sl,useId:Pl,useHostTransitionStatus:ri,useFormState:Nl,useActionState:Nl,useOptimistic:function(n,a){var r=He();return Tl(r,Te,n,a)},useMemoCache:Is,useCacheRefresh:Wl},yf={readContext:ot,use:pr,useCallback:Vl,useContext:ot,useEffect:Gl,useImperativeHandle:Xl,useInsertionEffect:Yl,useLayoutEffect:Hl,useMemo:Zl,useReducer:Ws,useRef:Bl,useState:function(){return Ws(It)},useDebugValue:ni,useDeferredValue:function(n,a){var r=He();return Te===null?ai(r,n,a):Ql(r,Te.memoizedState,n,a)},useTransition:function(){var n=Ws(It)[0],a=He().memoizedState;return[typeof n=="boolean"?n:co(n),a]},useSyncExternalStore:Sl,useId:Pl,useHostTransitionStatus:ri,useFormState:$l,useActionState:$l,useOptimistic:function(n,a){var r=He();return Te!==null?Tl(r,Te,n,a):(r.baseState=n,[n,r.queue.dispatch])},useMemoCache:Is,useCacheRefresh:Wl},va=null,uo=0;function gr(n){var a=uo;return uo+=1,va===null&&(va=[]),ml(va,n,a)}function fo(n,a){a=a.props.ref,n.ref=a!==void 0?a:null}function xr(n,a){throw a.$$typeof===w?Error(l(525)):(n=Object.prototype.toString.call(a),Error(l(31,n==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":n)))}function rp(n){var a=n._init;return a(n._payload)}function sp(n){function a(j,E){if(n){var _=j.deletions;_===null?(j.deletions=[E],j.flags|=16):_.push(E)}}function r(j,E){if(!n)return null;for(;E!==null;)a(j,E),E=E.sibling;return null}function s(j){for(var E=new Map;j!==null;)j.key!==null?E.set(j.key,j):E.set(j.index,j),j=j.sibling;return E}function c(j,E){return j=Vt(j,E),j.index=0,j.sibling=null,j}function p(j,E,_){return j.index=_,n?(_=j.alternate,_!==null?(_=_.index,_<E?(j.flags|=67108866,E):_):(j.flags|=67108866,E)):(j.flags|=1048576,E)}function f(j){return n&&j.alternate===null&&(j.flags|=67108866),j}function y(j,E,_,B){return E===null||E.tag!==6?(E=Ds(_,j.mode,B),E.return=j,E):(E=c(E,_),E.return=j,E)}function A(j,E,_,B){var oe=_.type;return oe===k?q(j,E,_.props.children,B,_.key):E!==null&&(E.elementType===oe||typeof oe=="object"&&oe!==null&&oe.$$typeof===ee&&rp(oe)===E.type)?(E=c(E,_.props),fo(E,_),E.return=j,E):(E=Io(_.type,_.key,_.props,null,j.mode,B),fo(E,_),E.return=j,E)}function T(j,E,_,B){return E===null||E.tag!==4||E.stateNode.containerInfo!==_.containerInfo||E.stateNode.implementation!==_.implementation?(E=_s(_,j.mode,B),E.return=j,E):(E=c(E,_.children||[]),E.return=j,E)}function q(j,E,_,B,oe){return E===null||E.tag!==7?(E=Nn(_,j.mode,B,oe),E.return=j,E):(E=c(E,_),E.return=j,E)}function G(j,E,_){if(typeof E=="string"&&E!==""||typeof E=="number"||typeof E=="bigint")return E=Ds(""+E,j.mode,_),E.return=j,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case D:return _=Io(E.type,E.key,E.props,null,j.mode,_),fo(_,E),_.return=j,_;case O:return E=_s(E,j.mode,_),E.return=j,E;case ee:var B=E._init;return E=B(E._payload),G(j,E,_)}if(ce(E)||K(E))return E=Nn(E,j.mode,_,null),E.return=j,E;if(typeof E.then=="function")return G(j,gr(E),_);if(E.$$typeof===Y)return G(j,tr(j,E),_);xr(j,E)}return null}function M(j,E,_,B){var oe=E!==null?E.key:null;if(typeof _=="string"&&_!==""||typeof _=="number"||typeof _=="bigint")return oe!==null?null:y(j,E,""+_,B);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case D:return _.key===oe?A(j,E,_,B):null;case O:return _.key===oe?T(j,E,_,B):null;case ee:return oe=_._init,_=oe(_._payload),M(j,E,_,B)}if(ce(_)||K(_))return oe!==null?null:q(j,E,_,B,null);if(typeof _.then=="function")return M(j,E,gr(_),B);if(_.$$typeof===Y)return M(j,E,tr(j,_),B);xr(j,_)}return null}function R(j,E,_,B,oe){if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return j=j.get(_)||null,y(E,j,""+B,oe);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case D:return j=j.get(B.key===null?_:B.key)||null,A(E,j,B,oe);case O:return j=j.get(B.key===null?_:B.key)||null,T(E,j,B,oe);case ee:var ge=B._init;return B=ge(B._payload),R(j,E,_,B,oe)}if(ce(B)||K(B))return j=j.get(_)||null,q(E,j,B,oe,null);if(typeof B.then=="function")return R(j,E,_,gr(B),oe);if(B.$$typeof===Y)return R(j,E,_,tr(E,B),oe);xr(E,B)}return null}function de(j,E,_,B){for(var oe=null,ge=null,ie=E,ue=E=0,Ke=null;ie!==null&&ue<_.length;ue++){ie.index>ue?(Ke=ie,ie=null):Ke=ie.sibling;var we=M(j,ie,_[ue],B);if(we===null){ie===null&&(ie=Ke);break}n&&ie&&we.alternate===null&&a(j,ie),E=p(we,E,ue),ge===null?oe=we:ge.sibling=we,ge=we,ie=Ke}if(ue===_.length)return r(j,ie),Se&&$n(j,ue),oe;if(ie===null){for(;ue<_.length;ue++)ie=G(j,_[ue],B),ie!==null&&(E=p(ie,E,ue),ge===null?oe=ie:ge.sibling=ie,ge=ie);return Se&&$n(j,ue),oe}for(ie=s(ie);ue<_.length;ue++)Ke=R(ie,j,ue,_[ue],B),Ke!==null&&(n&&Ke.alternate!==null&&ie.delete(Ke.key===null?ue:Ke.key),E=p(Ke,E,ue),ge===null?oe=Ke:ge.sibling=Ke,ge=Ke);return n&&ie.forEach(function(Mn){return a(j,Mn)}),Se&&$n(j,ue),oe}function pe(j,E,_,B){if(_==null)throw Error(l(151));for(var oe=null,ge=null,ie=E,ue=E=0,Ke=null,we=_.next();ie!==null&&!we.done;ue++,we=_.next()){ie.index>ue?(Ke=ie,ie=null):Ke=ie.sibling;var Mn=M(j,ie,we.value,B);if(Mn===null){ie===null&&(ie=Ke);break}n&&ie&&Mn.alternate===null&&a(j,ie),E=p(Mn,E,ue),ge===null?oe=Mn:ge.sibling=Mn,ge=Mn,ie=Ke}if(we.done)return r(j,ie),Se&&$n(j,ue),oe;if(ie===null){for(;!we.done;ue++,we=_.next())we=G(j,we.value,B),we!==null&&(E=p(we,E,ue),ge===null?oe=we:ge.sibling=we,ge=we);return Se&&$n(j,ue),oe}for(ie=s(ie);!we.done;ue++,we=_.next())we=R(ie,j,ue,we.value,B),we!==null&&(n&&we.alternate!==null&&ie.delete(we.key===null?ue:we.key),E=p(we,E,ue),ge===null?oe=we:ge.sibling=we,ge=we);return n&&ie.forEach(function(vh){return a(j,vh)}),Se&&$n(j,ue),oe}function ze(j,E,_,B){if(typeof _=="object"&&_!==null&&_.type===k&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case D:e:{for(var oe=_.key;E!==null;){if(E.key===oe){if(oe=_.type,oe===k){if(E.tag===7){r(j,E.sibling),B=c(E,_.props.children),B.return=j,j=B;break e}}else if(E.elementType===oe||typeof oe=="object"&&oe!==null&&oe.$$typeof===ee&&rp(oe)===E.type){r(j,E.sibling),B=c(E,_.props),fo(B,_),B.return=j,j=B;break e}r(j,E);break}else a(j,E);E=E.sibling}_.type===k?(B=Nn(_.props.children,j.mode,B,_.key),B.return=j,j=B):(B=Io(_.type,_.key,_.props,null,j.mode,B),fo(B,_),B.return=j,j=B)}return f(j);case O:e:{for(oe=_.key;E!==null;){if(E.key===oe)if(E.tag===4&&E.stateNode.containerInfo===_.containerInfo&&E.stateNode.implementation===_.implementation){r(j,E.sibling),B=c(E,_.children||[]),B.return=j,j=B;break e}else{r(j,E);break}else a(j,E);E=E.sibling}B=_s(_,j.mode,B),B.return=j,j=B}return f(j);case ee:return oe=_._init,_=oe(_._payload),ze(j,E,_,B)}if(ce(_))return de(j,E,_,B);if(K(_)){if(oe=K(_),typeof oe!="function")throw Error(l(150));return _=oe.call(_),pe(j,E,_,B)}if(typeof _.then=="function")return ze(j,E,gr(_),B);if(_.$$typeof===Y)return ze(j,E,tr(j,_),B);xr(j,_)}return typeof _=="string"&&_!==""||typeof _=="number"||typeof _=="bigint"?(_=""+_,E!==null&&E.tag===6?(r(j,E.sibling),B=c(E,_),B.return=j,j=B):(r(j,E),B=Ds(_,j.mode,B),B.return=j,j=B),f(j)):r(j,E)}return function(j,E,_,B){try{uo=0;var oe=ze(j,E,_,B);return va=null,oe}catch(ie){if(ie===no||ie===ar)throw ie;var ge=xt(29,ie,null,j.mode);return ge.lanes=B,ge.return=j,ge}finally{}}}var wa=sp(!0),ip=sp(!1),Tt=$(null),Ut=null;function mn(n){var a=n.alternate;X(Xe,Xe.current&1),X(Tt,n),Ut===null&&(a===null||ga.current!==null||a.memoizedState!==null)&&(Ut=n)}function cp(n){if(n.tag===22){if(X(Xe,Xe.current),X(Tt,n),Ut===null){var a=n.alternate;a!==null&&a.memoizedState!==null&&(Ut=n)}}else gn()}function gn(){X(Xe,Xe.current),X(Tt,Tt.current)}function Pt(n){J(Tt),Ut===n&&(Ut=null),J(Xe)}var Xe=$(0);function yr(n){for(var a=n;a!==null;){if(a.tag===13){var r=a.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||Ji(r)))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===n)break;for(;a.sibling===null;){if(a.return===null||a.return===n)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}function ii(n,a,r,s){a=n.memoizedState,r=r(s,a),r=r==null?a:v({},a,r),n.memoizedState=r,n.lanes===0&&(n.updateQueue.baseState=r)}var ci={enqueueSetState:function(n,a,r){n=n._reactInternals;var s=wt(),c=dn(s);c.payload=a,r!=null&&(c.callback=r),a=fn(n,c,s),a!==null&&(At(a,n,s),oo(a,n,s))},enqueueReplaceState:function(n,a,r){n=n._reactInternals;var s=wt(),c=dn(s);c.tag=1,c.payload=a,r!=null&&(c.callback=r),a=fn(n,c,s),a!==null&&(At(a,n,s),oo(a,n,s))},enqueueForceUpdate:function(n,a){n=n._reactInternals;var r=wt(),s=dn(r);s.tag=2,a!=null&&(s.callback=a),a=fn(n,s,r),a!==null&&(At(a,n,r),oo(a,n,r))}};function lp(n,a,r,s,c,p,f){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(s,p,f):a.prototype&&a.prototype.isPureReactComponent?!Qa(r,s)||!Qa(c,p):!0}function pp(n,a,r,s){n=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(r,s),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(r,s),a.state!==n&&ci.enqueueReplaceState(a,a.state,null)}function Xn(n,a){var r=a;if("ref"in a){r={};for(var s in a)s!=="ref"&&(r[s]=a[s])}if(n=n.defaultProps){r===a&&(r=v({},r));for(var c in n)r[c]===void 0&&(r[c]=n[c])}return r}var br=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)};function up(n){br(n)}function dp(n){console.error(n)}function fp(n){br(n)}function vr(n,a){try{var r=n.onUncaughtError;r(a.value,{componentStack:a.stack})}catch(s){setTimeout(function(){throw s})}}function hp(n,a,r){try{var s=n.onCaughtError;s(r.value,{componentStack:r.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function li(n,a,r){return r=dn(r),r.tag=3,r.payload={element:null},r.callback=function(){vr(n,a)},r}function mp(n){return n=dn(n),n.tag=3,n}function gp(n,a,r,s){var c=r.type.getDerivedStateFromError;if(typeof c=="function"){var p=s.value;n.payload=function(){return c(p)},n.callback=function(){hp(a,r,s)}}var f=r.stateNode;f!==null&&typeof f.componentDidCatch=="function"&&(n.callback=function(){hp(a,r,s),typeof c!="function"&&(An===null?An=new Set([this]):An.add(this));var y=s.stack;this.componentDidCatch(s.value,{componentStack:y!==null?y:""})})}function bf(n,a,r,s,c){if(r.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){if(a=r.alternate,a!==null&&Wa(a,r,c,!0),r=Tt.current,r!==null){switch(r.tag){case 13:return Ut===null?Ci():r.alternate===null&&Be===0&&(Be=3),r.flags&=-257,r.flags|=65536,r.lanes=c,s===$s?r.flags|=16384:(a=r.updateQueue,a===null?r.updateQueue=new Set([s]):a.add(s),Li(n,s,c)),!1;case 22:return r.flags|=65536,s===$s?r.flags|=16384:(a=r.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([s])},r.updateQueue=a):(r=a.retryQueue,r===null?a.retryQueue=new Set([s]):r.add(s)),Li(n,s,c)),!1}throw Error(l(435,r.tag))}return Li(n,s,c),Ci(),!1}if(Se)return a=Tt.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=c,s!==zs&&(n=Error(l(422),{cause:s}),Pa(Ot(n,r)))):(s!==zs&&(a=Error(l(423),{cause:s}),Pa(Ot(a,r))),n=n.current.alternate,n.flags|=65536,c&=-c,n.lanes|=c,s=Ot(s,r),c=li(n.stateNode,s,c),Gs(n,c),Be!==4&&(Be=2)),!1;var p=Error(l(520),{cause:s});if(p=Ot(p,r),vo===null?vo=[p]:vo.push(p),Be!==4&&(Be=2),a===null)return!0;s=Ot(s,r),r=a;do{switch(r.tag){case 3:return r.flags|=65536,n=c&-c,r.lanes|=n,n=li(r.stateNode,s,n),Gs(r,n),!1;case 1:if(a=r.type,p=r.stateNode,(r.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&(An===null||!An.has(p))))return r.flags|=65536,c&=-c,r.lanes|=c,c=mp(c),gp(c,n,r,s),Gs(r,c),!1}r=r.return}while(r!==null);return!1}var xp=Error(l(461)),Ze=!1;function Ie(n,a,r,s){a.child=n===null?ip(a,null,r,s):wa(a,n.child,r,s)}function yp(n,a,r,s,c){r=r.render;var p=a.ref;if("ref"in s){var f={};for(var y in s)y!=="ref"&&(f[y]=s[y])}else f=s;return Yn(a),s=Vs(n,a,r,f,p,c),y=Zs(),n!==null&&!Ze?(Qs(n,a,c),Wt(n,a,c)):(Se&&y&&Ts(a),a.flags|=1,Ie(n,a,s,c),a.child)}function bp(n,a,r,s,c){if(n===null){var p=r.type;return typeof p=="function"&&!js(p)&&p.defaultProps===void 0&&r.compare===null?(a.tag=15,a.type=p,vp(n,a,p,s,c)):(n=Io(r.type,null,s,a,a.mode,c),n.ref=a.ref,n.return=a,a.child=n)}if(p=n.child,!xi(n,c)){var f=p.memoizedProps;if(r=r.compare,r=r!==null?r:Qa,r(f,s)&&n.ref===a.ref)return Wt(n,a,c)}return a.flags|=1,n=Vt(p,s),n.ref=a.ref,n.return=a,a.child=n}function vp(n,a,r,s,c){if(n!==null){var p=n.memoizedProps;if(Qa(p,s)&&n.ref===a.ref)if(Ze=!1,a.pendingProps=s=p,xi(n,c))(n.flags&131072)!==0&&(Ze=!0);else return a.lanes=n.lanes,Wt(n,a,c)}return pi(n,a,r,s,c)}function wp(n,a,r){var s=a.pendingProps,c=s.children,p=n!==null?n.memoizedState:null;if(s.mode==="hidden"){if((a.flags&128)!==0){if(s=p!==null?p.baseLanes|r:r,n!==null){for(c=a.child=n.child,p=0;c!==null;)p=p|c.lanes|c.childLanes,c=c.sibling;a.childLanes=p&~s}else a.childLanes=0,a.child=null;return Ap(n,a,s,r)}if((r&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},n!==null&&nr(a,p!==null?p.cachePool:null),p!==null?vl(a,p):Hs(),cp(a);else return a.lanes=a.childLanes=536870912,Ap(n,a,p!==null?p.baseLanes|r:r,r)}else p!==null?(nr(a,p.cachePool),vl(a,p),gn(),a.memoizedState=null):(n!==null&&nr(a,null),Hs(),gn());return Ie(n,a,c,r),a.child}function Ap(n,a,r,s){var c=qs();return c=c===null?null:{parent:Fe._currentValue,pool:c},a.memoizedState={baseLanes:r,cachePool:c},n!==null&&nr(a,null),Hs(),cp(a),n!==null&&Wa(n,a,s,!0),null}function wr(n,a){var r=a.ref;if(r===null)n!==null&&n.ref!==null&&(a.flags|=4194816);else{if(typeof r!="function"&&typeof r!="object")throw Error(l(284));(n===null||n.ref!==r)&&(a.flags|=4194816)}}function pi(n,a,r,s,c){return Yn(a),r=Vs(n,a,r,s,void 0,c),s=Zs(),n!==null&&!Ze?(Qs(n,a,c),Wt(n,a,c)):(Se&&s&&Ts(a),a.flags|=1,Ie(n,a,r,c),a.child)}function Sp(n,a,r,s,c,p){return Yn(a),a.updateQueue=null,r=Al(a,s,r,c),wl(n),s=Zs(),n!==null&&!Ze?(Qs(n,a,p),Wt(n,a,p)):(Se&&s&&Ts(a),a.flags|=1,Ie(n,a,r,p),a.child)}function Ep(n,a,r,s,c){if(Yn(a),a.stateNode===null){var p=ua,f=r.contextType;typeof f=="object"&&f!==null&&(p=ot(f)),p=new r(s,p),a.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=ci,a.stateNode=p,p._reactInternals=a,p=a.stateNode,p.props=s,p.state=a.memoizedState,p.refs={},Bs(a),f=r.contextType,p.context=typeof f=="object"&&f!==null?ot(f):ua,p.state=a.memoizedState,f=r.getDerivedStateFromProps,typeof f=="function"&&(ii(a,r,f,s),p.state=a.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(f=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),f!==p.state&&ci.enqueueReplaceState(p,p.state,null),so(a,s,p,c),ro(),p.state=a.memoizedState),typeof p.componentDidMount=="function"&&(a.flags|=4194308),s=!0}else if(n===null){p=a.stateNode;var y=a.memoizedProps,A=Xn(r,y);p.props=A;var T=p.context,q=r.contextType;f=ua,typeof q=="object"&&q!==null&&(f=ot(q));var G=r.getDerivedStateFromProps;q=typeof G=="function"||typeof p.getSnapshotBeforeUpdate=="function",y=a.pendingProps!==y,q||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(y||T!==f)&&pp(a,p,s,f),un=!1;var M=a.memoizedState;p.state=M,so(a,s,p,c),ro(),T=a.memoizedState,y||M!==T||un?(typeof G=="function"&&(ii(a,r,G,s),T=a.memoizedState),(A=un||lp(a,r,A,s,M,T,f))?(q||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(a.flags|=4194308)):(typeof p.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=s,a.memoizedState=T),p.props=s,p.state=T,p.context=f,s=A):(typeof p.componentDidMount=="function"&&(a.flags|=4194308),s=!1)}else{p=a.stateNode,Us(n,a),f=a.memoizedProps,q=Xn(r,f),p.props=q,G=a.pendingProps,M=p.context,T=r.contextType,A=ua,typeof T=="object"&&T!==null&&(A=ot(T)),y=r.getDerivedStateFromProps,(T=typeof y=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(f!==G||M!==A)&&pp(a,p,s,A),un=!1,M=a.memoizedState,p.state=M,so(a,s,p,c),ro();var R=a.memoizedState;f!==G||M!==R||un||n!==null&&n.dependencies!==null&&er(n.dependencies)?(typeof y=="function"&&(ii(a,r,y,s),R=a.memoizedState),(q=un||lp(a,r,q,s,M,R,A)||n!==null&&n.dependencies!==null&&er(n.dependencies))?(T||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(s,R,A),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(s,R,A)),typeof p.componentDidUpdate=="function"&&(a.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof p.componentDidUpdate!="function"||f===n.memoizedProps&&M===n.memoizedState||(a.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||f===n.memoizedProps&&M===n.memoizedState||(a.flags|=1024),a.memoizedProps=s,a.memoizedState=R),p.props=s,p.state=R,p.context=A,s=q):(typeof p.componentDidUpdate!="function"||f===n.memoizedProps&&M===n.memoizedState||(a.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||f===n.memoizedProps&&M===n.memoizedState||(a.flags|=1024),s=!1)}return p=s,wr(n,a),s=(a.flags&128)!==0,p||s?(p=a.stateNode,r=s&&typeof r.getDerivedStateFromError!="function"?null:p.render(),a.flags|=1,n!==null&&s?(a.child=wa(a,n.child,null,c),a.child=wa(a,null,r,c)):Ie(n,a,r,c),a.memoizedState=p.state,n=a.child):n=Wt(n,a,c),n}function Op(n,a,r,s){return Ia(),a.flags|=256,Ie(n,a,r,s),a.child}var ui={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function di(n){return{baseLanes:n,cachePool:dl()}}function fi(n,a,r){return n=n!==null?n.childLanes&~r:0,a&&(n|=Mt),n}function jp(n,a,r){var s=a.pendingProps,c=!1,p=(a.flags&128)!==0,f;if((f=p)||(f=n!==null&&n.memoizedState===null?!1:(Xe.current&2)!==0),f&&(c=!0,a.flags&=-129),f=(a.flags&32)!==0,a.flags&=-33,n===null){if(Se){if(c?mn(a):gn(),Se){var y=$e,A;if(A=y){e:{for(A=y,y=Bt;A.nodeType!==8;){if(!y){y=null;break e}if(A=qt(A.nextSibling),A===null){y=null;break e}}y=A}y!==null?(a.memoizedState={dehydrated:y,treeContext:qn!==null?{id:Zt,overflow:Qt}:null,retryLane:536870912,hydrationErrors:null},A=xt(18,null,null,0),A.stateNode=y,A.return=a,a.child=A,rt=a,$e=null,A=!0):A=!1}A||Un(a)}if(y=a.memoizedState,y!==null&&(y=y.dehydrated,y!==null))return Ji(y)?a.lanes=32:a.lanes=536870912,null;Pt(a)}return y=s.children,s=s.fallback,c?(gn(),c=a.mode,y=Ar({mode:"hidden",children:y},c),s=Nn(s,c,r,null),y.return=a,s.return=a,y.sibling=s,a.child=y,c=a.child,c.memoizedState=di(r),c.childLanes=fi(n,f,r),a.memoizedState=ui,s):(mn(a),hi(a,y))}if(A=n.memoizedState,A!==null&&(y=A.dehydrated,y!==null)){if(p)a.flags&256?(mn(a),a.flags&=-257,a=mi(n,a,r)):a.memoizedState!==null?(gn(),a.child=n.child,a.flags|=128,a=null):(gn(),c=s.fallback,y=a.mode,s=Ar({mode:"visible",children:s.children},y),c=Nn(c,y,r,null),c.flags|=2,s.return=a,c.return=a,s.sibling=c,a.child=s,wa(a,n.child,null,r),s=a.child,s.memoizedState=di(r),s.childLanes=fi(n,f,r),a.memoizedState=ui,a=c);else if(mn(a),Ji(y)){if(f=y.nextSibling&&y.nextSibling.dataset,f)var T=f.dgst;f=T,s=Error(l(419)),s.stack="",s.digest=f,Pa({value:s,source:null,stack:null}),a=mi(n,a,r)}else if(Ze||Wa(n,a,r,!1),f=(r&n.childLanes)!==0,Ze||f){if(f=ke,f!==null&&(s=r&-r,s=(s&42)!==0?1:Jr(s),s=(s&(f.suspendedLanes|r))!==0?0:s,s!==0&&s!==A.retryLane))throw A.retryLane=s,pa(n,s),At(f,n,s),xp;y.data==="$?"||Ci(),a=mi(n,a,r)}else y.data==="$?"?(a.flags|=192,a.child=n.child,a=null):(n=A.treeContext,$e=qt(y.nextSibling),rt=a,Se=!0,Bn=null,Bt=!1,n!==null&&(Dt[_t++]=Zt,Dt[_t++]=Qt,Dt[_t++]=qn,Zt=n.id,Qt=n.overflow,qn=a),a=hi(a,s.children),a.flags|=4096);return a}return c?(gn(),c=s.fallback,y=a.mode,A=n.child,T=A.sibling,s=Vt(A,{mode:"hidden",children:s.children}),s.subtreeFlags=A.subtreeFlags&65011712,T!==null?c=Vt(T,c):(c=Nn(c,y,r,null),c.flags|=2),c.return=a,s.return=a,s.sibling=c,a.child=s,s=c,c=a.child,y=n.child.memoizedState,y===null?y=di(r):(A=y.cachePool,A!==null?(T=Fe._currentValue,A=A.parent!==T?{parent:T,pool:T}:A):A=dl(),y={baseLanes:y.baseLanes|r,cachePool:A}),c.memoizedState=y,c.childLanes=fi(n,f,r),a.memoizedState=ui,s):(mn(a),r=n.child,n=r.sibling,r=Vt(r,{mode:"visible",children:s.children}),r.return=a,r.sibling=null,n!==null&&(f=a.deletions,f===null?(a.deletions=[n],a.flags|=16):f.push(n)),a.child=r,a.memoizedState=null,r)}function hi(n,a){return a=Ar({mode:"visible",children:a},n.mode),a.return=n,n.child=a}function Ar(n,a){return n=xt(22,n,null,a),n.lanes=0,n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},n}function mi(n,a,r){return wa(a,n.child,null,r),n=hi(a,a.pendingProps.children),n.flags|=2,a.memoizedState=null,n}function Dp(n,a,r){n.lanes|=a;var s=n.alternate;s!==null&&(s.lanes|=a),Cs(n.return,a,r)}function gi(n,a,r,s,c){var p=n.memoizedState;p===null?n.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:s,tail:r,tailMode:c}:(p.isBackwards=a,p.rendering=null,p.renderingStartTime=0,p.last=s,p.tail=r,p.tailMode=c)}function _p(n,a,r){var s=a.pendingProps,c=s.revealOrder,p=s.tail;if(Ie(n,a,s.children,r),s=Xe.current,(s&2)!==0)s=s&1|2,a.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=a.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Dp(n,r,a);else if(n.tag===19)Dp(n,r,a);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===a)break e;for(;n.sibling===null;){if(n.return===null||n.return===a)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}s&=1}switch(X(Xe,s),c){case"forwards":for(r=a.child,c=null;r!==null;)n=r.alternate,n!==null&&yr(n)===null&&(c=r),r=r.sibling;r=c,r===null?(c=a.child,a.child=null):(c=r.sibling,r.sibling=null),gi(a,!1,c,r,p);break;case"backwards":for(r=null,c=a.child,a.child=null;c!==null;){if(n=c.alternate,n!==null&&yr(n)===null){a.child=c;break}n=c.sibling,c.sibling=r,r=c,c=n}gi(a,!0,r,null,p);break;case"together":gi(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Wt(n,a,r){if(n!==null&&(a.dependencies=n.dependencies),wn|=a.lanes,(r&a.childLanes)===0)if(n!==null){if(Wa(n,a,r,!1),(r&a.childLanes)===0)return null}else return null;if(n!==null&&a.child!==n.child)throw Error(l(153));if(a.child!==null){for(n=a.child,r=Vt(n,n.pendingProps),a.child=r,r.return=a;n.sibling!==null;)n=n.sibling,r=r.sibling=Vt(n,n.pendingProps),r.return=a;r.sibling=null}return a.child}function xi(n,a){return(n.lanes&a)!==0?!0:(n=n.dependencies,!!(n!==null&&er(n)))}function vf(n,a,r){switch(a.tag){case 3:ve(a,a.stateNode.containerInfo),pn(a,Fe,n.memoizedState.cache),Ia();break;case 27:case 5:_e(a);break;case 4:ve(a,a.stateNode.containerInfo);break;case 10:pn(a,a.type,a.memoizedProps.value);break;case 13:var s=a.memoizedState;if(s!==null)return s.dehydrated!==null?(mn(a),a.flags|=128,null):(r&a.child.childLanes)!==0?jp(n,a,r):(mn(a),n=Wt(n,a,r),n!==null?n.sibling:null);mn(a);break;case 19:var c=(n.flags&128)!==0;if(s=(r&a.childLanes)!==0,s||(Wa(n,a,r,!1),s=(r&a.childLanes)!==0),c){if(s)return _p(n,a,r);a.flags|=128}if(c=a.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),X(Xe,Xe.current),s)break;return null;case 22:case 23:return a.lanes=0,wp(n,a,r);case 24:pn(a,Fe,n.memoizedState.cache)}return Wt(n,a,r)}function Tp(n,a,r){if(n!==null)if(n.memoizedProps!==a.pendingProps)Ze=!0;else{if(!xi(n,r)&&(a.flags&128)===0)return Ze=!1,vf(n,a,r);Ze=(n.flags&131072)!==0}else Ze=!1,Se&&(a.flags&1048576)!==0&&rl(a,Wo,a.index);switch(a.lanes=0,a.tag){case 16:e:{n=a.pendingProps;var s=a.elementType,c=s._init;if(s=c(s._payload),a.type=s,typeof s=="function")js(s)?(n=Xn(s,n),a.tag=1,a=Ep(null,a,s,n,r)):(a.tag=0,a=pi(null,a,s,n,r));else{if(s!=null){if(c=s.$$typeof,c===W){a.tag=11,a=yp(null,a,s,n,r);break e}else if(c===H){a.tag=14,a=bp(null,a,s,n,r);break e}}throw a=me(s)||s,Error(l(306,a,""))}}return a;case 0:return pi(n,a,a.type,a.pendingProps,r);case 1:return s=a.type,c=Xn(s,a.pendingProps),Ep(n,a,s,c,r);case 3:e:{if(ve(a,a.stateNode.containerInfo),n===null)throw Error(l(387));s=a.pendingProps;var p=a.memoizedState;c=p.element,Us(n,a),so(a,s,null,r);var f=a.memoizedState;if(s=f.cache,pn(a,Fe,s),s!==p.cache&&ks(a,[Fe],r,!0),ro(),s=f.element,p.isDehydrated)if(p={element:s,isDehydrated:!1,cache:f.cache},a.updateQueue.baseState=p,a.memoizedState=p,a.flags&256){a=Op(n,a,s,r);break e}else if(s!==c){c=Ot(Error(l(424)),a),Pa(c),a=Op(n,a,s,r);break e}else{switch(n=a.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for($e=qt(n.firstChild),rt=a,Se=!0,Bn=null,Bt=!0,r=ip(a,null,s,r),a.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling}else{if(Ia(),s===c){a=Wt(n,a,r);break e}Ie(n,a,s,r)}a=a.child}return a;case 26:return wr(n,a),n===null?(r=Cu(a.type,null,a.pendingProps,null))?a.memoizedState=r:Se||(r=a.type,n=a.pendingProps,s=Nr(se.current).createElement(r),s[nt]=a,s[st]=n,We(s,r,n),Ve(s),a.stateNode=s):a.memoizedState=Cu(a.type,n.memoizedProps,a.pendingProps,n.memoizedState),null;case 27:return _e(a),n===null&&Se&&(s=a.stateNode=Mu(a.type,a.pendingProps,se.current),rt=a,Bt=!0,c=$e,On(a.type)?(Ii=c,$e=qt(s.firstChild)):$e=c),Ie(n,a,a.pendingProps.children,r),wr(n,a),n===null&&(a.flags|=4194304),a.child;case 5:return n===null&&Se&&((c=s=$e)&&(s=Qf(s,a.type,a.pendingProps,Bt),s!==null?(a.stateNode=s,rt=a,$e=qt(s.firstChild),Bt=!1,c=!0):c=!1),c||Un(a)),_e(a),c=a.type,p=a.pendingProps,f=n!==null?n.memoizedProps:null,s=p.children,Zi(c,p)?s=null:f!==null&&Zi(c,f)&&(a.flags|=32),a.memoizedState!==null&&(c=Vs(n,a,df,null,null,r),To._currentValue=c),wr(n,a),Ie(n,a,s,r),a.child;case 6:return n===null&&Se&&((n=r=$e)&&(r=Kf(r,a.pendingProps,Bt),r!==null?(a.stateNode=r,rt=a,$e=null,n=!0):n=!1),n||Un(a)),null;case 13:return jp(n,a,r);case 4:return ve(a,a.stateNode.containerInfo),s=a.pendingProps,n===null?a.child=wa(a,null,s,r):Ie(n,a,s,r),a.child;case 11:return yp(n,a,a.type,a.pendingProps,r);case 7:return Ie(n,a,a.pendingProps,r),a.child;case 8:return Ie(n,a,a.pendingProps.children,r),a.child;case 12:return Ie(n,a,a.pendingProps.children,r),a.child;case 10:return s=a.pendingProps,pn(a,a.type,s.value),Ie(n,a,s.children,r),a.child;case 9:return c=a.type._context,s=a.pendingProps.children,Yn(a),c=ot(c),s=s(c),a.flags|=1,Ie(n,a,s,r),a.child;case 14:return bp(n,a,a.type,a.pendingProps,r);case 15:return vp(n,a,a.type,a.pendingProps,r);case 19:return _p(n,a,r);case 31:return s=a.pendingProps,r=a.mode,s={mode:s.mode,children:s.children},n===null?(r=Ar(s,r),r.ref=a.ref,a.child=r,r.return=a,a=r):(r=Vt(n.child,s),r.ref=a.ref,a.child=r,r.return=a,a=r),a;case 22:return wp(n,a,r);case 24:return Yn(a),s=ot(Fe),n===null?(c=qs(),c===null&&(c=ke,p=Ls(),c.pooledCache=p,p.refCount++,p!==null&&(c.pooledCacheLanes|=r),c=p),a.memoizedState={parent:s,cache:c},Bs(a),pn(a,Fe,c)):((n.lanes&r)!==0&&(Us(n,a),so(a,null,null,r),ro()),c=n.memoizedState,p=a.memoizedState,c.parent!==s?(c={parent:s,cache:s},a.memoizedState=c,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=c),pn(a,Fe,s)):(s=p.cache,pn(a,Fe,s),s!==c.cache&&ks(a,[Fe],r,!0))),Ie(n,a,a.pendingProps.children,r),a.child;case 29:throw a.pendingProps}throw Error(l(156,a.tag))}function en(n){n.flags|=4}function Mp(n,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!$u(a)){if(a=Tt.current,a!==null&&((be&4194048)===be?Ut!==null:(be&62914560)!==be&&(be&536870912)===0||a!==Ut))throw ao=$s,fl;n.flags|=8192}}function Sr(n,a){a!==null&&(n.flags|=4),n.flags&16384&&(a=n.tag!==22?cc():536870912,n.lanes|=a,Oa|=a)}function ho(n,a){if(!Se)switch(n.tailMode){case"hidden":a=n.tail;for(var r=null;a!==null;)a.alternate!==null&&(r=a),a=a.sibling;r===null?n.tail=null:r.sibling=null;break;case"collapsed":r=n.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?a||n.tail===null?n.tail=null:n.tail.sibling=null:s.sibling=null}}function qe(n){var a=n.alternate!==null&&n.alternate.child===n.child,r=0,s=0;if(a)for(var c=n.child;c!==null;)r|=c.lanes|c.childLanes,s|=c.subtreeFlags&65011712,s|=c.flags&65011712,c.return=n,c=c.sibling;else for(c=n.child;c!==null;)r|=c.lanes|c.childLanes,s|=c.subtreeFlags,s|=c.flags,c.return=n,c=c.sibling;return n.subtreeFlags|=s,n.childLanes=r,a}function wf(n,a,r){var s=a.pendingProps;switch(Ms(a),a.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qe(a),null;case 1:return qe(a),null;case 3:return r=a.stateNode,s=null,n!==null&&(s=n.memoizedState.cache),a.memoizedState.cache!==s&&(a.flags|=2048),Jt(Fe),fe(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Ja(a)?en(a):n===null||n.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,cl())),qe(a),null;case 26:return r=a.memoizedState,n===null?(en(a),r!==null?(qe(a),Mp(a,r)):(qe(a),a.flags&=-16777217)):r?r!==n.memoizedState?(en(a),qe(a),Mp(a,r)):(qe(a),a.flags&=-16777217):(n.memoizedProps!==s&&en(a),qe(a),a.flags&=-16777217),null;case 27:Je(a),r=se.current;var c=a.type;if(n!==null&&a.stateNode!=null)n.memoizedProps!==s&&en(a);else{if(!s){if(a.stateNode===null)throw Error(l(166));return qe(a),null}n=re.current,Ja(a)?sl(a):(n=Mu(c,s,r),a.stateNode=n,en(a))}return qe(a),null;case 5:if(Je(a),r=a.type,n!==null&&a.stateNode!=null)n.memoizedProps!==s&&en(a);else{if(!s){if(a.stateNode===null)throw Error(l(166));return qe(a),null}if(n=re.current,Ja(a))sl(a);else{switch(c=Nr(se.current),n){case 1:n=c.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:n=c.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":n=c.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":n=c.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":n=c.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild);break;case"select":n=typeof s.is=="string"?c.createElement("select",{is:s.is}):c.createElement("select"),s.multiple?n.multiple=!0:s.size&&(n.size=s.size);break;default:n=typeof s.is=="string"?c.createElement(r,{is:s.is}):c.createElement(r)}}n[nt]=a,n[st]=s;e:for(c=a.child;c!==null;){if(c.tag===5||c.tag===6)n.appendChild(c.stateNode);else if(c.tag!==4&&c.tag!==27&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break e;for(;c.sibling===null;){if(c.return===null||c.return===a)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}a.stateNode=n;e:switch(We(n,r,s),r){case"button":case"input":case"select":case"textarea":n=!!s.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&en(a)}}return qe(a),a.flags&=-16777217,null;case 6:if(n&&a.stateNode!=null)n.memoizedProps!==s&&en(a);else{if(typeof s!="string"&&a.stateNode===null)throw Error(l(166));if(n=se.current,Ja(a)){if(n=a.stateNode,r=a.memoizedProps,s=null,c=rt,c!==null)switch(c.tag){case 27:case 5:s=c.memoizedProps}n[nt]=a,n=!!(n.nodeValue===r||s!==null&&s.suppressHydrationWarning===!0||Su(n.nodeValue,r)),n||Un(a)}else n=Nr(n).createTextNode(s),n[nt]=a,a.stateNode=n}return qe(a),null;case 13:if(s=a.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(c=Ja(a),s!==null&&s.dehydrated!==null){if(n===null){if(!c)throw Error(l(318));if(c=a.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(l(317));c[nt]=a}else Ia(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;qe(a),c=!1}else c=cl(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=c),c=!0;if(!c)return a.flags&256?(Pt(a),a):(Pt(a),null)}if(Pt(a),(a.flags&128)!==0)return a.lanes=r,a;if(r=s!==null,n=n!==null&&n.memoizedState!==null,r){s=a.child,c=null,s.alternate!==null&&s.alternate.memoizedState!==null&&s.alternate.memoizedState.cachePool!==null&&(c=s.alternate.memoizedState.cachePool.pool);var p=null;s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(p=s.memoizedState.cachePool.pool),p!==c&&(s.flags|=2048)}return r!==n&&r&&(a.child.flags|=8192),Sr(a,a.updateQueue),qe(a),null;case 4:return fe(),n===null&&Yi(a.stateNode.containerInfo),qe(a),null;case 10:return Jt(a.type),qe(a),null;case 19:if(J(Xe),c=a.memoizedState,c===null)return qe(a),null;if(s=(a.flags&128)!==0,p=c.rendering,p===null)if(s)ho(c,!1);else{if(Be!==0||n!==null&&(n.flags&128)!==0)for(n=a.child;n!==null;){if(p=yr(n),p!==null){for(a.flags|=128,ho(c,!1),n=p.updateQueue,a.updateQueue=n,Sr(a,n),a.subtreeFlags=0,n=r,r=a.child;r!==null;)ol(r,n),r=r.sibling;return X(Xe,Xe.current&1|2),a.child}n=n.sibling}c.tail!==null&&Re()>jr&&(a.flags|=128,s=!0,ho(c,!1),a.lanes=4194304)}else{if(!s)if(n=yr(p),n!==null){if(a.flags|=128,s=!0,n=n.updateQueue,a.updateQueue=n,Sr(a,n),ho(c,!0),c.tail===null&&c.tailMode==="hidden"&&!p.alternate&&!Se)return qe(a),null}else 2*Re()-c.renderingStartTime>jr&&r!==536870912&&(a.flags|=128,s=!0,ho(c,!1),a.lanes=4194304);c.isBackwards?(p.sibling=a.child,a.child=p):(n=c.last,n!==null?n.sibling=p:a.child=p,c.last=p)}return c.tail!==null?(a=c.tail,c.rendering=a,c.tail=a.sibling,c.renderingStartTime=Re(),a.sibling=null,n=Xe.current,X(Xe,s?n&1|2:n&1),a):(qe(a),null);case 22:case 23:return Pt(a),Fs(),s=a.memoizedState!==null,n!==null?n.memoizedState!==null!==s&&(a.flags|=8192):s&&(a.flags|=8192),s?(r&536870912)!==0&&(a.flags&128)===0&&(qe(a),a.subtreeFlags&6&&(a.flags|=8192)):qe(a),r=a.updateQueue,r!==null&&Sr(a,r.retryQueue),r=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(r=n.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==r&&(a.flags|=2048),n!==null&&J(Hn),null;case 24:return r=null,n!==null&&(r=n.memoizedState.cache),a.memoizedState.cache!==r&&(a.flags|=2048),Jt(Fe),qe(a),null;case 25:return null;case 30:return null}throw Error(l(156,a.tag))}function Af(n,a){switch(Ms(a),a.tag){case 1:return n=a.flags,n&65536?(a.flags=n&-65537|128,a):null;case 3:return Jt(Fe),fe(),n=a.flags,(n&65536)!==0&&(n&128)===0?(a.flags=n&-65537|128,a):null;case 26:case 27:case 5:return Je(a),null;case 13:if(Pt(a),n=a.memoizedState,n!==null&&n.dehydrated!==null){if(a.alternate===null)throw Error(l(340));Ia()}return n=a.flags,n&65536?(a.flags=n&-65537|128,a):null;case 19:return J(Xe),null;case 4:return fe(),null;case 10:return Jt(a.type),null;case 22:case 23:return Pt(a),Fs(),n!==null&&J(Hn),n=a.flags,n&65536?(a.flags=n&-65537|128,a):null;case 24:return Jt(Fe),null;case 25:return null;default:return null}}function zp(n,a){switch(Ms(a),a.tag){case 3:Jt(Fe),fe();break;case 26:case 27:case 5:Je(a);break;case 4:fe();break;case 13:Pt(a);break;case 19:J(Xe);break;case 10:Jt(a.type);break;case 22:case 23:Pt(a),Fs(),n!==null&&J(Hn);break;case 24:Jt(Fe)}}function mo(n,a){try{var r=a.updateQueue,s=r!==null?r.lastEffect:null;if(s!==null){var c=s.next;r=c;do{if((r.tag&n)===n){s=void 0;var p=r.create,f=r.inst;s=p(),f.destroy=s}r=r.next}while(r!==c)}}catch(y){Ce(a,a.return,y)}}function xn(n,a,r){try{var s=a.updateQueue,c=s!==null?s.lastEffect:null;if(c!==null){var p=c.next;s=p;do{if((s.tag&n)===n){var f=s.inst,y=f.destroy;if(y!==void 0){f.destroy=void 0,c=a;var A=r,T=y;try{T()}catch(q){Ce(c,A,q)}}}s=s.next}while(s!==p)}}catch(q){Ce(a,a.return,q)}}function Rp(n){var a=n.updateQueue;if(a!==null){var r=n.stateNode;try{bl(a,r)}catch(s){Ce(n,n.return,s)}}}function Cp(n,a,r){r.props=Xn(n.type,n.memoizedProps),r.state=n.memoizedState;try{r.componentWillUnmount()}catch(s){Ce(n,a,s)}}function go(n,a){try{var r=n.ref;if(r!==null){switch(n.tag){case 26:case 27:case 5:var s=n.stateNode;break;case 30:s=n.stateNode;break;default:s=n.stateNode}typeof r=="function"?n.refCleanup=r(s):r.current=s}}catch(c){Ce(n,a,c)}}function Gt(n,a){var r=n.ref,s=n.refCleanup;if(r!==null)if(typeof s=="function")try{s()}catch(c){Ce(n,a,c)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof r=="function")try{r(null)}catch(c){Ce(n,a,c)}else r.current=null}function kp(n){var a=n.type,r=n.memoizedProps,s=n.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":r.autoFocus&&s.focus();break e;case"img":r.src?s.src=r.src:r.srcSet&&(s.srcset=r.srcSet)}}catch(c){Ce(n,n.return,c)}}function yi(n,a,r){try{var s=n.stateNode;Hf(s,n.type,r,a),s[st]=a}catch(c){Ce(n,n.return,c)}}function Lp(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&On(n.type)||n.tag===4}function bi(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Lp(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&On(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function vi(n,a,r){var s=n.tag;if(s===5||s===6)n=n.stateNode,a?(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r).insertBefore(n,a):(a=r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,a.appendChild(n),r=r._reactRootContainer,r!=null||a.onclick!==null||(a.onclick=Lr));else if(s!==4&&(s===27&&On(n.type)&&(r=n.stateNode,a=null),n=n.child,n!==null))for(vi(n,a,r),n=n.sibling;n!==null;)vi(n,a,r),n=n.sibling}function Er(n,a,r){var s=n.tag;if(s===5||s===6)n=n.stateNode,a?r.insertBefore(n,a):r.appendChild(n);else if(s!==4&&(s===27&&On(n.type)&&(r=n.stateNode),n=n.child,n!==null))for(Er(n,a,r),n=n.sibling;n!==null;)Er(n,a,r),n=n.sibling}function Np(n){var a=n.stateNode,r=n.memoizedProps;try{for(var s=n.type,c=a.attributes;c.length;)a.removeAttributeNode(c[0]);We(a,s,r),a[nt]=n,a[st]=r}catch(p){Ce(n,n.return,p)}}var tn=!1,Ge=!1,wi=!1,qp=typeof WeakSet=="function"?WeakSet:Set,Qe=null;function Sf(n,a){if(n=n.containerInfo,Xi=Yr,n=Qc(n),bs(n)){if("selectionStart"in n)var r={start:n.selectionStart,end:n.selectionEnd};else e:{r=(r=n.ownerDocument)&&r.defaultView||window;var s=r.getSelection&&r.getSelection();if(s&&s.rangeCount!==0){r=s.anchorNode;var c=s.anchorOffset,p=s.focusNode;s=s.focusOffset;try{r.nodeType,p.nodeType}catch{r=null;break e}var f=0,y=-1,A=-1,T=0,q=0,G=n,M=null;t:for(;;){for(var R;G!==r||c!==0&&G.nodeType!==3||(y=f+c),G!==p||s!==0&&G.nodeType!==3||(A=f+s),G.nodeType===3&&(f+=G.nodeValue.length),(R=G.firstChild)!==null;)M=G,G=R;for(;;){if(G===n)break t;if(M===r&&++T===c&&(y=f),M===p&&++q===s&&(A=f),(R=G.nextSibling)!==null)break;G=M,M=G.parentNode}G=R}r=y===-1||A===-1?null:{start:y,end:A}}else r=null}r=r||{start:0,end:0}}else r=null;for(Vi={focusedElem:n,selectionRange:r},Yr=!1,Qe=a;Qe!==null;)if(a=Qe,n=a.child,(a.subtreeFlags&1024)!==0&&n!==null)n.return=a,Qe=n;else for(;Qe!==null;){switch(a=Qe,p=a.alternate,n=a.flags,a.tag){case 0:break;case 11:case 15:break;case 1:if((n&1024)!==0&&p!==null){n=void 0,r=a,c=p.memoizedProps,p=p.memoizedState,s=r.stateNode;try{var de=Xn(r.type,c,r.elementType===r.type);n=s.getSnapshotBeforeUpdate(de,p),s.__reactInternalSnapshotBeforeUpdate=n}catch(pe){Ce(r,r.return,pe)}}break;case 3:if((n&1024)!==0){if(n=a.stateNode.containerInfo,r=n.nodeType,r===9)Ki(n);else if(r===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":Ki(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(l(163))}if(n=a.sibling,n!==null){n.return=a.return,Qe=n;break}Qe=a.return}}function $p(n,a,r){var s=r.flags;switch(r.tag){case 0:case 11:case 15:yn(n,r),s&4&&mo(5,r);break;case 1:if(yn(n,r),s&4)if(n=r.stateNode,a===null)try{n.componentDidMount()}catch(f){Ce(r,r.return,f)}else{var c=Xn(r.type,a.memoizedProps);a=a.memoizedState;try{n.componentDidUpdate(c,a,n.__reactInternalSnapshotBeforeUpdate)}catch(f){Ce(r,r.return,f)}}s&64&&Rp(r),s&512&&go(r,r.return);break;case 3:if(yn(n,r),s&64&&(n=r.updateQueue,n!==null)){if(a=null,r.child!==null)switch(r.child.tag){case 27:case 5:a=r.child.stateNode;break;case 1:a=r.child.stateNode}try{bl(n,a)}catch(f){Ce(r,r.return,f)}}break;case 27:a===null&&s&4&&Np(r);case 26:case 5:yn(n,r),a===null&&s&4&&kp(r),s&512&&go(r,r.return);break;case 12:yn(n,r);break;case 13:yn(n,r),s&4&&Gp(n,r),s&64&&(n=r.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(r=Rf.bind(null,r),Jf(n,r))));break;case 22:if(s=r.memoizedState!==null||tn,!s){a=a!==null&&a.memoizedState!==null||Ge,c=tn;var p=Ge;tn=s,(Ge=a)&&!p?bn(n,r,(r.subtreeFlags&8772)!==0):yn(n,r),tn=c,Ge=p}break;case 30:break;default:yn(n,r)}}function Bp(n){var a=n.alternate;a!==null&&(n.alternate=null,Bp(a)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(a=n.stateNode,a!==null&&Wr(a)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var Ne=null,pt=!1;function nn(n,a,r){for(r=r.child;r!==null;)Up(n,a,r),r=r.sibling}function Up(n,a,r){if(dt&&typeof dt.onCommitFiberUnmount=="function")try{dt.onCommitFiberUnmount(Na,r)}catch{}switch(r.tag){case 26:Ge||Gt(r,a),nn(n,a,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode,r.parentNode.removeChild(r));break;case 27:Ge||Gt(r,a);var s=Ne,c=pt;On(r.type)&&(Ne=r.stateNode,pt=!1),nn(n,a,r),Oo(r.stateNode),Ne=s,pt=c;break;case 5:Ge||Gt(r,a);case 6:if(s=Ne,c=pt,Ne=null,nn(n,a,r),Ne=s,pt=c,Ne!==null)if(pt)try{(Ne.nodeType===9?Ne.body:Ne.nodeName==="HTML"?Ne.ownerDocument.body:Ne).removeChild(r.stateNode)}catch(p){Ce(r,a,p)}else try{Ne.removeChild(r.stateNode)}catch(p){Ce(r,a,p)}break;case 18:Ne!==null&&(pt?(n=Ne,_u(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,r.stateNode),Co(n)):_u(Ne,r.stateNode));break;case 4:s=Ne,c=pt,Ne=r.stateNode.containerInfo,pt=!0,nn(n,a,r),Ne=s,pt=c;break;case 0:case 11:case 14:case 15:Ge||xn(2,r,a),Ge||xn(4,r,a),nn(n,a,r);break;case 1:Ge||(Gt(r,a),s=r.stateNode,typeof s.componentWillUnmount=="function"&&Cp(r,a,s)),nn(n,a,r);break;case 21:nn(n,a,r);break;case 22:Ge=(s=Ge)||r.memoizedState!==null,nn(n,a,r),Ge=s;break;default:nn(n,a,r)}}function Gp(n,a){if(a.memoizedState===null&&(n=a.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{Co(n)}catch(r){Ce(a,a.return,r)}}function Ef(n){switch(n.tag){case 13:case 19:var a=n.stateNode;return a===null&&(a=n.stateNode=new qp),a;case 22:return n=n.stateNode,a=n._retryCache,a===null&&(a=n._retryCache=new qp),a;default:throw Error(l(435,n.tag))}}function Ai(n,a){var r=Ef(n);a.forEach(function(s){var c=Cf.bind(null,n,s);r.has(s)||(r.add(s),s.then(c,c))})}function yt(n,a){var r=a.deletions;if(r!==null)for(var s=0;s<r.length;s++){var c=r[s],p=n,f=a,y=f;e:for(;y!==null;){switch(y.tag){case 27:if(On(y.type)){Ne=y.stateNode,pt=!1;break e}break;case 5:Ne=y.stateNode,pt=!1;break e;case 3:case 4:Ne=y.stateNode.containerInfo,pt=!0;break e}y=y.return}if(Ne===null)throw Error(l(160));Up(p,f,c),Ne=null,pt=!1,p=c.alternate,p!==null&&(p.return=null),c.return=null}if(a.subtreeFlags&13878)for(a=a.child;a!==null;)Yp(a,n),a=a.sibling}var Nt=null;function Yp(n,a){var r=n.alternate,s=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:yt(a,n),bt(n),s&4&&(xn(3,n,n.return),mo(3,n),xn(5,n,n.return));break;case 1:yt(a,n),bt(n),s&512&&(Ge||r===null||Gt(r,r.return)),s&64&&tn&&(n=n.updateQueue,n!==null&&(s=n.callbacks,s!==null&&(r=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=r===null?s:r.concat(s))));break;case 26:var c=Nt;if(yt(a,n),bt(n),s&512&&(Ge||r===null||Gt(r,r.return)),s&4){var p=r!==null?r.memoizedState:null;if(s=n.memoizedState,r===null)if(s===null)if(n.stateNode===null){e:{s=n.type,r=n.memoizedProps,c=c.ownerDocument||c;t:switch(s){case"title":p=c.getElementsByTagName("title")[0],(!p||p[Ba]||p[nt]||p.namespaceURI==="http://www.w3.org/2000/svg"||p.hasAttribute("itemprop"))&&(p=c.createElement(s),c.head.insertBefore(p,c.querySelector("head > title"))),We(p,s,r),p[nt]=n,Ve(p),s=p;break e;case"link":var f=Nu("link","href",c).get(s+(r.href||""));if(f){for(var y=0;y<f.length;y++)if(p=f[y],p.getAttribute("href")===(r.href==null||r.href===""?null:r.href)&&p.getAttribute("rel")===(r.rel==null?null:r.rel)&&p.getAttribute("title")===(r.title==null?null:r.title)&&p.getAttribute("crossorigin")===(r.crossOrigin==null?null:r.crossOrigin)){f.splice(y,1);break t}}p=c.createElement(s),We(p,s,r),c.head.appendChild(p);break;case"meta":if(f=Nu("meta","content",c).get(s+(r.content||""))){for(y=0;y<f.length;y++)if(p=f[y],p.getAttribute("content")===(r.content==null?null:""+r.content)&&p.getAttribute("name")===(r.name==null?null:r.name)&&p.getAttribute("property")===(r.property==null?null:r.property)&&p.getAttribute("http-equiv")===(r.httpEquiv==null?null:r.httpEquiv)&&p.getAttribute("charset")===(r.charSet==null?null:r.charSet)){f.splice(y,1);break t}}p=c.createElement(s),We(p,s,r),c.head.appendChild(p);break;default:throw Error(l(468,s))}p[nt]=n,Ve(p),s=p}n.stateNode=s}else qu(c,n.type,n.stateNode);else n.stateNode=Lu(c,s,n.memoizedProps);else p!==s?(p===null?r.stateNode!==null&&(r=r.stateNode,r.parentNode.removeChild(r)):p.count--,s===null?qu(c,n.type,n.stateNode):Lu(c,s,n.memoizedProps)):s===null&&n.stateNode!==null&&yi(n,n.memoizedProps,r.memoizedProps)}break;case 27:yt(a,n),bt(n),s&512&&(Ge||r===null||Gt(r,r.return)),r!==null&&s&4&&yi(n,n.memoizedProps,r.memoizedProps);break;case 5:if(yt(a,n),bt(n),s&512&&(Ge||r===null||Gt(r,r.return)),n.flags&32){c=n.stateNode;try{aa(c,"")}catch(R){Ce(n,n.return,R)}}s&4&&n.stateNode!=null&&(c=n.memoizedProps,yi(n,c,r!==null?r.memoizedProps:c)),s&1024&&(wi=!0);break;case 6:if(yt(a,n),bt(n),s&4){if(n.stateNode===null)throw Error(l(162));s=n.memoizedProps,r=n.stateNode;try{r.nodeValue=s}catch(R){Ce(n,n.return,R)}}break;case 3:if(Br=null,c=Nt,Nt=qr(a.containerInfo),yt(a,n),Nt=c,bt(n),s&4&&r!==null&&r.memoizedState.isDehydrated)try{Co(a.containerInfo)}catch(R){Ce(n,n.return,R)}wi&&(wi=!1,Hp(n));break;case 4:s=Nt,Nt=qr(n.stateNode.containerInfo),yt(a,n),bt(n),Nt=s;break;case 12:yt(a,n),bt(n);break;case 13:yt(a,n),bt(n),n.child.flags&8192&&n.memoizedState!==null!=(r!==null&&r.memoizedState!==null)&&(_i=Re()),s&4&&(s=n.updateQueue,s!==null&&(n.updateQueue=null,Ai(n,s)));break;case 22:c=n.memoizedState!==null;var A=r!==null&&r.memoizedState!==null,T=tn,q=Ge;if(tn=T||c,Ge=q||A,yt(a,n),Ge=q,tn=T,bt(n),s&8192)e:for(a=n.stateNode,a._visibility=c?a._visibility&-2:a._visibility|1,c&&(r===null||A||tn||Ge||Vn(n)),r=null,a=n;;){if(a.tag===5||a.tag===26){if(r===null){A=r=a;try{if(p=A.stateNode,c)f=p.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none";else{y=A.stateNode;var G=A.memoizedProps.style,M=G!=null&&G.hasOwnProperty("display")?G.display:null;y.style.display=M==null||typeof M=="boolean"?"":(""+M).trim()}}catch(R){Ce(A,A.return,R)}}}else if(a.tag===6){if(r===null){A=a;try{A.stateNode.nodeValue=c?"":A.memoizedProps}catch(R){Ce(A,A.return,R)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===n)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===n)break e;for(;a.sibling===null;){if(a.return===null||a.return===n)break e;r===a&&(r=null),a=a.return}r===a&&(r=null),a.sibling.return=a.return,a=a.sibling}s&4&&(s=n.updateQueue,s!==null&&(r=s.retryQueue,r!==null&&(s.retryQueue=null,Ai(n,r))));break;case 19:yt(a,n),bt(n),s&4&&(s=n.updateQueue,s!==null&&(n.updateQueue=null,Ai(n,s)));break;case 30:break;case 21:break;default:yt(a,n),bt(n)}}function bt(n){var a=n.flags;if(a&2){try{for(var r,s=n.return;s!==null;){if(Lp(s)){r=s;break}s=s.return}if(r==null)throw Error(l(160));switch(r.tag){case 27:var c=r.stateNode,p=bi(n);Er(n,p,c);break;case 5:var f=r.stateNode;r.flags&32&&(aa(f,""),r.flags&=-33);var y=bi(n);Er(n,y,f);break;case 3:case 4:var A=r.stateNode.containerInfo,T=bi(n);vi(n,T,A);break;default:throw Error(l(161))}}catch(q){Ce(n,n.return,q)}n.flags&=-3}a&4096&&(n.flags&=-4097)}function Hp(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var a=n;Hp(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),n=n.sibling}}function yn(n,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)$p(n,a.alternate,a),a=a.sibling}function Vn(n){for(n=n.child;n!==null;){var a=n;switch(a.tag){case 0:case 11:case 14:case 15:xn(4,a,a.return),Vn(a);break;case 1:Gt(a,a.return);var r=a.stateNode;typeof r.componentWillUnmount=="function"&&Cp(a,a.return,r),Vn(a);break;case 27:Oo(a.stateNode);case 26:case 5:Gt(a,a.return),Vn(a);break;case 22:a.memoizedState===null&&Vn(a);break;case 30:Vn(a);break;default:Vn(a)}n=n.sibling}}function bn(n,a,r){for(r=r&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var s=a.alternate,c=n,p=a,f=p.flags;switch(p.tag){case 0:case 11:case 15:bn(c,p,r),mo(4,p);break;case 1:if(bn(c,p,r),s=p,c=s.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(T){Ce(s,s.return,T)}if(s=p,c=s.updateQueue,c!==null){var y=s.stateNode;try{var A=c.shared.hiddenCallbacks;if(A!==null)for(c.shared.hiddenCallbacks=null,c=0;c<A.length;c++)yl(A[c],y)}catch(T){Ce(s,s.return,T)}}r&&f&64&&Rp(p),go(p,p.return);break;case 27:Np(p);case 26:case 5:bn(c,p,r),r&&s===null&&f&4&&kp(p),go(p,p.return);break;case 12:bn(c,p,r);break;case 13:bn(c,p,r),r&&f&4&&Gp(c,p);break;case 22:p.memoizedState===null&&bn(c,p,r),go(p,p.return);break;case 30:break;default:bn(c,p,r)}a=a.sibling}}function Si(n,a){var r=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(r=n.memoizedState.cachePool.pool),n=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(n=a.memoizedState.cachePool.pool),n!==r&&(n!=null&&n.refCount++,r!=null&&eo(r))}function Ei(n,a){n=null,a.alternate!==null&&(n=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==n&&(a.refCount++,n!=null&&eo(n))}function Yt(n,a,r,s){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Fp(n,a,r,s),a=a.sibling}function Fp(n,a,r,s){var c=a.flags;switch(a.tag){case 0:case 11:case 15:Yt(n,a,r,s),c&2048&&mo(9,a);break;case 1:Yt(n,a,r,s);break;case 3:Yt(n,a,r,s),c&2048&&(n=null,a.alternate!==null&&(n=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==n&&(a.refCount++,n!=null&&eo(n)));break;case 12:if(c&2048){Yt(n,a,r,s),n=a.stateNode;try{var p=a.memoizedProps,f=p.id,y=p.onPostCommit;typeof y=="function"&&y(f,a.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(A){Ce(a,a.return,A)}}else Yt(n,a,r,s);break;case 13:Yt(n,a,r,s);break;case 23:break;case 22:p=a.stateNode,f=a.alternate,a.memoizedState!==null?p._visibility&2?Yt(n,a,r,s):xo(n,a):p._visibility&2?Yt(n,a,r,s):(p._visibility|=2,Aa(n,a,r,s,(a.subtreeFlags&10256)!==0)),c&2048&&Si(f,a);break;case 24:Yt(n,a,r,s),c&2048&&Ei(a.alternate,a);break;default:Yt(n,a,r,s)}}function Aa(n,a,r,s,c){for(c=c&&(a.subtreeFlags&10256)!==0,a=a.child;a!==null;){var p=n,f=a,y=r,A=s,T=f.flags;switch(f.tag){case 0:case 11:case 15:Aa(p,f,y,A,c),mo(8,f);break;case 23:break;case 22:var q=f.stateNode;f.memoizedState!==null?q._visibility&2?Aa(p,f,y,A,c):xo(p,f):(q._visibility|=2,Aa(p,f,y,A,c)),c&&T&2048&&Si(f.alternate,f);break;case 24:Aa(p,f,y,A,c),c&&T&2048&&Ei(f.alternate,f);break;default:Aa(p,f,y,A,c)}a=a.sibling}}function xo(n,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var r=n,s=a,c=s.flags;switch(s.tag){case 22:xo(r,s),c&2048&&Si(s.alternate,s);break;case 24:xo(r,s),c&2048&&Ei(s.alternate,s);break;default:xo(r,s)}a=a.sibling}}var yo=8192;function Sa(n){if(n.subtreeFlags&yo)for(n=n.child;n!==null;)Xp(n),n=n.sibling}function Xp(n){switch(n.tag){case 26:Sa(n),n.flags&yo&&n.memoizedState!==null&&lh(Nt,n.memoizedState,n.memoizedProps);break;case 5:Sa(n);break;case 3:case 4:var a=Nt;Nt=qr(n.stateNode.containerInfo),Sa(n),Nt=a;break;case 22:n.memoizedState===null&&(a=n.alternate,a!==null&&a.memoizedState!==null?(a=yo,yo=16777216,Sa(n),yo=a):Sa(n));break;default:Sa(n)}}function Vp(n){var a=n.alternate;if(a!==null&&(n=a.child,n!==null)){a.child=null;do a=n.sibling,n.sibling=null,n=a;while(n!==null)}}function bo(n){var a=n.deletions;if((n.flags&16)!==0){if(a!==null)for(var r=0;r<a.length;r++){var s=a[r];Qe=s,Qp(s,n)}Vp(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Zp(n),n=n.sibling}function Zp(n){switch(n.tag){case 0:case 11:case 15:bo(n),n.flags&2048&&xn(9,n,n.return);break;case 3:bo(n);break;case 12:bo(n);break;case 22:var a=n.stateNode;n.memoizedState!==null&&a._visibility&2&&(n.return===null||n.return.tag!==13)?(a._visibility&=-3,Or(n)):bo(n);break;default:bo(n)}}function Or(n){var a=n.deletions;if((n.flags&16)!==0){if(a!==null)for(var r=0;r<a.length;r++){var s=a[r];Qe=s,Qp(s,n)}Vp(n)}for(n=n.child;n!==null;){switch(a=n,a.tag){case 0:case 11:case 15:xn(8,a,a.return),Or(a);break;case 22:r=a.stateNode,r._visibility&2&&(r._visibility&=-3,Or(a));break;default:Or(a)}n=n.sibling}}function Qp(n,a){for(;Qe!==null;){var r=Qe;switch(r.tag){case 0:case 11:case 15:xn(8,r,a);break;case 23:case 22:if(r.memoizedState!==null&&r.memoizedState.cachePool!==null){var s=r.memoizedState.cachePool.pool;s!=null&&s.refCount++}break;case 24:eo(r.memoizedState.cache)}if(s=r.child,s!==null)s.return=r,Qe=s;else e:for(r=n;Qe!==null;){s=Qe;var c=s.sibling,p=s.return;if(Bp(s),s===r){Qe=null;break e}if(c!==null){c.return=p,Qe=c;break e}Qe=p}}}var Of={getCacheForType:function(n){var a=ot(Fe),r=a.data.get(n);return r===void 0&&(r=n(),a.data.set(n,r)),r}},jf=typeof WeakMap=="function"?WeakMap:Map,je=0,ke=null,xe=null,be=0,De=0,vt=null,vn=!1,Ea=!1,Oi=!1,an=0,Be=0,wn=0,Zn=0,ji=0,Mt=0,Oa=0,vo=null,ut=null,Di=!1,_i=0,jr=1/0,Dr=null,An=null,Pe=0,Sn=null,ja=null,Da=0,Ti=0,Mi=null,Kp=null,wo=0,zi=null;function wt(){if((je&2)!==0&&be!==0)return be&-be;if(z.T!==null){var n=ha;return n!==0?n:$i()}return uc()}function Jp(){Mt===0&&(Mt=(be&536870912)===0||Se?ic():536870912);var n=Tt.current;return n!==null&&(n.flags|=32),Mt}function At(n,a,r){(n===ke&&(De===2||De===9)||n.cancelPendingCommit!==null)&&(_a(n,0),En(n,be,Mt,!1)),$a(n,r),((je&2)===0||n!==ke)&&(n===ke&&((je&2)===0&&(Zn|=r),Be===4&&En(n,be,Mt,!1)),Ht(n))}function Ip(n,a,r){if((je&6)!==0)throw Error(l(327));var s=!r&&(a&124)===0&&(a&n.expiredLanes)===0||qa(n,a),c=s?Tf(n,a):ki(n,a,!0),p=s;do{if(c===0){Ea&&!s&&En(n,a,0,!1);break}else{if(r=n.current.alternate,p&&!Df(r)){c=ki(n,a,!1),p=!1;continue}if(c===2){if(p=a,n.errorRecoveryDisabledLanes&p)var f=0;else f=n.pendingLanes&-536870913,f=f!==0?f:f&536870912?536870912:0;if(f!==0){a=f;e:{var y=n;c=vo;var A=y.current.memoizedState.isDehydrated;if(A&&(_a(y,f).flags|=256),f=ki(y,f,!1),f!==2){if(Oi&&!A){y.errorRecoveryDisabledLanes|=p,Zn|=p,c=4;break e}p=ut,ut=c,p!==null&&(ut===null?ut=p:ut.push.apply(ut,p))}c=f}if(p=!1,c!==2)continue}}if(c===1){_a(n,0),En(n,a,0,!0);break}e:{switch(s=n,p=c,p){case 0:case 1:throw Error(l(345));case 4:if((a&4194048)!==a)break;case 6:En(s,a,Mt,!vn);break e;case 2:ut=null;break;case 3:case 5:break;default:throw Error(l(329))}if((a&62914560)===a&&(c=_i+300-Re(),10<c)){if(En(s,a,Mt,!vn),No(s,0,!0)!==0)break e;s.timeoutHandle=ju(Pp.bind(null,s,r,ut,Dr,Di,a,Mt,Zn,Oa,vn,p,2,-0,0),c);break e}Pp(s,r,ut,Dr,Di,a,Mt,Zn,Oa,vn,p,0,-0,0)}}break}while(!0);Ht(n)}function Pp(n,a,r,s,c,p,f,y,A,T,q,G,M,R){if(n.timeoutHandle=-1,G=a.subtreeFlags,(G&8192||(G&16785408)===16785408)&&(_o={stylesheets:null,count:0,unsuspend:ch},Xp(a),G=ph(),G!==null)){n.cancelPendingCommit=G(ru.bind(null,n,a,p,r,s,c,f,y,A,q,1,M,R)),En(n,p,f,!T);return}ru(n,a,p,r,s,c,f,y,A)}function Df(n){for(var a=n;;){var r=a.tag;if((r===0||r===11||r===15)&&a.flags&16384&&(r=a.updateQueue,r!==null&&(r=r.stores,r!==null)))for(var s=0;s<r.length;s++){var c=r[s],p=c.getSnapshot;c=c.value;try{if(!gt(p(),c))return!1}catch{return!1}}if(r=a.child,a.subtreeFlags&16384&&r!==null)r.return=a,a=r;else{if(a===n)break;for(;a.sibling===null;){if(a.return===null||a.return===n)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function En(n,a,r,s){a&=~ji,a&=~Zn,n.suspendedLanes|=a,n.pingedLanes&=~a,s&&(n.warmLanes|=a),s=n.expirationTimes;for(var c=a;0<c;){var p=31-ft(c),f=1<<p;s[p]=-1,c&=~f}r!==0&&lc(n,r,a)}function _r(){return(je&6)===0?(Ao(0),!1):!0}function Ri(){if(xe!==null){if(De===0)var n=xe.return;else n=xe,Kt=Gn=null,Ks(n),va=null,uo=0,n=xe;for(;n!==null;)zp(n.alternate,n),n=n.return;xe=null}}function _a(n,a){var r=n.timeoutHandle;r!==-1&&(n.timeoutHandle=-1,Xf(r)),r=n.cancelPendingCommit,r!==null&&(n.cancelPendingCommit=null,r()),Ri(),ke=n,xe=r=Vt(n.current,null),be=a,De=0,vt=null,vn=!1,Ea=qa(n,a),Oi=!1,Oa=Mt=ji=Zn=wn=Be=0,ut=vo=null,Di=!1,(a&8)!==0&&(a|=a&32);var s=n.entangledLanes;if(s!==0)for(n=n.entanglements,s&=a;0<s;){var c=31-ft(s),p=1<<c;a|=n[c],s&=~p}return an=a,Qo(),r}function Wp(n,a){he=null,z.H=mr,a===no||a===ar?(a=gl(),De=3):a===fl?(a=gl(),De=4):De=a===xp?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,vt=a,xe===null&&(Be=1,vr(n,Ot(a,n.current)))}function eu(){var n=z.H;return z.H=mr,n===null?mr:n}function tu(){var n=z.A;return z.A=Of,n}function Ci(){Be=4,vn||(be&4194048)!==be&&Tt.current!==null||(Ea=!0),(wn&134217727)===0&&(Zn&134217727)===0||ke===null||En(ke,be,Mt,!1)}function ki(n,a,r){var s=je;je|=2;var c=eu(),p=tu();(ke!==n||be!==a)&&(Dr=null,_a(n,a)),a=!1;var f=Be;e:do try{if(De!==0&&xe!==null){var y=xe,A=vt;switch(De){case 8:Ri(),f=6;break e;case 3:case 2:case 9:case 6:Tt.current===null&&(a=!0);var T=De;if(De=0,vt=null,Ta(n,y,A,T),r&&Ea){f=0;break e}break;default:T=De,De=0,vt=null,Ta(n,y,A,T)}}_f(),f=Be;break}catch(q){Wp(n,q)}while(!0);return a&&n.shellSuspendCounter++,Kt=Gn=null,je=s,z.H=c,z.A=p,xe===null&&(ke=null,be=0,Qo()),f}function _f(){for(;xe!==null;)nu(xe)}function Tf(n,a){var r=je;je|=2;var s=eu(),c=tu();ke!==n||be!==a?(Dr=null,jr=Re()+500,_a(n,a)):Ea=qa(n,a);e:do try{if(De!==0&&xe!==null){a=xe;var p=vt;t:switch(De){case 1:De=0,vt=null,Ta(n,a,p,1);break;case 2:case 9:if(hl(p)){De=0,vt=null,au(a);break}a=function(){De!==2&&De!==9||ke!==n||(De=7),Ht(n)},p.then(a,a);break e;case 3:De=7;break e;case 4:De=5;break e;case 7:hl(p)?(De=0,vt=null,au(a)):(De=0,vt=null,Ta(n,a,p,7));break;case 5:var f=null;switch(xe.tag){case 26:f=xe.memoizedState;case 5:case 27:var y=xe;if(!f||$u(f)){De=0,vt=null;var A=y.sibling;if(A!==null)xe=A;else{var T=y.return;T!==null?(xe=T,Tr(T)):xe=null}break t}}De=0,vt=null,Ta(n,a,p,5);break;case 6:De=0,vt=null,Ta(n,a,p,6);break;case 8:Ri(),Be=6;break e;default:throw Error(l(462))}}Mf();break}catch(q){Wp(n,q)}while(!0);return Kt=Gn=null,z.H=s,z.A=c,je=r,xe!==null?0:(ke=null,be=0,Qo(),Be)}function Mf(){for(;xe!==null&&!tt();)nu(xe)}function nu(n){var a=Tp(n.alternate,n,an);n.memoizedProps=n.pendingProps,a===null?Tr(n):xe=a}function au(n){var a=n,r=a.alternate;switch(a.tag){case 15:case 0:a=Sp(r,a,a.pendingProps,a.type,void 0,be);break;case 11:a=Sp(r,a,a.pendingProps,a.type.render,a.ref,be);break;case 5:Ks(a);default:zp(r,a),a=xe=ol(a,an),a=Tp(r,a,an)}n.memoizedProps=n.pendingProps,a===null?Tr(n):xe=a}function Ta(n,a,r,s){Kt=Gn=null,Ks(a),va=null,uo=0;var c=a.return;try{if(bf(n,c,a,r,be)){Be=1,vr(n,Ot(r,n.current)),xe=null;return}}catch(p){if(c!==null)throw xe=c,p;Be=1,vr(n,Ot(r,n.current)),xe=null;return}a.flags&32768?(Se||s===1?n=!0:Ea||(be&536870912)!==0?n=!1:(vn=n=!0,(s===2||s===9||s===3||s===6)&&(s=Tt.current,s!==null&&s.tag===13&&(s.flags|=16384))),ou(a,n)):Tr(a)}function Tr(n){var a=n;do{if((a.flags&32768)!==0){ou(a,vn);return}n=a.return;var r=wf(a.alternate,a,an);if(r!==null){xe=r;return}if(a=a.sibling,a!==null){xe=a;return}xe=a=n}while(a!==null);Be===0&&(Be=5)}function ou(n,a){do{var r=Af(n.alternate,n);if(r!==null){r.flags&=32767,xe=r;return}if(r=n.return,r!==null&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!a&&(n=n.sibling,n!==null)){xe=n;return}xe=n=r}while(n!==null);Be=6,xe=null}function ru(n,a,r,s,c,p,f,y,A){n.cancelPendingCommit=null;do Mr();while(Pe!==0);if((je&6)!==0)throw Error(l(327));if(a!==null){if(a===n.current)throw Error(l(177));if(p=a.lanes|a.childLanes,p|=Es,nd(n,r,p,f,y,A),n===ke&&(xe=ke=null,be=0),ja=a,Sn=n,Da=r,Ti=p,Mi=c,Kp=s,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,kf(kt,function(){return pu(),null})):(n.callbackNode=null,n.callbackPriority=0),s=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||s){s=z.T,z.T=null,c=Z.p,Z.p=2,f=je,je|=4;try{Sf(n,a,r)}finally{je=f,Z.p=c,z.T=s}}Pe=1,su(),iu(),cu()}}function su(){if(Pe===1){Pe=0;var n=Sn,a=ja,r=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||r){r=z.T,z.T=null;var s=Z.p;Z.p=2;var c=je;je|=4;try{Yp(a,n);var p=Vi,f=Qc(n.containerInfo),y=p.focusedElem,A=p.selectionRange;if(f!==y&&y&&y.ownerDocument&&Zc(y.ownerDocument.documentElement,y)){if(A!==null&&bs(y)){var T=A.start,q=A.end;if(q===void 0&&(q=T),"selectionStart"in y)y.selectionStart=T,y.selectionEnd=Math.min(q,y.value.length);else{var G=y.ownerDocument||document,M=G&&G.defaultView||window;if(M.getSelection){var R=M.getSelection(),de=y.textContent.length,pe=Math.min(A.start,de),ze=A.end===void 0?pe:Math.min(A.end,de);!R.extend&&pe>ze&&(f=ze,ze=pe,pe=f);var j=Vc(y,pe),E=Vc(y,ze);if(j&&E&&(R.rangeCount!==1||R.anchorNode!==j.node||R.anchorOffset!==j.offset||R.focusNode!==E.node||R.focusOffset!==E.offset)){var _=G.createRange();_.setStart(j.node,j.offset),R.removeAllRanges(),pe>ze?(R.addRange(_),R.extend(E.node,E.offset)):(_.setEnd(E.node,E.offset),R.addRange(_))}}}}for(G=[],R=y;R=R.parentNode;)R.nodeType===1&&G.push({element:R,left:R.scrollLeft,top:R.scrollTop});for(typeof y.focus=="function"&&y.focus(),y=0;y<G.length;y++){var B=G[y];B.element.scrollLeft=B.left,B.element.scrollTop=B.top}}Yr=!!Xi,Vi=Xi=null}finally{je=c,Z.p=s,z.T=r}}n.current=a,Pe=2}}function iu(){if(Pe===2){Pe=0;var n=Sn,a=ja,r=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||r){r=z.T,z.T=null;var s=Z.p;Z.p=2;var c=je;je|=4;try{$p(n,a.alternate,a)}finally{je=c,Z.p=s,z.T=r}}Pe=3}}function cu(){if(Pe===4||Pe===3){Pe=0,Oe();var n=Sn,a=ja,r=Da,s=Kp;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Pe=5:(Pe=0,ja=Sn=null,lu(n,n.pendingLanes));var c=n.pendingLanes;if(c===0&&(An=null),Ir(r),a=a.stateNode,dt&&typeof dt.onCommitFiberRoot=="function")try{dt.onCommitFiberRoot(Na,a,void 0,(a.current.flags&128)===128)}catch{}if(s!==null){a=z.T,c=Z.p,Z.p=2,z.T=null;try{for(var p=n.onRecoverableError,f=0;f<s.length;f++){var y=s[f];p(y.value,{componentStack:y.stack})}}finally{z.T=a,Z.p=c}}(Da&3)!==0&&Mr(),Ht(n),c=n.pendingLanes,(r&4194090)!==0&&(c&42)!==0?n===zi?wo++:(wo=0,zi=n):wo=0,Ao(0)}}function lu(n,a){(n.pooledCacheLanes&=a)===0&&(a=n.pooledCache,a!=null&&(n.pooledCache=null,eo(a)))}function Mr(n){return su(),iu(),cu(),pu()}function pu(){if(Pe!==5)return!1;var n=Sn,a=Ti;Ti=0;var r=Ir(Da),s=z.T,c=Z.p;try{Z.p=32>r?32:r,z.T=null,r=Mi,Mi=null;var p=Sn,f=Da;if(Pe=0,ja=Sn=null,Da=0,(je&6)!==0)throw Error(l(331));var y=je;if(je|=4,Zp(p.current),Fp(p,p.current,f,r),je=y,Ao(0,!1),dt&&typeof dt.onPostCommitFiberRoot=="function")try{dt.onPostCommitFiberRoot(Na,p)}catch{}return!0}finally{Z.p=c,z.T=s,lu(n,a)}}function uu(n,a,r){a=Ot(r,a),a=li(n.stateNode,a,2),n=fn(n,a,2),n!==null&&($a(n,2),Ht(n))}function Ce(n,a,r){if(n.tag===3)uu(n,n,r);else for(;a!==null;){if(a.tag===3){uu(a,n,r);break}else if(a.tag===1){var s=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(An===null||!An.has(s))){n=Ot(r,n),r=mp(2),s=fn(a,r,2),s!==null&&(gp(r,s,a,n),$a(s,2),Ht(s));break}}a=a.return}}function Li(n,a,r){var s=n.pingCache;if(s===null){s=n.pingCache=new jf;var c=new Set;s.set(a,c)}else c=s.get(a),c===void 0&&(c=new Set,s.set(a,c));c.has(r)||(Oi=!0,c.add(r),n=zf.bind(null,n,a,r),a.then(n,n))}function zf(n,a,r){var s=n.pingCache;s!==null&&s.delete(a),n.pingedLanes|=n.suspendedLanes&r,n.warmLanes&=~r,ke===n&&(be&r)===r&&(Be===4||Be===3&&(be&62914560)===be&&300>Re()-_i?(je&2)===0&&_a(n,0):ji|=r,Oa===be&&(Oa=0)),Ht(n)}function du(n,a){a===0&&(a=cc()),n=pa(n,a),n!==null&&($a(n,a),Ht(n))}function Rf(n){var a=n.memoizedState,r=0;a!==null&&(r=a.retryLane),du(n,r)}function Cf(n,a){var r=0;switch(n.tag){case 13:var s=n.stateNode,c=n.memoizedState;c!==null&&(r=c.retryLane);break;case 19:s=n.stateNode;break;case 22:s=n.stateNode._retryCache;break;default:throw Error(l(314))}s!==null&&s.delete(a),du(n,r)}function kf(n,a){return Ee(n,a)}var zr=null,Ma=null,Ni=!1,Rr=!1,qi=!1,Qn=0;function Ht(n){n!==Ma&&n.next===null&&(Ma===null?zr=Ma=n:Ma=Ma.next=n),Rr=!0,Ni||(Ni=!0,Nf())}function Ao(n,a){if(!qi&&Rr){qi=!0;do for(var r=!1,s=zr;s!==null;){if(n!==0){var c=s.pendingLanes;if(c===0)var p=0;else{var f=s.suspendedLanes,y=s.pingedLanes;p=(1<<31-ft(42|n)+1)-1,p&=c&~(f&~y),p=p&201326741?p&201326741|1:p?p|2:0}p!==0&&(r=!0,gu(s,p))}else p=be,p=No(s,s===ke?p:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),(p&3)===0||qa(s,p)||(r=!0,gu(s,p));s=s.next}while(r);qi=!1}}function Lf(){fu()}function fu(){Rr=Ni=!1;var n=0;Qn!==0&&(Ff()&&(n=Qn),Qn=0);for(var a=Re(),r=null,s=zr;s!==null;){var c=s.next,p=hu(s,a);p===0?(s.next=null,r===null?zr=c:r.next=c,c===null&&(Ma=r)):(r=s,(n!==0||(p&3)!==0)&&(Rr=!0)),s=c}Ao(n)}function hu(n,a){for(var r=n.suspendedLanes,s=n.pingedLanes,c=n.expirationTimes,p=n.pendingLanes&-62914561;0<p;){var f=31-ft(p),y=1<<f,A=c[f];A===-1?((y&r)===0||(y&s)!==0)&&(c[f]=td(y,a)):A<=a&&(n.expiredLanes|=y),p&=~y}if(a=ke,r=be,r=No(n,n===a?r:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),s=n.callbackNode,r===0||n===a&&(De===2||De===9)||n.cancelPendingCommit!==null)return s!==null&&s!==null&&et(s),n.callbackNode=null,n.callbackPriority=0;if((r&3)===0||qa(n,r)){if(a=r&-r,a===n.callbackPriority)return a;switch(s!==null&&et(s),Ir(r)){case 2:case 8:r=$t;break;case 32:r=kt;break;case 268435456:r=La;break;default:r=kt}return s=mu.bind(null,n),r=Ee(r,s),n.callbackPriority=a,n.callbackNode=r,a}return s!==null&&s!==null&&et(s),n.callbackPriority=2,n.callbackNode=null,2}function mu(n,a){if(Pe!==0&&Pe!==5)return n.callbackNode=null,n.callbackPriority=0,null;var r=n.callbackNode;if(Mr()&&n.callbackNode!==r)return null;var s=be;return s=No(n,n===ke?s:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),s===0?null:(Ip(n,s,a),hu(n,Re()),n.callbackNode!=null&&n.callbackNode===r?mu.bind(null,n):null)}function gu(n,a){if(Mr())return null;Ip(n,a,!0)}function Nf(){Vf(function(){(je&6)!==0?Ee(Ct,Lf):fu()})}function $i(){return Qn===0&&(Qn=ic()),Qn}function xu(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Go(""+n)}function yu(n,a){var r=a.ownerDocument.createElement("input");return r.name=a.name,r.value=a.value,n.id&&r.setAttribute("form",n.id),a.parentNode.insertBefore(r,a),n=new FormData(n),r.parentNode.removeChild(r),n}function qf(n,a,r,s,c){if(a==="submit"&&r&&r.stateNode===c){var p=xu((c[st]||null).action),f=s.submitter;f&&(a=(a=f[st]||null)?xu(a.formAction):f.getAttribute("formAction"),a!==null&&(p=a,f=null));var y=new Xo("action","action",null,s,c);n.push({event:y,listeners:[{instance:null,listener:function(){if(s.defaultPrevented){if(Qn!==0){var A=f?yu(c,f):new FormData(c);oi(r,{pending:!0,data:A,method:c.method,action:p},null,A)}}else typeof p=="function"&&(y.preventDefault(),A=f?yu(c,f):new FormData(c),oi(r,{pending:!0,data:A,method:c.method,action:p},p,A))},currentTarget:c}]})}}for(var Bi=0;Bi<Ss.length;Bi++){var Ui=Ss[Bi],$f=Ui.toLowerCase(),Bf=Ui[0].toUpperCase()+Ui.slice(1);Lt($f,"on"+Bf)}Lt(Ic,"onAnimationEnd"),Lt(Pc,"onAnimationIteration"),Lt(Wc,"onAnimationStart"),Lt("dblclick","onDoubleClick"),Lt("focusin","onFocus"),Lt("focusout","onBlur"),Lt(ef,"onTransitionRun"),Lt(tf,"onTransitionStart"),Lt(nf,"onTransitionCancel"),Lt(el,"onTransitionEnd"),ea("onMouseEnter",["mouseout","mouseover"]),ea("onMouseLeave",["mouseout","mouseover"]),ea("onPointerEnter",["pointerout","pointerover"]),ea("onPointerLeave",["pointerout","pointerover"]),Rn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Rn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Rn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Rn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Rn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Rn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var So="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Uf=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(So));function bu(n,a){a=(a&4)!==0;for(var r=0;r<n.length;r++){var s=n[r],c=s.event;s=s.listeners;e:{var p=void 0;if(a)for(var f=s.length-1;0<=f;f--){var y=s[f],A=y.instance,T=y.currentTarget;if(y=y.listener,A!==p&&c.isPropagationStopped())break e;p=y,c.currentTarget=T;try{p(c)}catch(q){br(q)}c.currentTarget=null,p=A}else for(f=0;f<s.length;f++){if(y=s[f],A=y.instance,T=y.currentTarget,y=y.listener,A!==p&&c.isPropagationStopped())break e;p=y,c.currentTarget=T;try{p(c)}catch(q){br(q)}c.currentTarget=null,p=A}}}}function ye(n,a){var r=a[Pr];r===void 0&&(r=a[Pr]=new Set);var s=n+"__bubble";r.has(s)||(vu(a,n,2,!1),r.add(s))}function Gi(n,a,r){var s=0;a&&(s|=4),vu(r,n,s,a)}var Cr="_reactListening"+Math.random().toString(36).slice(2);function Yi(n){if(!n[Cr]){n[Cr]=!0,fc.forEach(function(r){r!=="selectionchange"&&(Uf.has(r)||Gi(r,!1,n),Gi(r,!0,n))});var a=n.nodeType===9?n:n.ownerDocument;a===null||a[Cr]||(a[Cr]=!0,Gi("selectionchange",!1,a))}}function vu(n,a,r,s){switch(Fu(a)){case 2:var c=fh;break;case 8:c=mh;break;default:c=nc}r=c.bind(null,a,r,n),c=void 0,!ps||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(c=!0),s?c!==void 0?n.addEventListener(a,r,{capture:!0,passive:c}):n.addEventListener(a,r,!0):c!==void 0?n.addEventListener(a,r,{passive:c}):n.addEventListener(a,r,!1)}function Hi(n,a,r,s,c){var p=s;if((a&1)===0&&(a&2)===0&&s!==null)e:for(;;){if(s===null)return;var f=s.tag;if(f===3||f===4){var y=s.stateNode.containerInfo;if(y===c)break;if(f===4)for(f=s.return;f!==null;){var A=f.tag;if((A===3||A===4)&&f.stateNode.containerInfo===c)return;f=f.return}for(;y!==null;){if(f=In(y),f===null)return;if(A=f.tag,A===5||A===6||A===26||A===27){s=p=f;continue e}y=y.parentNode}}s=s.return}Dc(function(){var T=p,q=is(r),G=[];e:{var M=tl.get(n);if(M!==void 0){var R=Xo,de=n;switch(n){case"keypress":if(Ho(r)===0)break e;case"keydown":case"keyup":R=Rd;break;case"focusin":de="focus",R=hs;break;case"focusout":de="blur",R=hs;break;case"beforeblur":case"afterblur":R=hs;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":R=Mc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":R=vd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":R=Ld;break;case Ic:case Pc:case Wc:R=Sd;break;case el:R=qd;break;case"scroll":case"scrollend":R=xd;break;case"wheel":R=Bd;break;case"copy":case"cut":case"paste":R=Od;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":R=Rc;break;case"toggle":case"beforetoggle":R=Gd}var pe=(a&4)!==0,ze=!pe&&(n==="scroll"||n==="scrollend"),j=pe?M!==null?M+"Capture":null:M;pe=[];for(var E=T,_;E!==null;){var B=E;if(_=B.stateNode,B=B.tag,B!==5&&B!==26&&B!==27||_===null||j===null||(B=Ga(E,j),B!=null&&pe.push(Eo(E,B,_))),ze)break;E=E.return}0<pe.length&&(M=new R(M,de,null,r,q),G.push({event:M,listeners:pe}))}}if((a&7)===0){e:{if(M=n==="mouseover"||n==="pointerover",R=n==="mouseout"||n==="pointerout",M&&r!==ss&&(de=r.relatedTarget||r.fromElement)&&(In(de)||de[Jn]))break e;if((R||M)&&(M=q.window===q?q:(M=q.ownerDocument)?M.defaultView||M.parentWindow:window,R?(de=r.relatedTarget||r.toElement,R=T,de=de?In(de):null,de!==null&&(ze=d(de),pe=de.tag,de!==ze||pe!==5&&pe!==27&&pe!==6)&&(de=null)):(R=null,de=T),R!==de)){if(pe=Mc,B="onMouseLeave",j="onMouseEnter",E="mouse",(n==="pointerout"||n==="pointerover")&&(pe=Rc,B="onPointerLeave",j="onPointerEnter",E="pointer"),ze=R==null?M:Ua(R),_=de==null?M:Ua(de),M=new pe(B,E+"leave",R,r,q),M.target=ze,M.relatedTarget=_,B=null,In(q)===T&&(pe=new pe(j,E+"enter",de,r,q),pe.target=_,pe.relatedTarget=ze,B=pe),ze=B,R&&de)t:{for(pe=R,j=de,E=0,_=pe;_;_=za(_))E++;for(_=0,B=j;B;B=za(B))_++;for(;0<E-_;)pe=za(pe),E--;for(;0<_-E;)j=za(j),_--;for(;E--;){if(pe===j||j!==null&&pe===j.alternate)break t;pe=za(pe),j=za(j)}pe=null}else pe=null;R!==null&&wu(G,M,R,pe,!1),de!==null&&ze!==null&&wu(G,ze,de,pe,!0)}}e:{if(M=T?Ua(T):window,R=M.nodeName&&M.nodeName.toLowerCase(),R==="select"||R==="input"&&M.type==="file")var oe=Uc;else if($c(M))if(Gc)oe=Id;else{oe=Kd;var ge=Qd}else R=M.nodeName,!R||R.toLowerCase()!=="input"||M.type!=="checkbox"&&M.type!=="radio"?T&&rs(T.elementType)&&(oe=Uc):oe=Jd;if(oe&&(oe=oe(n,T))){Bc(G,oe,r,q);break e}ge&&ge(n,M,T),n==="focusout"&&T&&M.type==="number"&&T.memoizedProps.value!=null&&os(M,"number",M.value)}switch(ge=T?Ua(T):window,n){case"focusin":($c(ge)||ge.contentEditable==="true")&&(ia=ge,vs=T,Ka=null);break;case"focusout":Ka=vs=ia=null;break;case"mousedown":ws=!0;break;case"contextmenu":case"mouseup":case"dragend":ws=!1,Kc(G,r,q);break;case"selectionchange":if(Wd)break;case"keydown":case"keyup":Kc(G,r,q)}var ie;if(gs)e:{switch(n){case"compositionstart":var ue="onCompositionStart";break e;case"compositionend":ue="onCompositionEnd";break e;case"compositionupdate":ue="onCompositionUpdate";break e}ue=void 0}else sa?Nc(n,r)&&(ue="onCompositionEnd"):n==="keydown"&&r.keyCode===229&&(ue="onCompositionStart");ue&&(Cc&&r.locale!=="ko"&&(sa||ue!=="onCompositionStart"?ue==="onCompositionEnd"&&sa&&(ie=_c()):(cn=q,us="value"in cn?cn.value:cn.textContent,sa=!0)),ge=kr(T,ue),0<ge.length&&(ue=new zc(ue,n,null,r,q),G.push({event:ue,listeners:ge}),ie?ue.data=ie:(ie=qc(r),ie!==null&&(ue.data=ie)))),(ie=Hd?Fd(n,r):Xd(n,r))&&(ue=kr(T,"onBeforeInput"),0<ue.length&&(ge=new zc("onBeforeInput","beforeinput",null,r,q),G.push({event:ge,listeners:ue}),ge.data=ie)),qf(G,n,T,r,q)}bu(G,a)})}function Eo(n,a,r){return{instance:n,listener:a,currentTarget:r}}function kr(n,a){for(var r=a+"Capture",s=[];n!==null;){var c=n,p=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||p===null||(c=Ga(n,r),c!=null&&s.unshift(Eo(n,c,p)),c=Ga(n,a),c!=null&&s.push(Eo(n,c,p))),n.tag===3)return s;n=n.return}return[]}function za(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function wu(n,a,r,s,c){for(var p=a._reactName,f=[];r!==null&&r!==s;){var y=r,A=y.alternate,T=y.stateNode;if(y=y.tag,A!==null&&A===s)break;y!==5&&y!==26&&y!==27||T===null||(A=T,c?(T=Ga(r,p),T!=null&&f.unshift(Eo(r,T,A))):c||(T=Ga(r,p),T!=null&&f.push(Eo(r,T,A)))),r=r.return}f.length!==0&&n.push({event:a,listeners:f})}var Gf=/\r\n?/g,Yf=/\u0000|\uFFFD/g;function Au(n){return(typeof n=="string"?n:""+n).replace(Gf,`
`).replace(Yf,"")}function Su(n,a){return a=Au(a),Au(n)===a}function Lr(){}function Me(n,a,r,s,c,p){switch(r){case"children":typeof s=="string"?a==="body"||a==="textarea"&&s===""||aa(n,s):(typeof s=="number"||typeof s=="bigint")&&a!=="body"&&aa(n,""+s);break;case"className":$o(n,"class",s);break;case"tabIndex":$o(n,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":$o(n,r,s);break;case"style":Oc(n,s,p);break;case"data":if(a!=="object"){$o(n,"data",s);break}case"src":case"href":if(s===""&&(a!=="a"||r!=="href")){n.removeAttribute(r);break}if(s==null||typeof s=="function"||typeof s=="symbol"||typeof s=="boolean"){n.removeAttribute(r);break}s=Go(""+s),n.setAttribute(r,s);break;case"action":case"formAction":if(typeof s=="function"){n.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof p=="function"&&(r==="formAction"?(a!=="input"&&Me(n,a,"name",c.name,c,null),Me(n,a,"formEncType",c.formEncType,c,null),Me(n,a,"formMethod",c.formMethod,c,null),Me(n,a,"formTarget",c.formTarget,c,null)):(Me(n,a,"encType",c.encType,c,null),Me(n,a,"method",c.method,c,null),Me(n,a,"target",c.target,c,null)));if(s==null||typeof s=="symbol"||typeof s=="boolean"){n.removeAttribute(r);break}s=Go(""+s),n.setAttribute(r,s);break;case"onClick":s!=null&&(n.onclick=Lr);break;case"onScroll":s!=null&&ye("scroll",n);break;case"onScrollEnd":s!=null&&ye("scrollend",n);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(l(61));if(r=s.__html,r!=null){if(c.children!=null)throw Error(l(60));n.innerHTML=r}}break;case"multiple":n.multiple=s&&typeof s!="function"&&typeof s!="symbol";break;case"muted":n.muted=s&&typeof s!="function"&&typeof s!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(s==null||typeof s=="function"||typeof s=="boolean"||typeof s=="symbol"){n.removeAttribute("xlink:href");break}r=Go(""+s),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":s!=null&&typeof s!="function"&&typeof s!="symbol"?n.setAttribute(r,""+s):n.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&typeof s!="function"&&typeof s!="symbol"?n.setAttribute(r,""):n.removeAttribute(r);break;case"capture":case"download":s===!0?n.setAttribute(r,""):s!==!1&&s!=null&&typeof s!="function"&&typeof s!="symbol"?n.setAttribute(r,s):n.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":s!=null&&typeof s!="function"&&typeof s!="symbol"&&!isNaN(s)&&1<=s?n.setAttribute(r,s):n.removeAttribute(r);break;case"rowSpan":case"start":s==null||typeof s=="function"||typeof s=="symbol"||isNaN(s)?n.removeAttribute(r):n.setAttribute(r,s);break;case"popover":ye("beforetoggle",n),ye("toggle",n),qo(n,"popover",s);break;case"xlinkActuate":Ft(n,"http://www.w3.org/1999/xlink","xlink:actuate",s);break;case"xlinkArcrole":Ft(n,"http://www.w3.org/1999/xlink","xlink:arcrole",s);break;case"xlinkRole":Ft(n,"http://www.w3.org/1999/xlink","xlink:role",s);break;case"xlinkShow":Ft(n,"http://www.w3.org/1999/xlink","xlink:show",s);break;case"xlinkTitle":Ft(n,"http://www.w3.org/1999/xlink","xlink:title",s);break;case"xlinkType":Ft(n,"http://www.w3.org/1999/xlink","xlink:type",s);break;case"xmlBase":Ft(n,"http://www.w3.org/XML/1998/namespace","xml:base",s);break;case"xmlLang":Ft(n,"http://www.w3.org/XML/1998/namespace","xml:lang",s);break;case"xmlSpace":Ft(n,"http://www.w3.org/XML/1998/namespace","xml:space",s);break;case"is":qo(n,"is",s);break;case"innerText":case"textContent":break;default:(!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(r=md.get(r)||r,qo(n,r,s))}}function Fi(n,a,r,s,c,p){switch(r){case"style":Oc(n,s,p);break;case"dangerouslySetInnerHTML":if(s!=null){if(typeof s!="object"||!("__html"in s))throw Error(l(61));if(r=s.__html,r!=null){if(c.children!=null)throw Error(l(60));n.innerHTML=r}}break;case"children":typeof s=="string"?aa(n,s):(typeof s=="number"||typeof s=="bigint")&&aa(n,""+s);break;case"onScroll":s!=null&&ye("scroll",n);break;case"onScrollEnd":s!=null&&ye("scrollend",n);break;case"onClick":s!=null&&(n.onclick=Lr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!hc.hasOwnProperty(r))e:{if(r[0]==="o"&&r[1]==="n"&&(c=r.endsWith("Capture"),a=r.slice(2,c?r.length-7:void 0),p=n[st]||null,p=p!=null?p[r]:null,typeof p=="function"&&n.removeEventListener(a,p,c),typeof s=="function")){typeof p!="function"&&p!==null&&(r in n?n[r]=null:n.hasAttribute(r)&&n.removeAttribute(r)),n.addEventListener(a,s,c);break e}r in n?n[r]=s:s===!0?n.setAttribute(r,""):qo(n,r,s)}}}function We(n,a,r){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ye("error",n),ye("load",n);var s=!1,c=!1,p;for(p in r)if(r.hasOwnProperty(p)){var f=r[p];if(f!=null)switch(p){case"src":s=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(l(137,a));default:Me(n,a,p,f,r,null)}}c&&Me(n,a,"srcSet",r.srcSet,r,null),s&&Me(n,a,"src",r.src,r,null);return;case"input":ye("invalid",n);var y=p=f=c=null,A=null,T=null;for(s in r)if(r.hasOwnProperty(s)){var q=r[s];if(q!=null)switch(s){case"name":c=q;break;case"type":f=q;break;case"checked":A=q;break;case"defaultChecked":T=q;break;case"value":p=q;break;case"defaultValue":y=q;break;case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(l(137,a));break;default:Me(n,a,s,q,r,null)}}wc(n,p,y,A,T,f,c,!1),Bo(n);return;case"select":ye("invalid",n),s=f=p=null;for(c in r)if(r.hasOwnProperty(c)&&(y=r[c],y!=null))switch(c){case"value":p=y;break;case"defaultValue":f=y;break;case"multiple":s=y;default:Me(n,a,c,y,r,null)}a=p,r=f,n.multiple=!!s,a!=null?na(n,!!s,a,!1):r!=null&&na(n,!!s,r,!0);return;case"textarea":ye("invalid",n),p=c=s=null;for(f in r)if(r.hasOwnProperty(f)&&(y=r[f],y!=null))switch(f){case"value":s=y;break;case"defaultValue":c=y;break;case"children":p=y;break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(l(91));break;default:Me(n,a,f,y,r,null)}Sc(n,s,c,p),Bo(n);return;case"option":for(A in r)if(r.hasOwnProperty(A)&&(s=r[A],s!=null))switch(A){case"selected":n.selected=s&&typeof s!="function"&&typeof s!="symbol";break;default:Me(n,a,A,s,r,null)}return;case"dialog":ye("beforetoggle",n),ye("toggle",n),ye("cancel",n),ye("close",n);break;case"iframe":case"object":ye("load",n);break;case"video":case"audio":for(s=0;s<So.length;s++)ye(So[s],n);break;case"image":ye("error",n),ye("load",n);break;case"details":ye("toggle",n);break;case"embed":case"source":case"link":ye("error",n),ye("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(T in r)if(r.hasOwnProperty(T)&&(s=r[T],s!=null))switch(T){case"children":case"dangerouslySetInnerHTML":throw Error(l(137,a));default:Me(n,a,T,s,r,null)}return;default:if(rs(a)){for(q in r)r.hasOwnProperty(q)&&(s=r[q],s!==void 0&&Fi(n,a,q,s,r,void 0));return}}for(y in r)r.hasOwnProperty(y)&&(s=r[y],s!=null&&Me(n,a,y,s,r,null))}function Hf(n,a,r,s){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,p=null,f=null,y=null,A=null,T=null,q=null;for(R in r){var G=r[R];if(r.hasOwnProperty(R)&&G!=null)switch(R){case"checked":break;case"value":break;case"defaultValue":A=G;default:s.hasOwnProperty(R)||Me(n,a,R,null,s,G)}}for(var M in s){var R=s[M];if(G=r[M],s.hasOwnProperty(M)&&(R!=null||G!=null))switch(M){case"type":p=R;break;case"name":c=R;break;case"checked":T=R;break;case"defaultChecked":q=R;break;case"value":f=R;break;case"defaultValue":y=R;break;case"children":case"dangerouslySetInnerHTML":if(R!=null)throw Error(l(137,a));break;default:R!==G&&Me(n,a,M,R,s,G)}}as(n,f,y,A,T,q,p,c);return;case"select":R=f=y=M=null;for(p in r)if(A=r[p],r.hasOwnProperty(p)&&A!=null)switch(p){case"value":break;case"multiple":R=A;default:s.hasOwnProperty(p)||Me(n,a,p,null,s,A)}for(c in s)if(p=s[c],A=r[c],s.hasOwnProperty(c)&&(p!=null||A!=null))switch(c){case"value":M=p;break;case"defaultValue":y=p;break;case"multiple":f=p;default:p!==A&&Me(n,a,c,p,s,A)}a=y,r=f,s=R,M!=null?na(n,!!r,M,!1):!!s!=!!r&&(a!=null?na(n,!!r,a,!0):na(n,!!r,r?[]:"",!1));return;case"textarea":R=M=null;for(y in r)if(c=r[y],r.hasOwnProperty(y)&&c!=null&&!s.hasOwnProperty(y))switch(y){case"value":break;case"children":break;default:Me(n,a,y,null,s,c)}for(f in s)if(c=s[f],p=r[f],s.hasOwnProperty(f)&&(c!=null||p!=null))switch(f){case"value":M=c;break;case"defaultValue":R=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(l(91));break;default:c!==p&&Me(n,a,f,c,s,p)}Ac(n,M,R);return;case"option":for(var de in r)if(M=r[de],r.hasOwnProperty(de)&&M!=null&&!s.hasOwnProperty(de))switch(de){case"selected":n.selected=!1;break;default:Me(n,a,de,null,s,M)}for(A in s)if(M=s[A],R=r[A],s.hasOwnProperty(A)&&M!==R&&(M!=null||R!=null))switch(A){case"selected":n.selected=M&&typeof M!="function"&&typeof M!="symbol";break;default:Me(n,a,A,M,s,R)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var pe in r)M=r[pe],r.hasOwnProperty(pe)&&M!=null&&!s.hasOwnProperty(pe)&&Me(n,a,pe,null,s,M);for(T in s)if(M=s[T],R=r[T],s.hasOwnProperty(T)&&M!==R&&(M!=null||R!=null))switch(T){case"children":case"dangerouslySetInnerHTML":if(M!=null)throw Error(l(137,a));break;default:Me(n,a,T,M,s,R)}return;default:if(rs(a)){for(var ze in r)M=r[ze],r.hasOwnProperty(ze)&&M!==void 0&&!s.hasOwnProperty(ze)&&Fi(n,a,ze,void 0,s,M);for(q in s)M=s[q],R=r[q],!s.hasOwnProperty(q)||M===R||M===void 0&&R===void 0||Fi(n,a,q,M,s,R);return}}for(var j in r)M=r[j],r.hasOwnProperty(j)&&M!=null&&!s.hasOwnProperty(j)&&Me(n,a,j,null,s,M);for(G in s)M=s[G],R=r[G],!s.hasOwnProperty(G)||M===R||M==null&&R==null||Me(n,a,G,M,s,R)}var Xi=null,Vi=null;function Nr(n){return n.nodeType===9?n:n.ownerDocument}function Eu(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ou(n,a){if(n===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&a==="foreignObject"?0:n}function Zi(n,a){return n==="textarea"||n==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Qi=null;function Ff(){var n=window.event;return n&&n.type==="popstate"?n===Qi?!1:(Qi=n,!0):(Qi=null,!1)}var ju=typeof setTimeout=="function"?setTimeout:void 0,Xf=typeof clearTimeout=="function"?clearTimeout:void 0,Du=typeof Promise=="function"?Promise:void 0,Vf=typeof queueMicrotask=="function"?queueMicrotask:typeof Du<"u"?function(n){return Du.resolve(null).then(n).catch(Zf)}:ju;function Zf(n){setTimeout(function(){throw n})}function On(n){return n==="head"}function _u(n,a){var r=a,s=0,c=0;do{var p=r.nextSibling;if(n.removeChild(r),p&&p.nodeType===8)if(r=p.data,r==="/$"){if(0<s&&8>s){r=s;var f=n.ownerDocument;if(r&1&&Oo(f.documentElement),r&2&&Oo(f.body),r&4)for(r=f.head,Oo(r),f=r.firstChild;f;){var y=f.nextSibling,A=f.nodeName;f[Ba]||A==="SCRIPT"||A==="STYLE"||A==="LINK"&&f.rel.toLowerCase()==="stylesheet"||r.removeChild(f),f=y}}if(c===0){n.removeChild(p),Co(a);return}c--}else r==="$"||r==="$?"||r==="$!"?c++:s=r.charCodeAt(0)-48;else s=0;r=p}while(r);Co(a)}function Ki(n){var a=n.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var r=a;switch(a=a.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":Ki(r),Wr(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(r.rel.toLowerCase()==="stylesheet")continue}n.removeChild(r)}}function Qf(n,a,r,s){for(;n.nodeType===1;){var c=r;if(n.nodeName.toLowerCase()!==a.toLowerCase()){if(!s&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(s){if(!n[Ba])switch(a){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(p=n.getAttribute("rel"),p==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(p!==c.rel||n.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||n.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||n.getAttribute("title")!==(c.title==null?null:c.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(p=n.getAttribute("src"),(p!==(c.src==null?null:c.src)||n.getAttribute("type")!==(c.type==null?null:c.type)||n.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&p&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(a==="input"&&n.type==="hidden"){var p=c.name==null?null:""+c.name;if(c.type==="hidden"&&n.getAttribute("name")===p)return n}else return n;if(n=qt(n.nextSibling),n===null)break}return null}function Kf(n,a,r){if(a==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!r||(n=qt(n.nextSibling),n===null))return null;return n}function Ji(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState==="complete"}function Jf(n,a){var r=n.ownerDocument;if(n.data!=="$?"||r.readyState==="complete")a();else{var s=function(){a(),r.removeEventListener("DOMContentLoaded",s)};r.addEventListener("DOMContentLoaded",s),n._reactRetry=s}}function qt(n){for(;n!=null;n=n.nextSibling){var a=n.nodeType;if(a===1||a===3)break;if(a===8){if(a=n.data,a==="$"||a==="$!"||a==="$?"||a==="F!"||a==="F")break;if(a==="/$")return null}}return n}var Ii=null;function Tu(n){n=n.previousSibling;for(var a=0;n;){if(n.nodeType===8){var r=n.data;if(r==="$"||r==="$!"||r==="$?"){if(a===0)return n;a--}else r==="/$"&&a++}n=n.previousSibling}return null}function Mu(n,a,r){switch(a=Nr(r),n){case"html":if(n=a.documentElement,!n)throw Error(l(452));return n;case"head":if(n=a.head,!n)throw Error(l(453));return n;case"body":if(n=a.body,!n)throw Error(l(454));return n;default:throw Error(l(451))}}function Oo(n){for(var a=n.attributes;a.length;)n.removeAttributeNode(a[0]);Wr(n)}var zt=new Map,zu=new Set;function qr(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var on=Z.d;Z.d={f:If,r:Pf,D:Wf,C:eh,L:th,m:nh,X:oh,S:ah,M:rh};function If(){var n=on.f(),a=_r();return n||a}function Pf(n){var a=Pn(n);a!==null&&a.tag===5&&a.type==="form"?Il(a):on.r(n)}var Ra=typeof document>"u"?null:document;function Ru(n,a,r){var s=Ra;if(s&&typeof a=="string"&&a){var c=Et(a);c='link[rel="'+n+'"][href="'+c+'"]',typeof r=="string"&&(c+='[crossorigin="'+r+'"]'),zu.has(c)||(zu.add(c),n={rel:n,crossOrigin:r,href:a},s.querySelector(c)===null&&(a=s.createElement("link"),We(a,"link",n),Ve(a),s.head.appendChild(a)))}}function Wf(n){on.D(n),Ru("dns-prefetch",n,null)}function eh(n,a){on.C(n,a),Ru("preconnect",n,a)}function th(n,a,r){on.L(n,a,r);var s=Ra;if(s&&n&&a){var c='link[rel="preload"][as="'+Et(a)+'"]';a==="image"&&r&&r.imageSrcSet?(c+='[imagesrcset="'+Et(r.imageSrcSet)+'"]',typeof r.imageSizes=="string"&&(c+='[imagesizes="'+Et(r.imageSizes)+'"]')):c+='[href="'+Et(n)+'"]';var p=c;switch(a){case"style":p=Ca(n);break;case"script":p=ka(n)}zt.has(p)||(n=v({rel:"preload",href:a==="image"&&r&&r.imageSrcSet?void 0:n,as:a},r),zt.set(p,n),s.querySelector(c)!==null||a==="style"&&s.querySelector(jo(p))||a==="script"&&s.querySelector(Do(p))||(a=s.createElement("link"),We(a,"link",n),Ve(a),s.head.appendChild(a)))}}function nh(n,a){on.m(n,a);var r=Ra;if(r&&n){var s=a&&typeof a.as=="string"?a.as:"script",c='link[rel="modulepreload"][as="'+Et(s)+'"][href="'+Et(n)+'"]',p=c;switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":p=ka(n)}if(!zt.has(p)&&(n=v({rel:"modulepreload",href:n},a),zt.set(p,n),r.querySelector(c)===null)){switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(r.querySelector(Do(p)))return}s=r.createElement("link"),We(s,"link",n),Ve(s),r.head.appendChild(s)}}}function ah(n,a,r){on.S(n,a,r);var s=Ra;if(s&&n){var c=Wn(s).hoistableStyles,p=Ca(n);a=a||"default";var f=c.get(p);if(!f){var y={loading:0,preload:null};if(f=s.querySelector(jo(p)))y.loading=5;else{n=v({rel:"stylesheet",href:n,"data-precedence":a},r),(r=zt.get(p))&&Pi(n,r);var A=f=s.createElement("link");Ve(A),We(A,"link",n),A._p=new Promise(function(T,q){A.onload=T,A.onerror=q}),A.addEventListener("load",function(){y.loading|=1}),A.addEventListener("error",function(){y.loading|=2}),y.loading|=4,$r(f,a,s)}f={type:"stylesheet",instance:f,count:1,state:y},c.set(p,f)}}}function oh(n,a){on.X(n,a);var r=Ra;if(r&&n){var s=Wn(r).hoistableScripts,c=ka(n),p=s.get(c);p||(p=r.querySelector(Do(c)),p||(n=v({src:n,async:!0},a),(a=zt.get(c))&&Wi(n,a),p=r.createElement("script"),Ve(p),We(p,"link",n),r.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},s.set(c,p))}}function rh(n,a){on.M(n,a);var r=Ra;if(r&&n){var s=Wn(r).hoistableScripts,c=ka(n),p=s.get(c);p||(p=r.querySelector(Do(c)),p||(n=v({src:n,async:!0,type:"module"},a),(a=zt.get(c))&&Wi(n,a),p=r.createElement("script"),Ve(p),We(p,"link",n),r.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},s.set(c,p))}}function Cu(n,a,r,s){var c=(c=se.current)?qr(c):null;if(!c)throw Error(l(446));switch(n){case"meta":case"title":return null;case"style":return typeof r.precedence=="string"&&typeof r.href=="string"?(a=Ca(r.href),r=Wn(c).hoistableStyles,s=r.get(a),s||(s={type:"style",instance:null,count:0,state:null},r.set(a,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if(r.rel==="stylesheet"&&typeof r.href=="string"&&typeof r.precedence=="string"){n=Ca(r.href);var p=Wn(c).hoistableStyles,f=p.get(n);if(f||(c=c.ownerDocument||c,f={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},p.set(n,f),(p=c.querySelector(jo(n)))&&!p._p&&(f.instance=p,f.state.loading=5),zt.has(n)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},zt.set(n,r),p||sh(c,n,r,f.state))),a&&s===null)throw Error(l(528,""));return f}if(a&&s!==null)throw Error(l(529,""));return null;case"script":return a=r.async,r=r.src,typeof r=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=ka(r),r=Wn(c).hoistableScripts,s=r.get(a),s||(s={type:"script",instance:null,count:0,state:null},r.set(a,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error(l(444,n))}}function Ca(n){return'href="'+Et(n)+'"'}function jo(n){return'link[rel="stylesheet"]['+n+"]"}function ku(n){return v({},n,{"data-precedence":n.precedence,precedence:null})}function sh(n,a,r,s){n.querySelector('link[rel="preload"][as="style"]['+a+"]")?s.loading=1:(a=n.createElement("link"),s.preload=a,a.addEventListener("load",function(){return s.loading|=1}),a.addEventListener("error",function(){return s.loading|=2}),We(a,"link",r),Ve(a),n.head.appendChild(a))}function ka(n){return'[src="'+Et(n)+'"]'}function Do(n){return"script[async]"+n}function Lu(n,a,r){if(a.count++,a.instance===null)switch(a.type){case"style":var s=n.querySelector('style[data-href~="'+Et(r.href)+'"]');if(s)return a.instance=s,Ve(s),s;var c=v({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return s=(n.ownerDocument||n).createElement("style"),Ve(s),We(s,"style",c),$r(s,r.precedence,n),a.instance=s;case"stylesheet":c=Ca(r.href);var p=n.querySelector(jo(c));if(p)return a.state.loading|=4,a.instance=p,Ve(p),p;s=ku(r),(c=zt.get(c))&&Pi(s,c),p=(n.ownerDocument||n).createElement("link"),Ve(p);var f=p;return f._p=new Promise(function(y,A){f.onload=y,f.onerror=A}),We(p,"link",s),a.state.loading|=4,$r(p,r.precedence,n),a.instance=p;case"script":return p=ka(r.src),(c=n.querySelector(Do(p)))?(a.instance=c,Ve(c),c):(s=r,(c=zt.get(p))&&(s=v({},r),Wi(s,c)),n=n.ownerDocument||n,c=n.createElement("script"),Ve(c),We(c,"link",s),n.head.appendChild(c),a.instance=c);case"void":return null;default:throw Error(l(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(s=a.instance,a.state.loading|=4,$r(s,r.precedence,n));return a.instance}function $r(n,a,r){for(var s=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=s.length?s[s.length-1]:null,p=c,f=0;f<s.length;f++){var y=s[f];if(y.dataset.precedence===a)p=y;else if(p!==c)break}p?p.parentNode.insertBefore(n,p.nextSibling):(a=r.nodeType===9?r.head:r,a.insertBefore(n,a.firstChild))}function Pi(n,a){n.crossOrigin==null&&(n.crossOrigin=a.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=a.referrerPolicy),n.title==null&&(n.title=a.title)}function Wi(n,a){n.crossOrigin==null&&(n.crossOrigin=a.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=a.referrerPolicy),n.integrity==null&&(n.integrity=a.integrity)}var Br=null;function Nu(n,a,r){if(Br===null){var s=new Map,c=Br=new Map;c.set(r,s)}else c=Br,s=c.get(r),s||(s=new Map,c.set(r,s));if(s.has(n))return s;for(s.set(n,null),r=r.getElementsByTagName(n),c=0;c<r.length;c++){var p=r[c];if(!(p[Ba]||p[nt]||n==="link"&&p.getAttribute("rel")==="stylesheet")&&p.namespaceURI!=="http://www.w3.org/2000/svg"){var f=p.getAttribute(a)||"";f=n+f;var y=s.get(f);y?y.push(p):s.set(f,[p])}}return s}function qu(n,a,r){n=n.ownerDocument||n,n.head.insertBefore(r,a==="title"?n.querySelector("head > title"):null)}function ih(n,a,r){if(r===1||a.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return n=a.disabled,typeof a.precedence=="string"&&n==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function $u(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}var _o=null;function ch(){}function lh(n,a,r){if(_o===null)throw Error(l(475));var s=_o;if(a.type==="stylesheet"&&(typeof r.media!="string"||matchMedia(r.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var c=Ca(r.href),p=n.querySelector(jo(c));if(p){n=p._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(s.count++,s=Ur.bind(s),n.then(s,s)),a.state.loading|=4,a.instance=p,Ve(p);return}p=n.ownerDocument||n,r=ku(r),(c=zt.get(c))&&Pi(r,c),p=p.createElement("link"),Ve(p);var f=p;f._p=new Promise(function(y,A){f.onload=y,f.onerror=A}),We(p,"link",r),a.instance=p}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(a,n),(n=a.state.preload)&&(a.state.loading&3)===0&&(s.count++,a=Ur.bind(s),n.addEventListener("load",a),n.addEventListener("error",a))}}function ph(){if(_o===null)throw Error(l(475));var n=_o;return n.stylesheets&&n.count===0&&ec(n,n.stylesheets),0<n.count?function(a){var r=setTimeout(function(){if(n.stylesheets&&ec(n,n.stylesheets),n.unsuspend){var s=n.unsuspend;n.unsuspend=null,s()}},6e4);return n.unsuspend=a,function(){n.unsuspend=null,clearTimeout(r)}}:null}function Ur(){if(this.count--,this.count===0){if(this.stylesheets)ec(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var Gr=null;function ec(n,a){n.stylesheets=null,n.unsuspend!==null&&(n.count++,Gr=new Map,a.forEach(uh,n),Gr=null,Ur.call(n))}function uh(n,a){if(!(a.state.loading&4)){var r=Gr.get(n);if(r)var s=r.get(null);else{r=new Map,Gr.set(n,r);for(var c=n.querySelectorAll("link[data-precedence],style[data-precedence]"),p=0;p<c.length;p++){var f=c[p];(f.nodeName==="LINK"||f.getAttribute("media")!=="not all")&&(r.set(f.dataset.precedence,f),s=f)}s&&r.set(null,s)}c=a.instance,f=c.getAttribute("data-precedence"),p=r.get(f)||s,p===s&&r.set(null,c),r.set(f,c),this.count++,s=Ur.bind(this),c.addEventListener("load",s),c.addEventListener("error",s),p?p.parentNode.insertBefore(c,p.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(c,n.firstChild)),a.state.loading|=4}}var To={$$typeof:Y,Provider:null,Consumer:null,_currentValue:L,_currentValue2:L,_threadCount:0};function dh(n,a,r,s,c,p,f,y){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Kr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Kr(0),this.hiddenUpdates=Kr(null),this.identifierPrefix=s,this.onUncaughtError=c,this.onCaughtError=p,this.onRecoverableError=f,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=y,this.incompleteTransitions=new Map}function Bu(n,a,r,s,c,p,f,y,A,T,q,G){return n=new dh(n,a,r,f,y,A,T,G),a=1,p===!0&&(a|=24),p=xt(3,null,null,a),n.current=p,p.stateNode=n,a=Ls(),a.refCount++,n.pooledCache=a,a.refCount++,p.memoizedState={element:s,isDehydrated:r,cache:a},Bs(p),n}function Uu(n){return n?(n=ua,n):ua}function Gu(n,a,r,s,c,p){c=Uu(c),s.context===null?s.context=c:s.pendingContext=c,s=dn(a),s.payload={element:r},p=p===void 0?null:p,p!==null&&(s.callback=p),r=fn(n,s,a),r!==null&&(At(r,n,a),oo(r,n,a))}function Yu(n,a){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var r=n.retryLane;n.retryLane=r!==0&&r<a?r:a}}function tc(n,a){Yu(n,a),(n=n.alternate)&&Yu(n,a)}function Hu(n){if(n.tag===13){var a=pa(n,67108864);a!==null&&At(a,n,67108864),tc(n,67108864)}}var Yr=!0;function fh(n,a,r,s){var c=z.T;z.T=null;var p=Z.p;try{Z.p=2,nc(n,a,r,s)}finally{Z.p=p,z.T=c}}function mh(n,a,r,s){var c=z.T;z.T=null;var p=Z.p;try{Z.p=8,nc(n,a,r,s)}finally{Z.p=p,z.T=c}}function nc(n,a,r,s){if(Yr){var c=ac(s);if(c===null)Hi(n,a,s,Hr,r),Xu(n,s);else if(xh(c,n,a,r,s))s.stopPropagation();else if(Xu(n,s),a&4&&-1<gh.indexOf(n)){for(;c!==null;){var p=Pn(c);if(p!==null)switch(p.tag){case 3:if(p=p.stateNode,p.current.memoizedState.isDehydrated){var f=zn(p.pendingLanes);if(f!==0){var y=p;for(y.pendingLanes|=2,y.entangledLanes|=2;f;){var A=1<<31-ft(f);y.entanglements[1]|=A,f&=~A}Ht(p),(je&6)===0&&(jr=Re()+500,Ao(0))}}break;case 13:y=pa(p,2),y!==null&&At(y,p,2),_r(),tc(p,2)}if(p=ac(s),p===null&&Hi(n,a,s,Hr,r),p===c)break;c=p}c!==null&&s.stopPropagation()}else Hi(n,a,s,null,r)}}function ac(n){return n=is(n),oc(n)}var Hr=null;function oc(n){if(Hr=null,n=In(n),n!==null){var a=d(n);if(a===null)n=null;else{var r=a.tag;if(r===13){if(n=h(a),n!==null)return n;n=null}else if(r===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;n=null}else a!==n&&(n=null)}}return Hr=n,null}function Fu(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Rt()){case Ct:return 2;case $t:return 8;case kt:case Kn:return 32;case La:return 268435456;default:return 32}default:return 32}}var rc=!1,jn=null,Dn=null,_n=null,Mo=new Map,zo=new Map,Tn=[],gh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Xu(n,a){switch(n){case"focusin":case"focusout":jn=null;break;case"dragenter":case"dragleave":Dn=null;break;case"mouseover":case"mouseout":_n=null;break;case"pointerover":case"pointerout":Mo.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":zo.delete(a.pointerId)}}function Ro(n,a,r,s,c,p){return n===null||n.nativeEvent!==p?(n={blockedOn:a,domEventName:r,eventSystemFlags:s,nativeEvent:p,targetContainers:[c]},a!==null&&(a=Pn(a),a!==null&&Hu(a)),n):(n.eventSystemFlags|=s,a=n.targetContainers,c!==null&&a.indexOf(c)===-1&&a.push(c),n)}function xh(n,a,r,s,c){switch(a){case"focusin":return jn=Ro(jn,n,a,r,s,c),!0;case"dragenter":return Dn=Ro(Dn,n,a,r,s,c),!0;case"mouseover":return _n=Ro(_n,n,a,r,s,c),!0;case"pointerover":var p=c.pointerId;return Mo.set(p,Ro(Mo.get(p)||null,n,a,r,s,c)),!0;case"gotpointercapture":return p=c.pointerId,zo.set(p,Ro(zo.get(p)||null,n,a,r,s,c)),!0}return!1}function Vu(n){var a=In(n.target);if(a!==null){var r=d(a);if(r!==null){if(a=r.tag,a===13){if(a=h(r),a!==null){n.blockedOn=a,od(n.priority,function(){if(r.tag===13){var s=wt();s=Jr(s);var c=pa(r,s);c!==null&&At(c,r,s),tc(r,s)}});return}}else if(a===3&&r.stateNode.current.memoizedState.isDehydrated){n.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Fr(n){if(n.blockedOn!==null)return!1;for(var a=n.targetContainers;0<a.length;){var r=ac(n.nativeEvent);if(r===null){r=n.nativeEvent;var s=new r.constructor(r.type,r);ss=s,r.target.dispatchEvent(s),ss=null}else return a=Pn(r),a!==null&&Hu(a),n.blockedOn=r,!1;a.shift()}return!0}function Zu(n,a,r){Fr(n)&&r.delete(a)}function yh(){rc=!1,jn!==null&&Fr(jn)&&(jn=null),Dn!==null&&Fr(Dn)&&(Dn=null),_n!==null&&Fr(_n)&&(_n=null),Mo.forEach(Zu),zo.forEach(Zu)}function Xr(n,a){n.blockedOn===a&&(n.blockedOn=null,rc||(rc=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,yh)))}var Vr=null;function Qu(n){Vr!==n&&(Vr=n,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Vr===n&&(Vr=null);for(var a=0;a<n.length;a+=3){var r=n[a],s=n[a+1],c=n[a+2];if(typeof s!="function"){if(oc(s||r)===null)continue;break}var p=Pn(r);p!==null&&(n.splice(a,3),a-=3,oi(p,{pending:!0,data:c,method:r.method,action:s},s,c))}}))}function Co(n){function a(A){return Xr(A,n)}jn!==null&&Xr(jn,n),Dn!==null&&Xr(Dn,n),_n!==null&&Xr(_n,n),Mo.forEach(a),zo.forEach(a);for(var r=0;r<Tn.length;r++){var s=Tn[r];s.blockedOn===n&&(s.blockedOn=null)}for(;0<Tn.length&&(r=Tn[0],r.blockedOn===null);)Vu(r),r.blockedOn===null&&Tn.shift();if(r=(n.ownerDocument||n).$$reactFormReplay,r!=null)for(s=0;s<r.length;s+=3){var c=r[s],p=r[s+1],f=c[st]||null;if(typeof p=="function")f||Qu(r);else if(f){var y=null;if(p&&p.hasAttribute("formAction")){if(c=p,f=p[st]||null)y=f.formAction;else if(oc(c)!==null)continue}else y=f.action;typeof y=="function"?r[s+1]=y:(r.splice(s,3),s-=3),Qu(r)}}}function sc(n){this._internalRoot=n}Zr.prototype.render=sc.prototype.render=function(n){var a=this._internalRoot;if(a===null)throw Error(l(409));var r=a.current,s=wt();Gu(r,s,n,a,null,null)},Zr.prototype.unmount=sc.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var a=n.containerInfo;Gu(n.current,2,null,n,null,null),_r(),a[Jn]=null}};function Zr(n){this._internalRoot=n}Zr.prototype.unstable_scheduleHydration=function(n){if(n){var a=uc();n={blockedOn:null,target:n,priority:a};for(var r=0;r<Tn.length&&a!==0&&a<Tn[r].priority;r++);Tn.splice(r,0,n),r===0&&Vu(n)}};var Ku=o.version;if(Ku!=="19.1.1")throw Error(l(527,Ku,"19.1.1"));Z.findDOMNode=function(n){var a=n._reactInternals;if(a===void 0)throw typeof n.render=="function"?Error(l(188)):(n=Object.keys(n).join(","),Error(l(268,n)));return n=g(a),n=n!==null?b(n):null,n=n===null?null:n.stateNode,n};var bh={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Qr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qr.isDisabled&&Qr.supportsFiber)try{Na=Qr.inject(bh),dt=Qr}catch{}}return reactDomClient_production.createRoot=function(n,a){if(!u(n))throw Error(l(299));var r=!1,s="",c=up,p=dp,f=fp,y=null;return a!=null&&(a.unstable_strictMode===!0&&(r=!0),a.identifierPrefix!==void 0&&(s=a.identifierPrefix),a.onUncaughtError!==void 0&&(c=a.onUncaughtError),a.onCaughtError!==void 0&&(p=a.onCaughtError),a.onRecoverableError!==void 0&&(f=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(y=a.unstable_transitionCallbacks)),a=Bu(n,1,!1,null,null,r,s,c,p,f,y,null),n[Jn]=a.current,Yi(n),new sc(a)},reactDomClient_production.hydrateRoot=function(n,a,r){if(!u(n))throw Error(l(299));var s=!1,c="",p=up,f=dp,y=fp,A=null,T=null;return r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onUncaughtError!==void 0&&(p=r.onUncaughtError),r.onCaughtError!==void 0&&(f=r.onCaughtError),r.onRecoverableError!==void 0&&(y=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(A=r.unstable_transitionCallbacks),r.formState!==void 0&&(T=r.formState)),a=Bu(n,1,!0,a,r??null,s,c,p,f,y,A,T),a.context=Uu(null),r=a.current,s=wt(),s=Jr(s),c=dn(s),c.callback=null,fn(r,c,s),r=s,a.current.lanes=r,$a(a,r),Ht(a),n[Jn]=a.current,Yi(n),new Zr(a)},reactDomClient_production.version="19.1.1",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(o){console.error(o)}}return e(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient();const gettingStarted={name:"Getting Started: Introduction to Yield and RPN",description:"Yield is a concatenative, stack-based language. Operations are written in Reverse Polish Notation (RPN), where operators follow their operands.",cells:[{name:"Basic Arithmetic",description:"To add 2 and 3, you write `2 3 +`. The numbers are pushed onto a shared data stack, and the `+` operator pops them, adds them, and pushes the result back.",example:"2 3 +",expected:[5]},{name:"Chaining Operations",description:"Operations are executed from left to right. To calculate `(2 + 3) * 5`, you first perform the addition, leaving the result on the stack for the multiplication.",example:"2 3 + 5 *",expected:[25]},{name:"Primitives",description:"Yield supports several primitive data types. Numbers, booleans (`true`, `false`), and strings are pushed directly onto the stack.",example:'42 1.618 true "hello world"',expected:[42,1.618,!0,"hello world"]},{name:"Comments",description:"You can add comments to your code using `#` for line comments. The interpreter ignores them.",example:"1 2 + # -> 3",expected:[3]}]},stackPrimitives={name:"Stack Primitives: Manipulating Words and the Stack",description:"Since everything happens on the stack, there are powerful operators to manipulate its contents.",cells:[{name:"Duplicating with `dup`",description:"The `dup` operator duplicates the top item on the stack.",example:"10 dup",expected:[10,10]},{name:"Removing with `pop`",description:"The `pop` operator removes the top item from the stack.",example:"1 2 3 pop",expected:[1,2]},{name:"Swapping with `swap`",description:"The `swap` operator swaps the top two items on the stack.",example:"10 20 swap",expected:[20,10]},{name:"Clearing the Stack",description:"The `clear` operator removes all items, leaving the stack empty.",example:'1 2 3 "hello" clear',expected:[]}]},quotedPrograms={name:"Quoted Programs: Defining and Naming Programs",description:"In Yield, programs are just lists of words. These lists, called quotations, can be stored and executed later.",cells:[{name:"Quotations",description:"Anything inside parentheses `(...)` is a quotation. It is pushed onto the stack as a list without being executed.",example:"(1 2 3)",expected:[[1,2,3]]},{name:"Defining New Words with `=>`",description:"You can define new, executable words (functions) in the dictionary using the `=>` (`quote`) operator. It assigns the quotation on top of the stack to the name that follows it.",example:`(dup *) square => 
5 square`,replCode:`(dup *) square => 
5 square`,expected:[25]},{name:"Redefining Words",description:"You can redefine any word, including built-in operators. Be careful, this can lead to surprising results!",example:`(1 +) two => 
1 two`,replCode:`(1 +) two => 
1 two`,expected:[2]}]},combinators$1={name:"Combinators: Manipulating Stacks with Programs",description:"Combinators are special operators that take quotations from the stack and execute them in powerful ways.",cells:[{name:"Applying a Quotation with `i`",description:"The `i` combinator executes a quotation. It's the simplest way to run a program stored on the stack.",example:"(1 1 +) i",expected:[2]},{name:"Mapping with `map`",description:"The `map` combinator applies a quotation to each element of a list, creating a new list with the results.",example:"(1 2 3) (succ) map",expected:[[2,3,4]]},{name:"Conditional Logic with `ifte` (?)",description:"The `ifte` combinator provides if-then-else logic. It takes a boolean, a 'then' quotation, and an 'else' quotation. The `?` operator is a convenient alias for `ifte`.",example:'10 5 > ("Greater") ("Lesser") ?',expected:["Greater"]},{name:"Stateful Generators with `yield`",description:"The `yield` combinator enables creating stateful generators. This example generates the sequence of triangular numbers (a(n) = n * (n+1) / 2) by adding the current index to the previous term (a(n) = a(n-1) + n).",example:`
# State holds (n, a(n-1)), starting with (n=1, a(0)=0).
# The program calculates the new state (n+1, a(n)) and yields a(n).
((1 0) (dupd swap + swap succ swap) yield) next_triangular =>

# Generate the first 5 triangular numbers
(next_triangular) 5 times
`,expected:[1,3,6,10,15]}]},audio$1={name:"Audio: Making Beeps",description:"Yield has a built-in audio engine for live coding sound and music.",cells:[{name:"Playing a Sound",description:"Audio graphs are built on the stack as lists. `440 sine` creates a sine wave oscillator, `0.5 mul` adjusts its volume, and `play` starts the sound.",example:"440 sine 0.5 mul play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"An audio graph on the stack"},{name:"Creating a Rhythm",description:"The `impulse` operator creates a repeating trigger signal. We can feed this into a pre-built drum machine like `bd` (bass drum) to create a beat.",example:"2 impulse bd play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A rhythmic audio graph"},{name:"Composing a Song",description:"You can combine multiple sequences and voices to create a full musical piece. Here's a simple techno beat with a bassline, built using the powerful `voices` combinator.",example:`
# 1. Create a master clock signal
8 impulse

# 2. Use the 'voices' combinator to create three drum parts from the clock.
# Each part is a quotation that takes the clock and produces a final, gain-adjusted drum sound.
(
  ( (1 0 1 0 1 0 1 0) seq hh 0.5 mul )  # Hi-hat with gain 0.5
  ( (0 0 1 0 0 0 1 0) seq sd 0.8 mul )  # Snare with gain 0.8
  ( (1 0 0 0 1 0 0 0) seq bd 1.0 mul )  # Kick with gain 1.0
) voices

# The stack now contains [hi-hat_sound, snare_sound, kick_sound]. Let's mix them.
mix mix

# 3. Create the bassline using a fresh clock signal.
8 impulse (40 40 43 45 43 40 40 35) seq note saw 0.2 mul

# 4. Mix the combined drums with the bassline.
mix

# 5. Apply a master gain and play the final mix.
0.4 mul play
`,assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A complex audio graph for the song"}]},shaders$1={name:"Shaders: Creating Visuals",description:"You can create 3D visuals using Signed Distance Fields (SDFs).",cells:[{name:"Rendering a Shape",description:"First, create a shape like a `sphere`. Then, use `march` to create a scene object. Finally, `render` turns the scene into a visual shader.",example:"0.5 sphere march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object"},{name:"Adding Color",description:"Use the `material` operator to apply a color to a shape. You can use preset color names as strings.",example:"0.5 sphere :red material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A red shader object"},{name:"Procedural Animation",description:"Animate properties of shapes and materials over time using `t` and `mousey`. This example animates the 'scale' of a `mandelbox` fractal and cycles its color through the rainbow.",example:`
# Animate the 'scale' parameter of the mandelbox over time and with the mouse
(t sin 0.5 * 1.5 + mousey 0.005 * +) glsl # Scale
5.0                                      # Iterations
2.0                                      # Fold
mandelbox

# Apply an animated material that cycles through the rainbow
(
  t 0.2 * # Animate hue over time
  1.0     # Full saturation
  1.0     # Full brightness
  hsv
) glsl material

# Set up the scene, add a camera for a better view, and render
march
0 0 5 vec3 0 0 0 vec3 camera
render
`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A complex, animated shader object"},{name:"Animated Scene Tours",description:"The `path` operator can create cinematic fly-throughs of any 3D scene. You provide the scene and a path for the camera to follow, and it automatically carves a tunnel to avoid collisions.",example:`
# 1. A more detailed fractal world to make the tunnel more obvious
12 psychobox
# Make sure it's hollow for the fly-through by subtracting a smaller version
dup 0.95 scale 0.05 smoothDifference
# A procedural material based on position
(p 2 *) glsl curl material
march

# 2. Define a path that weaves through the fractal's holes
(
    t 0.2 * sin 2.0 *  # x: a sine wave
    t 0.3 * cos 2.0 *  # y: a cosine wave, creating a Lissajous curve
    t                  # z: move forward steadily
    vec3
) glsl

# 3. Create the tour. The 'path' operator carves a smooth tunnel.
path`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"An animated shader that flies through a psychedelic fractal."},{name:"Drawing Paths: The Flying Snake",description:"The `pathSDF` operator can render a path as a 3D tube, which is perfect for creating 'flying snake' or trail effects.",example:`
# 1. Define a spiraling path
(
    t 0.5 * sin # x
    t 0.5 * cos # y
    t           # z (moves forward over time)
    vec3
) glsl

# 2. Give the path a radius to create a tube
0.2

# 3. Create the path geometry
pathSDF

# 4. Apply a material that changes color along its length
(p z 0.5 *) glsl 1.0 1.0 hsv material

# 5. Set up the scene and a camera that follows the snake
march
(
    t 0.5 * sin 2 + # camera x
    t 0.5 * cos 2 + # camera y
    t               # z
    vec3
) glsl
(0 0 t vec3) glsl # camera target
camera
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:'A shader object rendering a colorful, spiraling "flying snake".'}]},repl$1={name:"Using REPL: System Commands",description:"The REPL has several built-in commands for managing your session.",cells:[{name:"Saving and Loading State",description:"`save` stores your current session (stack and definitions) in the browser's local storage. `load` restores it.",example:`1 2 3 "my-state" save 
clear 
"my-state" load`,expected:[1,2,3]},{name:"Undo and Redo in REPL",description:"The `undo` command reverts the last operation. `redo` applies it again. Left & right arrows also undo & redo. These operators work only in REPL.",example:["1 2 +","undo"],replCode:["1 2 +","undo"],expected:[]}]},projectEuler={name:"Yield for fun: Project Euler",description:"Solving classic programming puzzles with Yield is a great way to learn the language. Here are a few examples from Project Euler. The given solutions are not optimized in any way and Yield is running generator functions in JavaScript pushing and popping values to arrays in unnecessarily complex manner.",cells:[{name:"Problem 1: Multiples of 3 and 5",description:"If we list all the natural numbers below 10 that are multiples of 3 or 5, we get 3, 5, 6 and 9. The sum of these multiples is 23. Find the sum of all the multiples of 3 or 5 below 1000.",example:`
# 1. Generate numbers from 1 to 999
1 999 range

# 2. Filter for multiples of 3 or 5
(dup 3 % 0 == swap 5 % 0 == or) filter

# 3. Sum the resulting list
sum
`.trim(),expected:[233168]},{name:"Problem 2: Even Fibonacci Numbers",description:`Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be:
1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...
By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.`,example:`
# Generator for Fibonacci numbers: 1, 2, 3, 5...
((0 1) (swap dupd +) yield) fib =>

# Summing the even ones, then pop the final number (>4M).
(fib dup 4000000 <) (dup 2 % 0 == (+) (pop) ?) while pop
`.trim(),expected:[4613732]},{name:"Problem 3: Largest Prime Factor",description:`The prime factors of 13195 are 5, 7, 13 and 29.
What is the largest prime factor of the number 600851475143?`,example:`
# The strategy is to find the smallest prime factors first and divide them out
600851475143

# Handle all factors of 2 - the number here is odd, but this is for good practice:
(dup 2 % 0 ==) (2 /) while

# Start checking for odd divisors from 3
3

# Loop while D*D <= N. If D gets bigger than sqrt(N), the remaining N must be prime.
(over over dup * swap <=)
(over over % 0 == (swap over / swap) (2 +) ?) 
while

# After the loop, the stack is [N D]. The remaining N is the largest prime factor. Discard D.
pop
`.trim(),expected:[6857]},{name:"Problem n: Only 947 more to go...",description:"These are just a few examples to get you started. For a full list of challenging and fun mathematical problems that may or may not be good fit for concatenative languages, visit the Project Euler website: https://projecteuler.net/. There's surely enough to make you Yield!",example:"# Happy Yielding!"}]},documentation=[gettingStarted,stackPrimitives,quotedPrograms,combinators$1,audio$1,shaders$1,repl$1,projectEuler],iterate={definition:{exec:function*(e,o,i){const l=e.pop();yield*i(Array.isArray(l)?l:[l],e,o)},description:"Executes a program (quotation) from the stack. Alias: `i`.",effect:"[[P]] -> ..."},examples:[{code:"(1 1 +) iterate",expected:[2]},{code:"(1 2 +) i",expected:[3]},{code:"(iterate) meh => (1 1 +) meh",expected:[2]}]},dip={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();yield*i(l,e,o),e.push(u)},description:"Saves the top element, executes a program, then restores the element.",effect:"[A [P]] -> [A]"},examples:[{code:"10 (20 30 +) dip",expected:[50,10]},{code:"1 (2 3 +) dip (4 5 +) dip",expected:[5,9,1]}]},deepEqual=(e,o)=>JSON.stringify(e)===JSON.stringify(o),deepClone=e=>{try{return structuredClone(e)}catch{if(e===null||typeof e!="object")return e;if(e instanceof Array)return e.map(deepClone);if(e.constructor===Object){const i={};for(const l in e)e.hasOwnProperty(l)&&(i[l]=deepClone(e[l]));return i}return e}},isMatrix=e=>{if(!Array.isArray(e))return!1;if(e.length===0)return!0;const o=e[0];if(!Array.isArray(o))return!1;const i=o.length;return e.every(l=>Array.isArray(l)&&l.length===i)},isFlatList=e=>Array.isArray(e)&&!isMatrix(e),yieldFormatter=e=>{if(typeof e=="string")return e.startsWith("\0")?`"${e.slice(1)}"`:e;if(Array.isArray(e))return`(${e.map(yieldFormatter).join(" ")})`;if(e===!0)return"true";if(e===!1)return"false";if(typeof e=="object"&&e!==null){if(e.type==="until-process"){const{quotation:o,intervalBeats:i,endBeats:l}=e;return`(${yieldFormatter(o)} ${i} ${l} until)`}if(e.type==="until-def"){if(Array.isArray(e.sourceCode))return yieldFormatter(e.sourceCode);const{initialValue:o,quotation:i,intervalBeats:l,endBeats:u}=e;return`(${yieldFormatter(o)} ${yieldFormatter(i)} ${l} ${u} until)`}if(e.type==="live-loop-def")return Array.isArray(e.sourceCode)?yieldFormatter(e.sourceCode):Array.isArray(e.quotation)&&typeof e.beatValue=="number"?`(${yieldFormatter(e.quotation)} ${e.beatValue} live)`:"<live-loop>";if(e.type==="shader")return"<shader>";if(e.type==="scene")return"<scene>";if(e.type==="light")return"<light>";if(e.type==="color")return"<color>";if(e.type==="glsl_expression")return"<glsl_expression>";if(e.type==="postEffect")return`<${e.op} effect>`;if(["geometry","combinator","transformation","alteration"].includes(e.type))return"<sdf>"}if(typeof e=="symbol"){const o=Symbol.keyFor(e);return o!==void 0?`:${o}`:e.toString()}return String(e)},applyBinaryOp=(e,o,i)=>{if(typeof o=="number"&&typeof i=="number"){const l=e(o,i);return l===null?null:l}if(Array.isArray(o)&&typeof i=="number")return o.map(l=>applyBinaryOp(e,l,i));if(typeof o=="number"&&Array.isArray(i))return i.map(l=>applyBinaryOp(e,o,l));if(Array.isArray(o)&&Array.isArray(i)){const l=[];for(const u of o)for(const d of i){const h=applyBinaryOp(e,u,d);Array.isArray(h)?l.push(...h):l.push(h)}return l}throw new Error(`Incompatible types for binary math operation: ${yieldFormatter(o)} and ${yieldFormatter(i)}`)},isMarchingObject=e=>e&&typeof e=="object"&&["geometry","combinator","transformation","alteration"].includes(e.type),createMarchingObject=(e,o,i,l={})=>({op:e,type:o,children:i,props:l}),isColorObject=e=>e&&typeof e=="object"&&e.type==="color",materialPresets={red:[1,.2,.2],green:[.2,1,.2],blue:[.2,.2,1],yellow:[1,1,.2],cyan:[.2,1,1],magenta:[1,.2,1],white:[1,1,1],black:[0,0,0],gray:[.5,.5,.5],orange:[1,.5,0],purple:[.5,0,1],teal:[0,.5,.5]},toGLSL=e=>{if((e==null?void 0:e.type)==="glsl_expression")return e.code;if(isColorObject(e))return e.expression;if(typeof e=="number"){const o=e.toString();return Number.isInteger(e)&&!o.includes("e")&&!o.includes(".")?o+".0":o}if(typeof e=="symbol"){const o=Symbol.keyFor(e);if(o&&materialPresets[o])return toGLSL(materialPresets[o])}if(typeof e=="string")return materialPresets[e]?toGLSL(materialPresets[e]):e;if(Array.isArray(e)){if(isMatrix(e)){const o=e,i=o.length;if(i===0)return"";const l=o[0].length;if(i!==l)return"";const u=o.flat();return i===3?`mat3(${u.map(d=>toGLSL(d)).join(", ")})`:i===4?`mat4(${u.map(d=>toGLSL(d)).join(", ")})`:""}if(e.length===2)return`vec2(${e.map(toGLSL).join(", ")})`;if(e.length===3)return`vec3(${e.map(toGLSL).join(", ")})`;if(e.length===4)return`vec4(${e.map(toGLSL).join(", ")})`}return""},jsOpMap={"+":(e,o)=>`(${o} + ${e})`,"-":(e,o)=>`(${o} - ${e})`,"*":(e,o)=>`(${o} * ${e})`,"/":(e,o)=>`(${o} / ${e})`,"%":(e,o)=>`(${o} % ${e})`,">>":(e,o)=>`(${o} >> ${e})`,"<<":(e,o)=>`(${o} << ${e})`,"&":(e,o)=>`(${o} & ${e})`,"|":(e,o)=>`(${o} | ${e})`,"^":(e,o)=>`(${o} ^ ${e})`,"~":e=>`(~${e})`,sin:e=>`Math.sin(${e})`,cos:e=>`Math.cos(${e})`,tan:e=>`Math.tan(${e})`,pow:(e,o)=>`Math.pow(${o}, ${e})`,sqrt:e=>`Math.sqrt(${e})`,abs:e=>`Math.abs(${e})`,floor:e=>`Math.floor(${e})`,ceil:e=>`Math.ceil(${e})`,round:e=>`Math.round(${e})`,clamp:(e,o,i)=>`Math.max(${o}, Math.min(${e}, ${i}))`,">":(e,o)=>`((${o} > ${e}) ? 1 : 0)`,"<":(e,o)=>`((${o} < ${e}) ? 1 : 0)`,">=":(e,o)=>`((${o} >= ${e}) ? 1 : 0)`,"<=":(e,o)=>`((${o} <= ${e}) ? 1 : 0)`,"==":(e,o)=>`((${o} === ${e}) ? 1 : 0)`,"!=":(e,o)=>`((${o} !== ${e}) ? 1 : 0)`,"?":(e,o,i)=>`(${i} ? ${o} : ${e})`,ifte:(e,o,i)=>`(${i} ? ${o} : ${e})`},jsArityMap={"+":2,"-":2,"*":2,"/":2,"%":2,">>":2,"<<":2,"&":2,"|":2,"^":2,"~":1,sin:1,cos:1,tan:1,pow:2,sqrt:1,abs:1,floor:1,ceil:1,round:1,clamp:3,">":2,"<":2,">=":2,"<=":2,"==":2,"!=":2,"?":3,ifte:3},glslOpMap={"+":(e,o)=>`(${o} + ${e})`,"-":(e,o)=>`(${o} - ${e})`,"*":(e,o)=>`(${o} * ${e})`,"/":(e,o)=>`(${o} / ${e})`,"%":(e,o)=>`mod(${o}, ${e})`,">":(e,o)=>`(${o} > ${e})`,"<":(e,o)=>`(${o} < ${e})`,">=":(e,o)=>`(${o} >= ${e})`,"<=":(e,o)=>`(${o} <= ${e})`,"==":(e,o)=>`(${o} == ${e})`,"!=":(e,o)=>`(${o} != ${e})`,"?":(e,o,i)=>`(${i} ? ${o} : ${e})`,ifte:(e,o,i)=>`(${i} ? ${o} : ${e})`,sin:e=>`sin(${e})`,cos:e=>`cos(${e})`,tan:e=>`tan(${e})`,exp:e=>`exp(${e})`,pow:(e,o)=>`pow(${o}, ${e})`,sqrt:e=>`sqrt(${e})`,abs:e=>`abs(${e})`,neg:e=>`(-${e})`,floor:e=>`floor(${e})`,ceil:e=>`ceil(${e})`,round:e=>`round(${e})`,snoise:e=>`snoise(${e})`,fbm:e=>`fbm(${e})`,curl:e=>`curl(${e})`,fuse:(e,o,i)=>`mix(${i}, ${o}, ${e})`,clamp:(e,o,i)=>`clamp(${i}, ${o}, ${e})`,smoothstep:(e,o,i)=>`smoothstep(${o}, ${e}, ${i})`,cnoise:e=>`cnoise(${e})`,dot:(e,o)=>`dot(${o}, ${e})`,fract:e=>`fract(${e})`,length:e=>`length(${e})`,rotate:(e,o,i)=>`opRot(${i}, ${o}, ${e})`,translate:(e,o)=>`opTx(${o}, ${e})`,juliaset:(e,o,i)=>`juliaSDF(${i}, ${o}, ${e})`,mandelbrotSDF:(e,o)=>`mandelbrotSDF(${o}, ${e})`,mandelbrotset:(e,o)=>`mandelbrotSDF(${o}, ${e})`,vec2:(e,o)=>`vec2(${o}, ${e})`,vec3:(e,o,i)=>`vec3(${i}, ${o}, ${e})`,vec4:(e,o,i,l)=>`vec4(${l}, ${i}, ${o}, ${e})`,hsv:(e,o,i)=>`hsv2rgb(vec3(${i}, ${o}, ${e}))`,distEuclidean:(e,o)=>`distEuclidean(${o}, ${e})`,distManhattan:(e,o)=>`distManhattan(${o}, ${e})`,distChebychev:(e,o)=>`distChebychev(${o}, ${e})`,distMinkowski:(e,o,i)=>`distMinkowski(${i}, ${o}, ${e})`,worley:e=>`worley(${e})`,arc2d:(e,o,i,l)=>`sdArc2d(${l}, ${i}, ${o}, ${e})`,box2d:(e,o)=>`sdBox2d(${o}, ${e})`,circle2d:(e,o)=>`sdCircle2d(${o}, ${e})`,cross2d:(e,o,i)=>`sdCross2d(${i}, ${o}, ${e})`,ellipse2d:(e,o)=>`sdEllipse2d(${o}, ${e})`,equilateralTriangle2d:(e,o)=>`sdEquilateralTriangle2d(${o}, ${e})`,heart2d:e=>`sdHeart2d(${e})`,hexagon2d:(e,o)=>`sdHexagon2d(${o}, ${e})`,hexagram2d:(e,o)=>`sdHexagram2d(${o}, ${e})`,isoscelesTriangle2d:(e,o)=>`sdIsoscelesTriangle2d(${o}, ${e})`,moon2d:(e,o,i,l)=>`sdMoon2d(${l}, ${i}, ${o}, ${e})`,octogon2d:(e,o)=>`sdOctogon2d(${o}, ${e})`,parallelogram2d:(e,o,i,l)=>`sdParallelogram2d(${l}, ${i}, ${o}, ${e})`,pentagon2d:(e,o)=>`sdPentagon2d(${o}, ${e})`,pie2d:(e,o,i)=>`sdPie2d(${i}, ${o}, ${e})`,rhombus2d:(e,o)=>`sdRhombus2d(${o}, ${e})`,roundedbox2d:(e,o,i)=>`sdRoundedbox2d(${i}, ${o}, ${e})`,roundedx2d:(e,o,i)=>`sdRoundedx2d(${i}, ${o}, ${e})`,segment2d:(e,o,i)=>`sdSegment2d(${i}, ${o}, ${e})`,star2d:(e,o,i,l)=>`sdStar2d(${l}, ${i}, ${o}, ${e})`,trapezoid2d:(e,o,i,l)=>`sdTrapezoid2d(${l}, ${i}, ${o}, ${e})`,triangle2d:(e,o,i,l)=>`sdTriangle2d(${l}, ${i}, ${o}, ${e})`,vesica2d:(e,o,i)=>`sdVesica2d(${i}, ${o}, ${e})`,shape:(e,o,i)=>`sdNgon2d(${i}, ${e}, ${o})`,union:(e,o)=>`min(${o}, ${e})`,difference:(e,o)=>`max(${o}, -${e})`,intersection:(e,o)=>`max(${o}, ${e})`},glslArityMap={"+":2,"-":2,"*":2,"/":2,"%":2,">":2,"<":2,">=":2,"<=":2,"==":2,"!=":2,"?":3,ifte:3,sin:1,cos:1,tan:1,exp:1,pow:2,sqrt:1,abs:1,neg:1,floor:1,ceil:1,round:1,snoise:1,fbm:1,curl:1,fuse:3,clamp:3,smoothstep:3,cnoise:1,dot:2,fract:1,length:1,rotate:3,translate:2,juliaset:3,mandelbrotSDF:2,mandelbrotset:2,vec2:2,vec3:3,vec4:4,hsv:3,distEuclidean:2,distManhattan:2,distChebychev:2,distMinkowski:3,worley:1,arc2d:4,box2d:2,circle2d:2,cross2d:3,ellipse2d:2,equilateralTriangle2d:2,heart2d:1,hexagon2d:2,hexagram2d:2,isoscelesTriangle2d:2,moon2d:4,octogon2d:2,parallelogram2d:4,pentagon2d:2,pie2d:3,rhombus2d:2,roundedbox2d:3,roundedx2d:3,segment2d:3,star2d:4,trapezoid2d:4,triangle2d:4,vesica2d:3,shape:3,union:2,difference:2,intersection:2},transpileQuotation=(e,o,i,l,u)=>{const d=[],h=[...e],m=g=>/^[a-zA-Z_][a-zA-Z0-9_]*(\.[xyzw]{1,4})*$/.test(g);for(;h.length>0;){if(u&&h.length>1&&Array.isArray(h[0])&&h[1]==="glsl"){const b=h.shift();h.shift();const v=transpileQuotation(b,o,i,l,u);d.push(v);continue}const g=h.shift();if((g==null?void 0:g.type)==="glsl_expression"){d.push(g.code);continue}if(Array.isArray(g)){const b=transpileQuotation(g,o,i,l,u);d.push(`(${b})`);continue}if(typeof g=="number"){d.push(u?toGLSL(g):String(g));continue}if(typeof g=="string"){if(l.has(g)){let w=g;u&&(g==="t"&&(w="u_time"),g==="mouse"&&(w="u_mouse.xy"),g==="mousex"&&(w="u_mouse.x"),g==="mousey"&&(w="u_mouse.y"),g==="moused"&&(w="u_moused.xy"),g==="mousedx"&&(w="u_moused.x"),g==="mousedy"&&(w="u_moused.y")),d.push(w);continue}if(g==="vec4"){const w=o[g],D=i[g];if(d.length>=D){const O=[];for(let k=0;k<D;k++)O.push(d.pop());d.push(w(...O))}else if(d.length===3){const O=d.pop(),k=d.pop(),N=d.pop();d.push(`vec4(${N}, ${k}, ${O})`)}else if(d.length===2){const O=d.pop(),k=d.pop();d.push(`vec4(${k}, ${O})`)}else if(d.length===1){const O=d.pop();d.push(`vec4(${O})`)}else throw new Error("Stack underflow for operator in quotation: 'vec4'.");continue}if(g==="dup"){if(d.length<1)throw new Error("Stack underflow for 'dup' in quotation.");d.push(d[d.length-1]);continue}if(g==="swap"){if(d.length<2)throw new Error("Stack underflow for 'swap' in quotation.");const w=d.pop(),D=d.pop();d.push(w,D);continue}if(g==="rolldown"){if(d.length<3)throw new Error("Stack underflow for 'rolldown' in quotation.");const[w,D,O]=[d.pop(),d.pop(),d.pop()];d.push(D,w,O);continue}if(g==="pop"){if(d.length<1)throw new Error("Stack underflow for 'pop' in quotation.");d.pop();continue}if(u&&/^[xyzw]{1,4}$/.test(g)){if(d.length<1)throw new Error(`Stack underflow for swizzle operator '${g}'.`);const w=d.pop(),D=m(w)?w:`(${w})`;d.push(`${D}.${g}`);continue}const v=o[g];if(v){const w=i[g]||v.length;if(d.length<w)throw new Error(`Stack underflow for operator in quotation: '${g}'.`);const D=[];for(let O=0;O<w;O++)D.push(d.pop());d.push(v(...D));continue}}throw new Error(`Unsupported operator in quotation: '${yieldFormatter(g)}'.`)}if(d.length!==1){if(d.length===0&&e.length===0)return"";throw new Error(`Quotation must result in a single value on the stack, but resulted in ${d.length} values: [${d.join(", ")}]`)}return d[0]},transpileJS=e=>transpileQuotation(e,jsOpMap,jsArityMap,new Set(["t","mousex","mousey","mousedx","mousedy"]),!1),transpileGLSL=e=>transpileQuotation(e,glslOpMap,glslArityMap,new Set(["p","t","uv","mouse","mousex","mousey","moused","mousedx","mousedy","u_moused","u_moused.z","u_resolution"]),!0),dupdip={definition:{exec:function*(e,o,i){if(e.length<1)throw new Error("Stack underflow for operator: dupdip");const l=e.pop();if(!Array.isArray(l))throw e.push(l),new Error("dupdip expects a quotation on top of the stack.");if(e.length<1)throw e.push(l),new Error("Stack underflow for operator: dupdip");const u=e[e.length-1],d=[deepClone(u)];yield*i(l,d,o),e.push(...d)},description:"Executes a quotation on a copy of the second stack item, leaving the original item and the result on the stack.",effect:"[X [P]] -> [X P(X)]"},examples:[{code:"23 (succ) dupdip *",expected:[552]},{code:"10 (dup *) dupdip swap -",expected:[90]},{code:"5 (++) dupdip",expected:[5,6]},{code:"5 dupdip",expectedError:"dupdip expects a quotation on top of the stack."},{code:"dupdip",expectedError:"Stack underflow for operator: dupdip"}]},map={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();if(isMatrix(u)){const d=u,h=[];for(const m of d){const g=[];for(const b of m){const v=[b];yield*i([...l],v,o),v.length===0?g.push(null):g.push(v[v.length-1])}h.push(g)}e.push(h)}else if(Array.isArray(u)){const d=[];for(const h of u){const m=[h];yield*i([...l],m,o),d.push(...m)}e.push(d)}else throw e.push(u,l),new Error("map expects a list or a matrix.")},description:"Applies a program to each element of an aggregate. For a list, it creates a new list by concatenating the results of each application. For a matrix, it creates a new matrix of the same dimensions where each element is the result of applying the program to the corresponding input element. If the program leaves multiple items on the stack for a matrix element, only the top item is used.",effect:"[L|M [P]] -> [L'|M']"},examples:[{code:"(1 2 3 4) (dup *) map",expected:[[1,4,9,16]]},{code:"() (succ) map",expected:[[]]},{code:"(1 2) (dup dup) map",expected:[[1,1,1,2,2,2]]},{code:"((1 2)(3 4)) (succ) map",expected:[[[2,3],[4,5]]]},{code:"((1 2)(3 4)) (dup *) map",expected:[[[1,4],[9,16]]]},{code:"((1 2)(3 4)) (pop (5 6)) map",expected:[[[[5,6],[5,6]],[[5,6],[5,6]]]]},{code:"((1 2)(3 4)) (dup dup) map",expected:[[[1,2],[3,4]]]}]},filter={definition:{exec:function*(e,o,i){const[l,u]=[e.pop(),e.pop()],d=[];for(const h of u){const m=[h];yield*i([...l],m,o),m.pop()&&d.push(h)}e.push(d)},description:"Creates a new list containing only elements for which a program returns true.",effect:"[L [P]] -> [L']"},examples:[{code:"(1 2 3 4 5) (2 % 0 ==) filter",expected:[[2,4]]},{code:'("a" "b" 1 2) (string?) filter',expected:[["a","b"]]}]},step={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();if(!Array.isArray(u))throw new Error(`step operator expects a list to iterate over, but got: ${yieldFormatter(u)}`);for(const d of u)e.push(d),yield*i([...l],e,o)},description:"Applies a program to each element of a list, accumulating results on the main stack.",effect:"[A L [P]] -> ..."},examples:[{code:"0 (1 2 3 4) (+) step",expected:[10]},{code:"1 (2 3 4) (*) step",expected:[24]}]},ifte={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();yield*i(e.pop()?u:l,e,o)},description:"If-then-else (alias: ?). If B is true, executes T, else executes F.",effect:"[B [T] [F]] -> ..."},examples:[{code:"true (1) (2) ifte",expected:[1]},{code:"false (1) (2) ifte",expected:[2]},{code:'1 0 > ("yes") ("no") ifte',expected:["yes"]},{code:'1 0 > ("yes") ("no") ?',expected:["yes"]}]},times={definition:{exec:function*(e,o,i,l){const u=e.pop(),d=e.pop();if(typeof u!="number"||!Number.isInteger(u)||u<0)throw new Error("times expects an integer count on top of the stack.");if(d===void 0)throw new Error("times expects a program on the stack.");let h,m;if(typeof d=="symbol"){const b=Symbol.keyFor(d);b&&(m=`:${b}`)}else(typeof d=="string"||typeof d=="number")&&(m=String(d));const g=m?l[m]:void 0;g&&"body"in g&&Array.isArray(g.body)&&g.body[g.body.length-1]==="iterate"?h=[d]:h=Array.isArray(d)?[...d,"iterate"]:[d,"iterate"];for(let b=0;b<u;b++)yield*i([...h],e,o)},description:"Executes a program a specific number of times.",effect:"[X N [P]] -> [...]"},examples:[{code:"10 (2 *) 3 times",expected:[80]},{code:"0 (succ) 5 times",expected:[5]},{code:["0 :state =","(1 +) combinator =","(:state combinator yield) :next =",":next 3 times"],expected:[1,2,3]}]},whileOp={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();for(yield*i([...u],e,o);e.pop();)yield*i([...l],e,o),yield*i([...u],e,o)},description:"Executes a body program as long as a test program returns true.",effect:"[ [B] [D] ] -> ..."},examples:[{code:"5 (dup 0 >) (1 -) while",expected:[0]},{code:"0 (false) (pop) while",expected:[0]}]},branch={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();e.pop()?yield*i(u,e,o):yield*i(l,e,o)},description:"If the boolean B is true, executes T, otherwise executes F.",effect:"[B [T] [F]] -> ..."},examples:[{code:'10 5 > ("Greater") ("Not Greater") branch',expected:["Greater"]},{code:'5 10 > ("Greater") ("Not Greater") branch',expected:["Not Greater"]}]},cleave={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop(),d=e.pop(),h=[d];yield*i(u,h,o);const m=[d];yield*i(l,m,o),e.push(...h,...m)},description:"Applies two programs to the same value, leaving both results on the stack.",effect:"[X [P1] [P2]] -> [R1 R2]"},examples:[{code:"10 (dup *) (1 +) cleave",expected:[100,11]},{code:"(1 2) (size) (first) cleave",expected:[2,1]}]},cond={definition:{exec:function*(e,o,i){const l=e.pop();if(!Array.isArray(l)||l.length===0)return;const u=e[e.length-1],d=l.pop();for(const h of l){if(!Array.isArray(h)||h.length!==2)continue;const[m,g]=h,b=[u];if(yield*i(m,b,o),b.pop()){yield*i(g,e,o);return}}Array.isArray(d)&&d.length>0&&(yield*i(d[0],e,o))},description:"Executes the program for the first true condition. The last element is the default case.",effect:"[V [ [C1 T1] .. [D] ]] -> ..."},examples:[{code:'2 (( (1 ==) (pop "one") ) ( (2 ==) (pop "two") ) ( (pop "other") )) cond',expected:["two"]},{code:'3 (( (1 ==) (pop "one") ) ( (2 ==) (pop "two") ) ( (pop "other") )) cond',expected:["other"]}]},body={definition:{exec:function*(e,o,i,l){const u=e.pop();let d,h;if(typeof u=="symbol"){const g=Symbol.keyFor(u);if(!g)throw new Error("body: cannot get body of a non-global symbol.");d=`:${g}`,h=`:${g}`}else if(typeof u=="string"||typeof u=="number")d=String(u),h=String(u);else throw new Error(`body: expects a name, symbol, or integer, but got: ${JSON.stringify(u)}`);const m=l[d];if(m&&"body"in m)e.push(m.body);else throw new Error(`body: '${h}' is not a user-defined symbol or has no body.`)},description:"Pushes the body (quotation) of a user-defined function onto the stack. Expects the name of the function as a bare word.",effect:"[W] -> [[B]]"},examples:[{code:"(1 +) inc = inc body",expected:[[1,"+"]]},{code:"(1 2 3) mylist = mylist body",expected:[[1,2,3]]},{code:"(42) 1 = 1 body",expected:[[42]]},{code:'("hi") :msg = :msg body',expected:[["hi"]]}]},yieldOp={definition:{exec:function*(e,o,i,l){const u=e.pop(),d=e.pop();let h,m=!1,g=u;const b=typeof u=="symbol"?`:${Symbol.keyFor(u)}`:typeof u=="string"?u:"";if(b){const w=l[b];w&&"body"in w&&(!Array.isArray(w.body)||w.body[w.body.length-1]!=="i")&&(g=w.body)}let v;if(Array.isArray(d)&&d.length===2&&typeof d[1]=="symbol"){const w=d[0];h=`:${Symbol.keyFor(d[1])}`,l[h]||(l[h]={body:w,description:"User-defined state variable.",example:""}),m=!0,v=l[h]}else{if(typeof d=="symbol"){const w=Symbol.keyFor(d);w&&(h=`:${w}`)}else(typeof d=="string"||typeof d=="number")&&(h=String(d));v=h?l[h]:void 0,v&&"body"in v&&(m=!0)}if(m&&h){const w=v.body,D=Array.isArray(w)?[...w]:[w];yield*i(g,D,o),l[h].body=D.length===1?D[0]:D,D.length>0&&e.push(D[D.length-1])}else{const w=d;if(Array.isArray(w)){const D=[w];yield*i(g,D,o),D.length>1?e.push(D):e.push(...D)}else{e.push(w);const D=[w];yield*i(g,D,o),e.push(...D)}}},description:"A stateful generator combinator. It applies a program to a value or a named variable to evolve its state, then pushes the new top value onto the stack. Syntax: `variable_name_or_value program_name_or_quotation yield`.",effect:"[V_name P_name] -> [T]"},examples:[{code:"1 (1 +) yield",expected:[1,2]},{code:"1 (1) yield",expected:[1,1,1]},{code:["2 :foo =",":foo (1 +) yield",":foo"],expected:[3,3]},{code:"1 (1 2) (dup +) yield",expected:[1,[2,3,3,4]],expectedDescription:"To perform an outer-product sum on a list within yield, then proceed with 'dup' and '+'"},{code:["0 :state =","(succ) :combinator =","(:state :combinator yield) next =>","next next next"],expected:[1,2,3]},{code:["(1 1) :fib_state =","(swap dupd +) :program =","(:fib_state :program yield) :fib =>",":fib :fib :fib :fib :fib"],expected:[2,3,5,8,13]},{code:["10 1 =","1 (succ) yield"],expected:[11]},{code:["0 :state =","(1 +) :combinator =","(:state :combinator yield) :next =>",":next :next :next"],expected:[1,2,3]},{code:["((0) (1 +) yield) next =>","next next next"],expected:[1,2,3]},{code:["(0 (1 +) yield) next =>","next next next"],expected:[1,2,3]},{code:["((1 1) (dupd swap + swap succ swap) yield) next_caterer =>","1","(next_caterer) 5 times"],expected:[1,2,4,7,11,16]}]},combinators={name:"Combinators",description:"Higher-order functions that control execution flow.",definitions:{iterate,i:iterate,dip,dupdip,map,filter,step,ifte,"?":ifte,times,while:whileOp,branch,cleave,cond,body,yield:yieldOp}},acos={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.acos(l)))):e.push(Math.acos(o))},description:"Arccosine. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"0.5 acos",assert:e=>e.length===1&&typeof e[0]=="number"&&e[0].toFixed(15)==="1.047197551196598"},{code:"1 acos",expected:[0]},{code:"((0.5 1)(0 -1)) acos",assert:e=>isMatrix(e[0])}]},asin={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.asin(l)))):e.push(Math.asin(o))},description:"Arcsine. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"0.5 asin",assert:e=>e.length===1&&typeof e[0]=="number"&&e[0].toFixed(15)==="0.523598775598299"},{code:"0 asin",expected:[0]},{code:"((0.5 0)(1 -1)) asin",assert:e=>isMatrix(e[0])}]},atan={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.atan(l)))):e.push(Math.atan(o))},description:"Arctangent. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"1 atan",expected:[.7853981633974483]},{code:"0 atan",expected:[0]},{code:"((1 0)(10 -10)) atan",assert:e=>isMatrix(e[0])}]},atan2={definition:{exec:function*(e){const o=(h,m)=>Math.atan2(h,m);if(e.length<2)throw new Error("atan2 operator requires two arguments.");const i=e.pop(),l=e.pop(),u=applyBinaryOp(o,l,i);typeof l=="number"&&Array.isArray(i)||Array.isArray(l)&&typeof i=="number"?e.push(u):isFlatList(u)?e.push(...u):e.push(u)},description:'Arctangent of a quotient (y/x). Supports recursive, "sideways" (outer product) operations for lists and matrices. If a scalar and an aggregate are involved, it performs broadcasting.',effect:"[Y X] -> [C]"},examples:[{code:"1 1 atan2",expected:[.7853981633974483]},{code:"10 5 atan2",assert:e=>e.length===1&&typeof e[0]=="number",expectedType:"number"},{code:"(10 20) 5 atan2",expected:[[1.1071487177940904,1.3258176636680326]]},{code:"10 (5 10) atan2",expected:[[1.1071487177940904,.7853981633974483]]},{code:"(1 10) (1 5) atan2",assert:e=>e.length===4,expectedDescription:"Four float results on the stack."}]},ceil={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.ceil(l)))):e.push(Math.ceil(o))},description:"Rounds a number up to the nearest integer. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"3.1 ceil",expected:[4]},{code:"((3.1 2.9)(-1.5 0)) ceil",expected:[[[4,3],[-1,0]]]}]},cos={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.cos(l)))):e.push(Math.cos(o))},description:"Cosine. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"0.5 cos",assert:e=>e.length===1&&typeof e[0]=="number"},{code:"0 cos",expected:[1]},{code:"((0 0.5)(1 2)) cos",assert:e=>isMatrix(e[0])}]},cosh={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.cosh(l)))):e.push(Math.cosh(o))},description:"Hyperbolic cosine. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"0 cosh",expected:[1]},{code:"((0 1)(-1 2)) cosh",assert:e=>isMatrix(e[0])}]},exp={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.exp(l)))):e.push(Math.exp(o))},description:"Exponential function (e^x). Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"1 exp",expected:[Math.E]},{code:"0 exp",expected:[1]},{code:"((0 1)(2 3)) exp",assert:e=>isMatrix(e[0])}]},floor={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.floor(l)))):e.push(Math.floor(o))},description:"Rounds a number down to the nearest integer. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"3.7 floor",expected:[3]},{code:"((3.7 2.1)(-1.5 0)) floor",expected:[[[3,2],[-2,0]]]}]},ln={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.log(l)))):e.push(Math.log(o))},description:"Natural logarithm (base e). Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"1 ln",expected:[0]},{code:"((1 2)(10 20)) ln",assert:e=>isMatrix(e[0])}]},log10={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.log10(l)))):e.push(Math.log10(o))},description:"Base-10 logarithm. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"100 log10",expected:[2]},{code:"((100 1000)(1 10)) log10",expected:[[[2,3],[0,1]]]}]},pow={definition:{exec:function*(e){const o=(h,m)=>Math.pow(h,m);if(e.length===1&&Array.isArray(e[0])){const h=e.pop();if(h.length===0)throw new Error("pow with a single empty list is not supported.");const[m,...g]=h,b=g.reduce((v,w)=>applyBinaryOp(o,v,w),m);isFlatList(b)?e.push(...b):e.push(b);return}if(e.length<2)throw new Error("pow operator requires two arguments.");const i=e.pop(),l=e.pop(),u=applyBinaryOp(o,l,i);typeof l=="number"&&Array.isArray(i)||Array.isArray(l)&&typeof i=="number"?e.push(u):isFlatList(u)?e.push(...u):e.push(u)},description:'Raises A to the power of B. If a scalar and an aggregate are involved, it performs broadcasting. If two aggregates are involved, it performs a "sideways" operation. If a single list is provided, it reduces the list.',effect:"[A B] -> [C] or [[A B C]] -> ..."},examples:[{code:"2 8 pow",expected:[256]},{code:"(2 3 2) pow",expected:[64]},{code:"(4 (3 2)) pow",expected:[64,16]},{code:"(2 3) 2 pow",expected:[[4,9]]},{code:"2 (8 3) pow",expected:[[256,8]]},{code:"((2 3)(4 5)) 2 pow",expected:[[[4,9],[16,25]]]},{code:"(2 3) (2 4) pow",expected:[4,16,9,81]}]},sin={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.sin(l)))):e.push(Math.sin(o))},description:"Sine. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"0.5 sin",expected:[.479425538604203]},{code:"0 sin",expected:[0]},{code:"((0.5 0)(1 2)) sin",assert:e=>isMatrix(e[0])}]},sinh={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.sinh(l)))):e.push(Math.sinh(o))},description:"Hyperbolic sine. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"0 sinh",expected:[0]},{code:"((0 1)(-1 2)) sinh",assert:e=>isMatrix(e[0])}]},sqrt={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.sqrt(l)))):e.push(Math.sqrt(o))},description:"Square root. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"25 sqrt",expected:[5]},{code:"((25 4)(9 16)) sqrt",expected:[[[5,2],[3,4]]]}]},tan={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.tan(l)))):e.push(Math.tan(o))},description:"Tangent. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"0 tan",expected:[0]},{code:"((0 1)(-1 2)) tan",assert:e=>isMatrix(e[0])}]},tanh={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.tanh(l)))):e.push(Math.tanh(o))},description:"Hyperbolic tangent. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"1 tanh",expected:[.7615941559557649]},{code:"0 tanh",expected:[0]},{code:"((0 1)(-1 2)) tanh",assert:e=>isMatrix(e[0])}]},trunc={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.trunc(l)))):e.push(Math.trunc(o))},description:"Truncates the fractional part of a number. Supports element-wise operation on matrices.",effect:"[F] -> [G]"},examples:[{code:"3.7 trunc",expected:[3]},{code:"((3.7 -2.1)(1.9 0)) trunc",expected:[[[3,-2],[1,0]]]}]},jsMath={definitions:{acos,asin,atan,atan2,ceil,cos,cosh,exp,floor,ln,log10,pow,sin,sinh,sqrt,tan,tanh,trunc}},cons={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!Array.isArray(o))throw new Error("cons expects a list");e.push([i,...o])},description:"Constructs a new list by prepending an element to a list. Expects element, then list on the stack.",effect:"[E L] -> [L']"},examples:[{code:"1 (2 3 4) cons",expected:[[1,2,3,4]]},{code:"() (1) cons",expected:[[[],1]]}]},append={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!Array.isArray(i))throw new Error("append expects a list");i.push(o),e.push(i)},description:"Appends an element to the end of a list (mutates the list).",effect:"[L E] -> [L']"},examples:[{code:"(1 2) 3 append",expected:[[1,2,3]]},{code:'() "a" append',expected:[["a"]]}]},uncons={definition:{exec:function*(e){const o=e.pop();if(!Array.isArray(o))throw new Error("uncons expects a list.");const[i,...l]=o;e.push(i,l)},description:"Deconstructs a list, pushing its first element and then the rest of the list.",effect:"[L] -> [E R]"},examples:[{code:"(10 20 30) uncons",expected:[10,[20,30]]},{code:'("a") uncons',expected:["a",[]]}]},first={definition:{exec:function*(e){e.push(e.pop()[0])},description:"Gets the first element of a list.",effect:"[[A B]] -> [A]"},examples:[{code:"(10 20 30) first",expected:[10]},{code:"((1 2) 3) first",expected:[[1,2]]}]},spread={definition:{exec:function*(e){const o=e.pop();Array.isArray(o)?e.push(...o):e.push(o)},description:"Spreads the elements of a list onto the stack.",effect:"[[A B]] -> [A B]"},examples:[{code:"(10 20 30) spread",expected:[10,20,30]},{code:"() spread",expected:[]}]},rest={definition:{exec:function*(e){e.push(e.pop().slice(1))},description:"Gets the rest of a list (all but the first element).",effect:"[A] -> [R]"},examples:[{code:"(10 20 30) rest",expected:[[20,30]]},{code:"(10) rest",expected:[[]]}]},size={definition:{exec:function*(e){const o=e.pop();if(typeof o=="string"||Array.isArray(o))e.push(o.length);else throw new Error("size expects a list or a string.")},description:"Gets the number of elements in an aggregate (list or string).",effect:"[A] -> [I]"},examples:[{code:"(1 2 3) size",expected:[3]},{code:'"hello" size',expected:[5]},{code:"(10 20 30) set size",expected:[3]},{code:'(1 2 3) size "hello" size',expected:[3,5]},{code:"() size",expected:[0]},{code:"123 size",expectedError:"size expects a list or a string."}]},at={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(i[o])},description:"Gets the element at a specific index.",effect:"[A I] -> [X]"},examples:[{code:"(10 20 30) 1 at",expected:[20]},{code:'"hello" 4 at',expected:["o"]}]},of={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(o[i])},description:"Gets the element at a specific index. Infix form.",effect:"[I A] -> [X]"},examples:[{code:"1 (10 20 30) of",expected:[20]},{code:'0 "world" of',expected:["w"]}]},drop={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(i.slice(o))},description:"Removes the first N elements from a list.",effect:"[A N] -> [B]"},examples:[{code:"(1 2 3 4 5) 2 drop",expected:[[3,4,5]]},{code:'"hello" 3 drop',expected:["lo"]}]},take={definition:{exec:function*(e){const o=e.pop(),l=e.pop().slice(0,o);Array.isArray(l)?e.push(l.reverse()):typeof l=="string"?e.push(l.split("").reverse().join("")):e.push(l)},description:"Takes the first N elements from an aggregate and pushes the result in reverse order.",effect:"[A N] -> [B]"},examples:[{code:"(1 2 3 4 5) 2 take",expected:[[2,1]]},{code:'"hello" 2 take',expected:["eh"]}]},concat={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(i.concat(o))},description:"Concatenates two lists or strings.",effect:"[S T] -> [U]"},examples:[{code:"(1 2) (3 4) concat",expected:[[1,2,3,4]]},{code:'"hello " "world" concat',expected:["hello world"]},{code:"(1) () concat",expected:[[1]]}]},join={definition:{exec:function*(e){const o=e.pop();if(!Array.isArray(o))throw new Error("join expects a list");e.push(o.join(""))},description:"Joins a list of strings into a single string.",effect:"[[S1 S2]] -> [S]"},examples:[{code:'("hello" " " "world") join',expected:["hello world"]},{code:'("a" "b" "c") join',expected:["abc"]},{code:"() join",expected:[""]}]},pick={definition:{exec:function*(e){if(e.length===0){e.push(null);return}const o=e.pop();if(Array.isArray(o)){const i=o;if(i.length===0){e.push(null);return}const l=Math.floor(Math.random()*i.length),u=i[l];e.push(u)}else{e.push(o);const i=[...e],l=Math.floor(Math.random()*i.length),u=i[l];e.length=0,e.push(u)}},description:"Picks a random element. If the top of the stack is a list, it picks from that list. Otherwise, it picks a random element from the entire stack, which is then replaced by the picked element.",effect:"[L] -> [E] OR [A B C ...] -> [R]"},examples:[{code:"(1 2 3 4 5) pick",assert:e=>e.length===1&&[1,2,3,4,5].includes(e[0]),expectedDescription:"A random element from the list"},{code:["(1 2 3) mylist =","(mylist pick) 10 times"],assert:e=>e.length===10&&e.every(o=>[1,2,3].includes(o)),expectedDescription:"10 random elements on the stack"},{code:"() pick",expected:[null]},{code:"1 2 3 4 pick",assert:e=>e.length===1&&[1,2,3,4].includes(e[0]),expectedDescription:"A random element from the stack"},{code:"1 pick",expected:[1]},{code:"pick",expected:[null]}]},setlist={definition:{exec:function*(e){const o=e.pop();if(!Array.isArray(o))throw new Error("setlist expects a list.");e.push([...new Set(o)])},description:"Removes duplicate elements from a list.",effect:"[L] -> [L']"},examples:[{code:"(1 2 2 3) setlist",expected:[[1,2,3]]},{code:'("c" "a" "b" "a") setlist',expected:[["c","a","b"]]}]},zip={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!Array.isArray(i)||!Array.isArray(o))throw new Error("zip expects two lists on the stack.");const l=[],u=Math.min(i.length,o.length);for(let d=0;d<u;d++)l.push([o[d],i[d]]);e.push(l)},description:"Combines two lists element-wise into a new list of pairs. The operation stops when the shorter list is exhausted.",effect:"[L1 L2] -> [L3]"},examples:[{code:"(1 2 3) (6 5 4) zip",expected:[[[6,1],[5,2],[4,3]]]},{code:"(1 2) (10 20 30) zip",expected:[[[10,1],[20,2]]]},{code:"(1 2 3) (10 20) zip",expected:[[[10,1],[20,2]]]},{code:"(1 2 3) () zip",expected:[[]]},{code:"() (1 2 3) zip",expected:[[]]},{code:"() () zip",expected:[[]]},{code:"1 2 zip",expectedError:"zip expects two lists on the stack."}]},range={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(i===void 0||o===void 0)throw i!==void 0&&e.push(i),o!==void 0&&e.push(o),new Error("Stack underflow for range operator.");const l=[];if(typeof i=="number"&&typeof o=="number")if(i<=o)for(let u=i;u<=o;u++)l.push(u);else for(let u=i;u>=o;u--)l.push(u);else if(typeof i=="string"&&typeof o=="string"&&i.length===1&&o.length===1){const u=i.charCodeAt(0),d=o.charCodeAt(0);if(u<=d)for(let h=u;h<=d;h++)l.push(String.fromCharCode(h));else for(let h=u;h>=d;h--)l.push(String.fromCharCode(h))}else throw e.push(i,o),new Error("range expects two numbers or two single-character strings.");e.push(l)},description:"Creates a list containing a range of elements. If the arguments are numbers, it creates a numerical range. If they are single-character strings, it creates a character range. The range is inclusive and works in both increasing and decreasing directions.",effect:"[start end] -> [list]"},examples:[{code:"1 5 range",expected:[[1,2,3,4,5]]},{code:"-2 2 range",expected:[[-2,-1,0,1,2]]},{code:"5 1 range",expected:[[5,4,3,2,1]]},{code:"-1 -5 range",expected:[[-1,-2,-3,-4,-5]]},{code:"3 3 range",expected:[[3]]},{code:'"a" "e" range',expected:[["a","b","c","d","e"]]},{code:'"e" "a" range',expected:[["e","d","c","b","a"]]},{code:'"z" "z" range',expected:[["z"]]},{code:"-5 -1 ..",expected:[[-5,-4,-3,-2,-1]]},{code:'"a" "e" ..',expected:[["a","b","c","d","e"]]},{code:'1 "a" range',expectedError:"range expects two numbers or two single-character strings."},{code:'"a" 1 range',expectedError:"range expects two numbers or two single-character strings."},{code:'"ab" "c" range',expectedError:"range expects two numbers or two single-character strings."},{code:"1 range",expectedError:"Stack underflow for range operator."}]},swizzle={definition:{exec:function*(e){const o=e.pop(),i=e.pop();let l="list",u;if(typeof i=="number")l="number",u=String(i).replace(".","").split("");else if(typeof i=="string")l="string",u=i.split("");else if(Array.isArray(i))l="list",u=i.map(v=>v==="true"?!0:v==="false"?!1:v);else throw e.push(i,o),new Error("swizzle expects a list, string, or number as the second argument.");const d=v=>{const w=Math.floor(v);return w===0||w===1?0:w-1};let h,m=-1;const g=u.length;if(typeof o=="number"){const v=String(o);m=v.indexOf("."),h=v.replace(".","").split("").map(D=>d(parseInt(D,10)))}else if(Array.isArray(o)&&o.every(v=>typeof v=="number"))h=o.map(d);else throw e.push(i,o),new Error("swizzle expects a number or a list of integers as the pattern.");const b=[];if(g>0)for(const v of h){const w=(v%g+g)%g;b.push(u[w])}switch(l){case"number":let v=b.join("");m!==-1&&v.length>0&&(m>v.length?v=v+".":m===0?v="."+v:v=v.slice(0,m)+"."+v.slice(m)),e.push(v===""||v==="."?0:parseFloat(v));break;case"string":const w=b.join("");e.push(w);break;case"list":default:e.push(b);break}},description:"Swizzles a list, string, or number based on a pattern. The pattern can be a number (integer or decimal) or a list of numbers. Indexing is always 1-based, where both 0 and 1 in the pattern refer to the first element (index 0). Out-of-bounds indices wrap around. If the pattern is a decimal number, its decimal point position dictates the decimal point in the swizzled numeric output.",effect:"[Data Pattern] -> [SwizzledData]"},examples:[{code:'("a" "b" "c" "d") (1 3 2 4) swizzle',expected:[["a","c","b","d"]]},{code:'("a" "b" "c" "d") (0 2 1 3) swizzle',expected:[["a","b","a","c"]]},{code:'("a" "b" "c" "d") 1324 swizzle',expected:[["a","c","b","d"]]},{code:'("a" "b") 1212 swizzle',expected:[["a","b","a","b"]]},{code:"(true false false true) 2324 swizzle",expected:[[!1,!1,!1,!0]]},{code:'"abcd" 1324 swizzle',expected:["acbd"]},{code:'"ab" 1212 swizzle',expected:["abab"]},{code:"1234 1324 swizzle",expected:[1324]},{code:"12 1212 swizzle",expected:[1212]},{code:"123 103 swizzle",expected:[113]},{code:"(10 20) (4 1) swizzle",expected:[[20,10]]},{code:"1234 51 swizzle",expected:[11]},{code:'"abc" 41 swizzle',expected:["aa"]},{code:"98.76 1.32 swizzle",expected:[9.78]},{code:"2431 1.323 swizzle",expected:[2.343]},{code:"123 12.3 swizzle",expected:[12.3]},{code:"12345 1. swizzle",expected:[1]},{code:'1234 "abc" swizzle',expectedError:"swizzle expects a number or a list of integers as the pattern."},{code:"true 123 swizzle",expectedError:"swizzle expects a list, string, or number as the second argument."}]},list={definition:{exec:function*(e){const o=[...e];e.length=0,e.push(o)},description:"Consumes the entire stack and replaces it with a list containing all the stack's previous elements in their original order.",effect:"[A B C ...] -> [[A B C ...]]"},examples:[{code:"1 2 3 list",expected:[[1,2,3]]},{code:"list",expected:[[]]},{code:'1 "a" (2) list',expected:[[1,"a",[2]]]}]},lists={name:"Aggregate (List) Operators",description:"Operators for creating, deconstructing, and manipulating lists.",definitions:{cons,append,uncons,first,spread,rest,size,at,of,drop,take,concat,join,pick,setlist,zip,range,swizzle,list}},trueOp={definition:{exec:function*(e){e.push(!0)},description:"Pushes the boolean value `true`.",effect:"-> B"},examples:[{code:"true",expected:[!0]}]},falseOp={definition:{exec:function*(e){e.push(!1)},description:"Pushes the boolean value `false`.",effect:"-> B"},examples:[{code:"false",expected:[!1]}]},maxint={definition:{exec:function*(e){e.push(Number.MAX_SAFE_INTEGER)},description:"Pushes the largest safe integer available in the JavaScript environment.",effect:"-> I"},examples:[{code:"maxint",expected:[Number.MAX_SAFE_INTEGER]}]},stack$1={definition:{exec:function*(e){e.push([...e].reverse())},description:"Pushes a list representation of the current stack.",effect:".. X Y Z -> .. X Y Z [Z Y X ..]"},examples:[{code:"1 2 3 stack",expected:[1,2,3,[3,2,1]]},{code:"stack",expected:[[]]}]},clock={definition:{exec:function*(e){e.push(performance.now())},description:"Pushes the number of milliseconds since the page loaded.",effect:"-> F"},examples:[{code:"clock",assert:e=>e.length===1&&typeof e[0]=="number",expectedType:"number"}]},rand={definition:{exec:function*(e){e.push(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))},description:"Pushes a large random integer.",effect:"-> I"},examples:[{code:"rand",assert:e=>e.length===1&&Number.isInteger(e[0]),expectedType:"integer"}]},clearall={definition:{exec:function*(e,o,i,l){for(const u in l)"body"in l[u]&&delete l[u];e.length=0},description:"Clears the stack and removes all user-defined words from the dictionary.",effect:"[...] -> []"},examples:[{code:"[1+] inc = 1 2 3 clearall stack",expected:[[]]},{code:"1 2 3 clearall",expected:[]}]},t={definition:{exec:function*(e){e.push("t")},description:"A placeholder for the time variable. Inside a `bytebeat` or `floatbeat` quotation, it represents the integer sample count. Inside a `glsl` quotation, it represents the floating-point `u_time` uniform for animation.",effect:"-> t"},examples:[{code:"t",expected:["t"]}]},literals={name:"System & Environment",description:"Pushing constants and interacting with the environment.",definitions:{true:trueOp,false:falseOp,maxint,stack:stack$1,clock,rand,clearall,t}},mouseState={x:0,y:0},mouseDownState={x:0,y:0},isMouseDownState={down:!1},mouse={definition:{exec:function*(e){e.push([mouseState.x,mouseState.y])},description:"Pushes the current mouse coordinates as a list `(x y)` onto the stack. In `glsl`, this becomes the `u_mouse` vec2 uniform. This operator is not available inside `bytebeat` or `floatbeat` quotations; use `(mousex mousey)` instead.",effect:"-> [x y]"},examples:[{code:"mouse",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0].length===2&&typeof e[0][0]=="number"&&typeof e[0][1]=="number",expectedDescription:"A list containing the mouse [x, y] coordinates."},{code:`
# A plane to act as a canvas
0 1 0 vec3 0 plane

# Create a material that ripples from the mouse cursor
(
  p xz mouse - # Calculate vector from surface point to normalized mouse
  length 50 * sin          # Create sine wave ripples
  dup dup vec3               # Make it grayscale
) glsl material

march
0 2 5 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("u_mouse")},expectedDescription:"An interactive shader with ripples emanating from the mouse cursor."}]},mousex={definition:{exec:function*(e){e.push(mouseState.x)},description:"Pushes the current mouse X coordinate to the stack. In `glsl`, this becomes `u_mouse.x`. In `bytebeat`/`floatbeat`, it is the window X coordinate.",effect:"-> N"},examples:[{code:"mousex",assert:e=>typeof e[0]=="number",expectedDescription:"A number representing the mouse X coordinate."},{code:`
# A simple theremin-like instrument where pitch is controlled by mouse-x
(
  # t is the time variable in floatbeat
  # mousex provides the window X coordinate
  t 44100 /           # Convert sample index to seconds
  mousex 2 * 220 +    # Map mouse x-coord to a frequency range (e.g., 220-...)
  * 2 * 3.14159 * sin # Calculate sine wave for the frequency
) 44100 floatbeat     # Run the formula at 44.1kHz
0.5 mul play          # Apply gain and play
`,assert:e=>Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"An interactive audio graph where mouse X controls pitch."}]},mousey={definition:{exec:function*(e){e.push(mouseState.y)},description:"Pushes the current mouse Y coordinate to the stack. In `glsl`, this becomes `u_mouse.y`. In `bytebeat`/`floatbeat`, it is the window Y coordinate.",effect:"-> N"},examples:[{code:"mousey",assert:e=>typeof e[0]=="number",expectedDescription:"A number representing the mouse Y coordinate."},{code:`
# A simple theremin-like instrument where volume is controlled by mouse-y
(
  # A static 440Hz sine wave tone
  t 44100 / 440 * 2 * 3.14159 * sin
  
  # Calculate gain from mouse-y, inverting so up=louder
  # and clamping to a safe 0-1 range
  1.0 mousey 800 / - 0.0 1.0 clamp
  
  # Apply gain
  *
) 44100 floatbeat play
`,assert:e=>Array.isArray(e[0])&&e[0][0]==="floatbeat",expectedDescription:"An interactive audio graph where mouse Y controls volume."}]},moused={definition:{exec:function*(e){e.push([mouseDownState.x,mouseDownState.y])},description:"Pushes the mouse coordinates from the last mousedown event as a list `(x y)`. The value is updated on `mousedown` and while dragging. In `glsl`, this becomes the `u_moused.xy` vec2 uniform.",effect:"-> [x y]"},examples:[{code:"moused",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0].length===2&&typeof e[0][0]=="number"&&typeof e[0][1]=="number",expectedDescription:"A list containing the mousedown [x, y] coordinates."},{code:`
# An interactive Julia set explorer.
# Click and drag to change the 'c' parameter of the fractal.
2.0 sphere

# Create the material for the interactive Julia set
(
    # The surface coordinates for the fractal
    (p xy) glsl
    
    # The 'c' parameter, controlled by the mousedown position normalized to [-1, 1]
    (moused u_resolution / 0.5 - 2.0 *) glsl
    
    # The radius/zoom level
    1.0
    
    # Generate the raw fractal value
    juliaset
    
    # Make it colorful and animated
    (t 0.2 *) glsl + # Animate hue
    1.0 1.0 hsv
) glsl material

march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("u_moused")},expectedDescription:"An interactive shader where clicking and dragging explores different parts of the Julia set fractal."}]},mousedx={definition:{exec:function*(e){e.push(mouseDownState.x)},description:"Pushes the X coordinate from the last mousedown event. The value is updated on `mousedown` and while dragging. In `glsl`, this becomes `u_moused.x`. In `bytebeat`/`floatbeat`, it is the window X coordinate.",effect:"-> N"},examples:[{code:"mousedx",assert:e=>typeof e[0]=="number",expectedDescription:"A number representing the mousedown X coordinate."},{code:`
# Two spheres that will be blended
0.5 sphere
0.5 sphere 0.5 0 0 vec3 translate

# The smoothness of their union is controlled by the mousedown x-position
(mousedx) glsl
smoothUnion

:red material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("u_moused")},expectedDescription:"An interactive shader where dragging the mouse horizontally controls the smoothness of the blend between two spheres."}]},mousedy={definition:{exec:function*(e){e.push(mouseDownState.y)},description:"Pushes the Y coordinate from the last mousedown event. The value is updated on `mousedown` and while dragging. In `glsl`, this becomes `u_moused.y`. In `bytebeat`/`floatbeat`, it is the window Y coordinate.",effect:"-> N"},examples:[{code:"mousedy",assert:e=>typeof e[0]=="number",expectedDescription:"A number representing the mousedown Y coordinate."},{code:`
# A static sphere
0.5 sphere

# A second sphere whose radius is controlled by the mousedown y-position
(mousedy) glsl sphere
0.5 0 0 vec3 translate

# Blend them together
0.1 smoothUnion

:blue material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("u_moused")},expectedDescription:"An interactive shader where dragging the mouse vertically controls the size of one of the spheres."}]},input={name:"Input Devices",description:"Operators for getting input from devices like the mouse.",definitions:{mouse,mousex,mousey,moused,mousedx,mousedy}},and={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(isMatrix(i)||isMatrix(o)){const l=(u,d)=>u&&d?1:0;if(isMatrix(i)&&isMatrix(o)){const u=i,d=o;if(u.length!==d.length||u.length>0&&u[0].length!==d[0].length)throw new Error("Matrix dimensions must match for element-wise logical AND.");const h=u.map((m,g)=>m.map((b,v)=>l(b,d[g][v])));e.push(h);return}if(isMatrix(i)&&!isMatrix(o)){const d=i.map(h=>h.map(m=>l(m,o)));e.push(d);return}if(!isMatrix(i)&&isMatrix(o)){const d=o.map(h=>h.map(m=>l(i,m)));e.push(d);return}}if(isMarchingObject(i)&&isMarchingObject(o)){e.push(createMarchingObject("intersection","combinator",[i,o]));return}if(Array.isArray(i)&&Array.isArray(o)){const l=new Set(i),u=new Set(o),d=[...l].filter(h=>u.has(h));e.push(d);return}e.push(i&&o)},description:"Logical AND for booleans, an SDF intersection for two SDFs, element-wise logical AND for matrices (results in 0 or 1), or a set intersection for two lists.",effect:"[A B] -> [C]"},examples:[{code:"true true and",expected:[!0]},{code:"true false and",expected:[!1]},{code:"1 0 and",expected:[0]},{code:"0.5 sphere 0.3 0.3 0.6 vec3 box and march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the intersection."},{code:"((1 0)(5 1)) ((-1 2)(0 1)) and",expected:[[[1,0],[0,1]]]},{code:"(1 2 3) (2 3 4) and",expected:[[2,3]]},{code:"(1 2) (3 4) and",expected:[[]]}]},or={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(isMatrix(i)||isMatrix(o)){const l=(u,d)=>u||d?1:0;if(isMatrix(i)&&isMatrix(o)){const u=i,d=o;if(u.length!==d.length||u.length>0&&u[0].length!==d[0].length)throw new Error("Matrix dimensions must match for element-wise logical OR.");const h=u.map((m,g)=>m.map((b,v)=>l(b,d[g][v])));e.push(h);return}if(isMatrix(i)&&!isMatrix(o)){const d=i.map(h=>h.map(m=>l(m,o)));e.push(d);return}if(!isMatrix(i)&&isMatrix(o)){const d=o.map(h=>h.map(m=>l(i,m)));e.push(d);return}}if(isMarchingObject(i)&&isMarchingObject(o)){e.push(createMarchingObject("union","combinator",[i,o]));return}if(Array.isArray(i)&&Array.isArray(o)){const l=[...new Set([...i,...o])];e.push(l);return}e.push(i||o)},description:"Logical OR for booleans, an SDF union for two SDFs, element-wise logical OR for matrices (results in 0 or 1), or a set union for two lists.",effect:"[A B] -> [C]"},examples:[{code:"true false or",expected:[!0]},{code:"false false or",expected:[!1]},{code:"1 0 or",expected:[1]},{code:"0.5 sphere 0.3 0.3 0.6 vec3 box or march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the union."},{code:"((1 0)(0 1)) 0 or",expected:[[[1,0],[0,1]]]},{code:"(1 2 3) (2 3 4) or",expected:[[1,2,3,4]]},{code:"(1 2) (3 4) or",expected:[[1,2,3,4]]}]},xor={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(isMatrix(i)||isMatrix(o)){const l=(u,d)=>!!u!=!!d?1:0;if(isMatrix(i)&&isMatrix(o)){const u=i,d=o;if(u.length!==d.length||u.length>0&&u[0].length!==d[0].length)throw new Error("Matrix dimensions must match for element-wise logical XOR.");const h=u.map((m,g)=>m.map((b,v)=>l(b,d[g][v])));e.push(h);return}if(isMatrix(i)&&!isMatrix(o)){const d=i.map(h=>h.map(m=>l(m,o)));e.push(d);return}if(!isMatrix(i)&&isMatrix(o)){const d=o.map(h=>h.map(m=>l(i,m)));e.push(d);return}}if(isMarchingObject(i)&&isMarchingObject(o)){e.push(createMarchingObject("xor","combinator",[i,o]));return}if(Array.isArray(i)&&Array.isArray(o)){const l=new Set(i),u=new Set(o),d=[...l].filter(m=>!u.has(m)),h=[...u].filter(m=>!l.has(m));e.push([...d,...h]);return}e.push(!!(i^o))},description:"Logical XOR for booleans, an SDF combinator for two SDFs, element-wise logical XOR for matrices (results in 0 or 1), or a set symmetric difference for two lists.",effect:"[A B] -> [C]"},examples:[{code:"true true xor",expected:[!1]},{code:"true false xor",expected:[!0]},{code:"1 0 xor",expected:[!0]},{code:"0.5 sphere 0.3 0.3 0.3 vec3 box xor march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the XOR combination."},{code:"((1 0)(1 0)) ((1 1)(0 0)) xor",expected:[[[0,1],[1,0]]]},{code:"(1 2 3) (2 3 4) xor",expected:[[1,4]]},{code:"(1 2) (3 4) xor",expected:[[1,2,3,4]]}]},not={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>l?0:1))):e.push(!o)},description:"Logical NOT. Replaces top of stack with its logical negation. Supports element-wise operation on matrices, resulting in 0s and 1s.",effect:"[A] -> [!A]"},examples:[{code:"true not",expected:[!1]},{code:"false not",expected:[!0]},{code:"0 not",expected:[!0]},{code:'((1 0)("hello" ())) not',expected:[[[0,1],[0,0]]]}]},logic={name:"Logical Operations",description:"Operators for performing boolean logic. For lists, these operators perform set-like operations (intersection, union, etc.).",definitions:{and,or,xor,not}},isGLSLExpression$6=e=>(e==null?void 0:e.type)==="glsl_expression",add={definition:{exec:function*(e){if(e.length>=2){const m=e[e.length-1],g=e[e.length-2];if(isGLSLExpression$6(g)||isGLSLExpression$6(m)){e.pop(),e.pop();const b=toGLSL(g),v=toGLSL(m);e.push({type:"glsl_expression",code:`(${b} + ${v})`});return}}const o=(m,g)=>m+g,i=0;if(e.length===1&&Array.isArray(e[0])){const m=e.pop();if(m.length===0){e.push(i);return}const[g,...b]=m,v=b.reduce((w,D)=>applyBinaryOp(o,w,D),g);isFlatList(v)?e.push(...v):e.push(v);return}const l=e.pop(),u=e.pop();if(u===void 0||l===void 0){e.push((u??0)+(l??0));return}const d=applyBinaryOp(o,u,l);typeof u=="number"&&Array.isArray(l)||Array.isArray(u)&&typeof l=="number"?e.push(d):isFlatList(d)?e.push(...d):e.push(d)},description:'Adds two values. If both are numbers, it performs addition. If a scalar and an aggregate (list/matrix) are involved, it performs broadcasting, returning a new aggregate. If two aggregates are involved, it performs a recursive, "sideways" (outer product) addition, spreading flat lists back onto the stack. If only one argument is on the stack and it is a list, it reduces the list by addition.',effect:"[A B] -> [C] or [[A B C]] -> ..."},examples:[{code:"10 20 +",expected:[30]},{code:"1 +",expected:[1]},{code:"+",expected:[0]},{code:"(1 2 3) +",expected:[6]},{code:"((1 2) (3 4)) +",expected:[4,5,5,6]},{code:"(1 (2 3)) +",expected:[3,4]},{code:"() +",expected:[0]},{code:"(1 2 3) 10 +",expected:[[11,12,13]]},{code:"10 (1 2 3) +",expected:[[11,12,13]]},{code:"((1 2)(3 4)) 10 +",expected:[[[11,12],[13,14]]]},{code:"10 ((1 2)(3 4)) +",expected:[[[11,12],[13,14]]]},{code:"(1 2) (3 4) +",expected:[4,5,5,6]},{code:"(1 2 3) (4 5 6) +",expected:[5,6,7,6,7,8,7,8,9]},{code:"(1 2) ((3 4) (5 6)) +",expected:[4,5,6,7,5,6,7,8]},{code:"((1 2) (3 4)) (10 20) +",expected:[11,12,21,22,13,14,23,24]}]},subtract={definition:{exec:function*(e){const o=(m,g)=>m-g;if(e.length===1&&Array.isArray(e[0])){const m=e.pop();if(m.length===0){e.push(0);return}const[g,...b]=m,v=b.reduce((w,D)=>applyBinaryOp(o,w,D),g);isFlatList(v)?e.push(...v):e.push(v);return}const l=e.pop(),u=e.pop();if(u===void 0||l===void 0){e.push((u??0)-(l??0));return}const d=applyBinaryOp(o,u,l);typeof u=="number"&&Array.isArray(l)||Array.isArray(u)&&typeof l=="number"?e.push(d):isFlatList(d)?e.push(...d):e.push(d)},description:'Subtracts two values. If a scalar and an aggregate (list/matrix) are involved, it performs broadcasting, returning a new aggregate. If two aggregates are involved, it performs a recursive, "sideways" (outer product) subtraction, spreading flat lists back onto the stack. If only one argument is on the stack and it is a list, it reduces the list by subtraction.',effect:"[A B] -> [C] or [[A B C]] -> ..."},examples:[{code:"30 10 -",expected:[20]},{code:"10 -",expected:[-10]},{code:"-",expected:[0]},{code:"(10 5 2) -",expected:[3]},{code:"(10 (5 6)) -",expected:[5,4]},{code:"(10 20) 5 -",expected:[[5,15]]},{code:"100 (10 20) -",expected:[[90,80]]},{code:"((10 20)(30 40)) 5 -",expected:[[[5,15],[25,35]]]},{code:"(10 20) (1 2) -",expected:[9,8,19,18]},{code:"(5 1) (2 3) -",expected:[3,2,-1,-2]}]},isGLSLExpression$5=e=>(e==null?void 0:e.type)==="glsl_expression",multiply={definition:{exec:function*(e){if(e.length>=2){const m=e[e.length-1],g=e[e.length-2];if(isGLSLExpression$5(g)||isGLSLExpression$5(m)){e.pop(),e.pop();const b=toGLSL(g),v=toGLSL(m);e.push({type:"glsl_expression",code:`(${b} * ${v})`});return}}const o=(m,g)=>m*g,i=1;if(e.length===1&&Array.isArray(e[0])){const m=e.pop();if(m.length===0){e.push(i);return}const[g,...b]=m,v=b.reduce((w,D)=>applyBinaryOp(o,w,D),g);isFlatList(v)?e.push(...v):e.push(v);return}const l=e.pop(),u=e.pop();if(u===void 0||l===void 0){e.push((u??0)*(l??0));return}const d=applyBinaryOp(o,u,l);typeof u=="number"&&Array.isArray(l)||Array.isArray(u)&&typeof l=="number"?e.push(d):isFlatList(d)?e.push(...d):e.push(d)},description:'Multiplies two values. If a scalar and an aggregate (list/matrix) are involved, it performs broadcasting, returning a new aggregate. If two aggregates are involved, it performs a recursive, "sideways" (outer product) multiplication, spreading flat lists back onto the stack. If only one argument is on the stack and it is a list, it reduces the list by multiplication.',effect:"[A B] -> [C] or [[A B C]] -> ..."},examples:[{code:"10 5 *",expected:[50]},{code:"5 *",expected:[0]},{code:"*",expected:[0]},{code:"(2 3 4) *",expected:[24]},{code:"(2 (3 4)) *",expected:[6,8]},{code:"() *",expected:[1]},{code:"(2 3) 10 *",expected:[[20,30]]},{code:"10 (2 3) *",expected:[[20,30]]},{code:"((1 2)(3 4)) 10 *",expected:[[[10,20],[30,40]]]},{code:"(2 3) (4 5) *",expected:[8,10,12,15]},{code:"(1 2 3) (4 5) *",expected:[4,5,8,10,12,15]}]},divide={definition:{exec:function*(e){const o=(m,g)=>g===0?null:m/g;if(e.length===1&&Array.isArray(e[0])){const m=e.pop();if(m.length===0){e.push(1);return}const[g,...b]=m,v=b.reduce((w,D)=>applyBinaryOp(o,w,D),g);isFlatList(v)?e.push(...v):e.push(v);return}const l=e.pop(),u=e.pop();if(u===void 0||l===void 0){const m=u??1,g=l??1;e.push(g===0?null:m/g);return}const d=applyBinaryOp(o,u,l);typeof u=="number"&&Array.isArray(l)||Array.isArray(u)&&typeof l=="number"?e.push(d):isFlatList(d)?e.push(...d):e.push(d)},description:'Divides two values. If a scalar and an aggregate (list/matrix) are involved, it performs broadcasting, returning a new aggregate. If two aggregates are involved, it performs a recursive, "sideways" (outer product) division, spreading flat lists back onto the stack. If only one argument is on the stack and it is a list, it reduces the list by division. Division by zero results in `null`.',effect:"[A B] -> [C] or [[A B C]] -> ..."},examples:[{code:"20 4 /",expected:[5]},{code:"10 0 /",expected:[null]},{code:"5 /",expected:[.2]},{code:"/ # 1/1",expected:[1]},{code:"(100 5 2) /",expected:[10]},{code:"(100 (5 2)) /",expected:[20,50]},{code:"(10 20) 2 /",expected:[[5,10]]},{code:"20 (2 4) /",expected:[[10,5]]},{code:"((10 20)(30 40)) 2 /",expected:[[[5,10],[15,20]]]},{code:"(10 20) (2 5) /",expected:[5,2,10,4]},{code:"(10 20) (2 0) /",expected:[5,null,10,null]}]},modulo={definition:{exec:function*(e){const o=(m,g)=>g===0?0:m%g;if(e.length===1&&Array.isArray(e[0])){const m=e.pop();if(m.length===0){e.push(0);return}const[g,...b]=m,v=b.reduce((w,D)=>applyBinaryOp(o,w,D),g);isFlatList(v)?e.push(...v):e.push(v);return}const l=e.pop(),u=e.pop();if(u===void 0||l===void 0){e.push(o(u??0,l??1));return}const d=applyBinaryOp(o,u,l);typeof u=="number"&&Array.isArray(l)||Array.isArray(u)&&typeof l=="number"?e.push(d):isFlatList(d)?e.push(...d):e.push(d)},description:'Performs the modulo operation. If a scalar and an aggregate are involved, it performs broadcasting. If two aggregates are involved, it performs a "sideways" operation. If a single list is provided, it reduces the list.',effect:"[A B] -> [C] or [[A B C]] -> ..."},examples:[{code:"10 3 %",expected:[1]},{code:"10 0 %",expected:[0]},{code:"10 %",expected:[0]},{code:"(10 4 3) %",expected:[2]},{code:"(10 (11 12)) %",expected:[10%11,10%12]},{code:"(10 11) 3 %",expected:[[1,2]]},{code:"10 (3 4) %",expected:[[1,2]]},{code:"((10 11)(12 13)) 3 %",expected:[[[1,2],[0,1]]]},{code:"(10 11) (3 4) %",expected:[1,2,2,3]}]},div={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(Math.floor(i/o),i%o)},description:"Integer division. Pushes quotient and remainder.",effect:"[I J] -> [K L]"},examples:[{code:"21 10 div",expected:[2,1]},{code:"-21 10 div",expected:[-3,-1]},{code:"10 div",assert:e=>e.length===2&&isNaN(e[0])&&isNaN(e[1]),expectedDescription:"[NaN, NaN]"},{code:"10 0 div",assert:e=>e.length===2&&e[0]===1/0&&isNaN(e[1]),expectedDescription:"[Infinity, NaN]"}]},succ={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>l+1))):e.push((o??0)+1)},description:"Successor. Adds 1 to the top element. Supports matrices for element-wise operation.",effect:"[N] -> [N+1]"},examples:[{code:"10 succ",expected:[11]},{code:"-1 succ",expected:[0]},{code:"succ",expected:[1]},{code:"10 ++",expected:[11]},{code:"((1 2)(3 4)) succ",expected:[[[2,3],[4,5]]]}]},pred={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>l-1))):e.push((o??0)-1)},description:"Predecessor. Subtracts 1 from the top element. Supports matrices for element-wise operation.",effect:"[N] -> [N-1]"},examples:[{code:"10 pred",expected:[9]},{code:"0 pred",expected:[-1]},{code:"pred",expected:[-1]},{code:"10 --",expected:[9]},{code:"((1 2)(3 4)) pred",expected:[[[0,1],[2,3]]]}]},max={definition:{exec:function*(e){const o=(m,g)=>Math.max(m,g);if(e.length===1&&Array.isArray(e[0])){const m=e.pop();if(m.length===0){e.push(-1/0);return}const[g,...b]=m,v=b.reduce((w,D)=>applyBinaryOp(o,w,D),g);isFlatList(v)?e.push(...v):e.push(v);return}const l=e.pop(),u=e.pop();if(u===void 0||l===void 0){e.push(Math.max(u??-1/0,l??-1/0));return}const d=applyBinaryOp(o,u,l);typeof u=="number"&&Array.isArray(l)||Array.isArray(u)&&typeof l=="number"?e.push(d):isFlatList(d)?e.push(...d):e.push(d)},description:'Pushes the maximum of two values. If a scalar and an aggregate are involved, it performs broadcasting. If two aggregates are involved, it performs a "sideways" operation. If a single list is provided, it finds the maximum value in the list.',effect:"[A B] -> [N] or [[A B C]] -> ..."},examples:[{code:"10 20 max",expected:[20]},{code:"10 max",expected:[10]},{code:"max",expected:[-1/0]},{code:"(-10 50 2) max",expected:[50]},{code:"((1 100) (50 2)) max",expected:[50,2,100,100]},{code:"(10 (20 5)) max",expected:[20,10]},{code:"(1 10) 5 max",expected:[[5,10]]},{code:"50 ((1 100)(50 2)) max",expected:[[[50,100],[50,50]]]},{code:"(1 10) (5 2) max",expected:[5,2,10,10]}]},min={definition:{exec:function*(e){const o=(m,g)=>Math.min(m,g);if(e.length===1&&Array.isArray(e[0])){const m=e.pop();if(m.length===0){e.push(1/0);return}const[g,...b]=m,v=b.reduce((w,D)=>applyBinaryOp(o,w,D),g);isFlatList(v)?e.push(...v):e.push(v);return}const l=e.pop(),u=e.pop();if(u===void 0||l===void 0){e.push(Math.min(u??0,l??0));return}const d=applyBinaryOp(o,u,l);typeof u=="number"&&Array.isArray(l)||Array.isArray(u)&&typeof l=="number"?e.push(d):isFlatList(d)?e.push(...d):e.push(d)},description:'Pushes the minimum of two values. If a scalar and an aggregate are involved, it performs broadcasting. If two aggregates are involved, it performs a "sideways" operation. If a single list is provided, it finds the minimum value in the list.',effect:"[A B] -> [N] or [[A B C]] -> ..."},examples:[{code:"10 20 min",expected:[10]},{code:"10 min",expected:[0]},{code:"min",expected:[0]},{code:"(-10 50 2) min",expected:[-10]},{code:"((1 100) (50 2)) min",expected:[1,1,50,2]},{code:"(10 (20 5)) min",expected:[10,5]},{code:"() min",expected:[1/0]},{code:"(10 20) 15 min",expected:[[10,15]]},{code:"50 ((1 100)(50 2)) min",expected:[[[1,50],[50,2]]]},{code:"(10 2) (5 20) min",expected:[5,10,2,2]}]},sum={definition:{exec:function*(e){const o=e.pop()??[];if(!Array.isArray(o))throw new Error("sum expects a list");e.push(o.reduce((i,l)=>i+(typeof l=="number"?l:0),0))},description:"Calculates the sum of the numbers in a list.",effect:"[A] -> [N]"},examples:[{code:"(1 2 3) sum",expected:[6]},{code:"(10 20 30) set sum",expected:[60]},{code:"(10 -2 5) sum",expected:[13]},{code:"() sum",expected:[0]},{code:"() set sum",expected:[0]},{code:"sum",expected:[0]},{code:['"some_value" :sum =',"(1 2 3) sum"],expected:[6]},{code:["(1 +) sum =>","1 sum"],expected:[2]}]},neg={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>-l))):e.push(-(o??0))},description:"Negates the top element. Supports matrices for element-wise negation.",effect:"[N] -> [N']"},examples:[{code:"15 neg",expected:[-15]},{code:"-10 neg",expected:[10]},{code:"neg",expected:[0]},{code:"((1 -2)(3 -4)) neg",expected:[[[-1,2],[-3,4]]]}]},abs={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.abs(l)))):e.push(Math.abs(o??0))},description:"Pushes the absolute value of the top element. Supports matrices for element-wise operation.",effect:"[N] -> [N']"},examples:[{code:"-15 abs",expected:[15]},{code:"20 abs",expected:[20]},{code:"abs",expected:[0]},{code:"((1 -2)(3 -4)) abs",expected:[[[1,2],[3,4]]]}]},sign={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>Math.sign(l)))):e.push(Math.sign(o??0))},description:"Pushes the sign of a number (-1, 0, or 1). Supports matrices for element-wise operation.",effect:"[N] -> [N']"},examples:[{code:"-15 sign",expected:[-1]},{code:"15 sign",expected:[1]},{code:"0 sign",expected:[0]},{code:"sign",expected:[0]},{code:"((10 -20)(0 5)) sign",expected:[[[1,-1],[0,1]]]}]},bitwiseAnd={definition:{exec:function*(e){const o=(m,g)=>(m|0)&(g|0);if(e.length===1&&Array.isArray(e[0])){const m=e.pop();if(m.length===0){e.push(-1);return}const[g,...b]=m,v=b.reduce((w,D)=>applyBinaryOp(o,w,D),g);isFlatList(v)?e.push(...v):e.push(v);return}if(e.length<2)throw new Error("Bitwise AND operator requires two arguments.");const l=e.pop(),u=e.pop(),d=applyBinaryOp(o,u,l);typeof u=="number"&&Array.isArray(l)||Array.isArray(u)&&typeof l=="number"?e.push(d):isFlatList(d)?e.push(...d):e.push(d)},description:'Bitwise AND. If a scalar and an aggregate are involved, it performs broadcasting. If two aggregates are involved, it performs a "sideways" operation. If a single list is provided, it reduces the list. Operands are treated as 32-bit integers.',effect:"[A B] -> [C] or [[A B C]] -> ..."},examples:[{code:"6 3 &",expected:[2]},{code:"(6 3 2) &",expected:[2]},{code:"() &",expected:[-1]},{code:"(6 5) 3 &",expected:[[2,1]]},{code:"3 (6 5) &",expected:[[2,1]]},{code:"((6 5)(1 15)) 3 &",expected:[[[2,1],[1,3]]]},{code:"(7 15) (3 5) &",expected:[3,5,3,5]}]},bitwiseOr={definition:{exec:function*(e){const o=(m,g)=>m|0|(g|0);if(e.length===1&&Array.isArray(e[0])){const m=e.pop();if(m.length===0){e.push(0);return}const[g,...b]=m,v=b.reduce((w,D)=>applyBinaryOp(o,w,D),g);isFlatList(v)?e.push(...v):e.push(v);return}if(e.length<2)throw new Error("Bitwise OR operator requires two arguments.");const l=e.pop(),u=e.pop(),d=applyBinaryOp(o,u,l);typeof u=="number"&&Array.isArray(l)||Array.isArray(u)&&typeof l=="number"?e.push(d):isFlatList(d)?e.push(...d):e.push(d)},description:'Bitwise OR. If a scalar and an aggregate are involved, it performs broadcasting. If two aggregates are involved, it performs a "sideways" operation. If a single list is provided, it reduces the list. Operands are treated as 32-bit integers.',effect:"[A B] -> [C] or [[A B C]] -> ..."},examples:[{code:"5 2 |",expected:[7]},{code:"(1 2 4) |",expected:[7]},{code:"() |",expected:[0]},{code:"(5 4) 1 |",expected:[[5,5]]},{code:"1 (5 4) |",expected:[[5,5]]},{code:"((5 4)(2 1)) 1 |",expected:[[[5,5],[3,1]]]},{code:"(1 2) (4 8) |",expected:[5,9,6,10]}]},bitwiseXor={definition:{exec:function*(e){const o=(m,g)=>(m|0)^(g|0);if(e.length===1&&Array.isArray(e[0])){const m=e.pop();if(m.length===0){e.push(0);return}const[g,...b]=m,v=b.reduce((w,D)=>applyBinaryOp(o,w,D),g);isFlatList(v)?e.push(...v):e.push(v);return}if(e.length<2)throw new Error("Bitwise XOR operator requires two arguments.");const l=e.pop(),u=e.pop(),d=applyBinaryOp(o,u,l);typeof u=="number"&&Array.isArray(l)||Array.isArray(u)&&typeof l=="number"?e.push(d):isFlatList(d)?e.push(...d):e.push(d)},description:'Bitwise XOR. If a scalar and an aggregate are involved, it performs broadcasting. If two aggregates are involved, it performs a "sideways" operation. If a single list is provided, it reduces the list. Operands are treated as 32-bit integers.',effect:"[A B] -> [C] or [[A B C]] -> ..."},examples:[{code:"5 3 ^",expected:[6]},{code:"(5 3 1) ^",expected:[7]},{code:"() ^",expected:[0]},{code:"(5 7) 3 ^",expected:[[6,4]]},{code:"3 (5 7) ^",expected:[[6,4]]},{code:"((5 3)(7 2)) 3 ^",expected:[[[6,0],[4,1]]]},{code:"(5 3) (1 2) ^",expected:[4,7,2,1]}]},bitwiseNot={definition:{exec:function*(e){const o=e.pop();isMatrix(o)?e.push(o.map(i=>i.map(l=>~(l|0)))):e.push(~(o|0))},description:"Bitwise NOT. Inverts the bits of the top element. Supports matrices for element-wise operation. The operand is treated as a 32-bit integer.",effect:"[A] -> [C]"},examples:[{code:"5 ~",expected:[-6]},{code:"-1 ~",expected:[0]},{code:"((5 -1)(0 255)) ~",expected:[[[-6,0],[-1,-256]]]}]},leftShift={definition:{exec:function*(e){const o=(h,m)=>(h|0)<<(m|0);if(e.length<2)throw new Error("Left shift operator requires two arguments.");const i=e.pop(),l=e.pop(),u=applyBinaryOp(o,l,i);typeof l=="number"&&Array.isArray(i)||Array.isArray(l)&&typeof i=="number"?e.push(u):isFlatList(u)?e.push(...u):e.push(u)},description:'Bitwise left shift. Supports recursive, "sideways" (outer product) operations for lists and matrices. If a scalar and an aggregate are involved, it performs broadcasting. Operands are treated as 32-bit integers.',effect:"[A B] -> [C]"},examples:[{code:"5 1 <<",expected:[10]},{code:"(5 1) 2 <<",expected:[[20,4]]},{code:"2 (5 1) <<",expected:[[64,4]]},{code:"((5 1)(2 8)) 1 <<",expected:[[[10,2],[4,16]]]},{code:"(5 1) (1 2) <<",expected:[10,20,2,4]}]},rightShift={definition:{exec:function*(e){const o=(h,m)=>(h|0)>>(m|0);if(e.length<2)throw new Error("Right shift operator requires two arguments.");const i=e.pop(),l=e.pop(),u=applyBinaryOp(o,l,i);typeof l=="number"&&Array.isArray(i)||Array.isArray(l)&&typeof i=="number"?e.push(u):isFlatList(u)?e.push(...u):e.push(u)},description:'Bitwise (sign-propagating) right shift. Supports recursive, "sideways" (outer product) operations for lists and matrices. If a scalar and an aggregate are involved, it performs broadcasting. Operands are treated as 32-bit integers.',effect:"[A B] -> [C]"},examples:[{code:"10 1 >>",expected:[5]},{code:"(10 255) 1 >>",expected:[[5,127]]},{code:"255 (1 4) >>",expected:[[127,15]]},{code:"((10 255)(-10 1)) 1 >>",expected:[[[5,127],[-5,0]]]},{code:"(10 255) (1 2) >>",expected:[5,2,127,63]}]},average={definition:{exec:function*(e){const o=e.pop()??[];if(!Array.isArray(o))throw new Error("average expects a list");const i=o.filter(u=>typeof u=="number");if(i.length===0){e.push(0);return}const l=i.reduce((u,d)=>u+d,0);e.push(l/i.length)},description:"Calculates the average of the numbers in a list. Non-numeric elements are ignored.",effect:"[A] -> [N]"},examples:[{code:"(1 2 3 5) average",expected:[2.75]},{code:"(10 20 30) average",expected:[20]},{code:"(10 -10 30) average",expected:[10]},{code:"() average",expected:[0]},{code:'(1 2 "hello" 3) average',expected:[2]},{code:'("a" "b") average',expected:[0]},{code:"average",expected:[0]},{code:"(1 2 3 5) avg",expected:[2.75]}]},math={definitions:{"+":add,"-":subtract,"*":multiply,"/":divide,"%":modulo,div,succ,pred,max,min,sum,neg,abs,sign,average,"&":bitwiseAnd,"|":bitwiseOr,"^":bitwiseXor,"~":bitwiseNot,"<<":leftShift,">>":rightShift}},mat={definition:{exec:function*(e){const o=e.pop();if(typeof o!="number"||!Number.isInteger(o)||o<0){if(Array.isArray(o)&&o.length===0){e.push([]);return}throw o!==void 0&&e.push(o),new Error("mat operator expects a non-negative integer for column count.")}const i=o;if(e.length>=i&&i>0&&e.slice(e.length-i).every(h=>Array.isArray(h)&&!isMatrix(h))){const h=e.splice(e.length-i,i),m=h[0].length;if(!h.every(g=>g.length===m))throw e.push(...h,i),new Error("All lists must have the same length to form a matrix.");e.push(h);return}if(i===0){const u=e[e.length-1];if(Array.isArray(u)){const h=e.pop().length;e.push(Array(h).fill([]))}else e.push([]);return}const l=e[e.length-1];if(Array.isArray(l)&&!isMatrix(l)){const d=e.pop().filter(m=>typeof m=="number");if(d.length%i!==0)throw new Error(`The number of number elements in the list (${d.length}) is not divisible by the column count (${i}).`);const h=[];for(let m=0;m<d.length;m+=i)h.push(d.slice(m,m+i));e.push(h)}else{const u=i,d=i*u,h=[],m=[],g=[...e];for(;g.length>0&&h.length<d;){const w=g.pop();if(m.push(w),!isMatrix(w)){if(typeof w!="number")throw new Error("mat operator requires number elements from the stack.");h.push(w)}}e.length-=m.length;const b=h.reverse();for(;b.length<d;)b.push(0);const v=[];for(let w=0;w<u;w++)v.push(b.slice(w*i,(w+1)*i));e.push(v)}},description:"Creates a matrix. Consumes a number `M`. If the top `M` items on the stack are lists of consistent length, they form the rows of the matrix. Otherwise, if the next item is a list, it converts that list into a matrix with `M` columns. Otherwise, it assumes a square matrix, consuming `M*M` numbers to create an `M`x`M` matrix.",effect:"[r1..rM M] -> [matrix] OR [[e1...eN] M] -> [matrix] OR [e1..e(M*M) M] -> [matrix]"},examples:[{code:"(1 2) (3 4) 2 mat",expected:[[[1,2],[3,4]]]},{code:"(1) (2) (3) 3 mat",expected:[[[1],[2],[3]]]},{code:"(1 2) (3 4 5) 2 mat",expectedError:"All lists must have the same length to form a matrix."},{code:"1 2 3 4 2 mat",expected:[[[1,2],[3,4]]]},{code:"(1 2 3 4 5 6) 3 mat",expected:[[[1,2,3],[4,5,6]]]},{code:"(1 2 3 4 5) 2 mat",expectedError:"The number of number elements in the list (5) is not divisible by the column count (2)."},{code:"1 2 3 4 5 6 7 8 9 3 mat",expected:[[[1,2,3],[4,5,6],[7,8,9]]]},{code:"1 2 3 2 mat",expected:[[[1,2],[3,0]]]},{code:'1 2 3 "a" 2 mat',expectedError:"mat operator requires number elements from the stack."},{code:"1 2 3 4 2 mat 1 2 3 4 2 mat",expected:[[[1,2],[3,4]],[[1,2],[3,4]]]},{code:"(1 2 3 4 2 mat) mymatrix = (1 2 mymatrix 3 4) 2 mat",expected:[[[1,2],[3,4]]]},{code:"2 mat",expected:[[[0,0],[0,0]]]}]},cmat={definition:{exec:function*(e){const o=e.pop();if(!Number.isInteger(o)||o<0)throw new Error("cmat operator expects a non-negative integer.");const i=e[e.length-1];if(Array.isArray(i)&&!isMatrix(i)){const l=e.pop(),u=o;if(u===0){e.push([]);return}const d=l.filter(m=>typeof m=="number");if(d.length%u!==0)throw new Error(`The number of number elements in the list (${d.length}) is not divisible by the row count (${u}).`);d.length/u;const h=Array.from({length:u},()=>[]);for(let m=0;m<d.length;m++)h[m%u].push(d[m]);e.push(h)}else{const l=o,u=o*l,d=[];let h=0;for(let b=e.length-1;b>=0&&d.length<u;b--){const v=e[b];if(h++,!isMatrix(v)){if(typeof v!="number")throw new Error("cmat operator requires number elements from the stack.");d.push(v)}}e.splice(e.length-h);const m=d.reverse();for(;m.length<u;)m.push(0);const g=Array.from({length:l},()=>[]);for(let b=0;b<m.length;b++)g[b%l].push(m[b]);e.push(g)}},description:"Creates a matrix in column-major order. If the next item is a list, it consumes a row count `M` and converts the list. Otherwise, it assumes a square `M`x`M` matrix and consumes `M*M` numbers from the stack. It ignores any non-numeric or matrix values it encounters.",effect:"[e1...e(M*M) M] -> [matrix] OR [[e1...eN] M] -> [matrix]"},examples:[{code:"1 2 3 4 2 cmat",expected:[[[1,3],[2,4]]]},{code:"(1 2 3 4 5 6) 3 cmat",expected:[[[1,4],[2,5],[3,6]]]},{code:"(1 2 3 4) 2 cmat",expected:[[[1,3],[2,4]]]},{code:"1 2 3 4 5 6 7 8 9 3 cmat",expected:[[[1,4,7],[2,5,8],[3,6,9]]]},{code:"1 2 3 4 2 cmat 1 2 3 4 2 cmat",expected:[[[1,3],[2,4]],[[1,3],[2,4]]]},{code:"1 2 2 cmat",expected:[[[1,0],[2,0]]]},{code:"2 cmat",expected:[[[0,0],[0,0]]]}]},mat2={definition:{exec:function*(e){if(e.length>=2&&e.slice(e.length-2).every(v=>Array.isArray(v)&&!isMatrix(v)&&v.length===2)){const v=e.splice(e.length-2,2);e.push(v);return}const i=4,l=e.splice(Math.max(0,e.length-i));if(!l.every(g=>typeof g=="number"))throw e.push(...l),new Error("mat2 operator requires number elements from the stack.");const u=i-l.length,d=Array(u).fill(0),h=[...l,...d],m=[];for(let g=0;g<2;g++)m.push(h.slice(g*2,(g+1)*2));e.push(m)},description:"Creates a 2x2 matrix. If the top two stack items are lists of size 2, they are used as rows. Otherwise, it consumes up to 4 numbers from the stack. Fills with 0 if not enough elements are available.",effect:"[[r1] [r2]] -> [matrix] OR [e1 e2 e3 e4]? -> [matrix]"},examples:[{code:"(1 2) (3 4) mat2",expected:[[[1,2],[3,4]]]},{code:"(1) (3 4) mat2",expectedError:"mat2 operator requires number elements from the stack."},{code:"1 2 3 4 mat2",expected:[[[1,2],[3,4]]]},{code:"1 2 mat2",expected:[[[1,2],[0,0]]]},{code:"mat2",expected:[[[0,0],[0,0]]]}]},mat3={definition:{exec:function*(e){if(e.length>=3&&e.slice(e.length-3).every(v=>Array.isArray(v)&&!isMatrix(v)&&v.length===3)){const v=e.splice(e.length-3,3);e.push(v);return}const i=9,l=e.splice(Math.max(0,e.length-i));if(!l.every(g=>typeof g=="number"))throw e.push(...l),new Error("mat3 operator requires number elements from the stack.");const u=i-l.length,d=Array(u).fill(0),h=[...l,...d],m=[];for(let g=0;g<3;g++)m.push(h.slice(g*3,(g+1)*3));e.push(m)},description:"Creates a 3x3 matrix. If the top three stack items are lists of size 3, they are used as rows. Otherwise, it consumes up to 9 numbers from the stack. Fills with 0 if not enough elements are available.",effect:"[[r1][r2][r3]] -> [matrix] OR [e1...e9]? -> [matrix]"},examples:[{code:"(1 2 3) (4 5 6) (7 8 9) mat3",expected:[[[1,2,3],[4,5,6],[7,8,9]]]},{code:"1 2 3 4 5 6 7 8 9 mat3",expected:[[[1,2,3],[4,5,6],[7,8,9]]]},{code:"1 2 3 mat3",expected:[[[1,2,3],[0,0,0],[0,0,0]]]},{code:"mat3",expected:[[[0,0,0],[0,0,0],[0,0,0]]]}]},mat4={definition:{exec:function*(e){if(e.length>=4&&e.slice(e.length-4).every(v=>Array.isArray(v)&&!isMatrix(v)&&v.length===4)){const v=e.splice(e.length-4,4);e.push(v);return}const i=16,l=e.splice(Math.max(0,e.length-i));if(!l.every(g=>typeof g=="number"))throw e.push(...l),new Error("mat4 operator requires number elements from the stack.");const u=i-l.length,d=Array(u).fill(0),h=[...l,...d],m=[];for(let g=0;g<4;g++)m.push(h.slice(g*4,(g+1)*4));e.push(m)},description:"Creates a 4x4 matrix. If the top four stack items are lists of size 4, they are used as rows. Otherwise, it consumes up to 16 numbers from the stack. Fills with 0 if not enough elements are available.",effect:"[[r1]..[r4]] -> [matrix] OR [e1...e16]? -> [matrix]"},examples:[{code:"(1 2 3 4) (5 6 7 8) (9 10 11 12) (13 14 15 16) mat4",expected:[[[1,2,3,4],[5,6,7,8],[9,10,11,12],[13,14,15,16]]]},{code:"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 mat4",expected:[[[1,2,3,4],[5,6,7,8],[9,10,11,12],[13,14,15,16]]]},{code:"1 2 3 4 mat4",expected:[[[1,2,3,4],[0,0,0,0],[0,0,0,0],[0,0,0,0]]]},{code:"mat4",expected:[[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]]}]},transpose={definition:{exec:function*(e){const o=e.pop();if(!isMatrix(o))throw new Error("transpose expects a matrix on the stack.");if(o.length===0||o[0].length===0){e.push(o);return}const i=o.length,l=o[0].length,u=Array.from({length:l},()=>Array(i).fill(0));for(let d=0;d<i;d++)for(let h=0;h<l;h++)u[h][d]=o[d][h];e.push(u)},description:"Transposes a matrix, swapping its rows and columns.",effect:"[matrix] -> [transposed_matrix]"},examples:[{code:"1 2 3 4 2 mat transpose",expected:[[[1,3],[2,4]]]},{code:"(1 2 3 4 5 6) 3 mat transpose",expected:[[[1,4],[2,5],[3,6]]]},{code:"() mat transpose",expected:[[]]}]},rotmat={definition:{exec:function*(e){const o=e.pop();if(!isMatrix(o))throw new Error("rotmat expects a matrix on the stack.");if(o.length===0||o[0].length===0){e.push(o);return}const i=o.length,l=o[0].length,u=Array.from({length:l},()=>Array(i).fill(0));for(let h=0;h<i;h++)for(let m=0;m<l;m++)u[m][h]=o[h][m];const d=u.map(h=>h.reverse());e.push(d)},description:"Rotates a matrix 90 degrees clockwise.",effect:"[matrix] -> [rotated_matrix]"},examples:[{code:"1 2 3 4 2 mat rotmat",expected:[[[3,1],[4,2]]]},{code:"(1 2 3 4 5 6) 3 mat rotmat",expected:[[[4,1],[5,2],[6,3]]]}]},rotcol={definition:{exec:function*(e){const o=e.pop();if(!isMatrix(o))throw new Error("rotcol expects a matrix on the stack.");if(o.length<2){e.push(o);return}const i=[...o.slice(1),o[0]];e.push(i)},description:"Rotates the columns of a matrix up, moving the top row to the bottom.",effect:"[matrix] -> [rotated_matrix]"},examples:[{code:"(1 2 3 4 5 6) 3 mat rotcol",expected:[[[4,5,6],[1,2,3]]]},{code:"1 2 2 mat rotcol",expected:[[[0,0],[1,2]]]}]},rotrow={definition:{exec:function*(e){const o=e.pop();if(!isMatrix(o))throw new Error("rotrow expects a matrix on the stack.");if(o.length===0){e.push(o);return}const i=o.map(l=>{if(l.length<2)return[...l];const u=[...l],d=u.pop();return u.unshift(d),u});e.push(i)},description:"Rotates each row of a matrix to the right, moving the last element of each row to the first position.",effect:"[matrix] -> [rotated_matrix]"},examples:[{code:"(1 2 3 4 5 6) 3 mat rotrow",expected:[[[3,1,2],[6,4,5]]]},{code:"1 2 3 4 2 mat rotrow",expected:[[[2,1],[4,3]]]}]},isVector$2=e=>Array.isArray(e)&&!isMatrix(e)&&e.every(o=>typeof o=="number"),dot={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!isVector$2(i)||!isVector$2(o))throw new Error("dot product requires two vectors (lists of numbers).");if(i.length!==o.length)throw new Error("dot product requires vectors of the same length.");if(i.length===0){e.push(0);return}let l=0;for(let u=0;u<i.length;u++)l+=i[u]*o[u];e.push(l)},description:"Calculates the dot product of two vectors (lists of numbers).",effect:"[V1 V2] -> [N]"},examples:[{code:"(1 2 3) (4 5 6) dot",expected:[32]},{code:"(10 20) (5 2) dot",expected:[90]},{code:"(1 2) (3 4 5) dot",expectedError:"vectors of the same length"},{code:"1 (1 2) dot",expectedError:"requires two vectors"}]},is3DVector=e=>Array.isArray(e)&&!isMatrix(e)&&e.length===3&&e.every(o=>typeof o=="number"),cross={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!is3DVector(i)||!is3DVector(o))throw new Error("cross product requires two 3D vectors (lists of 3 numbers).");const l=[i[1]*o[2]-i[2]*o[1],i[2]*o[0]-i[0]*o[2],i[0]*o[1]-i[1]*o[0]];e.push(l)},description:"Calculates the cross product of two 3D vectors.",effect:"[V1 V2] -> [V3]"},examples:[{code:"(1 0 0) (0 1 0) cross",expected:[[0,0,1]]},{code:"(0 1 0) (1 0 0) cross",expected:[[0,0,-1]]},{code:"(1 2 3) (4 5 6) cross",expected:[[-3,6,-3]]},{code:"(1 2) (3 4 5) cross",expectedError:"requires two 3D vectors"}]},isVector$1=e=>Array.isArray(e)&&!isMatrix(e)&&e.every(o=>typeof o=="number"),isGLSLExpression$4=e=>(e==null?void 0:e.type)==="glsl_expression",numericMatrixToGLSL=e=>{if(!isMatrix(e))return"";const o=e.length;if(o===0)return"";const i=e[0].length;if(o!==i||o!==3&&o!==4)return"";const u=e[0].map((h,m)=>e.map(g=>g[m])).flat(),d=h=>{const m=h.toString();return Number.isInteger(h)&&!m.includes("e")&&!m.includes(".")?m+".0":m};return o===3?`mat3(${u.map(d).join(", ")})`:o===4?`mat4(${u.map(d).join(", ")})`:""},matmul={definition:{exec:function*(e){var C,V,U;const o=e.pop(),i=e.pop(),l=isGLSLExpression$4(i)&&(i.returnType==="mat3"||i.returnType==="mat4"),u=isGLSLExpression$4(o)&&(o.returnType==="mat3"||o.returnType==="mat4");if(l||u){const Y=l?`(${i.code})`:numericMatrixToGLSL(i),W=u?`(${o.code})`:numericMatrixToGLSL(o);if(!Y||!W)throw new Error("matmul: Could not generate GLSL for one of the operands.");const P=`(${Y} * ${W})`,F=l?i.returnType:u?o.returnType:"mat3";e.push({type:"glsl_expression",code:P,returnType:F});return}let d,h;const m=isVector$1(i),g=isVector$1(o),b=isMatrix(i),v=isMatrix(o);if(m&&g)throw new Error("matmul on two vectors is ambiguous. Use `dot` for dot product.");if(b)d=i;else if(m)d=[i];else throw new Error("matmul: first operand must be a matrix or a vector.");if(v)h=o;else if(g)h=o.map(Y=>[Y]);else throw new Error("matmul: second operand must be a matrix or a vector.");const w=d.length,D=((C=d[0])==null?void 0:C.length)||0,O=h.length,k=((V=h[0])==null?void 0:V.length)||0;if(D!==O)throw new Error(`Matrix multiplication dimension mismatch: A is ${w}x${D}, B is ${O}x${k}.`);if(D===0||w===0||k===0){e.push([]);return}const N=Array.from({length:w},()=>Array(k).fill(0));for(let Y=0;Y<w;Y++)for(let W=0;W<k;W++){let P=0;for(let F=0;F<D;F++)P+=d[Y][F]*h[F][W];N[Y][W]=P}N.length===1?e.push(N[0]):((U=N[0])==null?void 0:U.length)===1?e.push(N.map(Y=>Y[0])):e.push(N)},description:"Performs matrix multiplication. Can multiply matrix by matrix, vector by matrix (row vector), or matrix by vector (column vector). It also supports combining dynamic `glsl_expression` matrices for animated shaders. Alias: `@`.",effect:"[A B] -> [C]"},examples:[{code:`
# 1. Start with a Torus
0.8 0.2 vec2 torus

# 2. Create a dynamic rotation matrix around a tilted axis
(t 0.5 *) glsl  # angle animates
1 1 0 vec3      # tilted axis
matrot

# 3. Create a dynamic, non-uniform scaling matrix
(t sin 0.2 * 1 +) glsl  # sx: pulses between 0.8 and 1.2
(t cos 0.2 * 1 +) glsl  # sy: pulses out of phase with sx
1.0                       # sz: static
scalemat

# 4. Multiply the rotation and scaling matrices into ONE final matrix
# The order matters: R * S applies scaling first, then rotation.
@

# 5. Apply the combined transformation
transform

# 6. Apply an animated procedural material
(p 5 * t +) glsl cnoise material

# 7. Set up the scene with lighting and render
march
2 2 5 vec3 "white" 0.1 light
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a torus that simultaneously rotates and pulses in size, textured with animated noise."},{code:"((1 2)(3 4)) ((10 20)(30 40)) matmul",expected:[[[70,100],[150,220]]]},{code:"((1 2)(3 4)) ((10 20)(30 40)) @",expected:[[[70,100],[150,220]]]},{code:"(1 2) ((10 20)(30 40)) matmul",expected:[[70,100]]},{code:"((1 2)(3 4)) (10 30) matmul",expected:[[70,150]]},{code:"((1 2)(3 4)) ((1)(2)(3)) matmul",expectedError:"dimension mismatch"},{code:"(1 2) (3 4) matmul",expectedError:"ambiguous"}]},identity={definition:{exec:function*(e){const o=e.pop();if(!Number.isInteger(o)||o<0)throw new Error("identity operator expects a non-negative integer.");const i=[];for(let l=0;l<o;l++){const u=Array(o).fill(0);u[l]=1,i.push(u)}e.push(i)},description:"Creates an NxN identity matrix.",effect:"[N] -> [matrix]"},examples:[{code:"3 identity",expected:[[[1,0,0],[0,1,0],[0,0,1]]]},{code:"1 identity",expected:[[[1]]]},{code:"0 identity",expected:[[]]}]},rows={definition:{exec:function*(e){const o=e.pop();if(!isMatrix(o))throw new Error("rows operator expects a matrix.");e.push(...o)},description:"Spreads the rows of a matrix onto the stack as individual lists.",effect:"[matrix] -> [row1 row2 ...]"},examples:[{code:"((1 2)(3 4)) rows",expected:[[1,2],[3,4]]},{code:"3 identity rows",expected:[[1,0,0],[0,1,0],[0,0,1]]}]},cols={definition:{exec:function*(e){const o=e.pop();if(!isMatrix(o))throw new Error("cols operator expects a matrix.");if(o.length===0||o[0].length===0){for(let d=0;d<o.length;d++)e.push([]);return}const i=o.length,l=o[0].length,u=Array.from({length:l},()=>Array(i).fill(0));for(let d=0;d<i;d++)for(let h=0;h<l;h++)u[h][d]=o[d][h];e.push(...u)},description:"Spreads the columns of a matrix onto the stack as individual lists.",effect:"[matrix] -> [col1 col2 ...]"},examples:[{code:"((1 2)(3 4)) cols",expected:[[1,3],[2,4]]},{code:"3 identity cols",expected:[[1,0,0],[0,1,0],[0,0,1]]},{code:"(1 2 3 4 5 6) 3 mat cols",expected:[[1,4],[2,5],[3,6]]}]},matrows={definition:{exec:function*(e){const o=e.pop();if(!Number.isInteger(o)||o<0)throw new Error("matrows operator expects a non-negative integer for the row count.");if(e.length<o)throw e.push(o),new Error(`Stack underflow for matrows. Expected ${o} rows on the stack.`);if(o===0){e.push([]);return}const i=e.splice(e.length-o,o);if(!i.every(d=>Array.isArray(d)&&(!isMatrix(d)||d.length===0)))throw e.push(...i,o),new Error("matrows expects all row arguments to be lists.");const u=i[0].length;if(!i.every(d=>d.length===u))throw e.push(...i,o),new Error("All lists must have the same length to form a matrix with matrows.");e.push(i)},description:"Creates a matrix from N row vectors. Consumes an integer N, then consumes N lists from the stack to use as the rows of the new matrix.",effect:"[row1 row2 ... rowN N] -> [matrix]"},examples:[{code:"(1 2) (3 4) 2 matrows",expected:[[[1,2],[3,4]]]},{code:"(1) (2) (3) 3 matrows",expected:[[[1],[2],[3]]]},{code:"0 matrows",expected:[[]]}]},matcols={definition:{exec:function*(e){const o=e.pop();if(!Number.isInteger(o)||o<0)throw new Error("matcols operator expects a non-negative integer for the column count.");if(e.length<o)throw e.push(o),new Error(`Stack underflow for matcols. Expected ${o} columns on the stack.`);if(o===0){e.push([]);return}const i=e.splice(e.length-o,o);if(!i.every(m=>Array.isArray(m)&&(!isMatrix(m)||m.length===0)))throw e.push(...i,o),new Error("matcols expects all column arguments to be lists.");const u=i[0].length;if(!i.every(m=>m.length===u))throw e.push(...i,o),new Error("All lists must have the same length to form a matrix with matcols.");if(u===0){e.push([]);return}const d=u,h=Array.from({length:d},()=>Array(o).fill(0));for(let m=0;m<d;m++)for(let g=0;g<o;g++)h[m][g]=i[g][m];e.push(h)},description:"Creates a matrix from N column vectors. Consumes an integer N, then consumes N lists from the stack to use as the columns of the new matrix.",effect:"[col1 col2 ... colN N] -> [matrix]"},examples:[{code:"(1 3) (2 4) 2 matcols",expected:[[[1,2],[3,4]]]},{code:"(1 4 7) (2 5 8) (3 6 9) 3 matcols",expected:[[[1,2,3],[4,5,6],[7,8,9]]]},{code:"() () 2 matcols",expected:[[]]}]},isVector=(e,o)=>Array.isArray(e)&&!isMatrix(e)&&e.length===o&&e.every(i=>typeof i=="number"),numToGLSL$1=e=>{const o=e.toString();return Number.isInteger(e)&&!o.includes("e")&&!o.includes(".")?o+".0":o},matrot={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(typeof i!="number"&&(i==null?void 0:i.type)!=="glsl_expression")throw new Error("matrot expects a number or glsl_expression for the angle (in radians).");if(!isVector(o,3))throw new Error("matrot expects a vec3 for the axis of rotation.");const l=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]);if(l===0){e.push([[1,0,0],[0,1,0],[0,0,1]]);return}const u=o[0]/l,d=o[1]/l,h=o[2]/l;if(typeof i=="number"){const m=Math.cos(i),g=Math.sin(i),b=1-m,v=[[u*u*b+m,u*d*b-h*g,u*h*b+d*g],[d*u*b+h*g,d*d*b+m,d*h*b-u*g],[h*u*b-d*g,h*d*b+u*g,h*h*b+m]];e.push(v)}else{const m=i.code,b={type:"glsl_expression",code:`rotationMatrix(${`vec3(${numToGLSL$1(u)}, ${numToGLSL$1(d)}, ${numToGLSL$1(h)})`}, ${m})`,returnType:"mat3"};e.push(b)}},description:"Creates a 3x3 rotation matrix from an angle (in radians) and a 3D axis vector. The angle can be a number for a static matrix or a `glsl_expression` for a dynamic matrix used in shaders.",effect:"[F_angle|glsl_expr V_axis] -> [matrix]"},examples:[{code:"3.14159 0 1 0 vec3 matrot",assert:e=>{const o=e[0];return e.length===1&&isMatrix(o)&&Math.abs(o[0][0]- -1)<1e-4&&Math.abs(o[2][2]- -1)<1e-4},expectedDescription:"A 3x3 matrix representing a 180-degree rotation around the Y-axis."},{code:`1 1 1 vec3 box
(t) glsl 1 2 3 vec3 matrot
transform
march
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated, rotating sphere."}]},isGLSLExpression$3=e=>(e==null?void 0:e.type)==="glsl_expression",numToGLSL=e=>{const o=e.toString();return Number.isInteger(e)&&!o.includes("e")&&!o.includes(".")?o+".0":o},scalemat={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();if(isGLSLExpression$3(l)||isGLSLExpression$3(i)||isGLSLExpression$3(o)){const d=isGLSLExpression$3(l)?l.code:numToGLSL(l),h=isGLSLExpression$3(i)?i.code:numToGLSL(i),m=isGLSLExpression$3(o)?o.code:numToGLSL(o),g={type:"glsl_expression",code:`mat3(${d}, 0.0, 0.0, 0.0, ${h}, 0.0, 0.0, 0.0, ${m})`,returnType:"mat3"};e.push(g)}else{if(typeof l!="number"||typeof i!="number"||typeof o!="number")throw new Error("scalemat expects three numbers or glsl_expressions for x, y, z scales.");const d=[[l,0,0],[0,i,0],[0,0,o]];e.push(d)}},description:"Creates a 3x3 scaling matrix from x, y, and z scale factors. Factors can be numbers for a static matrix or `glsl_expression`s for a dynamic matrix used in shaders.",effect:"[sx sy sz] -> [matrix]"},examples:[{code:"2 1 1 scalemat",expected:[[[2,0,0],[0,1,0],[0,0,1]]]},{code:`
0.5 sphere
(t sin 0.5 * 1 +) glsl # dynamic x scale
1.0                     # static y scale
1.0                     # static z scale
scalemat
transform
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a sphere pulsing in size along the x-axis."}]},matrix={name:"Matrix Operations",description:"Operators for creating and manipulating matrices.",definitions:{mat,cmat,mat2,mat3,mat4,transpose,rotmat,rotcol,rotrow,dot,cross,matmul,identity,rows,cols,matrows,matcols,matrot,scalemat}},greaterThanOrEqual={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(i>=o)},description:"Tests if A is greater than or equal to B.",effect:"[A B] -> [bool]"},examples:[{code:"10 10 >=",expected:[!0]},{code:"10 5 >=",expected:[!0]},{code:"5 10 >=",expected:[!1]}]},greaterThan={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(i>o)},description:"Tests if A is greater than B.",effect:"[A B] -> [bool]"},examples:[{code:"10 5 >",expected:[!0]},{code:"10 10 >",expected:[!1]},{code:"5 10 >",expected:[!1]}]},lessThanOrEqual={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(i<=o)},description:"Tests if A is less than or equal to B.",effect:"[A B] -> [bool]"},examples:[{code:"5 10 <=",expected:[!0]},{code:"10 10 <=",expected:[!0]},{code:"10 5 <=",expected:[!1]}]},lessThan={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(i<o)},description:"Tests if A is less than B.",effect:"[A B] -> [bool]"},examples:[{code:"5 10 <",expected:[!0]},{code:"10 10 <",expected:[!1]},{code:"10 5 <",expected:[!1]}]},notEqual={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(i!=o)},description:"Tests for inequality.",effect:"[A B] -> [bool]"},examples:[{code:"5 10 !=",expected:[!0]},{code:"10 10 !=",expected:[!1]},{code:'"a" "b" !=',expected:[!0]}]},equal={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(deepEqual(i,o))},description:"Tests for deep equality.",effect:"[A B] -> [bool]"},examples:[{code:"10 10 ==",expected:[!0]},{code:"10 5 ==",expected:[!1]},{code:'"a" "a" ==',expected:[!0]},{code:"(1 (2)) (1 (2)) ==",expected:[!0]},{code:"(1 (2)) (1 (3)) ==",expected:[!1]}]},nullPredicate={definition:{exec:function*(e){const o=e.pop();e.push(o===0||Array.isArray(o)&&o.length===0)},description:"Tests if a number is 0 or a list is empty.",effect:"[A] -> [bool]"},examples:[{code:"() null?",expected:[!0]},{code:"0 null?",expected:[!0]},{code:"(1) null?",expected:[!1]},{code:"1 null?",expected:[!1]}]},small={definition:{exec:function*(e){const o=e.pop();e.push(o===0||o===1||Array.isArray(o)&&o.length<=1)},description:"Tests if an aggregate has 0 or 1 members.",effect:"[A] -> [bool]"},examples:[{code:"(42) small",expected:[!0]},{code:"1 small",expected:[!0]},{code:"0 small",expected:[!0]},{code:"() small",expected:[!0]},{code:"(1 2) small",expected:[!1]},{code:"2 small",expected:[!1]}]},has={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(i.includes(o))},description:"Tests if a list contains an element. Postfix form.",effect:"[A X] -> [bool]"},examples:[{code:"(1 2 3) 2 has",expected:[!0]},{code:"(1 2 3) 4 has",expected:[!1]}]},inOp={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(o.includes(i))},description:"Tests if a list contains an element. Infix form.",effect:"[X A] -> [bool]"},examples:[{code:"2 (1 2 3) in",expected:[!0]},{code:"4 (1 2 3) in",expected:[!1]}]},integerPredicate={definition:{exec:function*(e){e.push(Number.isInteger(e.pop()))},description:"Tests if the top element is an integer.",effect:"[A] -> [bool]"},examples:[{code:"10 integer?",expected:[!0]},{code:"-5 integer?",expected:[!0]},{code:"10.5 integer?",expected:[!1]},{code:'"10" integer?',expected:[!1]}]},charPredicate={definition:{exec:function*(e){const o=e.pop();e.push(typeof o=="string"&&o.length===1)},description:"Tests if the top element is a character (string of length 1).",effect:"[A] -> [bool]"},examples:[{code:'"a" char?',expected:[!0]},{code:'"ab" char?',expected:[!1]},{code:"97 chr char?",expected:[!0]}]},logicalPredicate={definition:{exec:function*(e){const o=e.pop();e.push(typeof o=="boolean")},description:"Tests if the top element is a boolean (`true` or `false`).",effect:"[A] -> [bool]"},examples:[{code:"true logical?",expected:[!0]},{code:"false logical?",expected:[!0]},{code:"1 logical?",expected:[!1]},{code:'"true" logical?',expected:[!1]},{code:"[] logical?",expected:[!1]}]},stringPredicate={definition:{exec:function*(e){const o=e.pop();e.push(typeof o=="string")},description:"Tests if the top element is a string.",effect:"[A] -> [bool]"},examples:[{code:'"hi" string?',expected:[!0]},{code:'"" string?',expected:[!0]},{code:"1 string?",expected:[!1]}]},listPredicate={definition:{exec:function*(e){e.push(Array.isArray(e.pop()))},description:"Tests if the top element is a list.",effect:"[A] -> [bool]"},examples:[{code:"(1 2) list?",expected:[!0]},{code:"() list?",expected:[!0]},{code:"1 list?",expected:[!1]}]},setPredicate={definition:{exec:function*(e){const o=e.pop();if(!Array.isArray(o)){e.push(!1);return}e.push(new Set(o).size===o.length)},description:"Tests if the top element is a list with only unique values.",effect:"[A] -> [bool]"},examples:[{code:"(1 2 3) set?",expected:[!0]},{code:"(1 2 2 3) set?",expected:[!1]},{code:"() set?",expected:[!0]},{code:'"hello" set?',expected:[!1]},{code:"(1 2 3) set set?",expected:[!0]}]},predicates={name:"Predicates",description:"Operators that test values and return a boolean.",definitions:{">=":greaterThanOrEqual,">":greaterThan,"<=":lessThanOrEqual,"<":lessThan,"!=":notEqual,"==":equal,"null?":nullPredicate,small,has,in:inOp,"integer?":integerPredicate,"char?":charPredicate,"logical?":logicalPredicate,"string?":stringPredicate,"list?":listPredicate,"set?":setPredicate}},linrec={definition:{exec:function*(e,o={},i){const[l,u,d,h]=[e.pop(),e.pop(),e.pop(),e.pop()],m=function*(b,v){const w=[b];if(yield*i([...h],w,v),w.pop()){const D=[b];return yield*i([...d],D,v),D}else{const D=[b];yield*i([...u],D,v);const O=D.pop(),k=[...D],N=yield*m(O,v),C=[...k,...N];return yield*i([...l],C,v),v.isDebug&&v.onStep([...e,...C]),C}},g=yield*m(e.pop(),o);e.push(...g)},description:"Linear recursion combinator.",effect:"..."},examples:[{code:"((null?) (succ) (dup pred) (*) linrec) fac => 5 fac",expected:[120]},{code:"5 ((null?) (succ) (dup pred) (*) linrec) i",expected:[120]}]},binrec={definition:{exec:function*(e,o={},i){const[l,u,d,h]=[e.pop(),e.pop(),e.pop(),e.pop()],m=function*(b,v){const w=[b];if(yield*i([...h],w,v),w.pop()){const D=[b];return yield*i([...d],D,v),D}else{const D=[b];yield*i([...u],D,v);const O=D.pop(),k=D.pop(),N=yield*m(k,v),C=yield*m(O,v),V=[...D,...N,...C];return yield*i([...l],V,v),v.isDebug&&v.onStep([...e,...V]),V}},g=yield*m(e.pop(),o);e.push(...g)},description:"Binary recursion combinator, useful for divide-and-conquer.",effect:"..."},examples:[{code:["( (2 <) () (dup pred swap pred pred) (+) binrec ) fib =>","8 fib"],expected:[21]}]},primrec={definition:{exec:function*(e,o={},i){const[l,u]=[e.pop(),e.pop()],d=e.pop(),h=function*(m,g){if(typeof m=="number"&&m<=0||Array.isArray(m)&&m.length===0)yield*i(u,e,g);else if(typeof m=="number")yield*h(m-1,g),e.push(m),yield*i(l,e,g);else{const[b,...v]=m;yield*h(v,g),e.push(b),yield*i(l,e,g)}};e.length=0,yield*h(d,o)},description:"Primitive recursion. Executes [I] for 0 or empty list. For N > 0, executes N-1 primrec, then combines with N via [C]. For lists, recurses on rest, then combines with first via [C].",effect:"[X [I] [C]] -> [R]"},examples:[{code:"5 (1) (*) primrec",expected:[120]},{code:"(1 2 3 4) 0 (+) primrec",expected:[10]}]},tailrec={definition:{exec:function*(e,o={},i){const[l,u,d]=[e.pop(),e.pop(),e.pop()],h=function*(m){const g=[...e];yield*i(d,g,m),g.pop()?yield*i(u,e,m):(yield*i(l,e,m),yield*h(m))};yield*h(o)},description:"Tail recursion. Executes [T]est. If true, executes [Th]en. Else executes [R]ecurse and loops. `[... [T] [Th] [R]] tailrec`",effect:"[... [T] [Th] [R]] -> [...]"},examples:[{code:["# Factorial (tail-recursive)","# Stack state is [N Acc]","( (swap popd dup 1 <=) (popd) (dupd swapd * swap pred swap) tailrec ) fac =>","5 1 fac"],expected:[120]},{code:["# Find the last element of a list","( (rest null?) (first) (rest) tailrec ) last =>","(1 2 3 4 5) last"],expected:[5]}]},genrec={definition:{exec:function*(e,o={},i){const[l,u,d,h]=[e.pop(),e.pop(),e.pop(),e.pop()];yield*function*(g){const b=[...e];if(yield*i(h,b,g),b.pop())yield*i(d,e,g);else{yield*i(u,e,g);const v=[h,d,u,l,"genrec"];e.push(v),yield*i(l,e,g)}}(o)},description:"General recursion. `[B] [T] [R1] [R2] genrec`. Executes B. If true, executes T. Else, executes R1, pushes the recursive call, then executes R2.",effect:"[... [B] [T] [R1] [R2]] -> [...]"},examples:[{code:"5 ( (dup 0 <=) (pop 1) (dup pred) (i *) genrec ) i",expected:[120]},{code:["( (dup 0 ==) (pop 1) (dup pred) (i *) genrec ) fac =>","5 fac"],expected:[120]}]},condlinrec={definition:{exec:function*(e,o={},i){const l=e.pop(),u=function*(d){for(const h of l){if(!Array.isArray(h)||h.length<2)continue;const m=h[0],g=[...e];if(yield*i(m,g,d),g.pop()){if(h.length===2){const b=h[1];yield*i(b,e,d)}else{const[b,v,w]=h;yield*i(v,e,d),yield*u(d),yield*i(w,e,d)}return}}};yield*u(o)},description:"Conditional linear recursion. Takes a list of cases `[[B T] or [B R1 R2]...]`. Finds the first true B. If a `[T]` branch, executes T. If a `[R1 R2]` branch, executes R1, recurses, then executes R2.",effect:"[... [Cases]] -> [...]"},examples:[{code:`# Factorial with condlinrec
5 ( 
    ( (dup 0 ==) (pop 1) )
    ( (true) (dup pred) (*) )
) condlinrec`,expected:[120]},{code:`1 ( 
                ( (dup 0 ==) (pop 1) )
                ( (true) (dup pred) (*) )
            ) condlinrec`,expected:[1]}]},recursion={name:"Recursive Combinators",description:"Specialized combinators for performing various forms of recursion, from simple linear patterns to the most general cases.",definitions:{linrec,binrec,primrec,tailrec,genrec,condlinrec}},pop={definition:{exec:function*(e){e.pop()},description:"Removes the top element from the stack.",effect:"[X] -> []"},examples:[{code:"1 2 3 pop",expected:[1,2]},{code:"() 1 pop",expected:[[]]}]},put={definition:{exec:function*(e){},description:"No-op. Sometimes used for clarity to indicate a value is intentionally left on the stack.",effect:"[A] -> [A]"},examples:[{code:"42 put",expected:[42]},{code:"1 2 3 put",expected:[1,2,3]}]},dup={definition:{exec:function*(e){e.push(e[e.length-1])},description:"Duplicates the top element of the stack.",effect:"[X] -> [X X]"},examples:[{code:"10 dup",expected:[10,10]},{code:"(1 2) dup",expected:[[1,2],[1,2]]}]},swap={definition:{exec:function*(e){e.push(e.pop(),e.pop())},description:"Swaps the top two elements of the stack.",effect:"[X Y] -> [Y X]"},examples:[{code:"10 20 swap",expected:[20,10]},{code:"true (1) swap",expected:[[1],!0]}]},id={definition:{exec:function*(e){},description:"Identity function. Does nothing.",effect:"[X] -> [X]"},examples:[{code:"42 id",expected:[42]},{code:"(1 2 3) id",expected:[[1,2,3]]}]},rollup={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();e.push(o,l,i)},description:"Rolls the top three stack items up.",effect:"[X Y Z] -> [Z X Y]"},examples:[{code:"1 2 3 rollup",expected:[3,1,2]},{code:"10 20 30 rollup",expected:[30,10,20]}]},rolldown={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();e.push(i,o,l)},description:"Rolls the top three stack items down.",effect:"[X Y Z] -> [Y Z X]"},examples:[{code:"1 2 3 rolldown",expected:[2,3,1]},{code:'"c" "b" "a" rolldown',expected:["b","a","c"]}]},rotate={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();e.push(o,i,l)},description:"Rotates the top three stack items.",effect:"[X Y Z] -> [Z Y X]"},examples:[{code:"1 2 3 rotate",expected:[3,2,1]},{code:'"a" "b" "c" rotate',expected:["c","b","a"]}]},popd={definition:{exec:function*(e){const o=e.pop();e.pop(),e.push(o)},description:"Like pop, but removes the second element from the stack.",effect:"[X Y] -> [Y]"},examples:[{code:"1 2 3 popd",expected:[1,3]},{code:'"a" "b" "c" popd',expected:["a","c"]}]},dupd={definition:{exec:function*(e){const o=e.pop();e.push(e[e.length-1],o)},description:"Like dup, but duplicates the second element on the stack.",effect:"[X Y] -> [X X Y]"},examples:[{code:"1 2 3 dupd",expected:[1,2,2,3]},{code:'"a" "b" dupd',expected:["a","a","b"]}]},swapd={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();e.push(i,l,o)},description:"Like swap, but swaps the second and third elements.",effect:"[X Y Z] -> [Y X Z]"},examples:[{code:"10 20 30 swapd",expected:[20,10,30]},{code:"1 (2) 3 swapd",expected:[[2],1,3]}]},clear={definition:{exec:function*(e){e.length=0},description:"Removes all items from the stack, leaving it empty.",effect:"[...] -> []"},examples:[{code:"1 2 3 clear",expected:[]},{code:"[] clear",expected:[]}]},over={definition:{exec:function*(e){if(e.length<2)throw new Error("Stack underflow for operator: over");e.push(e[e.length-2])},description:"Copies the second element from the top of the stack to the top.",effect:"[X Y] -> [X Y X]"},examples:[{code:"10 20 over",expected:[10,20,10]},{code:"1 2 3 over",expected:[1,2,3,2]},{code:"1 over",expectedError:"Stack underflow"}]},tuck={definition:{exec:function*(e){if(e.length<2)throw new Error("Stack underflow for operator: tuck");const o=e.pop(),i=e.pop();e.push(o,i,o)},description:"Copies the top element and inserts it below the second element.",effect:"[X Y] -> [Y X Y]"},examples:[{code:"10 20 tuck",expected:[20,10,20]},{code:"1 2 3 tuck",expected:[1,3,2,3]},{code:"1 tuck",expectedError:"Stack underflow"}]},stack={definitions:{pop,put,dup,swap,over,tuck,id,rollup,rolldown,rotate,popd,dupd,swapd,clear}},ord={definition:{exec:function*(e){e.push(e.pop().charCodeAt(0))},description:"Pushes the character code of the first character of a string.",effect:"[S] -> [I]"},examples:[{code:'"A" ord',expected:[65]},{code:'"a" ord',expected:[97]}]},chr={definition:{exec:function*(e){e.push(String.fromCharCode(e.pop()))},description:"Pushes the string representation of a character code.",effect:"[I] -> [S]"},examples:[{code:"65 chr",expected:["A"]},{code:"97 chr",expected:["a"]}]},set={definition:{exec:function*(e){const o=e.pop();if(!Array.isArray(o))throw new Error("set expects a list.");e.push([...new Set(o)])},description:"Converts a list to a list with unique values.",effect:"[L] -> [L']"},examples:[{code:"(1 2 2 3) set",expected:[[1,2,3]]}]},types={definitions:{ord,chr,set}},wrap={definition:{exec:function*(e){e.push([e.pop()])},description:"Wraps the top element in a new list.",effect:"[X] -> [[X]]"},examples:[{code:"10 wrap",expected:[[10]]},{code:"(1) wrap",expected:[[[1]]]}]},second={definition:{exec:function*(e){const o=e.pop();e.push(o.slice(1)[0]),e.push(o)},description:"Pushes the second element of a list without consuming the list.",effect:"[L] -> [E L]"},examples:[{code:"(10 20 30) second",expected:[20,[10,20,30]]},{code:'"abc" second',expected:["b","abc"]}]},third={definition:{exec:function*(e){const o=e.pop();e.push(o.slice(2)[0]),e.push(o)},description:"Pushes the third element of a list without consuming the list.",effect:"[L] -> [E L]"},examples:[{code:"(10 20 30) third",expected:[30,[10,20,30]]},{code:'"abc" third',expected:["c","abc"]}]},shunt={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!Array.isArray(i)||!Array.isArray(o))throw new Error("shunt expects two lists on the stack.");const l=[...o].reverse();i.unshift(...l),e.push(i)},description:"Moves all elements from list L2, in reverse order, to the front of list L1.",effect:"[L1 L2] -> [L3]"},examples:[{code:"(1 2 3) (4 5 6) shunt",expected:[[6,5,4,1,2,3]]},{code:"() (1 2) shunt",expected:[[2,1]]}]},reverse={definition:{exec:function*(e){const o=e.pop();if(Array.isArray(o))e.push(o.reverse());else if(typeof o=="string")e.push(o.split("").reverse().join(""));else throw new Error("reverse expects a list or a string.")},description:"Reverses a list or string.",effect:"[S] -> [S']"},examples:[{code:"(1 2 3 4) reverse",expected:[[4,3,2,1]]},{code:'("h" "e" "l" "l" "o") reverse',expected:[["o","l","l","e","h"]]},{code:'"hello" reverse',expected:["olleh"]}]},dip2={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop(),d=e.pop();yield*i(l,e,o),e.push(d,u)},description:"Saves two stack items, executes a program, then restores them.",effect:"[X Y [P]] -> [... X Y]"},examples:[{code:"1 2 (10 20 +) dip2",expected:[30,1,2]},{code:"1 2 () dip2",expected:[1,2]}]},dip3={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop(),d=e.pop(),h=e.pop();yield*i(l,e,o),e.push(h,d,u)},description:"Saves three stack items, executes a program, then restores them.",effect:"[X Y Z [P]] -> [... X Y Z]"},examples:[{code:"1 2 3 (10 20 +) dip3",expected:[30,1,2,3]},{code:"10 20 1 2 3 (+) dip3",expected:[30,1,2,3]}]},enjoin={definition:{exec:function*(e){if(e.length<1){e.push("");return}const o=String(e.pop()),i=e.join(o);e.length=0,e.push(i)},description:"Joins all elements on the stack (except the separator at the top) into a single string, separated by the given separator.",effect:"[A B C ... S] -> [S']"},examples:[{code:'1 2 3 "-" enjoin',expected:["1-2-3"]},{code:'"hello" "world" " " enjoin',expected:["hello world"]},{code:'1 2 3 "" enjoin',expected:["123"]},{code:'"," enjoin',expected:[""]},{code:"enjoin",assert:e=>e.length===1&&e[0]==="",expectedDescription:"Empty string for empty stack"}]},utils={name:"Utility Operators",description:"General-purpose helper operators.",definitions:{wrap,second,third,shunt,reverse,dip2,dip3,enjoin}},appendTo={definition:{exec:function*(e,o,i,l){const u=e.pop();let d,h;if(typeof u=="symbol"){const b=Symbol.keyFor(u);if(!b)throw new Error("appendTo: assignment to a non-global symbol is not supported.");d=`:${b}`,h=`:${b}`}else if(typeof u=="string"||typeof u=="number")d=String(u),h=String(u);else throw new Error(`appendTo: target must be a name, symbol, or integer, but got: ${JSON.stringify(u)}`);const m=e.pop(),g=l[d];if(!g)l[d]={body:m,description:"User-defined variable.",example:""};else if("body"in g)Array.isArray(g.body)?g.body.push(m):g.body=[g.body,m];else throw new Error(`Cannot append to built-in function: '${h}'.`)},description:"Pops a value and a name, then appends the value to the list variable associated with the name. If the variable exists but is not a list, it is automatically converted to a list. Creates the variable if it does not exist. Alias: `<-`.",effect:"[... V N] -> [...]"},examples:[{code:["() mylist =","10 mylist appendTo","20 mylist <-","mylist"],expected:[[10,20]]},{code:["10 newlog <-","20 newlog <-","newlog"],expected:[[10,20]]},{code:["42 :mynum <-",":mynum"],expected:[42]},{code:["1 foo =","2 foo <-","foo"],expected:[[1,2]]}]},ary={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();if(typeof l!="number"||!Number.isInteger(l)||l<0)throw new Error("ary expects an integer count on top of the stack.");if(e.length<l)throw new Error(`Stack underflow for ary. Expected ${l} items, but only ${e.length} available.`);const h=e.splice(e.length-l,l);yield*i(u,h,o),e.push(...h)},description:"Like `map`, but applies program P to N values taken from the stack as a single unit. `... X1..XN [P] N -> ... R...`",effect:"[... X1..XN [P] N] -> [... R...]"},examples:[{code:"20 30 (+) 2 ary",expected:[50]},{code:"10 20 30 (+ *) 3 ary",expected:[500]},{code:"10 20 30 40 (+ *) 3 ary",expected:[10,1400]},{code:"1 2 () 0 ary",expected:[1,2]},{code:"10 20 30 40 (+ *) 4 ary",expected:[10,1400]}]},construct={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();if(!Array.isArray(l)||!Array.isArray(u))throw new Error("construct expects two lists on top of the stack.");const d=[...e],h=[...e];yield*i(u,h,o);const m=[];for(const g of l){const b=[...d];yield*i(g,b,o),b.length>0&&m.push(b[b.length-1])}e.push(...m)},description:"Saves the stack, executes a setup program [P], then executes each program in a list of constructor programs [[P1] [P2]..] on the saved stack, collecting the single result from each.",effect:"[S [P] [[P1]..]] -> [S R1 R2 ..]"},examples:[{code:"10 20 (pop) ((dup) (succ)) construct",expected:[10,20,20,21]}]},infra={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();if(!Array.isArray(u))throw new Error("infra expects a list to be used as the stack.");const d=[...u].reverse();yield*i(l,d,o),e.push([...d].reverse())},description:"Using list L1 as a temporary stack, executes program P and returns a new list L2. The first element of L1 is the top of the stack.",effect:"[L1 [P]] -> [L2]"},examples:[{code:"(10 20) (dup *) infra",expected:[[100,20]]}]},nullary={definition:{exec:function*(e,o,i){const l=e.pop(),u=[...e],d=[...e];yield*i(l,d,o);let h=d;if(d.length>=u.length){let m=!0;for(let g=0;g<u.length;g++)if(!deepEqual(d[g],u[g])){m=!1;break}m&&(h=d.slice(u.length))}e.push(...h)},description:"Executes a program P on a copy of the current stack. If P only adds items, only the new items are pushed. If P modifies the original stack items, the entire resulting stack from P is pushed. In either case, the original stack remains untouched by the operation.",effect:"[... [P]] -> [... R]"},examples:[{code:"10 20 (1 1 +) nullary",expected:[10,20,2]},{code:"10 20 (list dup +) nullary",expected:[10,20,20,30,30,40]}]},popstackto={definition:{exec:function*(e,o,i,l){const u=e.pop();let d;if(typeof u=="symbol"){const m=Symbol.keyFor(u);if(!m)throw new Error("popstackto: assignment to a non-global symbol is not supported.");d=`:${m}`}else if(typeof u=="string"||typeof u=="number")d=String(u);else throw new Error(`Assignment target must be a name, symbol, or integer, but got: ${JSON.stringify(u)}`);const h=[...e];e.length=0,l[d]={body:h,description:"User-defined function/variable.",example:""}},description:"Pops a name, assigns the entire rest of the stack as a list to that name, and then clears the stack. `... N popstackto`",effect:"[... N] -> []"},examples:[{code:["1 2 3 4 allmine popstackto","allmine"],expected:[[1,2,3,4]]},{code:["1 2 :allmine popstackto",":allmine"],expected:[[1,2]]},{code:["1 2 3 1 popstackto","1"],expected:[[1,2,3]]}]},popto={definition:{exec:function*(e,o,i,l){const u=e.pop();let d;if(typeof u=="symbol"){const m=Symbol.keyFor(u);if(!m)throw new Error("popto: assignment to a non-global symbol is not supported.");d=`:${m}`}else if(typeof u=="string"||typeof u=="number")d=String(u);else throw new Error(`Assignment target must be a name, symbol, or integer, but got: ${JSON.stringify(u)}`);const h=e.pop();l[d]={body:h,description:"User-defined function/variable.",example:""}},description:"Pops a value and a name, then assigns the value to the name in the dictionary. This is used to define data variables. Alias: `=`. `... V N popto`",effect:"[... V N] -> [...]"},examples:[{replCode:["(1 2 3 4) mylist =","mylist"],assert:e=>e.length===1&&Array.isArray(e[0])&&e[0].length===4,expected:[[1,2,3,4]]},{replCode:["1 2 + my_three =","my_three"],expected:[3]},{code:["42 :mynum =",":mynum"],expected:[42]},{code:["100 1 =","1"],expected:[100]},{replCode:["(1 2 +) my_func =","my_func"],expected:[[1,2,"+"]]}]},unary={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();if(typeof l!="number"||!Number.isInteger(l)||l<0)throw new Error("unary expects an integer count on top of the stack.");if(e.length<l)throw new Error(`Stack underflow for unary. Expected ${l} items, but only ${e.length} available.`);const d=e.splice(e.length-l,l),h=[];for(const m of d){const g=[m];yield*i(u,g,o),h.push(...g)}e.push(...h)},description:"Executes the same program P on N separate values from the stack, returning N results. `... X1..XN [P] N -> ... R1..RN`",effect:"[... X1..XN [P] N] -> [... R1..RN]"},examples:[{code:"10 20 (succ) 2 unary",expected:[11,21]},{code:"10 20 30 (succ) 3 unary",expected:[11,21,31]},{code:"10 20 30 40 (succ) 4 unary",expected:[11,21,31,41]},{code:"1 0 (not) 2 unary",expected:[!1,!0]},{code:"1 2 3 () 0 unary",expected:[1,2,3]}]},unstack={definition:{exec:function*(e){const o=e.pop();if(!Array.isArray(o))throw new Error("unstack expects a list.");e.length=0,e.push(...[...o].reverse())},description:"The list becomes the new stack. The first element of the list is the top of the new stack.",effect:"[... [L]] -> [..]"},examples:[{code:"1 2 (10 20 30) unstack",expected:[30,20,10]}]},x={definition:{exec:function*(e,o,i){if(e.length<1)throw new Error("x expects a quotation on the stack.");const l=e[e.length-1];if(!Array.isArray(l))throw new Error("x expects a quotation on top of the stack.");const u=[...e];e.pop(),yield*i(l,e,o);const d=[...e];e.length=0,e.push(...u),e.push(...d)},description:"Executes the quotation on top of the stack without popping it. The quotation is applied to the stack below it, and the results are pushed on top.",effect:"[X [P]] -> [X [P] R]"},examples:[{code:"10 (1 +) x",expected:[10,[1,"+"],11]}]},quote={definition:{exec:function*(e,o,i,l){const u=e.pop();let d;if(typeof u=="symbol"){const b=Symbol.keyFor(u);if(!b)throw new Error("=>: assignment to a non-global symbol is not supported.");d=`:${b}`}else if(typeof u=="string"||typeof u=="number")d=String(u);else throw new Error(`Assignment target must be a name, symbol, or integer, but got: ${JSON.stringify(u)}`);const h=e.pop();if((h==null?void 0:h.type)==="live-loop-def"){const b=[[h],"iterate"];l[d]={body:b,description:"User-defined live loop.",example:""};return}if(Array.isArray(h)&&h.length>0&&h[h.length-1]==="live"&&h.length>=2){const v=h[0],w=h[1];if(Array.isArray(v)&&typeof w=="number"){const O=[[{type:"live-loop-def",quotation:v,beatValue:w,sourceCode:h}],"iterate"];l[d]={body:O,description:"User-defined live loop.",example:""};return}}const g=[Array.isArray(h)?h:[h],"iterate"];l[d]={body:g,description:"User-defined function.",example:""}},description:"Defines a new executable word from a quotation. `P N =>` is shorthand for `((P) iterate) N =`.",effect:"[... P N] -> [...]"},examples:[{replCode:["(1 1 +) foo =>","foo"],expected:[2]},{replCode:["10 bar =>","bar"],expected:[10]},{replCode:["(1 1) baz =>","baz"],expected:[1,1]},{replCode:["(1 1) data =","data i"],expected:[1,1]},{replCode:["(0 (succ) yield) counter =>","counter counter counter"],expected:[1,2,3]}]},advancedStack={definitions:{appendTo,ary,construct,infra,nullary,popstackto,popto,unary,unstack,x,quote}},swons={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!Array.isArray(i))throw new Error("swons expects a list");e.push([o,...i])},description:"Constructs a new list by prepending an element to a list. Expects list, then element on the stack. Equivalent to `swap cons`.",effect:"[L E] -> [L']"},examples:[{code:"(2 3 4) 1 swons",expected:[[1,2,3,4]]},{code:"() 1 swons",expected:[[1]]}]},enconcat={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();if(!Array.isArray(l)||!Array.isArray(i))throw new Error("enconcat expects two lists");e.push([...l,o,...i])},description:"Concatenates two sequences with an element inserted between them. `S T X -> U`",effect:"[L1 L2 E] -> [L3]"},examples:[{code:"(1 2) (3 4) 0 enconcat",expected:[[1,2,0,3,4]]},{code:'("a") ("b") "-" enconcat',expected:[["a","-","b"]]}]},unswons={definition:{exec:function*(e){const o=e.pop();if(!Array.isArray(o))throw new Error("unswons expects a list.");const[i,...l]=o;e.push(l,i)},description:"The reverse of `uncons`. Deconstructs a list, pushing the rest of the list and then its first element.",effect:"[L] -> [R E]"},examples:[{code:"(10 20 30) unswons",expected:[[20,30],10]},{code:"(1) unswons",expected:[[],1]}]},leaf={definition:{exec:function*(e){const o=e.pop();e.push(!Array.isArray(o))},description:"Tests whether a value is a leaf (i.e., not a list).",effect:"[A] -> [bool]"},examples:[{code:"42 leaf",expected:[!0]},{code:'"hello" leaf',expected:[!0]},{code:"() leaf",expected:[!1]},{code:"(1 2) leaf",expected:[!1]}]},fold={definition:{exec:function*(e,o,i){const l=e.pop();let u=e.pop();const d=e.pop();if(!Array.isArray(d))throw new Error("fold expects a list.");for(const h of d){const m=[u,h];yield*i(l,m,o),u=m.pop()}e.push(u)},description:"Starting with an initial value, sequentially applies a program to each member of a list to produce a final value. `A V0 [P] -> V`",effect:"[L V [P]] -> [R]"},examples:[{code:"(1 2 3 4) 0 (+) fold",expected:[10]},{code:"(2 3 4) 1 (*) fold",expected:[24]},{code:"() 100 (+) fold",expected:[100]}]},split={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();if(!Array.isArray(u))throw new Error("split expects a list.");const d=[],h=[];for(const m of u){const g=[m];yield*i(l,g,o),g.pop()?d.push(m):h.push(m)}e.push(d,h)},description:"Uses a predicate program to split a list into two lists: one for which the predicate was true, and one for which it was false. `A [B] -> A1 A2`",effect:"[L [P]] -> [L_true L_false]"},examples:[{code:"(1 2 3 4 5) (2 % 0 ==) split",expected:[[2,4],[1,3,5]]},{code:"(1 2 3) (10 >) split",expected:[[],[1,2,3]]}]},some={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();if(!Array.isArray(u))throw new Error("some expects a list.");for(const d of u){const h=[d];if(yield*i(l,h,o),h.pop()){e.push(!0);return}}e.push(!1)},description:"Applies a predicate to each member of a list, returning true if the predicate returns true for any member.",effect:"[L [P]] -> [bool]"},examples:[{code:"(1 2 3 4) (3 >) some",expected:[!0]},{code:"(1 2 3 4) (5 >) some",expected:[!1]},{code:"() (true) some",expected:[!1]}]},all={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();if(!Array.isArray(u))throw new Error("all expects a list.");for(const d of u){const h=[d];if(yield*i(l,h,o),!h.pop()){e.push(!1);return}}e.push(!0)},description:"Applies a predicate to each member of a list, returning true only if the predicate returns true for all members.",effect:"[L [P]] -> [bool]"},examples:[{code:"(2 4 6) (2 % 0 ==) all",expected:[!0]},{code:"(2 4 7) (2 % 0 ==) all",expected:[!1]},{code:"() (false) all",expected:[!0]}]},generatePowerlist=e=>{const o=e;if(o.length===0)return typeof e=="string"?[""]:[[]];const i=o[0],l=o.slice(1),u=generatePowerlist(l);return[...u.map(h=>typeof e=="string"?i+h:[i,...h]),...u]},powerlist={definition:{exec:function*(e){const o=e.pop();if(Array.isArray(o)||typeof o=="string")e.push(generatePowerlist(o));else throw new Error("powerlist expects a list or string.")},description:"For an aggregate of size N, produces a list of all 2^N subaggregates (sublists or subsequences of characters).",effect:"[A] -> [[A1, A2, ...]]"},examples:[{code:"(1 2) powerlist",assert:e=>{const o=e[0],i=[[1,2],[1],[2],[]];return o.length===i.length&&i.every(l=>o.some(u=>deepEqual(l,u)))},expectedDescription:"A list containing [[1,2], [1], [2], []] (order may vary)"},{code:'"ab" powerlist',assert:e=>{const o=e[0].sort(),i=["ab","a","b",""].sort();return deepEqual(o,i)},expectedDescription:'A list containing ["ab", "a", "b", ""] (order may vary)'},{code:"() powerlist",expected:[[[]]]},{code:'"" powerlist',expected:[[""]]},{code:"(1 1) powerlist",assert:e=>{const o=e[0],i=[[1,1],[1],[1],[]];return o.length===i.length&&i.every(l=>o.some(u=>deepEqual(l,u)))},expectedDescription:"A list containing [[1,1], [1], [1], []] (order may vary)"},{code:"(1 2) powerlist (size) map",assert:e=>{const o=e[0].sort((l,u)=>l-u);return deepEqual(o,[0,1,1,2])},expectedDescription:"A list of the sizes of each sublist: [0, 1, 1, 2] (order may vary)"}]},swoncat={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(o.concat(i))},description:"Concatenates two sequences (lists or strings) after swapping them. Equivalent to `swap concat`.",effect:"[S T] -> [U]"},examples:[{code:"(1 2) (3 4) swoncat",expected:[[3,4,1,2]]},{code:'"world" "hello" swoncat',expected:["helloworld"]},{code:"() (1) swoncat",expected:[[1]]},{code:"(1) () swoncat",expected:[[1]]},{code:'"a" "b" swoncat',expected:["ba"]}]},functional={name:"Functional & Aggregate Operations",description:"Higher-order functions for list processing and advanced aggregate manipulation.",definitions:{swons,swoncat,enconcat,unswons,leaf,fold,split,some,all,powerlist}},ucase={definition:{exec:function*(e){e.push(String(e.pop()).toUpperCase())},description:"Converts a string to uppercase.",effect:"[S] -> [S']"},examples:[{code:'"hello" ucase',expected:["HELLO"]},{code:'"Hello World" ucase',expected:["HELLO WORLD"]},{code:'"" ucase',expected:[""]}]},locase={definition:{exec:function*(e){e.push(String(e.pop()).toLowerCase())},description:"Converts a string to lowercase.",effect:"[S] -> [S']"},examples:[{code:'"HELLO" locase',expected:["hello"]},{code:'"Hello World" locase',expected:["hello world"]},{code:'"" locase',expected:[""]}]},trim={definition:{exec:function*(e){e.push(String(e.pop()).trim())},description:"Removes whitespace from both ends of a string.",effect:"[S] -> [S']"},examples:[{code:'"  hello  " trim',expected:["hello"]},{code:'"  hello world  " trim',expected:["hello world"]},{code:`" 
	  " trim`,expected:[""]}]},slice={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();e.push(l.slice(i,o))},description:"Extracts a section of a string and returns it as a new string. `S Start End -> S`",effect:"[S I_start I_end] -> [S']"},examples:[{code:'"hello world" 0 5 slice',expected:["hello"]},{code:'"hello world" 6 11 slice',expected:["world"]},{code:'"abc" 1 1 slice',expected:[""]}]},splitstr={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(i.split(o))},description:"Splits a string into a list of substrings. `S Separator -> [S1 S2 ...]`",effect:"[S Separator] -> [L]"},examples:[{code:'"a,b,c" "," splitstr',expected:[["a","b","c"]]},{code:'"hello" "" splitstr',expected:[["h","e","l","l","o"]]},{code:'"a b" " " splitstr',expected:[["a","b"]]}]},starts={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(i.startsWith(o))},description:"Checks if a string starts with the characters of a specified string. `S Prefix -> B`",effect:"[S Prefix] -> [bool]"},examples:[{code:'"hello" "he" starts',expected:[!0]},{code:'"hello world" "hello" starts',expected:[!0]},{code:'"hello world" "world" starts',expected:[!1]}]},ends={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(i.endsWith(o))},description:"Checks if a string ends with the characters of a specified string. `S Suffix -> B`",effect:"[S Suffix] -> [bool]"},examples:[{code:'"hello" "lo" ends',expected:[!0]},{code:'"hello world" "world" ends',expected:[!0]},{code:'"hello world" "hello" ends',expected:[!1]}]},replace={definition:{exec:function*(e){const o=String(e.pop()),i=String(e.pop()),l=String(e.pop()),u=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");e.push(l.replace(new RegExp(u,"g"),o))},description:"Replaces all occurrences of a search string with a replacement string. `S Search Replace -> S`",effect:"[S Search Replace] -> [S']"},examples:[{code:'"ha ha ha" "a" "o" replace',expected:["ho ho ho"]},{code:'"banana" "na" "no" replace',expected:["banono"]},{code:'"test" "x" "y" replace',expected:["test"]}]},jsString={definitions:{ucase,locase,trim,slice,splitstr,starts,ends,replace}},stringOp={definition:{exec:function*(e){const o=e.pop();typeof o=="string"?e.push(o):e.push(String(yieldFormatter(o)).replace(/^"(.*)"$/,"$1").replace(/^\((.*)\)$/,"$1"))},description:"Converts the top value on the stack to its string representation.",effect:"[A] -> [S]"},examples:[{code:"123 string",expected:["123"]},{code:"true string",expected:["true"]},{code:"(1 2 3) string",expected:["1 2 3"]},{code:"(1 2 2) set string",expected:["1 2"]},{code:'"abc" string',expected:["abc"]}]},toNumber={definition:{exec:function*(e){const o=e.pop(),i=parseFloat(o);e.push(isNaN(i)?0:i)},description:"Parses a string into a number. Returns 0 if the string cannot be parsed.",effect:"[S] -> [N]"},examples:[{code:'"123.45" toNumber',expected:[123.45]},{code:'"-10" toNumber',expected:[-10]},{code:'"hello" toNumber',expected:[0]},{code:"true toNumber",expected:[0]},{code:"123 toNumber",expected:[123]}]},toBool={definition:{exec:function*(e){e.push(!!e.pop())},description:"Converts the top value on the stack to its boolean equivalent (using standard JavaScript truthiness).",effect:"[A] -> [B]"},examples:[{code:"1 toBool",expected:[!0]},{code:"0 toBool",expected:[!1]},{code:'"" toBool',expected:[!1]},{code:'"hello" toBool',expected:[!0]},{code:"[] toBool",expected:[!0]}]},regtest={definition:{exec:function*(e){const o=e.pop(),i=e.pop();try{e.push(new RegExp(o).test(i))}catch{throw new Error(`Invalid RegExp pattern: ${o}`)}},description:"Tests if a string matches a regular expression. `S Pattern -> B`",effect:"[S Pattern] -> [bool]"},examples:[{code:'"hello" "^he" regtest',expected:[!0]},{code:'"hello" "o$" regtest',expected:[!0]},{code:'"banana" "na" regtest',expected:[!0]},{code:'"banana" "^na" regtest',expected:[!1]}]},regsub={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();try{e.push(l.replace(new RegExp(i),o))}catch{throw new Error(`Invalid RegExp pattern: ${i}`)}},description:"Replaces the first occurrence of a regex pattern in a string. `S Pattern Replacement -> S`",effect:"[S Pattern Replace] -> [S']"},examples:[{code:'"banana" "a" "o" regsub',expected:["bonana"]},{code:'"banana" "an" "o" regsub',expected:["boana"]},{code:'"hello world" "l" "X" regsub',expected:["heXlo world"]}]},regsubg={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();try{e.push(l.replace(new RegExp(i,"g"),o))}catch{throw new Error(`Invalid RegExp pattern: ${i}`)}},description:"Replaces all occurrences of a regex pattern in a string (global substitute). `S Pattern Replacement -> S`",effect:"[S Pattern Replace] -> [S']"},examples:[{code:'"banana" "a" "o" regsubg',expected:["bonono"]},{code:'"banana" "an" "o" regsubg',expected:["booa"]},{code:'"hello world" "l" "X" regsubg',expected:["heXXo worXd"]}]},advancedTypes={definitions:{string:stringOp,toNumber,toBool,regtest,regsub,regsubg}},cr={definition:{exec:function*(e,o){o.onOutput?o.onOutput(`
`):console.log(`
`)},description:"Outputs a newline to the REPL.",effect:"[] -> []"},examples:[{code:"cr",expected:[]}]},emit={definition:{exec:function*(e,o){const i=String(e.pop());o.onOutput?o.onOutput(i):console.log(i)},description:"Outputs the top of the stack to the REPL.",effect:"[S] -> []"},examples:[{code:'"Hello" emit',expected:[]}]},getUserDictionary=(e,o)=>{const i={};for(const l in e)o.has(l)||(i[l]=e[l]);return i},save={definition:{exec:function*(e,o,i,l){const u=e.pop();if(typeof u!="string"||!u)throw new Error("'save' expects a non-empty string name on the stack.");try{const d={stack:e,userDictionary:getUserDictionary(l,o.builtInKeys)},m=JSON.stringify(d,(g,b)=>{if(typeof b=="symbol"){const v=Symbol.keyFor(b);return v?{__type:"Symbol",key:v}:void 0}return b});localStorage.setItem(u,m),o.onOutput&&o.onOutput(`State saved to '${u}'.`)}catch(d){throw new Error(`Failed to save state to '${u}': ${d.message}`)}},description:"Saves the current stack and user-defined dictionary to localStorage under the given name.",effect:"[... S_name] -> [...]"},examples:[{code:["1 2 3","(dup *) sq =>",'"test-save" save'],assert:e=>{const o=localStorage.getItem("test-save");if(!o)return!1;const i=JSON.parse(o),l=i.userDictionary.sq.body;return i.stack.length===3&&Array.isArray(l)&&l[1]==="iterate"},expected:[1,2,3]}]},load={definition:{exec:function*(e,o,i,l){const u=e.pop();if(typeof u!="string"||!u)throw new Error("'load' expects a non-empty string name on the stack.");try{const d=localStorage.getItem(u);if(!d)throw new Error(`No saved state found for '${u}'.`);const m=JSON.parse(d,(g,b)=>b&&typeof b=="object"&&b.__type==="Symbol"&&b.key?Symbol.for(b.key):b);if(!m||!m.stack||!m.userDictionary)throw new Error(`Invalid data format for saved state '${u}'.`);for(const g in l)o.builtInKeys.has(g)||delete l[g];Object.assign(l,m.userDictionary),e.length=0,e.push(...m.stack),o.onOutput&&o.onOutput(`State loaded from '${u}'.`)}catch(d){throw new Error(`Failed to load state from '${u}': ${d.message}`)}},description:"Loads a previously saved state (stack and dictionary) from localStorage, replacing the current state.",effect:"[S_name] -> [...]"},examples:[{code:['1 2 3 (dup *) sq => "test-load" save',"clearall",'"test-load" load',"5 sq"],expected:[1,2,3,25]}]},ls={definition:{exec:function*(e,o){try{const i=Object.keys(localStorage);let l;i.length===0?l="No saved states.":l=`Saved states:
`+i.map(u=>`- ${u}`).join(`
`),o.onOutput&&o.onOutput(l)}catch(i){throw new Error(`Failed to list saved states: ${i.message}`)}},description:"Lists all saved REPL states from localStorage.",effect:"[] -> []"},examples:[{code:['"test-ls" save',"ls"],assert:e=>e.length===0,expectedDescription:"Stack should be empty."}]},formatDictionary=e=>{const o=Object.keys(e);return o.length===0?"No user-defined words found.":`User-defined words:
`+o.map(i=>{var d;const l=(d=e[i])==null?void 0:d.body;return`* ${Array.isArray(l)?`( ${l.map(yieldFormatter).join(" ")} )`:yieldFormatter(l)} ${i} = `}).join(`
`)},lurk={definition:{exec:function*(e,o,i,l){const u=e.pop();if(typeof u!="string"||!u)throw new Error(`'lurk' expects a non-empty string name (e.g., "this") on the stack.`);let d;if(u==="this"){const h={};for(const m in l)o.builtInKeys.has(m)||(h[m]=l[m]);d=formatDictionary(h)}else try{const h=localStorage.getItem(u);if(!h)throw new Error(`No saved state found for '${u}'.`);const g=JSON.parse(h,(b,v)=>v&&typeof v=="object"&&v.__type==="Symbol"&&v.key?Symbol.for(v.key):v);if(!g||!g.userDictionary)throw new Error(`Invalid data format for saved state '${u}'.`);d=formatDictionary(g.userDictionary)}catch(h){throw new Error(`Failed to lurk into '${u}': ${h.message}`)}o.onOutput&&o.onOutput(d)},description:'Lists user-defined words. With "this", lists words in the current session. With another name, lists words from a saved session.',effect:"[S_name] -> []"},examples:[{code:["(dup *) sq =>",'"this" lurk'],assert:e=>e.length===0,expectedDescription:"Stack should be empty."},{code:['1 2 3 (dup *) sq => "test-lurk" save',"clearall",'"test-lurk" lurk'],assert:e=>e.length===0,expectedDescription:"Stack should be empty."}]},repl={name:"REPL I/O",description:"Operators for interacting with the REPL environment.",definitions:{cr,emit,save,load,ls,lurk}},undo={definition:{exec:function*(e,o,i,l){if(!o.historyManager)return;const u=o.historyManager.undo();if(u){e.length=0,e.push(...u.stack);for(const d in l)"body"in l[d]&&delete l[d];Object.assign(l,u.userDictionary)}},description:"Reverts the stack and all user-defined words to their state before the last operation. Can be called multiple times.",effect:"[...] -> [...]"},examples:[{replCode:["1 2 +","dup","undo"],assert:e=>e.length===1&&e[0]===3,expectedDescription:"[3]"},{replCode:["100","1 2 +","undo"],expected:[100]}]},redo={definition:{exec:function*(e,o,i,l){if(!o.historyManager)return;const u=o.historyManager.redo();if(u){e.length=0,e.push(...u.stack);for(const d in l)"body"in l[d]&&delete l[d];Object.assign(l,u.userDictionary)}},description:"Re-applies an operation that was undone. Can only be used after `undo`.",effect:"[...] -> [...]"},examples:[{replCode:["1 2 +","undo","redo"],expected:[3]},{replCode:["1 2 +","undo","3 4 +","redo"],expected:[7]}]},clearhistory={definition:{exec:function*(e,o,i,l){if(o.historyManager){const u=o.historyManager.createSnapshot(e,l);o.historyManager.clear(),o.historyManager.add(u)}},description:"Clears the undo/redo history. The current state becomes the new initial state.",effect:"[] -> []"},examples:[{code:"1 2 + clearhistory",expected:[3]},{code:"1 2 clearhistory",expected:[1,2]}]},again={definition:{exec:function*(e,o,i){const{commandHistory:l,parse:u}=o;if(!l||l.length<2||!u)return;let d=null;for(let h=l.length-2;h>=0;h--)if(l[h].trim().toLowerCase()!=="again"){d=l[h];break}if(d){const h=u(d);yield*i(h,e,o)}},description:'Re-executes the last command from the history that was not "again". NOTE: Works only in REPL and line by line execution.',effect:"[...] -> [...]"},examples:[{replCode:["1 2 +","again"],expected:[3,3]},{replCode:["5 dup *","again"],expected:[25,25]},{replCode:["1","again","again"],expected:[1,1,1]},{replCode:["1 1 + again"],expected:[2]},{replCode:["10 20 +","1 again"],expected:[30,1,30]},{replCode:["1 again"],expected:[1]},{replCode:["(1) mylist =","1 mylist <-","again","mylist"],expected:[[1,1,1]]}]},history={name:"History Management",description:"Operators for managing the REPL session history (undo/redo).",definitions:{undo,redo,clearhistory,again}},prelude=`
const { PI, sin, cos, random, abs, min, max, pow, sign, floor } = Math;

// --- DSP Library Functions ---
// Each function takes its own state object 's', the processor instance, and its arguments.

const dsp = {
    sine: (s, processor, freq) => {
        s.phase = (s.phase || 0) + freq / sampleRate;
        return sin(s.phase * 2 * PI);
    },
    saw: (s, processor, freq) => {
        s.phase = (s.phase || 0) + freq / sampleRate;
        s.phase %= 1;
        return s.phase * 2 - 1;
    },
    triangle: (s, processor, freq) => {
        s.phase = (s.phase || 0) + freq / sampleRate;
        s.phase %= 1;
        return 4 * abs(s.phase - 0.5) - 1;
    },
    pulse: (s, processor, freq, duty = 0.5) => {
        s.phase = (s.phase || 0) + freq / sampleRate;
        s.phase %= 1;
        return s.phase < duty ? 1 : -1;
    },
    noise: (s, processor) => random() * 2 - 1,
    impulse: (s, processor, freq) => {
        s.phase = (s.phase || 1) + freq / sampleRate;
        let v = s.phase >= 1 ? 1 : 0;
        s.phase %= 1;
        return v;
    },
    oneshot: (s, processor) => {
        if (s.triggered) return 0;
        s.triggered = true;
        return 1;
    },
    lpf: (s, processor, input, cutoff, res) => {
        s.c = pow(0.5, (1 - min(max(cutoff, 0), 1)) / 0.125);
        s.r = pow(0.5, (min(max(res, 0), 1) + 0.125) / 0.125);
        s.mrc = 1 - s.r * s.c;
        s.s0 = (s.s0 || 0) * s.mrc - (s.s1 || 0) * s.c + input * s.c;
        s.s1 = (s.s1 || 0) * s.mrc + s.s0 * s.c;
        return s.s1;
    },
    hpf: (s, processor, input, cutoff, res) => {
        s.lpf_state = s.lpf_state || {};
        return input - dsp.lpf(s.lpf_state, processor, input, cutoff, res);
    },
    adsr: (s, processor, gate, a, d, sus, r) => {
        const aSamples = Math.max(1, a * sampleRate);
        const dSamples = Math.max(1, d * sampleRate);
        const rSamples = Math.max(1, r * sampleRate);

        s.val = s.val || 0;
        
        if (gate > 0 && (s.gate === undefined || s.gate <= 0)) {
            s.mode = 1; // attack
        } else if (gate <= 0 && s.gate > 0) {
            s.mode = 4; // release
            s.releaseStartVal = s.val;
        }
        s.gate = gate;

        switch (s.mode) {
            case 1: // Attack
                s.val += 1.0 / aSamples;
                if (s.val >= 1.0) { s.val = 1.0; s.mode = 2; }
                break;
            case 2: // Decay
                if (s.val > sus) { s.val -= (1.0 - sus) / dSamples; }
                if (s.val <= sus) { s.val = sus; s.mode = 3; }
                break;
            case 3: // Sustain
                s.val = sus;
                break;
            case 4: // Release
                s.val -= (s.releaseStartVal || 0) / rSamples;
                if (s.val <= 0) { s.val = 0; s.mode = 0; }
                break;
            default: // Off
                s.val = 0;
        }
        return Math.max(0, s.val);
    },
    ad: (s, processor, gate, a, d) => {
        const aSamples = Math.max(1, a * sampleRate);
        const dSamples = Math.max(1, d * sampleRate);

        s.val = s.val || 0;
        s.mode = s.mode || 0; // 0: off, 1: attack, 2: decay

        // A rising edge on the gate triggers the envelope
        if (gate > 0 && (s.lastGate === undefined || s.lastGate <= 0)) {
            s.mode = 1; // Go to attack phase
            s.val = 0;  // Reset from the bottom
        }
        s.lastGate = gate;

        if (s.mode === 1) { // In attack phase
            s.val += 1.0 / aSamples;
            if (s.val >= 1.0) {
                s.val = 1.0;
                s.mode = 2; // Switch to decay
            }
        } else if (s.mode === 2) { // In decay phase
            s.val -= 1.0 / dSamples;
            if (s.val <= 0) {
                s.val = 0;
                s.mode = 0; // Switch to off
            }
        }
        
        return s.val;
    },
    bytebeat: (s, processor, code, frequency) => {
        // Init state
        s.t = s.t ?? 0;
        s.lastT = s.lastT ?? -1;
        s.data = s.data ?? 0;

        if (s.code !== code) {
            try {
                s.fn = new Function('t', 'mousex', 'mousey', 'mousedx', 'mousedy', 'return ' + code);
                s.code = code;
            } catch (e) {
                console.error('Bytebeat compile error:', e);
                s.fn = null;
            }
        }
        
        const tDelta = frequency / sampleRate;
        s.t += tDelta;
        const t = floor(s.t);

        if (t !== s.lastT) {
            if (s.fn) {
                try {
                    const result = s.fn(t, processor.mouse.x, processor.mouse.y, processor.moused.x, processor.moused.y);
                    s.data = ((result | 0) & 255) / 127.5 - 1;
                } catch(e) {
                    console.error('Bytebeat runtime error in code "' + s.code + '":', e.message);
                    s.data = 0;
                }
            } else {
                s.data = 0;
            }
            s.lastT = t;
        }

        return s.data;
    },
    floatbeat: (s, processor, code, frequency) => {
        s.t = s.t ?? 0;
        s.lastT = s.lastT ?? -1;
        s.data = s.data ?? 0;

        if (s.code !== code) {
            try {
                s.fn = new Function('t', 'mousex', 'mousey', 'mousedx', 'mousedy', 'return ' + code);
                s.code = code;
            } catch (e) {
                console.error('Floatbeat compile error:', e);
                s.fn = null;
            }
        }
        
        const tDelta = frequency / sampleRate;
        s.t += tDelta;
        const t = floor(s.t);

        if (t !== s.lastT) {
            if (s.fn) {
                try {
                    const result = s.fn(t, processor.mouse.x, processor.mouse.y, processor.moused.x, processor.moused.y);
                    s.data = min(1, max(-1, result));
                } catch(e) {
                    console.error('Floatbeat runtime error in code "' + s.code + '":', e.message);
                    s.data = 0;
                }
            } else {
                s.data = 0;
            }
            s.lastT = t;
        }

        return s.data;
    },
    delay: (s, processor, input, time, feedback) => {
        if (!s.buffer) s.buffer = new Float32Array(sampleRate * 5); // 5 sec max
        s.writeIdx = (s.writeIdx || 0);
        let readIdx = s.writeIdx - Math.floor(time * sampleRate);
        if (readIdx < 0) readIdx += s.buffer.length;
        const out = s.buffer[readIdx];
        s.buffer[s.writeIdx] = input + out * feedback;
        s.writeIdx = (s.writeIdx + 1) % s.buffer.length;
        return out;
    },
    distort: (s, processor, input, amount) => {
        const gain = 1 + amount * 4;
        return Math.tanh(input * gain);
    },
    pan: (s, processor, input, pos) => {
        const angle = (pos * 0.5 + 0.5) * (PI / 2);
        return [input * cos(angle), input * sin(angle)];
    },
    note: (s, processor, note) => (2 ** ((note - 69) / 12) * 440),
    seq: (s, processor, clock, ...values) => {
        if (!s.lastClock && clock > 0) {
            s.step = (s.step || 0) + 1;
        }
        s.lastClock = clock;
        return values[s.step % values.length];
    },
    'mix': (s, processor, a, b) => {
        if (Array.isArray(a) && Array.isArray(b)) return [a[0]+b[0], a[1]+b[1]];
        if (Array.isArray(a)) return [a[0]+b, a[1]+b];
        if (Array.isArray(b)) return [a+b[0], a+b[1]];
        return a + b;
    },
    'mul': (s, processor, a, b) => {
        if (Array.isArray(a) && Array.isArray(b)) return [a[0]*b[0], a[1]*b[1]];
        if (Array.isArray(a)) return [a[0]*b, a[1]*b];
        if (Array.isArray(b)) return [a*b[0], a*b[1]];
        return a * b;
    },
    fm_simple: (s, processor, carrier_freq, mod_freq, mod_index, carrier_wave, mod_wave) => {
        s.modState = s.modState || {};
        s.carrierState = s.carrierState || {};

        const modOscFn = dsp[mod_wave] || dsp.sine;
        const carrierOscFn = dsp[carrier_wave] || dsp.sine;

        const modulator_output = modOscFn(s.modState, processor, mod_freq) * mod_index;
        const carrier_input_freq = carrier_freq + modulator_output;
        const final_output = carrierOscFn(s.carrierState, processor, carrier_input_freq);
        
        return final_output;
    },
    fm_synth: (s, processor, gate, baseFreq, opDefs, algorithmId) => {
        s.opStates = s.opStates || Array.from({ length: 6 }, () => ({}));
        
        const getOpOutput = (opNum, modulatorInput = 0) => {
            const opDef = opDefs[opNum - 1];
            const state = s.opStates[opNum - 1];
            if (!opDef || opDef.length < 7) return 0;

            const [level, freqSpec, a, d, sus, r, opTypeSym] = opDef;
            const opType = typeof opTypeSym === 'symbol' ? Symbol.keyFor(opTypeSym) : (opTypeSym || 'sine');
            const oscFn = dsp[opType] || dsp.sine;

            let freq;
            if (Array.isArray(freqSpec) && freqSpec[0] === Symbol.for('fixed') && typeof freqSpec[1] === 'number') {
                freq = freqSpec[1];
            } else if (typeof freqSpec === 'number') {
                freq = baseFreq * freqSpec;
            } else {
                freq = baseFreq;
            }

            const oscInputFreq = freq + modulatorInput;
            const oscVal = oscFn(state, processor, oscInputFreq);
            state.envState = state.envState || {};
            const envVal = dsp.adsr(state.envState, processor, gate, a, d, sus, r);
            const outputLevel = (level / 99.0);
            return oscVal * envVal * outputLevel;
        };
        
        let op1, op2, op3, op4, op5, op6;
        let finalOutput = 0.0;
        
        switch (algorithmId) {
            case 1: op3 = getOpOutput(3); op2 = getOpOutput(2, op3); op1 = getOpOutput(1, op2); op6 = getOpOutput(6); op5 = getOpOutput(5, op6); op4 = getOpOutput(4, op5); finalOutput = op1 + op4; break;
            case 2: op3 = getOpOutput(3); op2 = getOpOutput(2, op3); op6 = getOpOutput(6); op5 = getOpOutput(5, op6); op4 = getOpOutput(4, op5); finalOutput = getOpOutput(1, op2 + op4); break;
            case 3: op3 = getOpOutput(3); op2 = getOpOutput(2, op3); op1 = getOpOutput(1, op2); op6 = getOpOutput(6); op5 = getOpOutput(5, op6); op4 = getOpOutput(4, op5 + op3); finalOutput = op1 + op4; break;
            case 4: case 5: op3 = getOpOutput(3); op2 = getOpOutput(2, op3); op6 = getOpOutput(6); op5 = getOpOutput(5, op6); op4 = getOpOutput(4); finalOutput = getOpOutput(1, op2 + op5 + op4); break;
            case 6: op3 = getOpOutput(3); op2 = getOpOutput(2, op3); op1 = getOpOutput(1, op2); op6 = getOpOutput(6); op5 = getOpOutput(5, op6); op4 = getOpOutput(4); finalOutput = op1 + op5 + op4; break;
            case 7: op3 = getOpOutput(3); op2 = getOpOutput(2, op3); op6 = getOpOutput(6); op5 = getOpOutput(5, op6); op4 = getOpOutput(4, op5); op1 = getOpOutput(1); finalOutput = op1 + op2 + op4; break;
            case 8: op1=getOpOutput(1); op2=getOpOutput(2); op3=getOpOutput(3); op4=getOpOutput(4); op5=getOpOutput(5); finalOutput = getOpOutput(6, op1+op2+op3+op4+op5); break;
            case 9: op3 = getOpOutput(3); op2 = getOpOutput(2, op3); op1 = getOpOutput(1, op2); op5 = getOpOutput(5); op4 = getOpOutput(4, op5); op6 = getOpOutput(6); finalOutput = op1 + op4 + op6; break;
            case 10: op3 = getOpOutput(3); op2 = getOpOutput(2, op3); op5 = getOpOutput(5); op4 = getOpOutput(4, op5); op1 = getOpOutput(1); op6 = getOpOutput(6, op1); finalOutput = op2 + op4 + op6; break;
            case 11: {
                const lastOp6Out = s.opStates[5].lastOutput || 0;
                op3 = getOpOutput(3); op2 = getOpOutput(2, op3); op5 = getOpOutput(5); op4 = getOpOutput(4, op5); op1 = getOpOutput(1);
                op6 = getOpOutput(6, op1+op2+op4+lastOp6Out);
                s.opStates[5].lastOutput = op6; finalOutput = op6; break;
            }
            case 12: case 21: op2=getOpOutput(2); op1=getOpOutput(1, op2); op4=getOpOutput(4); op3=getOpOutput(3, op4); op6=getOpOutput(6); op5=getOpOutput(5, op6); finalOutput = op1 + op3 + op5; break;
            case 13: op6=getOpOutput(6); op5=getOpOutput(5,op6); op4=getOpOutput(4); op2=getOpOutput(2); const mod_13 = op5+op4+op2; op1=getOpOutput(1, mod_13); op3=getOpOutput(3, mod_13); finalOutput = op1 + op3; break;
            case 14: op2=getOpOutput(2); op3=getOpOutput(3); op1=getOpOutput(1, op2+op3); op5=getOpOutput(5); op6=getOpOutput(6); op4=getOpOutput(4, op5+op6); finalOutput = op1 + op4; break;
            case 15: op2=getOpOutput(2); op1=getOpOutput(1,op2); op3=getOpOutput(3); op5=getOpOutput(5); op4=getOpOutput(4,op5); op6=getOpOutput(6); finalOutput = op1+op3+op4+op6; break;
            case 16: op3=getOpOutput(3); op2=getOpOutput(2,op3); op6=getOpOutput(6); op5=getOpOutput(5,op6); op4=getOpOutput(4,op5); op1=getOpOutput(1); finalOutput = op1+op2+op4; break;
            case 17: op3=getOpOutput(3); op2=getOpOutput(2,op3); op5=getOpOutput(5); op6=getOpOutput(6); op4=getOpOutput(4, op5+op6); op1=getOpOutput(1); finalOutput = op1+op2+op4; break;
            case 18: op2=getOpOutput(2); op1=getOpOutput(1,op2); op3=getOpOutput(3); op4=getOpOutput(4); op5=getOpOutput(5); op6=getOpOutput(6); finalOutput = op1+op3+op4+op5+op6; break;
            case 19: op2=getOpOutput(2); op1=getOpOutput(1,op2); op4=getOpOutput(4); op3=getOpOutput(3,op4); op5=getOpOutput(5); op6=getOpOutput(6); finalOutput = op1+op3+op5+op6; break;
            case 20: op2=getOpOutput(2); op3=getOpOutput(3); op1=getOpOutput(1,op2+op3); op5=getOpOutput(5); op4=getOpOutput(4,op5); op6=getOpOutput(6); finalOutput = op1+op4+op6; break;
            case 22: op3=getOpOutput(3); op2=getOpOutput(2,op3); op6=getOpOutput(6); op5=getOpOutput(5,op6); op1=getOpOutput(1); op4=getOpOutput(4); finalOutput = op1+op2+op4+op5; break;
            case 23: op4=getOpOutput(4); op3=getOpOutput(3,op4); op6=getOpOutput(6); op5=getOpOutput(5,op6); op1=getOpOutput(1); op2=getOpOutput(2); finalOutput = op1+op2+op3+op5; break;
            case 24: op5=getOpOutput(5); op6=getOpOutput(6); op4=getOpOutput(4,op5+op6); op1=getOpOutput(1); op2=getOpOutput(2); op3=getOpOutput(3); finalOutput = op1+op2+op3+op4; break;
            case 25: op6=getOpOutput(6); op5=getOpOutput(5,op6); op1=getOpOutput(1); op2=getOpOutput(2); op3=getOpOutput(3); op4=getOpOutput(4); finalOutput = op1+op2+op3+op4+op5; break;
            case 26: op3=getOpOutput(3); op2=getOpOutput(2,op3); op1=getOpOutput(1); op4=getOpOutput(4); op5=getOpOutput(5); op6=getOpOutput(6); finalOutput = op1+op2+op4+op5+op6; break;
            case 27: op4=getOpOutput(4); op3=getOpOutput(3,op4); op1=getOpOutput(1); op2=getOpOutput(2); op5=getOpOutput(5); op6=getOpOutput(6); finalOutput = op1+op2+op3+op5+op6; break;
            case 28: op5=getOpOutput(5); op4=getOpOutput(4,op5); op1=getOpOutput(1); op2=getOpOutput(2); op3=getOpOutput(3); op6=getOpOutput(6); finalOutput = op1+op2+op3+op4+op6; break;
            case 29: {
                 const lastOp6Out = s.opStates[5].lastOutput || 0;
                 op6 = getOpOutput(6, lastOp6Out); s.opStates[5].lastOutput = op6;
                 op1=getOpOutput(1); op2=getOpOutput(2); op3=getOpOutput(3); op4=getOpOutput(4); op5=getOpOutput(5);
                 finalOutput = op1+op2+op3+op4+op5+op6; break;
            }
            case 30: {
                const lastOp6Out = s.opStates[5].lastOutput || 0;
                op6 = getOpOutput(6, lastOp6Out); s.opStates[5].lastOutput = op6;
                op5 = getOpOutput(5, op6);
                op1=getOpOutput(1); op2=getOpOutput(2); op3=getOpOutput(3); op4=getOpOutput(4);
                finalOutput = op1+op2+op3+op4+op5; break;
            }
            case 31: {
                const lastOp6Out = s.opStates[5].lastOutput || 0;
                op6 = getOpOutput(6, lastOp6Out); s.opStates[5].lastOutput = op6;
                op5 = getOpOutput(5, op6);
                op1=getOpOutput(1); op2=getOpOutput(2); op3=getOpOutput(3); op4=getOpOutput(4);
                finalOutput = op1+op2+op3+op4+op5; break;
            }
            case 32: op1=getOpOutput(1); op2=getOpOutput(2); op3=getOpOutput(3); op4=getOpOutput(4); op5=getOpOutput(5); op6=getOpOutput(6); finalOutput = op1+op2+op3+op4+op5+op6; break;
            default: finalOutput = 0; break;
        }

        return finalOutput;
    },
};

class DspProcessor extends AudioWorkletProcessor {
    constructor() {
        super();
        this.voices = new Map(); // { id: { graph, params, state } }
        this.port.onmessage = (e) => this.handleMessage(e.data);
        // FIX: Add tempo property to the processor for use in DSP functions.
        this.tempo = 120.0;
        this.moused = { x: 0, y: 0, down: false };
        this.mouse = { x: 0, y: 0 };
    }

    handleMessage(msg) {
        switch (msg.command) {
            case 'play':
                this.voices.set(msg.id, {
                    graph: msg.graph,
                    params: msg.params || {},
                    state: {} // For stateful nodes
                });
                break;
            case 'update':
                if (this.voices.has(msg.id)) {
                    const voice = this.voices.get(msg.id);
                    voice.graph = msg.graph;
                    voice.params = msg.params || {};
                }
                break;
            case 'ctrl':
                if (this.voices.has(msg.id)) {
                    this.voices.get(msg.id).params[msg.param] = msg.value;
                }
                break;
            case 'stop':
                this.voices.delete(msg.id);
                break;
            case 'stopAll':
                this.voices.clear();
                break;
            // FIX: Handle 'setTempo' command to update the processor's tempo.
            case 'setTempo':
                this.tempo = msg.bpm;
                break;
            case 'mousedown':
                this.moused.x = msg.x;
                this.moused.y = msg.y;
                this.moused.down = msg.down;
                break;
            case 'mouse':
                this.mouse.x = msg.x;
                this.mouse.y = msg.y;
                break;
        }
    }

    // Recursively evaluates an audio graph node for the current sample
    evaluate(node, params, state, counters) {
        if (typeof node !== 'object' || node === null) return node;
        if (node.param) return params[node.param];
        if (!Array.isArray(node)) return 0;

        const op = node[0];
        const dspFn = dsp[op];
        if (!dspFn) return 0;

        const evalArgs = node.slice(1).map(arg => this.evaluate(arg, params, state, counters));

        const opCount = counters[op] = (counters[op] || 0) + 1;
        const stateKey = op + '_' + (opCount - 1);
        state[stateKey] = state[stateKey] || {};

        return dspFn(state[stateKey], this, ...evalArgs);
    }

    process(inputs, outputs) {
        const outL = outputs[0][0];
        const outR = outputs[0][1];

        for (let i = 0; i < outL.length; i++) {
            let totalL = 0;
            let totalR = 0;

            for (const voice of this.voices.values()) {
                try {
                    const counters = {};
                    const result = this.evaluate(voice.graph, voice.params, voice.state, counters);
                    
                    if (Array.isArray(result)) {
                        totalL += result[0] || 0;
                        totalR += result[1] || 0;
                    } else {
                        totalL += result || 0;
                        totalR += result || 0;
                    }
                } catch (e) {
                    console.error('DSP Error:', e);
                }
            }
            
            outL[i] = totalL;
            outR[i] = totalR;
        }
        return true;
    }
}

registerProcessor('dsp-processor', DspProcessor);

class ClockProcessor extends AudioWorkletProcessor {
    constructor() {
        super();
        this.tickInterval = 128 / sampleRate; // ~2.9 ms at 44.1kHz
        this.nextTickTime = currentTime + this.tickInterval;
        this.running = false;

        this.port.onmessage = (e) => {
            if (e.data === "start") {
                this.running = true;
                this.nextTickTime = currentTime + this.tickInterval;
            } else if (e.data === "stop") {
                this.running = false;
            }
        };
    }

    process() {
        if (!this.running) return true;

        while (currentTime >= this.nextTickTime) {
            this.port.postMessage(this.nextTickTime);
            this.nextTickTime += this.tickInterval;
        }

        return true;
    }
}
registerProcessor("clock", ClockProcessor);
`,analyzeAndBuildTemplate=(e,o,i)=>{if(Array.isArray(e))for(let l=0;l<e.length;l++){const u=e[l];if(typeof u=="symbol"){const d=Symbol.keyFor(u);d&&(o.params.hasOwnProperty(d)||(o.params[d]=0),e[l]={param:d})}else Array.isArray(u)&&analyzeAndBuildTemplate(u,o)}};class AudioEngine{constructor(){this.context=null,this.workletNode=null,this.clockNode=null,this.isInitialized=!1,this.initPromise=null,this.voiceIdCounter=0,this.isMuted=!1,this.readyListeners=[],this.startTime=0,this.scheduledCallbacks=new Map,this.sourceVoices=new Map,this.readyPromise=new Promise(o=>{this.resolveReady=o})}static getInstance(){return AudioEngine.instance||(AudioEngine.instance=new AudioEngine),AudioEngine.instance}onReady(o){this.isInitialized?o():this.readyListeners.push(o)}offReady(o){this.readyListeners=this.readyListeners.filter(i=>i!==o)}isReady(){return this.isInitialized}setMuted(o){this.isMuted=o,o&&this.stopAll()}init(){return this.isInitialized?Promise.resolve():this.initPromise?this.readyPromise:(this.initPromise=(async()=>{if(typeof window>"u"){this.isInitialized=!0,this.resolveReady();return}try{this.context||(this.context=new AudioContext),this.context.state==="suspended"&&await this.context.resume();const o=new Blob([prelude],{type:"application/javascript"}),i=URL.createObjectURL(o);try{await this.context.audioWorklet.addModule(i)}catch(l){if(!l.message.includes("is already registered"))throw l}finally{URL.revokeObjectURL(i)}this.workletNode||(this.workletNode=new AudioWorkletNode(this.context,"dsp-processor",{outputChannelCount:[2]}),this.workletNode.connect(this.context.destination)),this.clockNode||(this.clockNode=new AudioWorkletNode(this.context,"clock"),this.clockNode.port.onmessage=l=>this.handleTick(l.data),this.clockNode.port.postMessage("start"))}catch(o){throw console.error("Error initializing AudioEngine:",o),this.initPromise=null,o}})(),this.readyPromise)}handleTick(o){if(this.isInitialized||(this.startTime=o,this.isInitialized=!0,this.resolveReady(),setTimeout(()=>{this.readyListeners.forEach(l=>l()),this.readyListeners=[]},0)),this.scheduledCallbacks.size===0)return;const i=[...this.scheduledCallbacks.keys()];for(const l of i){const u=this.scheduledCallbacks.get(l);u&&u.time<=o&&(this.scheduledCallbacks.delete(l),u.callback(o).catch(d=>{console.error(`Error in scheduled callback '${l}':`,d)}))}}getContextTime(){var o;return((o=this.context)==null?void 0:o.currentTime)??0}getStartTime(){return this.startTime}getElapsedTime(){return this.isInitialized?this.getContextTime()-this.startTime:0}schedule(o,i,l){this.isInitialized||this.init().catch(u=>console.error("Could not auto-initialize AudioEngine for scheduling.",u)),this.scheduledCallbacks.set(o,{time:i,callback:l})}cancel(o){this.scheduledCallbacks.delete(o)}play(o,i){if(this.isMuted||!this.isInitialized||!this.workletNode)return"";const l=deepClone(o),u={graph:l,params:{}};analyzeAndBuildTemplate(u.graph,u);const d=u.params;if(i&&this.sourceVoices.has(i)){const m=this.sourceVoices.get(i);return this.workletNode.port.postMessage({command:"update",id:m,graph:l,params:d}),m}const h=`voice_${this.voiceIdCounter++}`;return i&&this.sourceVoices.set(i,h),this.workletNode.port.postMessage({command:"play",id:h,graph:l,params:d}),h}ctrl(o,i,l){if(this.isMuted||!this.isInitialized||!this.workletNode)return;const u=this.sourceVoices.get(o);u?this.workletNode.port.postMessage({command:"ctrl",id:u,param:i,value:l}):console.warn(`No active voice found for patch named "${o}".`)}setMouse(o,i){!this.isInitialized||!this.workletNode||this.workletNode.port.postMessage({command:"mouse",x:o,y:i})}setMouseDown(o,i,l){!this.isInitialized||!this.workletNode||this.workletNode.port.postMessage({command:"mousedown",x:o,y:i,down:l})}setTempo(o){!this.isInitialized||!this.workletNode||this.workletNode.port.postMessage({command:"setTempo",bpm:o})}stop(o){if(this.isMuted)return[];if(!this.isInitialized||!this.workletNode)return[];const i=this.sourceVoices.get(o);return i?(this.workletNode.port.postMessage({command:"stop",id:i}),this.sourceVoices.delete(o),[i]):[]}stopAll(){if(this.scheduledCallbacks.clear(),this.workletNode){this.workletNode.port.postMessage({command:"stopAll"});const o=Array.from(this.sourceVoices.values());return this.sourceVoices.clear(),o}return[]}}const audioEngine=AudioEngine.getInstance(),isAudioGraph$1=e=>Array.isArray(e)&&typeof e[0]=="string",isQuotation=e=>Array.isArray(e)&&!isAudioGraph$1(e),isListOfNotes=e=>Array.isArray(e)&&e.every(o=>typeof o=="number"||Array.isArray(o)&&o[0]==="note"),play={definition:{description:"Plays an audio graph. It can resolve and apply patch quotations to audio graphs or lists of notes to create complex sounds like chords or sequences before playing. If a patch name (symbol) is used, the sound can be controlled later.",effect:"[... graph|notes patch?] -> [graph]",exec:function*(e,o,i){for(;e.length!==0;){let l=!1;const u=e[e.length-1],d=e.length>1?e[e.length-2]:void 0;if(typeof u=="symbol"||isQuotation(u)&&!isListOfNotes(u))yield*i(["i"],e,o),l=!0;else if(isQuotation(u)&&d!==void 0){const h=e.pop(),m=e.pop();if(isListOfNotes(m)){const g=[];for(const b of m){const v=[1,b];yield*i(h,v,o),g.push(...v)}if(g.length>0){const b=g.slice(1).reduce((v,w)=>["mix",v,w],g[0]);e.push(b)}else e.push([])}else{const b=Array.isArray(m)&&m[0]==="note"?[1,m]:[m];yield*i(h,b,o),e.push(...b)}l=!0}if(!l)break}if(e.length>0&&isAudioGraph$1(e[e.length-1])){const l=e[e.length-1],u=e.find(m=>typeof m=="symbol"),d=u?Symbol.keyFor(u):o.sourceId,h=audioEngine.play(deepClone(l),d);h&&o.onVoiceCreated&&o.onVoiceCreated(h)}}},examples:[{code:"440 sine play",assert:e=>e.length===1&&isAudioGraph$1(e[0])&&e[0][0]==="sine",expectedDescription:"A sine wave audio graph"},{code:`
((220 400 :sine :sine fm)) :bell =
60 note :bell play
`,assert:e=>e.length===1&&isAudioGraph$1(e[0])&&e[0][0]==="fm_simple",expectedDescription:"An FM audio graph produced by a patch."},{code:"440 (220 400 :sine :sine fm) play",assert:e=>{const o=l=>Array.isArray(l)&&typeof l[0]=="string";if(e.length!==1||!o(e[0]))return!1;const i=e[0];return i.length===6&&i[0]==="fm_simple"&&i[1]===440&&i[2]===220&&i[3]===400&&i[4]==="sine"&&i[5]==="sine"},expectedDescription:"An fm_simple audio graph for a single note."}]},sine={definition:{exec:function*(e){const o=e.pop();if(Array.isArray(o)){if(o.length===0){e.push(["mul",["sine",0],0]);return}if(typeof o[0]=="string")e.push(["sine",o]);else{const l=o.map(d=>["sine",d]),u=l.slice(1).reduce((d,h)=>["mix",d,h],l[0]);e.push(u)}}else e.push(["sine",o])},description:"Creates a sine wave oscillator node. The frequency can be a number, a list of numbers (for a chord), or an audio graph for frequency modulation (FM).",effect:"[F_freq | [F1 F2...] | L_modulator_graph] -> [L_graph]"},examples:[{code:"440 sine",expected:[["sine",440]]},{code:"(330 440 445) sine",assert:e=>{const o=e[0];return e.length===1&&Array.isArray(o)&&o[0]==="mix"&&o[1][0]==="mix"&&o[1][1][0]==="sine"&&o[1][1][1]===330&&o[1][2][0]==="sine"&&o[1][2][1]===440&&o[2][0]==="sine"&&o[2][1]===445},expectedDescription:"A mixed audio graph for a chord."},{code:`# Manual FM patch: Carrier Freq = 440, Modulator Freq = 220, Modulation Index = 100
220 sine 100 mul 440 mix sine`,assert:e=>{const o=e[0];return e.length===1&&Array.isArray(o)&&o[0]==="sine"&&o[1][0]==="mix"&&o[1][1][0]==="mul"&&o[1][1][1][0]==="sine"&&o[1][1][1][1]===220&&o[1][1][2]===100&&o[1][2]===440},expectedDescription:"An FM audio graph."}]},saw={definition:{exec:function*(e){const o=e.pop();if(Array.isArray(o)){if(o.length===0){e.push(["mul",["saw",0],0]);return}if(typeof o[0]=="string")e.push(["saw",o]);else{const l=o.map(d=>["saw",d]),u=l.slice(1).reduce((d,h)=>["mix",d,h],l[0]);e.push(u)}}else e.push(["saw",o])},description:"Creates a sawtooth wave oscillator node. The frequency can be a number, a list of numbers (for a chord), or an audio graph for frequency modulation (FM).",effect:"[F_freq | [F1 F2...] | L_modulator_graph] -> [L_graph]"},examples:[{code:"440 saw",expected:[["saw",440]]},{code:"(330 440) saw",assert:e=>e.length===1&&e[0][0]==="mix"&&e[0][1][0]==="saw"&&e[0][1][1]===330&&e[0][2][0]==="saw"&&e[0][2][1]===440,expectedDescription:"A mixed audio graph for a chord."}]},pulse={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(Array.isArray(i)){if(i.length===0){e.push(["mul",["pulse",0,o],0]);return}if(typeof i[0]=="string")e.push(["pulse",i,o]);else{const u=i.map(h=>["pulse",h,o]),d=u.slice(1).reduce((h,m)=>["mix",h,m],u[0]);e.push(d)}}else e.push(["pulse",i,o])},description:"Creates a pulse wave oscillator node. The frequency can be a number, a list of numbers (for a chord), or an audio graph for frequency modulation (FM). The duty cycle can also be a number or an audio graph.",effect:"[F_freq|L_freqs|L_modulator F_duty|L_modulator] -> [L_graph]"},examples:[{code:"440 0.25 pulse",expected:[["pulse",440,.25]]},{code:"(220 330) 0.5 pulse",assert:e=>e.length===1&&e[0][0]==="mix"&&e[0][1][1]===220&&e[0][2][1]===330,expectedDescription:"A mixed audio graph for a chord."}]},noise={definition:{exec:function*(e){e.push(["noise"])},description:"Creates a white noise generator node.",effect:"[] -> [L_graph]"},examples:[{code:"noise 0.2 mul play",expected:[["mul",["noise"],.2]]},{code:"noise",expected:[["noise"]]}]},lpf={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();e.push(["lpf",l,i,o])},description:"Applies a low-pass filter to an audio signal node.",effect:"[L_graph F_cutoff F_resonance] -> [L_graph]"},examples:[{code:"220 saw 800 0.5 lpf play",expected:[["lpf",["saw",220],800,.5]]}]},hpf={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();e.push(["hpf",l,i,o])},description:"Applies a high-pass filter to an audio signal node.",effect:"[L_graph F_cutoff F_resonance] -> [L_graph]"},examples:[{code:"noise 2000 0.2 hpf play",expected:[["hpf",["noise"],2e3,.2]]}]},ad={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();e.push(["ad",l,i,o])},description:"Creates an Attack-Decay envelope generator node.",effect:"[S_gate F_attack F_decay] -> [L_graph]"},examples:[{code:"440 sine 1 0.01 0.4 ad mul play",expected:[["mul",["sine",440],["ad",1,.01,.4]]]},{code:"1 0.1 0.2 ad",expected:[["ad",1,.1,.2]]}]},adsr={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop(),u=e.pop(),d=e.pop();e.push(["adsr",d,u,l,i,o])},description:"Creates an Attack-Decay-Sustain-Release (ADSR) envelope node.",effect:"[S_gate F_a F_d F_s F_r] -> [L_graph]"},examples:[{code:"440 sine 1 0.1 0.2 0.5 0.3 adsr mul play",expected:[["mul",["sine",440],["adsr",1,.1,.2,.5,.3]]]},{code:"1 0.1 0.2 0.5 0.3 adsr",expected:[["adsr",1,.1,.2,.5,.3]]}]},delay={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();e.push(["delay",l,i,o])},description:"Applies a delay effect with feedback to an audio signal node.",effect:"[L_graph F_time F_feedback] -> [L_graph]"},examples:[{code:"220 sine dup 0.25 0.5 delay mix 0.5 mul play",assert:e=>e.length===1&&e[0][0]==="mul"}]},distort={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(["distort",i,o])},description:"Applies distortion to an audio signal node.",effect:"[L_graph F_amount] -> [L_graph]"},examples:[{code:"220 saw 0.8 distort 0.5 mul play",expected:[["mul",["distort",["saw",220],.8],.5]]}]},pan={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(["pan",i,o])},description:"Pans a mono signal node in the stereo field. -1 is hard left, 1 is hard right.",effect:"[L_graph F_pos] -> [L_graph]"},examples:[{code:"220 sine -0.7 pan play",expected:[["pan",["sine",220],-.7]]}]},note={definition:{exec:function*(e){const o=e.pop();if(Array.isArray(o)&&o.every(i=>typeof i=="number")){const i=o.map(l=>["note",l]);e.push(i)}else e.push(["note",o])},description:"Creates a node that converts a MIDI note number to a frequency in Hz. If given a list of numbers, it creates a list of note nodes.",effect:"[N_midi | [N1 N2 ...]] -> [L_graph | [L_graph1 L_graph2 ...]]"},examples:[{code:"69 note sine play",expected:[["sine",["note",69]]]},{code:"69 note",expected:[["note",69]]},{code:"(60 64 67) note",expected:[[["note",60],["note",64],["note",67]]]}]},seq={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!Array.isArray(o))throw new Error("seq expects a list of values.");e.push(["seq",i,...o])},description:"Creates a step sequencer node. Steps through the list of values on each tick of the clock signal.",effect:"[L_clock L_values] -> [L_graph]"},examples:[{code:"4 impulse (60 64 67 72) seq note sine play",expected:[["sine",["note",["seq",["impulse",4],60,64,67,72]]]]}]},impulse={definition:{exec:function*(e){const o=e.pop();e.push(["impulse",o])},description:"Creates a trigger impulse oscillator node at a given frequency (Hz). Note: For safety, a raw impulse played directly will be silent. To hear it, you must apply a gain (e.g., `8 impulse 0.5 mul play`).",effect:"[F_freq] -> [L_graph]"},examples:[{code:"8 impulse 0.5 mul play",expected:[["mul",["impulse",8],.5]]},{code:"8 impulse",expected:[["impulse",8]]}]},mix={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(["mix",i,o])},description:"Mixes two audio signal nodes together by adding them.",effect:"[L_graphA L_graphB] -> [L_graph]"},examples:[{code:"220 sine 330 sine mix 0.5 mul play",expected:[["mul",["mix",["sine",220],["sine",330]],.5]]}]},mul={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push(["mul",i,o])},description:"Multiplies two audio signals (or a signal and a number for gain).",effect:"[L_graphA L_graphB_or_F] -> [L_graph]"},examples:[{code:"440 sine 0.5 mul play",expected:[["mul",["sine",440],.5]]}]},ctrl={definition:{exec:function*(e){if(e.length<3)throw new Error("ctrl expects 3 arguments on the stack.");const o=e.pop(),i=e.pop(),l=e.pop();if(typeof l!="symbol"||typeof i!="symbol"||typeof o!="number")throw e.push(l,i,o),new Error("ctrl expects: symbol (patch name), symbol (param name), number (value)");const u=Symbol.keyFor(l);if(!u)throw new Error("ctrl: Invalid symbol for patch name.");const d=Symbol.keyFor(i);if(!d)throw new Error("ctrl: Invalid symbol for parameter name.");audioEngine.ctrl(u,d,o),e.push(l,i,o)},description:"Controls a parameter of a running audio patch. Consumes the patch name, parameter name, and value, then pushes them back onto the stack.",effect:"[A B C] -> [A B C]"},examples:[{code:":my-synth :freq 440 ctrl",assert:e=>e.length===3&&typeof e[0]=="symbol"&&Symbol.keyFor(e[0])==="my-synth"&&typeof e[1]=="symbol"&&Symbol.keyFor(e[1])==="freq"&&e[2]===440,expectedDescription:"[:my-synth :freq 440]"}]},hush={definition:{exec:function*(e,o,i,l){audioEngine.stopAll();const d=l[":loops"];d&&"body"in d&&Array.isArray(d.body)&&(d.body.length=0)},description:"Stops all currently playing audio voices and terminates all live loops immediately.",effect:"[] -> []"},examples:[{code:"hush",expected:[]}]},bd={definition:{exec:function*(e){let o;e.length>0&&Array.isArray(e[e.length-1])?o=e.pop():o=["oneshot"];const h=["mul",["mul",["sine",["mix",60,["mul",["ad",[...o],.001,.1],200]]],["ad",o,.001,.4]],1];e.push(h)},description:"Creates a bass drum synth node. If a gate signal is on the stack, it is used for triggering. Otherwise, the sound is triggered once immediately.",effect:"[L_gate]? -> [L_graph]"},examples:[{code:"bd play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A valid audio graph"},{code:"2 impulse bd play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A valid audio graph"}]},sd={definition:{exec:function*(e){let o;e.length>0&&Array.isArray(e[e.length-1])?o=e.pop():o=["oneshot"];const u=["mul",["mix",["triangle",220],["triangle",180]],.5],d=["ad",[...o],.001,.1],b=["mul",["mul",["mix",u,["mul",["mul",["hpf",["noise"],1e3,.5],d],.8]],["ad",o,.001,.2]],.9];e.push(b)},description:"Creates a snare drum synth node. If a gate signal is on the stack, it is used for triggering. Otherwise, the sound is triggered once immediately.",effect:"[L_gate]? -> [L_graph]"},examples:[{code:"sd play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A valid audio graph"},{code:"2 impulse sd play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A valid audio graph"}]},lt={definition:{exec:function*(e){let o;e.length>0&&Array.isArray(e[e.length-1])?o=e.pop():o=["oneshot"];const i=120,l=["ad",[...o],.001,.08],m=["mul",["mul",["sine",["mix",i,["mul",l,i*1.5]]],["ad",o,.001,.3]],.9];e.push(m)},description:"Creates a low tom synth node. If a gate signal is on the stack, it is used for triggering. Otherwise, the sound is triggered once immediately.",effect:"[L_gate]? -> [L_graph]"},examples:[{code:"lt play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A valid audio graph"},{code:"2 impulse lt play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A valid audio graph"}]},mt={definition:{exec:function*(e){let o;e.length>0&&Array.isArray(e[e.length-1])?o=e.pop():o=["oneshot"];const i=180,l=["ad",[...o],.001,.08],m=["mul",["mul",["sine",["mix",i,["mul",l,i*1.5]]],["ad",o,.001,.3]],.9];e.push(m)},description:"Creates a mid tom synth node. If a gate signal is on the stack, it is used for triggering. Otherwise, the sound is triggered once immediately.",effect:"[L_gate]? -> [L_graph]"},examples:[{code:"mt play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A valid audio graph"},{code:"2 impulse mt play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A valid audio graph"}]},ht={definition:{exec:function*(e){let o;e.length>0&&Array.isArray(e[e.length-1])?o=e.pop():o=["oneshot"];const i=250,l=["ad",[...o],.001,.08],m=["mul",["mul",["sine",["mix",i,["mul",l,i*1.5]]],["ad",o,.001,.3]],.9];e.push(m)},description:"Creates a high tom synth node. If a gate signal is on the stack, it is used for triggering. Otherwise, the sound is triggered once immediately.",effect:"[L_gate]? -> [L_graph]"},examples:[{code:"ht play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A valid audio graph"},{code:"2 impulse ht play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A valid audio graph"}]},hh={definition:{exec:function*(e){let o;e.length>0&&Array.isArray(e[e.length-1])?o=e.pop():o=["oneshot"];const m=["mul",["mul",["hpf",["noise"],8e3,.1],["ad",o,.001,.05]],.5];e.push(m)},description:"Creates a closed hi-hat synth node. If a gate signal is on the stack, it is used for triggering. Otherwise, the sound is triggered once immediately.",effect:"[L_gate]? -> [L_graph]"},examples:[{code:"hh play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A valid audio graph"},{code:"8 impulse hh play",assert:e=>e.length===1&&Array.isArray(e[0])&&e[0][0]==="mul",expectedDescription:"A valid audio graph"}]},bytebeat={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!Array.isArray(i))throw e.push(i,o),new Error("bytebeat expects a quotation (list) containing a valid RPN expression.");if(typeof o!="number")throw e.push(i,o),new Error("bytebeat expects a frequency number.");try{const l=transpileJS(i);e.push(["bytebeat",l,o])}catch(l){throw new Error(`Error transpiling bytebeat quotation: ${l.message}`)}},description:"Bytebeat node. Consumes a quotation with an RPN expression and a frequency. The expression is transpiled to JS and evaluated for every audio sample. The integer variable 't' (time) is available inside the quotation. The integer result of the formula is wrapped to 8 bits (0-255) and converted to an audio signal (-1 to 1).",effect:"[L_quotation F_frequency] -> [L_graph]"},examples:[{code:`
# A simple bytebeat formula: t * 42
# In RPN, this is "t 42 *"
(t 42 *) 8000 bytebeat play`,assert:e=>Array.isArray(e[0])&&e[0][0]==="bytebeat",expectedDescription:"A bytebeat audio graph"},{code:`
# A classic formula: (t>>7|t|t>>6)*10+4*(t&t>>13|t>>6)
# This has to be broken down into RPN steps.
(
  # Part 1: (t>>7|t|t>>6)
  t 7 >> t | t 6 >> |
  
  # Part 2: *10
  10 *
  
  # Part 3: 4*(t&t>>13|t>>6)
  4 
  t t 13 >> &
  t 6 >>
  | *
  
  # Part 4: Add them together
  +
) 8000 bytebeat play`,assert:e=>e[0][0]==="bytebeat",expectedDescription:"A bytebeat audio graph from a complex formula."},{code:`
# Formula: t*(t&16384?6:5)*(3+(3&t>>(t&2048?7:14)))>>(3&t>>9)|t>>2
# Let's break it down.

(
  # 1. t
  t
  
  # 2. (t&16384 ? 6 : 5) -> RPN: t 16384 & (6) (5) ?
  t 16384 & (6) (5) ?
  
  # 3. Multiply 1 and 2
  *
  
  # 4. (3 + (3 & (t >> (t&2048?7:14))))
  # 4a. (t&2048?7:14) -> t 2048 & (7) (14) ?
  # 4b. t >> (4a) -> t (4a) >>
  # 4c. 3 & (4b) -> 3 (4b) &
  # 4d. 3 + (4c) -> 3 (4c) +
  3 t t 2048 & (7) (14) ? >> 3 swap & +

  # 5. Multiply 3 and 4
  *
  
  # 6. (3 & (t >> 9))
  3 t 9 >> &
  
  # 7. Right shift 5 by 6
  >>

  # 8. (t >> 2)
  t 2 >>
  
  # 9. Bitwise OR 7 and 8
  |
) 8000 bytebeat play
`,assert:e=>e[0][0]==="bytebeat",expectedDescription:"A bytebeat audio graph from a very complex formula."},{code:`
# Control pitch and rhythm with the mouse
(
  t mousex 100 / * # rhythm controlled by mousex
  t mousey 200 / *  # pitch controlled by mousey
  &
) 8000 bytebeat play`,assert:e=>Array.isArray(e[0])&&e[0][0]==="bytebeat",expectedDescription:"A bytebeat audio graph controlled by the mouse."}]},floatbeat={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!Array.isArray(i))throw e.push(i,o),new Error("floatbeat expects a quotation (list) containing a valid RPN expression.");if(typeof o!="number")throw e.push(i,o),new Error("floatbeat expects a frequency number.");try{const l=transpileJS(i);e.push(["floatbeat",l,o])}catch(l){throw new Error(`Error transpiling floatbeat quotation: ${l.message}`)}},description:"Floatbeat node. Consumes a quotation with an RPN expression and a frequency. The expression is transpiled to JS and evaluated for every audio sample. The integer variable 't' (time) is available inside the quotation. The float result is used directly as an audio sample and should be in the -1 to 1 range.",effect:"[L_quotation F_frequency] -> [L_graph]"},examples:[{code:"(t 44100 / 440 * 2 * 3.14159 * sin) 44100 floatbeat play",assert:e=>Array.isArray(e[0])&&e[0][0]==="floatbeat",expectedDescription:"A floatbeat audio graph"}]},tri={definition:{exec:function*(e){const o=e.pop();if(Array.isArray(o)){if(o.length===0){e.push(["mul",["triangle",0],0]);return}if(typeof o[0]=="string")e.push(["triangle",o]);else{const l=o.map(d=>["triangle",d]),u=l.slice(1).reduce((d,h)=>["mix",d,h],l[0]);e.push(u)}}else e.push(["triangle",o])},description:"Creates a triangle wave oscillator node. The frequency can be a number, a list of numbers (for a chord), or an audio graph for frequency modulation (FM).",effect:"[F_freq | [F1 F2...] | L_modulator_graph] -> [L_graph]"},examples:[{code:"440 tri",expected:[["triangle",440]]},{code:"(330 440) tri",assert:e=>{const o=e[0];return e.length===1&&Array.isArray(o)&&o[0]==="mix"&&o[1][0]==="triangle"&&o[1][1]===330&&o[2][0]==="triangle"&&o[2][1]===440},expectedDescription:"A mixed audio graph for a chord."}]},voices={definition:{exec:function*(e,o,i){const l=e.pop(),u=e.pop();if(!Array.isArray(l))throw new Error("voices expects a list of programs.");if(!Array.isArray(u))throw new Error("voices expects a clock signal graph.");const d=[];for(const h of l){const m=[];m.push(deepClone(u)),yield*i(h,m,o),d.push(...m)}e.push(...d)},description:"Applies a clock signal to multiple program quotations to generate multiple audio graphs (voices), leaving them on the stack.",effect:"[Clock [Prog1 Prog2 ...]] -> [Result1 Result2 ...]"},examples:[{code:"8 impulse ( (hh) (sd) (bd) ) voices",assert:e=>e.length===3&&e.every(o=>Array.isArray(o)),expectedDescription:"Three audio graphs on the stack"}]},isAudioGraph=e=>Array.isArray(e)&&typeof e[0]=="string",fm={definition:{exec:function*(e){const o=e.length>0?e[e.length-1]:void 0,i=e.length>1?e[e.length-2]:void 0;if(typeof o=="number"&&Array.isArray(i)){const v=e.pop(),w=e.pop(),D=e.pop(),O=e.pop();if(!Array.isArray(w)||w.length!==6)throw new Error("fm (complex) expects 6 operator definitions.");e.push(["fm_synth",O,D,w,v]);return}const l=e.pop(),u=e.pop(),d=e.pop(),h=e.pop(),m=e.pop();if(typeof l!="symbol"||typeof u!="symbol"||typeof d!="number"||typeof h!="number"||typeof m!="number"&&!isAudioGraph(m))throw e.push(m,h,d,u,l),new Error("Simple fm expects [carrier_freq(num|graph) mod_freq(num) mod_index(num) :carrier_wave(sym) :mod_wave(sym)]");const g=Symbol.keyFor(l),b=Symbol.keyFor(u);if(!g||!b)throw new Error("fm (simple): Invalid waveform symbols.");e.push(["fm_simple",m,h,d,b,g])},description:"A versatile FM synthesis operator that directly creates an audio graph node.\n- **Simple Mode**: `carrier_freq mod_freq mod_index :carrier_wave :mod_wave fm -> graph`. Creates a simple 2-operator FM graph.\n- **Complex Mode**: `gate baseFreq [op_defs] algo_id fm -> graph`. Creates a 6-operator DX7-style FM graph.",effect:"[...] -> [L_graph]"},examples:[{code:["# A patch that takes a carrier frequency and applies FM.","(220 400 :sine :sine fm) :bell =","# Play the patch at 440 Hz.","440 :bell play"],assert:e=>{const o=e[0];return e.length===1&&o[0]==="fm_simple"&&o[1]===440},expectedDescription:"An FM audio graph with a frequency as its carrier."},{code:[`# Define a percussive E-Piano patch quotation.
# This patch expects a [gate, freq_graph] on the stack from 'play'.
(
  ( # opDefs
    (99 1.00 0.01 0.2 0.0 0.1) # Op1
    (75 1.00 0.01 0.2 0.0 0.1) # Op2
    (90 1.00 0.01 0.8 0.0 0.2) # Op3 (Carrier)
    (85 14.0 0.01 0.2 0.0 0.1) # Op4
    (70 1.00 0.01 0.2 0.0 0.1) # Op5
    (88 1.00 0.01 0.5 0.0 0.2) # Op6 (Carrier)
  )
  5 fm
) :epiano =

# Play a C4 note using the patch.
60 note :epiano play`],assert:e=>e.length===1&&isAudioGraph(e[0])&&e[0][0]==="fm_synth",expectedDescription:"A single audio graph for one E-Piano note."}]},audio={name:"Audio",description:"Operators for audio synthesis and processing using the Web Audio API.",definitions:{ad,adsr,bd,bytebeat,ctrl,delay,distort,floatbeat,fm,hh,hpf,ht,hush,impulse,lpf,lt,mix,mt,mul,noise,note,pan,play,pulse,saw,sd,seq,sine,tri,voices}},march={definition:{exec:function*(e){const o=[];for(;e.length>0&&isMarchingObject(e[e.length-1]);)o.unshift(e.pop());if(o.length===0)throw new Error("march expects at least one SDF object on the stack.");let i;o.length>1?i=o.reduce((u,d)=>createMarchingObject("union","combinator",[u,d])):i=o[0];const l={type:"scene",graph:i,lights:[]};e.push(l)},description:"Collects all SDF objects from the stack, combines them with a union operation if there are multiple, and creates a single scene object.",effect:"[sdf1 sdf2...] -> [scene]"},examples:[{code:["1 sphere march"],assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="scene"},expectedDescription:"A shader object showing a sphere."}]},smoothmarch={definition:{exec:function*(e){const o=e.pop();if(typeof o!="number")throw new Error("smoothmarch expects a smoothness value on top of the stack.");const i=[];for(;e.length>0&&isMarchingObject(e[e.length-1]);)i.unshift(e.pop());if(i.length===0)throw new Error("smoothmarch expects at least one SDF object on the stack.");let l;i.length>1?l=i.reduce((d,h)=>createMarchingObject("smoothUnion","combinator",[d,h],{smoothness:o})):l=i[0];const u={type:"scene",graph:l,lights:[]};e.push(u)},description:"Collects all SDF objects from the stack, combines them with a smooth union, and creates a scene. The smoothness factor is popped from the top of the stack.",effect:"[sdf1 sdf2... F_smoothness] -> [scene]"},examples:[{code:"0.8 sphere 0.5 0 0 vec3 translate 0.8 sphere -0.5 0 0 vec3 translate 0.2 smoothmarch render",assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"}}]},glslLibrary={dot2:{code:"float dot2( in vec2 v ) { return dot(v,v); }",dependencies:[]},ndot:{code:"float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }",dependencies:[]},extrude:{code:`float extrude(float d2, float z, float h) {
    vec2 d = vec2(d2, abs(z) - h * 0.5);
    return min(max(d.x,d.y),0.0) + length(max(d,0.0));
}`,dependencies:[]},smax:{code:`float smax(float a, float b, float k) {
    float h = clamp(0.5 + 0.5 * (b - a) / k, 0.0, 1.0);
    return mix(a, b, h) - k * h * (1.0 - h);
}`,dependencies:[]},texture_dots:{code:`vec3 texture_dots(vec3 p, float scale) {
    vec3 p_scaled = p * scale;
    float d = length(fract(p_scaled) - 0.5);
    return vec3(step(0.25, d));
}`,dependencies:[]},texture_stripes:{code:`vec3 texture_stripes(vec3 p, float scale) {
    float stripes = sin((p.x + p.y + p.z) * scale * 5.0);
    return vec3(step(0.0, stripes));
}`,dependencies:[]},texture_checkers:{code:`vec3 texture_checkers(vec3 p, float scale) {
    vec3 p_scaled = floor(p * scale);
    float check = mod(p_scaled.x + p_scaled.y + p_scaled.z, 2.0);
    return vec3(check);
}`,dependencies:[]},snoise:{code:`vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }
vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }

float snoise(vec3 v) {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzz, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy;
    vec3 x3 = x0 - D.yyy;
    i = mod289(i);
    vec4 p = permute( permute( i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
        + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
        + i.x + vec4(0.0, i1.x, i2.x, 1.0 );
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2,p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );
}`,dependencies:[]},cnoise:{code:`float cnoise(vec3 p) { return snoise(p) * 0.5 + 0.5; }
float cnoise(vec2 p) { return snoise(vec3(p, 0.0)) * 0.5 + 0.5; }`,dependencies:["snoise"]},vector_snoise:{code:`vec3 vector_snoise(vec3 p) {
    return vec3(
        snoise(p),
        snoise(p + vec3(100.0, 24.5, 34.6)),
        snoise(p - vec3(54.2, 14.7, 78.1))
    );
}`,dependencies:["snoise"]},curl:{code:`vec3 curl(vec3 p) {
    const float e = 0.001;
    vec3 dx = vec3(e, 0.0, 0.0);
    vec3 dy = vec3(0.0, e, 0.0);
    vec3 dz = vec3(0.0, 0.0, e);

    vec3 n_y1 = vector_snoise(p + dy); vec3 n_y0 = vector_snoise(p - dy);
    vec3 n_z1 = vector_snoise(p + dz); vec3 n_z0 = vector_snoise(p - dz);
    vec3 n_x1 = vector_snoise(p + dx); vec3 n_x0 = vector_snoise(p - dx);
    
    float x = (n_y1.z - n_y0.z) - (n_z1.y - n_z0.y);
    float y = (n_z1.x - n_z0.x) - (n_x1.z - n_x0.z);
    float z = (n_x1.y - n_y0.y) - (n_y1.x - n_y0.y);
    
    vec3 curlVec = vec3(x, y, z) / (2.0 * e);
    return curlVec * 0.5 + 0.5;
}

vec3 curl(vec2 p) {
    const float e = 0.001;
    float n1 = snoise(vec3(p + vec2(0.0, e), 0.0));
    float n2 = snoise(vec3(p - vec2(0.0, e), 0.0));
    float n3 = snoise(vec3(p + vec2(e, 0.0), 0.0));
    float n4 = snoise(vec3(p - vec2(e, 0.0), 0.0));
    vec2 curl2d = vec2(n1 - n2, n4 - n3) / (2.0 * e);
    curl2d = curl2d * 0.5 + 0.5;
    return vec3(curl2d.x, curl2d.y, (curl2d.x + curl2d.y) * 0.5);
}`,dependencies:["vector_snoise","snoise"]},random:{code:`float random(vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}

float random(vec3 pos) {
    return fract(sin(dot(pos.xyz, vec3(12.9898, 78.233, 151.7182))) * 43758.5453123);
}`,dependencies:[]},random2:{code:`vec2 random2(vec2 st) {
    return vec2(random(st), random(st + vec2(1.23, 4.56)));
}`,dependencies:["random"]},worley:{code:`vec2 worley(vec2 p) {
    vec2 g = floor(p);
    vec2 f = fract(p);
    float jitter = (sin(u_time) * 0.5 + 0.5);

    float F1 = 8.0;
    float F2 = 8.0;

    for (int y = -1; y <= 1; y++) {
        for (int x = -1; x <= 1; x++) {
            vec2 lattice = vec2(x,y);
            vec2 offset = vec2(random(g + lattice)) * jitter;
            float d = distance(lattice + offset, f);
            if(d < F1) {
                F2 = F1;
                F1 = d;
            } else if(d < F2) {
                F2 = d;
            }
        }
    }
    return vec2(F1,F2);
}

vec2 worley(vec3 p) {
    vec3 g = floor(p);
    vec3 f = fract(p);
    float jitter = (sin(u_time) * 0.5 + 0.5);

    float F1 = 8.0;
    float F2 = 8.0;

    for (int z = -1; z <= 1; z++) {
        for (int y = -1; y <= 1; y++) {
            for (int x = -1; x <= 1; x++) {
                vec3 lattice = vec3(x,y,z);
                vec3 offset = vec3(random(g + lattice)) * jitter;
                float d = distance(lattice + offset, f);
                if(d < F1) {
                    F2 = F1;
                    F1 = d;
                } else if(d < F2) {
                    F2 = d;
                }
            }
        }
    }
    return vec2(F1,F2);
}`,dependencies:["random"]},voronoi:{code:`vec3 voronoi(vec2 uv, float time) {
    vec2 i_uv = floor(uv);
    vec2 f_uv = fract(uv);
    vec3 rta = vec3(0.0, 0.0, 10.0);
    for (int j=-1; j<=1; j++ ) {
        for (int i=-1; i<=1; i++ ) {
            vec2 neighbor = vec2(float(i),float(j));
            vec2 p_rand = random2(i_uv + neighbor);
            vec2 p = 0.5 + 0.5 * sin(time + 6.2831853 * p_rand);
            vec2 diff = neighbor + p - f_uv;
            float dist = length(diff);
            if ( dist < rta.z ) {
                rta.xy = p;
                rta.z = dist;
            }
        }
    }
    return rta;
}
vec3 voronoi(vec2 p)  { return voronoi(p, u_time); }
vec3 voronoi(vec3 p)  { return voronoi(p.xy, p.z); }`,dependencies:["random2"]},noise2d_val:{code:`float noise2d_val (in vec2 _st) {
    vec2 i = floor(_st);
    vec2 f = fract(_st);
    float a = random(i);
    float b = random(i + vec2(1.0, 0.0));
    float c = random(i + vec2(0.0, 1.0));
    float d = random(i + vec2(1.0, 1.0));
    vec2 u = f * f * (3.0 - 2.0 * f);
    return mix(a, b, u.x) +
            (c - a)* u.y * (1.0 - u.x) +
            (d - b) * u.x * u.y;
}`,dependencies:["random"]},fbm:{code:`float fbm(in vec2 _st) {
    float v = 0.0;
    float a = 0.5;
    vec2 shift = vec2(100.0);
    mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));
    for (int i = 0; i < 5; ++i) { // Unrolled loop for NUM_OCTAVES 5
        v += a * noise2d_val(_st);
        _st = rot * _st * 2.0 + shift;
        a *= 0.5;
    }
    return v;
}

float fbm(in vec3 _st) { // 3D version using existing snoise
    float v = 0.0;
    float a = 0.5;
    for (int i = 0; i < 5; ++i) {
        v += a * cnoise(_st);
        _st = _st * 2.0 + 100.0;
        a *= 0.5;
    }
    return v;
}`,dependencies:["noise2d_val","cnoise"]},cloud_color:{code:`vec3 cloud_color(vec3 p, float u_time, vec3 colorA, vec3 colorB) {
    vec2 st = p.xy * 3.0;
    vec3 color = vec3(0.0);
    vec2 q = vec2(0.);
    q.x = fbm( st + 0.00*u_time);
    q.y = fbm( st + vec2(1.0));
    vec2 r = vec2(0.);
    r.x = fbm( st + 1.0*q + vec2(1.7,9.2)+ 0.15*u_time );
    r.y = fbm( st + 1.0*q + vec2(8.3,2.8)+ 0.126*u_time);
    float f = fbm(st+r);
    color = mix(colorA, colorB, clamp((f*f)*4.0,0.0,1.0));
    color = mix(color, vec3(0,0,0.164706), clamp(length(q),0.0,1.0));
    color = mix(color, vec3(0.666667,1,1), clamp(length(r.x),0.0,1.0));
    return (f*f*f+.6*f*f+.5*f)*color;
}`,dependencies:["fbm"]},cart2polar:{code:`vec3 cart2polar(vec3 p) {
    float r = length(p);
    if (r < 0.0001) return vec3(0.0); // Guard against division by zero at the origin
    float theta = acos(p.z / r);
    float phi = atan(p.y, p.x);
    return vec3(r, theta, phi);
}`,dependencies:[]},mandelbulbSDF:{code:`vec2 mandelbulbSDF( in vec3 st ) {
   vec3 zeta = st;
   float m = dot(st,st);
   float dz = 1.0;
   float n = 8.0;
   const int maxiterations = 20;
   float iterations = 0.0;
   for (int i = 0; i < maxiterations; i+=1) {
       dz = n*pow(m, 3.5)*dz + 1.0;
       vec3 sphericalZ = cart2polar( zeta );
       float newx = pow(sphericalZ.x, n) * sin(sphericalZ.y*n) * cos(sphericalZ.z*n);
       float newy = pow(sphericalZ.x, n) * sin(sphericalZ.y*n) * sin(sphericalZ.z*n);
       float newz = pow(sphericalZ.x, n) * cos(sphericalZ.y*n);
       zeta.x = newx + st.x;
       zeta.y = newy + st.y;
       zeta.z = newz + st.z;
       m = dot(zeta, zeta);
       if ( m > 2.0 ) break;
   }
   return vec2(0.25*log(m) * sqrt(m) / dz, iterations);
}`,dependencies:["cart2polar"]},pow2:{code:"float pow2( float x ) { return x*x; }",dependencies:[]},juliaSDF:{code:`float juliaSDF( vec2 st, vec2 c, float r) {
    vec2 z = st * r;
    float n = 0.0;
    const int I = 50;
    for (int i = I; i > 0; i--) {
        if ( length(z) > 4.0 ) { n = float(i)/float(I); break; }
        z = vec2( (pow2(z.x) - pow2(z.y)) + c.x, (2.0*z.x*z.y) + c.y );
    }
    return n;
}`,dependencies:["pow2"]},mandelbrotSDF:{code:`float mandelbrotSDF( vec2 st, float r) {
    vec2 z = vec2(0.0);
    vec2 c = st * r;
    float n = 0.0;
    const int I = 50;
    for (int i = I; i > 0; i--) {
        if ( length(z) > 4.0 ) { n = float(i)/float(I); break; }
        z = vec2( (z.x*z.x - z.y*z.y) + c.x, (2.0*z.x*z.y) + c.y );
    }
    return n;
}`,dependencies:[]},sdFractal:{code:`float sdFractal(vec3 p, float iterations, float scale) {
    vec3 offset = p;
    vec3 z = p;
    float dr = 1.0;
    for (int i = 0; i < 256; i++) {
        if(float(i) >= iterations) break;
        // Box folding operation
        z = clamp(z, -1.0, 1.0) * 2.0 - z;
        // Spherical inversion
        float r2 = dot(z, z);
        if (r2 < 0.5) { // minRadius^2 = 0.5
            float temp = 1.0 / r2;
            z *= temp;
            dr *= temp;
        }
        z = z * scale + offset;
        dr = dr * abs(scale) + 1.0;
    }
    return length(z) / abs(dr);
}`,dependencies:[]},sdPsychobox:{code:`float sdPsychobox(vec3 p, float iterations) {
    p = fract(p) - 0.5;
    float s = 1.0;
    for (int i = 0; i < 128; i++) {
        if(float(i) >= iterations) break;
        float m = dot(p, p) * 0.7;
        if (m < 0.001) break;
        p /= m;
        s *= m;
        p.xy = fract(p.xy) - 0.5;
        p.xyz = p.yzx;
    }
    return (length(p) - 1.0) * s;
}`,dependencies:[]},hsv2rgb:{code:`vec3 hsv2rgb(vec3 c) {
    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}`,dependencies:[]},random_color:{code:`vec3 random_color(vec3 p) {
    vec3 p3  = fract(p * vec3(.1031, .1030, .0973));
    p3 += dot(p3, p3.yzx + 33.33);
    return fract((p3.xxy + p3.yzz)*p3.zyx);
}`,dependencies:[]},distEuclidean:{code:"float distEuclidean(vec2 a, vec2 b) { return distance(a, b); }",dependencies:[]},distManhattan:{code:"float distManhattan(vec2 a, vec2 b) { return abs(a.x - b.x) + abs(a.y - b.y); }",dependencies:[]},distChebychev:{code:"float distChebychev(vec2 a, vec2 b) { return max(abs(a.x - b.x), abs(a.y - b.y)); }",dependencies:[]},distMinkowski:{code:"float distMinkowski(vec2 a, vec2 b, float p) { return pow(pow(abs(a.x - b.x), p) + pow(abs(a.y - b.y), p), 1.0 / p); }",dependencies:[]},sdSphere:{code:"float sdSphere( vec3 p, float s ) { return length(p)-s; }",dependencies:[]},sdBox:{code:"float sdBox( vec3 p, vec3 b ) { vec3 q = abs(p) - b; return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0); }",dependencies:[]},sdRoundbox:{code:"float sdRoundbox( vec3 p, vec3 b, float r ) { vec3 q = abs(p) - b; return length(max(q,0.0)) - r; }",dependencies:[]},sdTorus:{code:"float sdTorus( vec3 p, vec2 t ) { vec2 q = vec2(length(p.xz)-t.x,p.y); return length(q)-t.y; }",dependencies:[]},sdTorus88:{code:"float sdTorus88( vec3 p, vec2 t ) { vec2 q = vec2(length(p.xz)-t.x,p.y); return max(abs(q.x),abs(q.y))-t.y; }",dependencies:[]},sdTorus82:{code:"float sdTorus82( vec3 p, vec2 t ) { vec2 q = vec2(length(p.xy)-t.x,p.z); return length(q)-t.y; }",dependencies:[]},sdPlane:{code:"float sdPlane(vec3 p, vec3 n, float h) { return dot(p, n) + h; }",dependencies:[]},sdCapsule:{code:"float sdCapsule( vec3 p, vec3 a, vec3 b, float r ) { vec3 pa = p - a, ba = b - a; float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 ); return length( pa - ba*h ) - r; }",dependencies:[]},sdCone:{code:"float sdCone( vec3 p, vec2 c ) { float q = length(p.xy); return dot(normalize(c), vec2(q, p.z)); }",dependencies:[]},sdCylinder:{code:"float sdCylinder( vec3 p, vec2 h ) { vec2 d = abs(vec2(length(p.xz),p.y)) - h; return min(max(d.x,d.y),0.0) + length(max(d,0.0)); }",dependencies:[]},sdHexprism:{code:"float sdHexprism( vec3 p, vec2 h ) { vec3 q = abs(p); return max(q.z-h.y,max((q.x*0.866025+q.y*0.5),q.y)-h.x); }",dependencies:[]},sdTriprism:{code:"float sdTriprism( vec3 p, vec2 h ) { vec3 q = abs(p); return max(q.z-h.y, max(q.x*0.866025+p.y*0.5,-p.y)-h.x*0.5); }",dependencies:[]},sdOctahedron:{code:"float sdOctahedron( vec3 p, float s) { p = abs(p); return (p.x+p.y+p.z-s)*0.57735027; }",dependencies:[]},sdMandelbox:{code:"float sdMandelbox(vec3 p, float scale, float iterations, float folding) { vec3 z=p; float dr=1.0; for(int n=0;n<int(iterations);n++){z=clamp(z,-folding,folding)*2.0-z;float r2=dot(z,z);if(r2<0.5){z*=1.0/r2;dr=dr/r2;}z=z*scale+p;dr=dr*abs(scale)+1.0;} return length(z)/abs(dr); }",dependencies:[]},sdMandelbulb:{code:"float sdMandelbulb(vec3 p) { return mandelbulbSDF(p).x; }",dependencies:["mandelbulbSDF"]},sdArc2d:{code:"float sdArc2d( in vec3 p_3d, in vec2 sc, in float ra, float rb ) { vec2 p = p_3d.xy; p.x = abs(p.x); vec2 p2 = (sc.y*p.x>sc.x*p.y) ? p : vec2( dot(p,sc), ndot(p,sc) ); float d2d = sign(p2.x)*length(p2-vec2(ra,0.0)) - rb; return extrude(d2d, p_3d.z, 0.1);}",dependencies:["extrude","ndot"]},sdBox2d:{code:"float sdBox2d(in vec3 p_3d, in vec2 b){vec2 p=p_3d.xy;vec2 d=abs(p)-b;float d2d=length(max(d,0.0))+min(max(d.x,d.y),0.0);return extrude(d2d,p_3d.z,0.1);}",dependencies:["extrude"]},sdCircle2d:{code:"float sdCircle2d(vec3 p_3d, float r){ float d2d = length(p_3d.xy)-r; return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdCross2d:{code:"float sdCross2d( in vec3 p_3d, in vec2 b, float r ) { vec2 p = p_3d.xy; p = abs(p); p = (p.y>p.x) ? p.yx : p; vec2 q = p - b; float k = max(q.y,q.x); vec2 w = (k>0.0) ? q : vec2(b.y-p.x,-k); float d2d = sign(k)*length(max(w,0.0)) + r; return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdEllipse2d:{code:"float sdEllipse2d( in vec3 p_3d, in vec2 ab ) { vec2 p = p_3d.xy; p = abs(p); if( p.x > p.y ) p=p.yx; float l = ab.y-ab.x; float m = (l*p.x + l*p.y)/ (l*l); float n = clamp( m, 0.0, 1.0 ); vec2 q = p - ab.x*normalize(mix(ab.yx,vec2(1.0,0.0),n)); float d2d = length(q) * sign(p.y-ab.y); return extrude(d2d, p_3d.z, 0.1);}",dependencies:["extrude"]},sdEquilateralTriangle2d:{code:"float sdEquilateralTriangle2d( in vec3 p_3d, float r ) { vec2 p = p_3d.xy; const float k = sqrt(3.0); p.x = abs(p.x) - r; p.y = p.y + r/k; if( p.x+k*p.y>0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0; p.x -= clamp( p.x, -2.0*r, 0.0 ); float d2d = -length(p)*sign(p.y); return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdHeart2d:{code:"float sdHeart2d( in vec3 p_3d ) { vec2 p = p_3d.xy; p.x = abs(p.x); float d2d; if( p.y+p.x>1.0 ) d2d = sqrt(dot2(p-vec2(0.25,0.75))) - sqrt(2.0)/4.0; else d2d = sqrt(min(dot2(p-vec2(0.00,1.00)), dot2(p-0.5*max(p.x+p.y,0.0)))) * sign(p.x-p.y); return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude","dot2"]},sdHexagon2d:{code:"float sdHexagon2d( in vec3 p_3d, float r ) { vec2 p = p_3d.xy; const vec3 k = vec3(-0.866025404,0.5,0.577350269); p = abs(p); p -= 2.0*min(dot(k.xy,p),0.0)*k.xy; p -= vec2(clamp(p.x, -k.z*r, k.z*r), r); float d2d = length(p)*sign(p.y); return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdHexagram2d:{code:"float sdHexagram2d( in vec3 p_3d, in float r ) { vec2 p = p_3d.xy; const vec4 k = vec4(-0.5,0.86602540,0.57735027,1.73205081); p = abs(p); p -= 2.0*min(dot(vec2(k.x,k.y),p),0.0)*vec2(k.x,k.y); p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y); p -= vec2(clamp(p.x,r*k.z,r*k.w),r); float d2d = length(p)*sign(p.y); return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdIsoscelesTriangle2d:{code:"float sdIsoscelesTriangle2d( in vec3 p_3d, in vec2 q ) { vec2 p = p_3d.xy; p.x = abs(p.x); vec2 a = p - q*clamp( dot(p,q)/dot(q,q), 0.0, 1.0 ); vec2 b = p - q*vec2( clamp( p.x/q.x, 0.0, 1.0 ), 1.0 ); float s = -sign( q.y ); vec2 d = min( vec2( dot(a,a), s*(p.x*q.y-p.y*q.x) ), vec2( dot(b,b), s*(p.y-q.y)  )); float d2d = -sqrt(d.x)*sign(d.y); return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdMoon2d:{code:"float sdMoon2d( vec3 p_3d, float d, float ra, float rb ) { vec2 p = p_3d.xy; p.y = abs(p.y); float a = (ra*ra - rb*rb + d*d)/(2.0*d); float b = sqrt(max(ra*ra-a*a,0.0)); float d2d; if( d*(p.x*b-p.y*a) > d*d*max(b-p.y,0.0) ) d2d = length(p-vec2(a,b)); else d2d = max( length(p)-ra, -length(p-vec2(d,0))+rb ); return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdNgon2d:{code:"float sdNgon2d( in vec3 p_3d, in float r, in float n) { vec2 p = p_3d.xy; float an = 3.141593/n; vec2  acs = vec2(cos(an),sin(an)); float bn = mod(atan(p.y,p.x),2.0*an) - an; p = length(p)*vec2(cos(bn),abs(sin(bn))); p -= r*acs; p.y += clamp(-p.y, 0.0, r*acs.y); float d2d = length(p)*sign(p.x); return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdOctogon2d:{code:"float sdOctogon2d( in vec3 p_3d, in float r ) { vec2 p = p_3d.xy; const vec3 k = vec3(-0.92387953, 0.38268343, 0.41421356); p = abs(p); p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y); p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y); p -= vec2(clamp(p.x,-k.z*r,k.z*r),r); float d2d = length(p)*sign(p.y); return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdParallelogram2d:{code:"float sdParallelogram2d( in vec3 p_3d, float wi, float he, float sk ) { vec2 p = p_3d.xy; vec2 e = vec2(sk,he); p = (p.y<0.0)?-p:p; vec2 q = p - e*clamp(dot(p,e)/dot(e,e),0.0,1.0); q -= vec2(clamp(q.x,-wi,wi),0.0); float d2d = length(q)*sign(p.y); return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdPentagon2d:{code:"float sdPentagon2d( in vec3 p_3d, in float r ) { vec2 p = p_3d.xy; const vec3 k = vec3(0.80901699, 0.58778525, 0.72654253); p.x = abs(p.x); p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y); p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y); p -= vec2(clamp(p.x,-r*k.z,r*k.z),r); float d2d = length(p)*sign(p.y); return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdPie2d:{code:"float sdPie2d( in vec3 p_3d, in vec2 c, in float r ){ vec2 p = p_3d.xy; p.x = abs(p.x); float l = length(p) - r; float m = length(p-c*clamp(dot(p,c),0.0,r)); float d2d = max(l,m*sign(c.y*p.x-c.x*p.y)); return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdRhombus2d:{code:"float sdRhombus2d( in vec3 p_3d, in vec2 b ) { vec2 p = p_3d.xy; p=abs(p); float h = clamp( (-2.0*ndot(p,b) + ndot(b,b))/dot(b,b), -1.0, 1.0 ); vec2 d = p - 0.5*b*vec2(1.0-h,1.0+h); float d2d = length(d)*sign( p.x*b.y + p.y*b.x - b.x*b.y ); return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude","ndot"]},sdRoundedbox2d:{code:"float sdRoundedbox2d( in vec3 p_3d, in vec2 b, in vec4 r ) { vec2 p = p_3d.xy; r.xy = (p.x>0.0)?r.xy : r.zw; r.x  = (p.y>0.0)?r.x  : r.y; vec2 q = abs(p)-b+r.x; float d2d = min(max(q.x,q.y),0.0) + length(max(q,0.0)) - r.x; return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdRoundedx2d:{code:"float sdRoundedx2d( in vec3 p_3d, in float w, in float r ) { vec2 p = p_3d.xy; p = abs(p); float d2d = length(p-min(p.x+p.y,w)*0.5) - r; return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},sdSegment2d:{code:"float sdSegment2d(in vec3 p_3d, in vec2 a, in vec2 b){vec2 p=p_3d.xy;vec2 pa=p-a,ba=b-a;float h=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);float d2d=length(pa-ba*h);return extrude(d2d,p_3d.z,0.1);}",dependencies:["extrude"]},sdStar2d:{code:"float sdStar2d(in vec3 p_3d, in float r, in float n, in float m) { vec2 p = p_3d.xy; float an = 3.141593/n; float en = 3.141593/m; vec2  acs = vec2(cos(an),sin(an)); vec2  ecs = vec2(cos(en),sin(en)); float bn = mod(atan(p.x,-p.y),2.0*an) - an; p = length(p)*vec2(cos(bn),abs(sin(bn))); p -= r*acs; p += ecs*clamp( -dot(p,ecs), 0.0, r*acs.y/ecs.y); float d2d = length(p)*sign(p.x); return extrude(d2d, p_3d.z, 0.1);}",dependencies:["extrude"]},sdTrapezoid2d:{code:"float sdTrapezoid2d( in vec3 p_3d, float r1, float r2, float he ) { vec2 p = p_3d.xy; vec2 k1 = vec2(r2,he); vec2 k2 = vec2(r2-r1,2.0*he); p.x = abs(p.x); vec2 ca = vec2(p.x-min(p.x,(p.y<0.0)?r1:r2), abs(p.y)-he); vec2 cb = p - k1 + k2*clamp( dot(k1-p,k2)/dot2(k2), 0.0, 1.0 ); float s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0; float d2d = s*sqrt( min(dot2(ca),dot2(cb)) ); return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude","dot2"]},sdTriangle2d:{code:"float sdTriangle2d( in vec3 p_3d, in vec2 p0, in vec2 p1, in vec2 p2 ) { vec2 p = p_3d.xy; vec2 e0 = p1-p0, e1 = p2-p1, e2 = p0-p2; vec2 v0 = p -p0, v1 = p -p1, v2 = p -p2; vec2 pq0 = v0 - e0*clamp( dot(v0,e0)/dot(e0,e0), 0.0, 1.0 ); vec2 pq1 = v1 - e1*clamp( dot(v1,e1)/dot(e1,e1), 0.0, 1.0 ); vec2 pq2 = v2 - e2*clamp( dot(v2,e2)/dot(e2,e2), 0.0, 1.0 ); float s = sign( e0.x*e2.y - e0.y*e2.x ); float d2d = sqrt(min(min(dot2(pq0),dot2(pq1)),dot2(pq2))) * s; return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude","dot2"]},sdVesica2d:{code:"float sdVesica2d( vec3 p_3d, float w, float h ) { vec2 p = p_3d.xy; p = abs(p); float b = sqrt(w*w-h*h); float d2d = ((p.y-h)*b>p.x*h) ? length(p-vec2(0.0,h)) : length(p-vec2(-b,0))-w; return extrude(d2d, p_3d.z, 0.1); }",dependencies:["extrude"]},opU:{code:"vec2 opU( vec2 d1, vec2 d2 ) { return (d1.x<d2.x) ? d1 : d2; }",dependencies:[]},opS:{code:"vec2 opS( vec2 d1, vec2 d2, float k ) { float h = clamp(0.5+0.5*(d2.x-d1.x)/k,0.0,1.0); float d=mix(d2.x,d1.x,h)-k*h*(1.0-h); float m=mix(d2.y, d1.y,h); return vec2(d, m); }",dependencies:[]},opD:{code:"vec2 opD( vec2 d1, vec2 d2 ) { return (d1.x>-d2.x) ? d1 : vec2(-d2.x, d2.y); }",dependencies:[]},opI:{code:"vec2 opI( vec2 d1, vec2 d2 ) { return (d1.x>d2.x) ? d1 : d2; }",dependencies:[]},opXor:{code:"vec2 opXor(vec2 d1, vec2 d2) { float d=max(min(d1.x,d2.x),-max(d1.x,d2.x)); return vec2(d,(d1.x<d2.x)?d1.y:d2.y);}",dependencies:[]},opSS:{code:"vec2 opSS(vec2 d1,vec2 d2,float k){float h=clamp(0.5-0.5*(d2.x+d1.x)/k,0.0,1.0);float d=mix(d2.x,-d1.x,h)+k*h*(1.0-h);float m=mix(d2.y,d1.y,h);return vec2(d,m);}",dependencies:[]},opSI:{code:"vec2 opSI(vec2 d1,vec2 d2,float k){float h=clamp(0.5-0.5*(d2.x-d1.x)/k,0.0,1.0);float d=mix(d2.x,d1.x,h)+k*h*(1.0-h);float m=mix(d2.y,d1.y,h);return vec2(d,m);}",dependencies:[]},opRound:{code:"vec2 opRound(vec2 d, float r) { return vec2(d.x - r, d.y); }",dependencies:[]},opPipe:{code:"vec2 opPipe(vec2 d1, vec2 d2, float r) { return vec2(length(vec2(d1.x, d2.x)) - r, opU(d1, d2).y); }",dependencies:["opU"]},opEngrave:{code:"vec2 opEngrave(vec2 d1, vec2 d2, float r) { return vec2(max(d1.x, d2.x - r), opU(d1, d2).y); }",dependencies:["opU"]},opGroove:{code:"vec2 opGroove(vec2 d1, vec2 d2, float r) { return vec2(max(d1.x, min(d2.x, -d2.x + r)), opU(d1, d2).y); }",dependencies:["opU"]},opTongue:{code:"vec2 opTongue(vec2 d1, vec2 d2, float r) { return vec2(min(d1.x, max(d2.x, -d2.x + r)), opU(d1, d2).y); }",dependencies:["opU"]},opStairs:{code:"vec2 opStairs( vec2 d1, vec2 d2, float r, float n ) { float s=r/n; float u=d2.x-r; return opU(d1,vec2(min(d2.x,0.5*(u+d1.x+abs(mod(u-d1.x,2.0*s)-s))),d2.y));}",dependencies:["opU"]},opTx:{code:"vec3 opTx( vec3 p, vec3 t ) { return p-t; }",dependencies:[]},opElongate:{code:"vec3 opElongate( vec3 p, vec3 h ) { return p - clamp( p, -h, h ); }",dependencies:[]},rotationMatrix:{code:"mat3 rotationMatrix(vec3 axis, float angle) { axis = normalize(axis); float s=sin(angle); float c=cos(angle); float oc=1.0-c; return mat3(oc*axis.x*axis.x+c,oc*axis.x*axis.y-axis.z*s,oc*axis.z*axis.x+axis.y*s, oc*axis.x*axis.y+axis.z*s,oc*axis.y*axis.y+c,oc*axis.y*axis.z-axis.x*s, oc*axis.z*axis.x-axis.y*s,oc*axis.y*axis.z+axis.x*s,oc*axis.z*axis.z+c); }",dependencies:[]},opRot:{code:"vec3 opRot( vec3 p, vec3 axis, float angle) { return inverse(rotationMatrix(axis, angle)) * p; }",dependencies:["rotationMatrix"]},opRep:{code:"vec3 opRep( vec3 p, vec3 spacing ) { return mod(p,spacing)-0.5*spacing; }",dependencies:[]},opMirrorRepeat:{code:"vec3 opMirrorRepeat(vec3 p, vec3 s){vec3 id=round(p/s);vec3 r=p-s*id;if(mod(id.x,2.)>0.5)r.x=-r.x;if(mod(id.y,2.)>0.5)r.y=-r.y;if(mod(id.z,2.)>0.5)r.z=-r.z;return r;}",dependencies:[]},opLimitedRepeat:{code:"vec3 opLimitedRepeat(vec3 p,vec3 s,vec3 l){return p-s*clamp(round(p/s),-l,l);}",dependencies:[]},opRectangularRepeat:{code:"vec3 opRectangularRepeat(vec3 p,vec2 s,float spacing){vec2 q=p.xy;q=abs(q/spacing)-(s*0.5-0.5);if(q.x<q.y)q=q.yx;q.y-=min(0.,round(q.y));p.xy=q*spacing;return p;}",dependencies:[]},opTwist:{code:"vec3 opTwist(vec3 p,float k){float c=cos(k*p.y);float s=sin(k*p.y);mat2 m=mat2(c,-s,s,c);vec3 q=vec3(m*p.xz,p.y);return q;}",dependencies:[]},opBend:{code:"vec3 opBend(vec3 p,float k){float c=cos(k*p.x);float s=sin(k*p.x);mat2 m=mat2(c,-s,s,c);vec3 q=vec3(m*p.xy,p.z);return q;}",dependencies:[]},opMirror:{code:"vec3 opMirror( vec3 p ){ return abs(p); }",dependencies:[]},opMirrorX:{code:"vec3 opMirrorX(vec3 p) { p.x = abs(p.x); return p; }",dependencies:[]},opMirrorY:{code:"vec3 opMirrorY(vec3 p) { p.y = abs(p.y); return p; }",dependencies:[]},opMirrorZ:{code:"vec3 opMirrorZ(vec3 p) { p.z = abs(p.z); return p; }",dependencies:[]},opOnion:{code:"vec2 opOnion(vec2 d, float thickness) { return vec2(abs(d.x) - thickness, d.y); }",dependencies:[]},opHalve:{code:"vec2 opHalve(vec2 d, vec3 p, float dir) { float ps=0.;if(dir==0.)ps=p.y;else if(dir==1.)ps=-p.y;else if(dir==2.)ps=-p.x;else if(dir==3.)ps=p.x;return vec2(max(d.x,ps),d.y);}",dependencies:[]},getNormal:{code:"vec3 getNormal(vec3 p){vec2 e=vec2(.001,0.);return normalize(vec3(map(p+e.xyy).x-map(p-e.xyy).x,map(p+e.yxy).x-map(p-e.yxy).x,map(p+e.yyx).x-map(p-e.yyx).x));}",dependencies:[]},calcSoftshadow:{code:"float calcSoftshadow(in vec3 ro,in vec3 rd,float k){float res=1.;float t=.01;for(int i=0;i<32;i++){float h=map(ro+rd*t).x;if(h<.001)return 0.;res=min(res,k*h/t);t+=h;}return res;}",dependencies:[]},post_invert:{code:"vec3 post_invert(vec3 c, vec2 uv) { return 1.0 - c; }",dependencies:[]},post_brightness:{code:"vec3 post_brightness(vec3 c, vec2 uv, float amount) { return c + amount; }",dependencies:[]},post_contrast:{code:"vec3 post_contrast(vec3 c, vec2 uv, float amount) { return (c - 0.5) * amount + 0.5; }",dependencies:[]},post_edge:{code:"vec3 post_edge(vec3 c, vec2 uv) { vec3 dx = dFdx(c); vec3 dy = dFdy(c); float edge = length(vec3(length(dx), length(dy), 0.0)); return vec3(smoothstep(0.01, 0.05, edge)); }",dependencies:[]}},getTopologicallySortedNames=e=>{const o=[],i=new Set,l=new Set,u=d=>{if(i.has(d))return;if(l.has(d)){console.warn(`Circular dependency detected in GLSL library: ${d}`);return}const h=glslLibrary[d];h&&(l.add(d),h.dependencies.forEach(m=>u(m)),l.delete(d),i.add(d),o.push(d))};return Array.from(e).sort().forEach(u),o},getTransitiveDependencies=e=>{const o=new Set,i=[...e];for(;i.length>0;){const l=i.pop();if(o.has(l))continue;o.add(l);const u=glslLibrary[l];u&&i.push(...u.dependencies)}return o},scanExpressionForDependencies=(e,o)=>{if(e)for(const i in glslLibrary)new RegExp(`\\b${i}\\b`).test(e)&&o.add(i)},resolveDependencies=e=>getTopologicallySortedNames(e).map(o=>{var i;return(i=glslLibrary[o])==null?void 0:i.code}).filter(Boolean).join(`

`),buildNodeList=e=>{const o=[],i=new Set,l=u=>{!u||i.has(u)||(i.add(u),u.children.forEach(l),o.push(u))};return l(e),o},combinatorOpToGLSLFunc={union:"opU",difference:"opD",intersection:"opI",xor:"opXor",smoothUnion:"opS",smoothDifference:"opSS",smoothIntersection:"opSI",pipe:"opPipe",engrave:"opEngrave",groove:"opGroove",tongue:"opTongue",stairsUnion:"opStairs",stairsIntersection:"opStairs",stairsDifference:"opStairs"},transformationOpToGLSLFunc={translate:"opTx",rotate:"opRot",repeat:"opRep",mirrorRepeat:"opMirrorRepeat",limitedRepeat:"opLimitedRepeat",rectangularRepeat:"opRectangularRepeat",mirror:"opMirror",mirrorX:"opMirrorX",mirrorY:"opMirrorY",mirrorZ:"opMirrorZ",bend:"opBend",twist:"opTwist",elongate:"opElongate"},sdfParamOrder={sdPlane:["normal","distance"],sdCapsule:["start","end","radius"],sdRoundbox:["size","radius"],sdCone:["dimensions"],sdCylinder:["dimensions"],sdHexprism:["dimensions"],sdTriprism:["dimensions"],sdTorus:["radii"],sdTorus82:["radii"],sdTorus88:["radii"],sdMandelbox:["scale","iterations","folding"],sdPathSDF:["radius"],sdArc2d:["sc","ra","rb"],sdBox2d:["size"],sdCircle2d:["radius"],sdCross2d:["size","radius"],sdEllipse2d:["size"],sdEquilateralTriangle2d:["radius"],sdHeart2d:[],sdHexagon2d:["radius"],sdHexagram2d:["radius"],sdIsoscelesTriangle2d:["size"],sdMoon2d:["d","ra","rb"],sdOctogon2d:["radius"],sdParallelogram2d:["width","height","skew"],sdPentagon2d:["radius"],sdPie2d:["c","radius"],sdRhombus2d:["size"],sdRoundedbox2d:["size","radii"],sdRoundedx2d:["width","radius"],sdSegment2d:["a","b"],sdStar2d:["radius","n","m"],sdTrapezoid2d:["r1","r2","height"],sdTriangle2d:["p0","p1","p2"],sdVesica2d:["width","height"],sdNgon2d:["radius","n"]},transformationOpParamOrder={rotate:["axis","angle"],scale:["amount"],translate:["amount"],repeat:["spacing"],mirrorRepeat:["spacing"],limitedRepeat:["spacing","limits"],rectangularRepeat:["size","spacing"],bend:["amount"],twist:["amount"],elongate:["h"]},processProps=(e,o,i)=>{const l=o?o.map(u=>e[u]):Object.values(e);return l.forEach(u=>{(u==null?void 0:u.type)==="glsl_expression"&&scanExpressionForDependencies(u.code,i)}),l.map(toGLSL).join(", ")};function buildSDFShaderParts(e){const o=buildNodeList(e),i=new Map(o.map((w,D)=>[w,D])),l=new Set,u=[],d=[],h=o.map((w,D)=>{const O=w.material;if((O==null?void 0:O.type)==="image_material"){l.add("getNormal");const N=`image_material_${D+1}`,C=transpileGLSL(O.quotation);return scanExpressionForDependencies(C,l),d.push(`
vec4 ${N}(vec3 p, vec2 uv) {
    // p, t, etc are available here from the transpiler's special vars
    return ${C};
}`),`
    if (matId == ${D+1}) {
        vec3 n = abs(getNormal(p));
        n /= dot(n, vec3(1.0));
        vec4 color = vec4(0.0);
        color += ${N}(p, p.yz) * n.x;
        color += ${N}(p, p.xz) * n.y;
        color += ${N}(p, p.xy) * n.z;
        return color.xyz;
    }`}const k=toGLSL(O);return scanExpressionForDependencies(k,l),k?`if (matId == ${D+1}) return ${k};`:`if (matId == ${D+1}) return vec3(0.8);`}).join(`
    `),m=`
${d.join(`
`)}

vec3 getMaterialColor(int matId, float u_time, vec3 p) {
    if (matId == 0) return vec3(0.8);
    ${h}
    return vec3(0.8);
}`,g=o.map((w,D)=>{const O=w.children.map(N=>i.get(N));let k="";switch(w.type){case"geometry":{const C=`sd${w.op.charAt(0).toUpperCase()+w.op.slice(1)}`;if(C==="sdPathSDF"){const Y=w.props.path;if(Y&&Y.type==="glsl_expression"){scanExpressionForDependencies(Y.code,l);const W=Y.code.replace(/u_time/g,"t");u.some(P=>P.startsWith("vec3 path(float t)"))||u.push(`vec3 path(float t) { return ${W}; }`),u.some(P=>P.startsWith("float sdPathSDF"))||u.push("float sdPathSDF(vec3 p, float r) { vec3 path_pos = path(p.z); return length(p.xy - path_pos.xy) - r; }")}}else l.add(C);w.op.endsWith("2d")&&l.add("extrude");const V=sdfParamOrder[C],U=processProps(w.props,V,l);k=`return vec2(${C}(p${U?", "+U:""}), ${toGLSL(D+1)});`;break}case"combinator":{const N=combinatorOpToGLSLFunc[w.op];N&&l.add(N),(w.op.startsWith("round")||w.op.startsWith("chamfer"))&&(l.add("opRound"),l.add(combinatorOpToGLSLFunc[w.op.replace("round","").replace("chamfer","").toLowerCase()]||"opU"));const C=processProps(w.props,void 0,l),V=`map_${O[0]}(p)`,U=`map_${O[1]}(p)`;let Y;switch(w.op){case"union":Y=`opU(${V}, ${U})`;break;case"difference":Y=`opD(${V}, ${U})`;break;case"intersection":Y=`opI(${V}, ${U})`;break;case"xor":Y=`opXor(${V}, ${U})`;break;case"smoothUnion":Y=`opS(${V}, ${U}, ${C})`;break;case"smoothDifference":Y=`opSS(${V}, ${U}, ${C})`;break;case"smoothIntersection":Y=`opSI(${V}, ${U}, ${C})`;break;case"roundUnion":case"chamferUnion":Y=`opRound(opU(${V}, ${U}), ${C})`;break;case"roundIntersection":case"chamferIntersection":Y=`opRound(opI(${V}, ${U}), ${C})`;break;case"roundDifference":case"chamferDifference":Y=`opRound(opD(${V}, ${U}), ${C})`;break;case"pipe":Y=`opPipe(${V}, ${U}, ${C})`;break;case"engrave":Y=`opEngrave(${V}, ${U}, ${C})`;break;case"groove":Y=`opGroove(${V}, ${U}, ${C})`;break;case"tongue":Y=`opTongue(${V}, ${U}, ${C})`;break;case"stairsUnion":case"stairsIntersection":case"stairsDifference":Y=`opStairs(${V}, ${U}, ${C})`;break;default:Y=`opU(${V}, ${U})`;break}k=`return ${Y};`;break}case"transformation":{if(w.op==="transform"){const U=w.props.matrix;(U==null?void 0:U.type)==="glsl_expression"&&scanExpressionForDependencies(U.code,l);const Y=toGLSL(U);let W=!1;(U==null?void 0:U.type)==="glsl_expression"?W=U.returnType==="mat3":isMatrix(U)&&(W=U.length===3);const P=W?`inverse(${Y}) * p`:`(inverse(${Y}) * vec4(p, 1.0)).xyz`;k=`return map_${O[0]}(${P});`;break}if(w.op==="polarRepeat"){const U=toGLSL(w.props.count);scanExpressionForDependencies(U,l);const Y=O[0];k=`
                        float angle = 6.2831853 / ${U};
                        float a = atan(p.y, p.x);
                        float r = length(p.xy);
                        a = mod(a + angle*0.5, angle) - angle*0.5;
                        vec3 p_rep = vec3(r * cos(a), r * sin(a), p.z);
                        return map_${Y}(p_rep);
                    `;break}const N=transformationOpToGLSLFunc[w.op];N&&l.add(N);const C=processProps(w.props,transformationOpParamOrder[w.op],l);if(w.op==="scale"){k=`vec2 res = map_${O[0]}(p / ${C}); res.x *= ${C}; return res;`;break}const V=`${N}(p${C?", "+C:""})`;k=`return map_${O[0]}(${V});`;break}case"alteration":{const N=`op${w.op.charAt(0).toUpperCase()+w.op.slice(1)}`;glslLibrary[N]&&l.add(N);const C=processProps(w.props,void 0,l);let V=`map_${O[0]}(p)`;w.op==="halve"?k=`return ${N}(${V}, p${C?", "+C:""});`:w.op==="displace"?k=`vec2 res = ${V}; res.x += ${C}; return res;`:k=`return ${N}(${V}${C?", "+C:""});`;break}}return`vec2 map_${D}(vec3 p) { ${k} }`}).join(`
`),b=[...u,g].join(`

`),v=`vec2 map(vec3 p) { return map_${o.length-1}(p); }`;return{materialFunction:m,mapFunctions:b,mainMapFunction:v,directDeps:l}}const generateImageShaderFromQuotation=e=>{const o=new Set,i=transpileGLSL(e);return scanExpressionForDependencies(i,o),`#version 300 es
precision highp float;
uniform vec2 u_resolution;
uniform float u_time;
uniform vec2 u_mouse;
uniform vec3 u_moused;
out vec4 fragColor;

${resolveDependencies(o)}

void main() {
    vec2 p_coord = gl_FragCoord.xy;
    vec2 uv = p_coord / u_resolution.xy;
    fragColor = ${i};
}
`},generate2dSDFShader=e=>{const{materialFunction:o,mapFunctions:i,mainMapFunction:l,directDeps:u}=buildSDFShaderParts(e);return`#version 300 es
precision highp float;
uniform vec2 u_resolution;
uniform float u_time;
uniform vec2 u_mouse;
uniform vec3 u_moused;
out vec4 fragColor;

vec2 map(vec3 p);

${resolveDependencies(u)}

${o}

${i}

${l}


void main() {
    vec2 st = (2.0 * gl_FragCoord.xy - u_resolution.xy) / u_resolution.y;
    vec3 p = vec3(st * (5.0 / 1.5), 0.0); // Scale to match the default 3D camera's perspective at z=0

    vec2 res = map(p);
    float dist = res.x;
    float matId = res.y;

    vec3 color = getMaterialColor(int(matId), u_time, p);
    
    // Antialiased fill
    float fill = 1.0 - smoothstep(0.0, 2.0 / u_resolution.y, dist);

    // Optional outline
    float outline = smoothstep(0.0, 4.0 / u_resolution.y, abs(dist)) - fill;

    vec3 finalColor = color * fill + vec3(0.2) * outline;

    fragColor = vec4(finalColor, 1.0);
}
    
`},generateMarchingShader=(e,o)=>{var Y,W,P,F,H,ee,Q,te,ae;const{materialFunction:i,mapFunctions:l,mainMapFunction:u,directDeps:d}=buildSDFShaderParts(e.graph),h=((Y=e.renderParams)==null?void 0:Y.iterations)??o*10,m=((W=e.renderParams)==null?void 0:W.near)??.001,g=((P=e.renderParams)==null?void 0:P.far)??100;scanExpressionForDependencies(toGLSL((F=e.camera)==null?void 0:F.pos),d),scanExpressionForDependencies(toGLSL((H=e.camera)==null?void 0:H.target),d),e.lights.forEach(K=>{scanExpressionForDependencies(toGLSL(K.pos),d),scanExpressionForDependencies(toGLSL(K.color),d)}),scanExpressionForDependencies(toGLSL(e.background),d),scanExpressionForDependencies(toGLSL((ee=e.fog)==null?void 0:ee.color),d),scanExpressionForDependencies(toGLSL((Q=e.fog)==null?void 0:Q.strength),d);const b=new Set;e.lights.length>0&&b.add("getNormal"),e.shadow&&b.add("calcSoftshadow"),e.post&&e.post.length>0&&e.post.forEach(K=>d.add(`post_${K.op}`));const v=getTransitiveDependencies(b),w=new Set;for(const K of d)v.has(K)||w.add(K);const D=resolveDependencies(w),O=resolveDependencies(v),k=(te=e.camera)!=null&&te.pos?toGLSL(e.camera.pos):"vec3(0.0, 0.0, 5.0)",N=(ae=e.camera)!=null&&ae.target?toGLSL(e.camera.target):"vec3(0.0, 0.0, 0.0)";let C=e.lights.map((K,I)=>`
        vec3 lightPos_${I} = ${toGLSL(K.pos)||"vec3(2.0, 2.0, 5.0)"};
        vec3 lightColor_${I} = ${toGLSL(K.color)||"vec3(1.0)"};
        float lightAtten_${I} = ${toGLSL(K.attenuation)||"0.1"};
    `).join(""),V=e.lights.map((K,I)=>`
        {
            vec3 lightDir = normalize(lightPos_${I} - p);
            float dif = max(dot(nor, lightDir), 0.0);
            float spe = pow(max(dot(reflect(-rd, nor), lightDir), 0.0), 32.0);
            
            float shadowFactor = 1.0;
            ${e.shadow?`shadowFactor = calcSoftshadow(p + nor * 0.001, lightDir, ${toGLSL(e.shadow.diffuseness)});`:""}

            float dist = length(lightPos_${I} - p);
            float atten = 1.0 / (1.0 + dist * dist * lightAtten_${I});
            
            totalColor += (dif * matColor * shadowFactor + vec3(spe * 0.5)) * lightColor_${I} * atten;
        }
    `).join("")||"totalColor = matColor * 0.5;",U="";return e.post&&e.post.length>0&&(U=`
    vec3 finalColor = col;
    ${e.post.map(K=>{const I=processProps(K.props,void 0,d);return`finalColor = post_${K.op}(finalColor, st${I?", "+I:""});`}).join(`
    `)}
        `),`#version 300 es
precision highp float;

uniform vec2 u_resolution;
uniform float u_time;
uniform vec2 u_mouse;
uniform vec3 u_moused;

out vec4 fragColor;

vec2 map(vec3 p);

${D}

// Material Definitions
${i}

// Scene Definition
${l}
${u}

${O}

vec3 render(vec3 ro, vec3 rd, float u_time) {
    float t = 0.0;
    vec3 col = ${toGLSL(e.background)||"vec3(0.0)"};
    
    for (int i = 0; i < ${Math.floor(h)}; i++) {
        vec3 p = ro + rd * t;
        vec2 d = map(p);
        
        if (d.x < ${toGLSL(m)}) {
            vec3 nor = vec3(0.0);
            ${e.lights.length>0?"nor = getNormal(p);":""}
            vec3 matColor = getMaterialColor(int(d.y), u_time, p);
            vec3 totalColor = vec3(0.0);
            
            ${C}
            ${V}

            col = totalColor;
            break;
        }
        
        if (t > ${toGLSL(g)}) {
            break;
        }
        t += d.x;
    }

    ${e.fog?`
        float fogAmount = 1.0 - exp(-t * (${toGLSL(e.fog.strength)||"0.1"}));
        col = mix(col, ${toGLSL(e.fog.color)||"vec3(0.5)"}, fogAmount);
    `:""}

    return col;
}

void main() {
    vec2 st = (2.0 * gl_FragCoord.xy - u_resolution.xy) / u_resolution.y;
    
    vec3 ro = ${k};
    vec3 ta = ${N};
    
    vec3 ww = normalize(ta - ro);
    vec3 uu = normalize(cross(ww, vec3(0.0, 1.0, 0.0)));
    vec3 vv = cross(uu, ww);
    vec3 rd = normalize(st.x * uu + st.y * vv + 1.5 * ww);
    
    vec3 col = render(ro, rd, u_time);

    ${U}
    
    fragColor = vec4(${e.post&&e.post.length>0?"finalColor":"col"}, 1.0);
}
`};function generatePathShader(e,o,i){var V,U,Y;const{materialFunction:l,mapFunctions:u,mainMapFunction:d,directDeps:h}=buildSDFShaderParts(e.graph);scanExpressionForDependencies(o.code,h),h.add("opSS");const g=getTransitiveDependencies(new Set),b=new Set;for(const W of h)g.has(W)||b.add(W);const v=resolveDependencies(b),w=resolveDependencies(g),D=o.code.replace(/u_time/g,"t"),O=((V=e.renderParams)==null?void 0:V.iterations)??128,k=((U=e.renderParams)==null?void 0:U.near)??.001,N=((Y=e.renderParams)==null?void 0:Y.far)??50;let C="vec3 rd = normalize(uv.x * uu + uv.y * vv + 1.5 * ww);";return i&&(scanExpressionForDependencies(i.code,h),C=`
    vec2 look = ${i.code};
    vec3 rd = normalize((uv.x + look.x * 0.5) * uu + (uv.y - look.y * 0.5) * vv + 1.5 * ww);`),`#version 300 es
precision highp float;
uniform vec2 u_resolution;
uniform float u_time;
uniform vec2 u_mouse;
uniform vec3 u_moused;
out vec4 fragColor;

vec2 map(vec3 p);
vec2 map_combined(vec3 p, float time);

${v}
${l}
${u}
${d}
${w}

// --- Path Function (from user quotation) ---
vec3 path(float t) {
    return ${D};
}

// The main Signed Distance Function that combines the world and the track.
vec2 map_combined(vec3 p, float time) {
    vec2 world_res = map(p);

    // Iteratively find a better estimate for t on the path closest to p
    float t_est = time;
    for(int i=0; i<4; i++) {
        vec3 path_pos = path(t_est);
        vec3 path_tangent = normalize(path(t_est + 0.01) - path_pos);
        float proj = dot(p - path_pos, path_tangent);
        t_est += proj * 0.5; // Move halfway to the projected point
    }

    vec3 closest_point = path(t_est);

    // SDF for a circular tunnel around the path
    float tunnel_radius = 0.8;
    float tunnel_dist = length(p - closest_point) - tunnel_radius;
    vec2 tunnel_res = vec2(tunnel_dist, -1.0); // Tunnel has no material

    // Subtract the tunnel from the world.
    return opSS(tunnel_res, world_res, 0.2);
}

vec3 getNormalTour(vec3 p, float time) {
    vec2 e = vec2(0.001, 0.0);
    return normalize(vec3(
        map_combined(p + e.xyy, time).x - map_combined(p - e.xyy, time).x,
        map_combined(p + e.yxy, time).x - map_combined(p - e.yxy, time).x,
        map_combined(p + e.yyx, time).x - map_combined(p - e.yyx, time).x
    ));
}

vec3 trace(vec3 ro, vec3 rd, float time) {
    float t = 0.0;
    for (int i = 0; i < ${Math.floor(O)}; i++) {
        vec3 p = ro + t * rd;
        vec2 res = map_combined(p, time);
        float d = res.x;
        if (d < ${toGLSL(k)}) {
            // Get material color from user's SDF definitions
            vec3 matColor = getMaterialColor(int(res.y), u_time, p);

            // --- Simple Headlight Lighting (Ambient + Diffuse) ---
            vec3 nor = getNormalTour(p, time);
            vec3 lightPos = ro + vec3(0.0, 0.2, 0.5); // Headlight attached to camera
            vec3 lightDir = normalize(lightPos - p);
            
            float dif = max(dot(nor, lightDir), 0.0);
            vec3 ambient = vec3(0.2);
            vec3 lighting = ambient + matColor * dif;
            
            return lighting;
        }
        if (t > ${toGLSL(N)}) break;
        t += d * 0.5;
    }

    return vec3(0.0, 0.0, 0.05); // Background color
}

void main() {
    vec2 uv = (2.0 * gl_FragCoord.xy - u_resolution.xy) / u_resolution.y;
    float time = u_time * 0.5;
    
    vec3 ro = path(time);
    vec3 ta = path(time + 0.1);

    vec3 ww = normalize(ta - ro);
    vec3 uu = normalize(cross(ww, vec3(0.0, 1.0, 0.0)));
    vec3 vv = cross(uu, ww);
    ${C}

    vec3 col = trace(ro, rd, time);
    fragColor = vec4(col, 1.0);
}
`}const isSceneObject$a=e=>e&&typeof e=="object"&&e.type==="scene",isImageMaterialObject=e=>e&&typeof e=="object"&&e.type==="image_material",render={definition:{exec:function*(e){const o=e.length>0&&typeof e[e.length-1]=="number"?e.pop():10,i=e.pop();if(isSceneObject$a(i)){const l=generateMarchingShader(i,o);e.push({type:"shader",code:l})}else if(isMarchingObject(i)){const l=generate2dSDFShader(i);e.push({type:"shader",code:l})}else if(isImageMaterialObject(i)){const l=generateImageShaderFromQuotation(i.quotation);e.push({type:"shader",code:l})}else throw new Error("render expects a scene, sdf, or image object.")},description:"Renders a 3D scene, an SDF object, or a 2D image shader into a final visual. When rendering an SDF object directly, it produces a 2D cross-section at z=0. For 3D scenes, it raymarches and optionally takes a quality number (1-100) from the stack.",effect:"[scene|sdf|image I_quality?] -> [shader]"},examples:[{code:"1 sphere march render",assert:e=>e[0].type==="shader"&&e[0].code.includes("sdSphere")},{code:"1 sphere march 5 render",assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("i < 50")}},{code:"0.5 circle2d render",assert:e=>e[0].type==="shader"&&e[0].code.includes("sdCircle2d")&&!e[0].code.includes("getNormal"),expectedDescription:"A 2D shader object rendering a circle."},{code:"0.5 sphere render",assert:e=>e[0].type==="shader"&&e[0].code.includes("sdSphere")&&!e[0].code.includes("getNormal"),expectedDescription:"A 2D shader object rendering a cross-section of a sphere."}]},isSceneObject$9=e=>e&&typeof e=="object"&&e.type==="scene",light={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),u={type:"light",pos:e.pop(),color:i,attenuation:o};if(e.length>0&&isSceneObject$9(e[e.length-1])){const d=e.pop();d.lights.push(u),e.push(d)}else e.push(u)},description:"Creates a light object and adds it to a scene if one is present on the stack. If no scene is present, it just creates the light object. Syntax: `[scene?] pos color attenuation light -> [scene|light]`",effect:"[scene? vec3 (vec3|color) F] -> [scene|light]"},examples:[{code:'1 1 1 vec3 "white" 0.1 light',assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="light"},expectedDescription:"A light object on the stack."},{code:`
1 sphere march
  # Red light from the right
  2 1 0 vec3 :red 0.1 light
  # Blue light from the left
  -2 1 0 vec3 :blue 0.1 light
render`,assert:e=>e[0].type==="shader"&&e[0].code.includes("lightPos_0")&&e[0].code.includes("lightPos_1"),expectedDescription:"A shader with two colored lights added directly to the scene."},{code:`
# Define a reusable light
(2 1 4 vec3 "yellow" 0.1 light) mylight =>

# Use it on two different scenes
1 sphere march mylight
0.5 box march mylight
`,assert:e=>e.length===2&&isSceneObject$9(e[0])&&isSceneObject$9(e[1])&&e[0].lights.length===1&&e[1].lights.length===1,expectedDescription:"Two scene objects, each with one light."},{code:`
1 sphere march
  # Light position orbits the sphere
  ( t sin 3 *   2.0   t cos 3 *   vec3 ) glsl
  # Light color cycles through the rainbow
  1.0 1.2 1.4 wavecolor
  # Attenuation
  0.05
  light
render`,assert:e=>e[0].type==="shader"&&e[0].code.includes("lightPos_0 = vec3((sin(u_time) * 3.0), 2.0, (cos(u_time) * 3.0))")&&e[0].code.includes("abs(sin(u_time * 1.0))"),expectedDescription:"A shader with an animated light orbiting a sphere."}]},isSceneObject$8=e=>e&&typeof e=="object"&&e.type==="scene",background={definition:{exec:function*(e){const o=e.pop();if(!isSceneObject$8(o))throw new Error("background operator expects a scene object.");const i=e.pop();o.background=i,e.push(o)},description:"Sets the background color of a scene. `(vec3_color|color_obj) scene background -> scene`",effect:"[(vec3|color) scene] -> [scene]"},examples:[{code:"0.5 0.6 0.7 vec3 1 sphere march background render",assert:e=>e[0].type==="shader"&&e[0].code.includes("vec3(0.5, 0.6, 0.7)")}]},isSceneObject$7=e=>e&&typeof e=="object"&&e.type==="scene",isGLSLExpression$2=e=>(e==null?void 0:e.type)==="glsl_expression",isVec3=e=>Array.isArray(e)&&e.length===3,camera={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();if(!isSceneObject$7(l))throw new Error("camera operator expects a scene object.");if(!isVec3(i)&&!isGLSLExpression$2(i))throw new Error("camera operator expects a vec3 or glsl_expression for position.");if(!isVec3(o)&&!isGLSLExpression$2(o))throw new Error("camera operator expects a vec3 or glsl_expression for target.");const u=l.camera||{pos:[0,0,5],speed:1,target:[0,0,0]};l.camera={...u,pos:i,target:o},e.push(l)},description:"Sets the camera position and target for a scene. Position and target can be static `vec3` values or dynamic `glsl_expression` objects for animation. `scene (vec3|glsl_expr)_pos (vec3|glsl_expr)_target camera`",effect:"[scene (vec3|glsl_expr) (vec3|glsl_expr)] -> [scene]"},examples:[{code:"0.8 0.4 0.2 vec3 box march 2 0 6 vec3 0 0 0 vec3 camera render",assert:e=>e[0].type==="shader"&&e[0].code.includes("vec3(2.0, 0.0, 6.0)")},{code:`
# An asymmetric box geometry to show camera movement
0.8 0.4 0.2 vec3 box "yellow" material march

# Animate the camera position to orbit around the origin
(
    t 0.5 * sin 5 * # x-coordinate
    2.0               # y-coordinate (height)
    t 0.5 * cos 5 * # z-coordinate
    vec3
) glsl

# Keep the camera pointed at the origin
0 0 0 vec3

# Apply the dynamic camera settings
camera

# Add a light that moves with the camera
(
    t 0.5 * sin 6 * # x
    2.5               # y
    t 0.5 * cos 6 * # z
    vec3
) glsl "white" 0.1 light

# Render the scene
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("ro = vec3((sin((u_time * 0.5)) * 5.0), 2.0, (cos((u_time * 0.5)) * 5.0));")},expectedDescription:"A shader object with a camera orbiting a box."},{code:`
# A central object to look at
0.8 0.2 vec2 torus
(p 5 *) glsl curl material
march

# Define the camera position using normalized mouse coordinates to orbit the object
(
    # X position: 5.0 * sin(phi) * cos(theta)
    5.0 mousey 3.14 * sin * mousex 6.28 * cos *

    # Y position: 5.0 * cos(phi) - clamped to prevent flipping
    5.0 mousey 3.14 * 0.1 3.0 clamp cos *

    # Z position: 5.0 * sin(phi) * sin(theta)
    5.0 mousey 3.14 * sin * mousex 6.28 * sin *
    
    vec3
) glsl

# The camera always looks at the origin
0 0 0 vec3

camera
2 2 4 vec3 "white" 0.1 light
render`,assert:e=>e[0].type==="shader"&&e[0].code.includes("u_mouse"),expectedDescription:"A shader object with a camera that orbits a central object based on mouse position."},{code:`
# A central object to look at
0.8 0.2 vec2 torus :red material march

# The camera position is controlled by where the mouse is held down
(
    (mousedx 0.5 -) 10.0 * # x from -5 to 5
    3.0                     # y is static
    (mousedy 0.5 -) 10.0 * # z from -5 to 5
    vec3
) glsl

# The camera always looks at the origin
0 0 0 vec3

camera
2 2 4 vec3 "white" 0.1 light
render`,assert:e=>e[0].type==="shader"&&e[0].code.includes("u_moused"),expectedDescription:"A shader object where clicking and dragging moves the camera position on the XZ plane."}]},isSceneObject$6=e=>e&&typeof e=="object"&&e.type==="scene",fog={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();if(!isSceneObject$6(l))throw new Error("fog operator expects a scene object.");l.fog={strength:i,color:o},e.push(l)},description:"Adds distance fog to a scene. `scene F_strength (vec3_color|color_obj) fog -> scene`",effect:"[scene F (vec3|color)] -> [scene]"},examples:[{code:"0 1 0 vec3 1.0 plane march 0.25 0.8 0.8 0.95 vec3 fog render",assert:e=>e[0].type==="shader"&&e[0].code.includes("mix(col, vec3(0.8, 0.8, 0.95)")},{code:"1 sphere march 0.2 0.8 0.8 0.9 vec3 fog render",assert:e=>e[0].type==="shader"&&e[0].code.includes("mix(col, vec3(0.8, 0.8, 0.9)")}]},isSceneObject$5=e=>e&&typeof e=="object"&&e.type==="scene",shadow={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!isSceneObject$5(i))throw new Error("shadow operator expects a scene object.");i.shadow={diffuseness:o},e.push(i)},description:"Adds soft shadows to a scene. Higher diffuseness values create harder shadows. `scene F_diffuseness shadow -> scene`",effect:"[scene F] -> [scene]"},examples:[{code:"0.5 sphere 0 1 -2 vec3 translate march 8 shadow render",assert:e=>e[0].type==="shader"&&e[0].code.includes("calcSoftshadow")}]},material={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!isMarchingObject(i))throw new Error("material expects an SDF object.");if((o==null?void 0:o.type)!=="color"&&(o==null?void 0:o.type)!=="image_material"&&(o==null?void 0:o.type)!=="glsl_expression"&&typeof o!="string"&&typeof o!="symbol"&&!Array.isArray(o))throw e.push(i,o),new Error("Invalid material type. Expecting a color name, symbol, vec3, color object, or image object.");const l=deepClone(i);l.material=o,e.push(l)},description:'Applies a material to an SDF object. Material can be a preset string ("red", "green", etc.), a preset symbol (:red, :green, etc.), a static `vec3`, a dynamic `color` object, or an `image` object for procedural texturing.',effect:"[sdf material] -> [sdf]"},examples:[{code:'1 sphere "red" material march render',assert:e=>e[0].type==="shader",expectedDescription:"A shader object rendering a red sphere."},{code:"1 sphere :blue material march render",assert:e=>e[0].type==="shader",expectedDescription:"A shader object rendering a blue sphere."},{code:"1 sphere 0.2 1.0 0.5 rgb material march render",assert:e=>e[0].type==="shader",expectedDescription:"A shader object rendering a sphere with a custom RGB color."},{code:"1 sphere 0.6 0.8 1.0 hsv material march render",assert:e=>e[0].type==="shader",expectedDescription:"A shader object rendering a sphere with a custom HSV color."},{code:"1 sphere 1.0 1.2 1.4 wavecolor material march render",assert:e=>e[0].type==="shader",expectedDescription:"A shader object rendering a sphere with an animated, pulsing color."},{code:"1 sphere (p xy t +) glsl cnoise material march render",assert:e=>e[0].type==="shader",expectedDescription:"A shader object rendering a sphere with an animated noise material."}]},isSceneObject$4=e=>e&&typeof e=="object"&&e.type==="scene",isPostEffectObject=e=>e&&typeof e=="object"&&e.type==="postEffect",post={definition:{exec:function*(e){const o=[];for(;e.length>0&&isPostEffectObject(e[e.length-1]);)o.unshift(e.pop());const i=e.pop();if(!isSceneObject$4(i))throw new Error("post expects a scene object.");i.post=[...i.post||[],...o],e.push(i)},description:"Adds one or more post-processing effects to a scene. `scene effect1... post -> scene`",effect:"[scene effect...] -> [scene]"},examples:[{code:"1 sphere march invert post render",assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("post_invert")}}]},isSceneObject$3=e=>e&&typeof e=="object"&&e.type==="scene",iterations={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!isSceneObject$3(i))throw new Error("iterations operator expects a scene object.");if(typeof o!="number"||!Number.isInteger(o)||o<1)throw new Error("iterations expects a positive integer count.");i.renderParams={...i.renderParams,iterations:o},e.push(i)},description:"Sets the maximum number of raymarching steps for a scene. Higher values improve quality but decrease performance. `scene count iterations -> scene`",effect:"[scene I] -> [scene]"},examples:[{code:"1 sphere march 50 iterations render",assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("i < 50;")},expectedDescription:"A shader with 50 iterations."},{code:`
# A detailed mandelbulb fractal
mandelbulb

# Animate rotation
(t 0.2 *) glsl 0 1 0 vec3 rotatesdf

# Apply a procedural material based on position
(p 2 *) glsl curl material

# Set up scene
march

# Add a light
2 2 4 vec3 "white" 0.1 light

# Use a high iteration count for detail
128 iterations

# Render
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("i < 128;")},expectedDescription:"A shader with 128 iterations for a detailed fractal."}]},isSceneObject$2=e=>e&&typeof e=="object"&&e.type==="scene",near={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!isSceneObject$2(i))throw new Error("near operator expects a scene object.");if(typeof o!="number"||o<=0)throw new Error("near expects a positive number.");i.renderParams={...i.renderParams,near:o},e.push(i)},description:"Sets the near clip distance for raymarching. This is the minimum distance for a ray to hit a surface. A smaller value allows for more detailed close-ups but can increase rendering time. `scene dist near -> scene`",effect:"[scene F] -> [scene]"},examples:[{code:`
# A highly detailed psychobox fractal
12 psychobox
(p 2 *) glsl curl material
march

# Set a very low near clip distance for high-detail closeups
0.0001 near

# Animate the camera to move slowly toward and away from the fractal
0 0 (t 0.2 * sin 0.5 * 1.5 +) glsl vec3  # Camera position
0 0 0 vec3    # Look at target
camera

# Render
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("if (d.x < 0.0001)")},expectedDescription:"A shader with a near distance of 0.0001 for a detailed close-up shot."}]},isSceneObject$1=e=>e&&typeof e=="object"&&e.type==="scene",far={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!isSceneObject$1(i))throw new Error("far operator expects a scene object.");if(typeof o!="number"||o<=0)throw new Error("far expects a positive number.");i.renderParams={...i.renderParams,far:o},e.push(i)},description:"Sets the far clip distance for raymarching. This is the maximum distance a ray will travel. `scene dist far -> scene`",effect:"[scene F] -> [scene]"},examples:[{code:`
# A scene with repeating mandelbulbs
mandelbulb
1.5 1.5 1.5 vec3 repeat
:orange material
march

# Use low iterations for speed
20 iterations

# Set a low far clipping distance
5 far

# Add a light
2 2 4 vec3 :white 0.1 light

# Animate camera moving backward to see objects get clipped by the far plane
0 0 (t) glsl vec3 # camera position
0 0 0 vec3       # look at target
camera

# Render - objects beyond 5 units will be clipped
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("if (t > 5.0)")},expectedDescription:"A shader with a far distance of 5, clipping distant objects."}]},rgb={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();e.push({type:"color",expression:`vec3(${toGLSL(l)}, ${toGLSL(i)}, ${toGLSL(o)})`})},description:"Creates a static color object from RGB values.",effect:"[r g b] -> [color]"},examples:[{code:"2 sphere 255 255 0 rgb material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"}}]},hsv={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();e.push({type:"color",expression:`hsv2rgb(vec3(${toGLSL(l)}, ${toGLSL(i)}, ${toGLSL(o)}))`})},description:"Creates a color object from HSV (Hue, Saturation, Value) values.",effect:"[h s v] -> [color]"},examples:[{code:"0.5 sphere 0.0 1.0 1.0 hsv material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"}}]},wavecolor={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();e.push({type:"color",expression:`vec3(abs(sin(u_time * ${toGLSL(l)})), abs(sin(u_time * ${toGLSL(i)})), abs(sin(u_time * ${toGLSL(o)})))`})},description:"Creates an animated color that oscillates based on time. Takes separate frequencies for R, G, and B channels.",effect:"[r_freq g_freq b_freq] -> [color]"},examples:[{code:"0.5 sphere 1 0 0 wavecolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"}}]},cnoise={definition:{exec:function*(e){const o=e.pop(),i=toGLSL(o);if(!i)throw new Error("cnoise expects an input value (e.g., a vec2, vec3, or a glsl_expression object)");e.push({type:"color",expression:`vec3(0.2 + 0.8 * cnoise(${i}))`})},description:"Creates a color from Classic Perlin noise. The noise function's output range of [0.0, 1.0] is remapped to [0.2, 1.0] to create a brighter, more visible material, which is then used for all three (R,G,B) color channels. The input should be a vec2, vec3, or a `glsl_expression`, which can be constructed from GLSL variables like `p` (hit position) and `t` (time) for animation, using the `glsl` combinator.",effect:"[vec] -> [color]"},examples:[{code:"1.5 sphere (p xy t +) glsl cnoise material march render",assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a sphere textured with animated noise."},{code:`
# Warp the noise pattern by swapping the X and Y coordinates
1.0 sphere
(
  p yxz # Swizzle coordinates to warp the texture
  5 *   # Scale the noise for more detail
  t +   # Animate the noise over time
) glsl cnoise material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a sphere textured with animated, warped noise."}]},curl={definition:{exec:function*(e){const o=e.pop(),i=toGLSL(o);if(!i)throw new Error("curl expects an input value (e.g., a vec2, vec3, or a glsl_expression object)");e.push({type:"color",expression:`curl(${i})`})},description:"Creates a color from curl noise, which is useful for fluid-like patterns. The input should be a vec2, vec3, or a `glsl_expression`, which can be constructed from GLSL variables like `p` (hit position) and `t` (time) for animation, using the `glsl` combinator.",effect:"[vec] -> [color]"},examples:[{code:`0.4 0.4 0.4 vec3 0.1 roundbox (p xy t +) glsl curl material
march
1 1 1 vec3 "white" 0.1 light
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a roundbox textured with animated curl noise."},{code:`
# Use the X and Z coordinates to apply 2D curl noise to a 3D shape
0.5 1.5 vec2 cylinder
# Rotate the cylinder to see the effect
(t 0.5 *) glsl 1 1 0 vec3 rotatesdf
(
  p xz # Project the 3D surface point to a 2D plane
  2 *  # Scale the noise pattern
  t +  # Animate the pattern over time
) glsl curl material
march
# Add a light for better visibility
2 2 4 vec3 "white" 0.1 light
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a cylinder textured with animated, flowing curl noise."}]},worley={definition:{exec:function*(e){const o=e.pop(),i=toGLSL(o);if(!i)throw new Error("worley expects an input value (e.g., a vec2, vec3, or a glsl_expression object)");e.push({type:"color",expression:`vec3(1.0 - worley(${i}).x)`})},description:"Creates a color from Worley noise (Voronoi cells). The input should be a vec2, vec3, or a `glsl_expression`, which can be constructed from GLSL variables like `p` (hit position) and `t` (time) for animation, using the `glsl` combinator.",effect:"[vec] -> [color]"},examples:[{code:`0.4 0.4 0.4 vec3 0.1 roundbox (p xy 10 * t +) glsl worley material
march
1 1 1 vec3 "white" 1 light
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a roundbox textured with animated Worley noise."},{code:`
# Animate a 2D slice through a 3D noise volume
1 1 1 vec3 box
(
  p x      # Use surface x
  p y      # Use surface y
  t 0.5 *  # Animate the z-coordinate to slice through the noise
  vec3
  5 *      # Scale the noise for more detail
) glsl worley material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a box textured with an animated 2D slice of 3D Worley noise."}]},voronoi={definition:{exec:function*(e){const o=e.pop(),i=toGLSL(o);if(!i)throw new Error("voronoi expects an input value (e.g., a vec2, vec3, or a glsl_expression object)");e.push({type:"color",expression:`vec3(voronoi(${i}).z)`})},description:"Creates a color from Voronoi noise. The input should be a vec2, vec3, or a `glsl_expression`, which can be constructed from GLSL variables like `p` (hit position) and `t` (time) for animation, using the `glsl` combinator.",effect:"[vec] -> [color]"},examples:[{code:"2 4 4 vec3 0.1 roundbox (p xy 5 * t +) glsl voronoi material march render",assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a roundbox textured with animated Voronoi noise."}]},randomcolor={definition:{exec:function*(e){e.push({type:"color",expression:"random_color(p)"})},description:"Creates a random color based on the surface position, useful for differentiating objects.",effect:"[] -> [color]"},examples:[{code:"0.5 sphere randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"}}]},julia={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push({type:"color",expression:`vec3(juliaSDF(p.xy, ${toGLSL(i)}, ${toGLSL(o)}))`})},description:"A convenient high-level operator that creates a complete grayscale Julia set material. It takes a `c` parameter (a vec2) which defines the fractal's shape, and an `r` parameter (a float) which controls the radius/zoom. For more advanced control over color and animation, see the `juliaset` operator.",effect:"[c_vec2 r_float] -> [color]"},examples:[{code:`
# A static Julia set with a classic appearance
2.0 sphere
  -0.745 0.113 vec2  # 'c' constant
  1.0                # radius
  julia              # generate grayscale material
material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a sphere textured with a classic Julia set."},{code:`
# A colorful Julia set using 'juliaset' multiplied by a 'wavecolor'
2.0 sphere

# Push arguments for juliaset
(p xy) glsl
-0.745 0.113 vec2
1.0
juliaset  # -> stack has [glsl_expr_julia]

# Create a wavecolor vector as a glsl_expression
(t 1.0 * sin abs t 1.2 * sin abs t 1.4 * sin abs vec3) glsl    # -> stack has [glsl_expr_julia, glsl_expr_wave]

# Multiply them. The '*' operator is shader-aware.
*         # -> stack has [glsl_expr_final]

material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a sphere with an animated, colorful Julia fractal."}]},juliaset={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop(),u=toGLSL(l),d=toGLSL(i),h=toGLSL(o);if(!u||!d||!h)throw e.push(l,i,o),new Error("juliaset expects st (vec2/glsl), c (vec2/glsl), and r (float/glsl) on the stack.");const m=`juliaSDF(${u}, ${d}, ${h})`;e.push({type:"glsl_expression",code:m,returnType:"float"})},description:"Calculates the raw 2D Julia set fractal value (a float from 0.0 to 1.0) and pushes it to the stack as a GLSL expression. This is the building block for creating custom, animated 2D fractal materials. It requires the surface coordinates ('st'), the 'c' constant, and a radius/zoom 'r'. For a 3D fractal, see 'mandelbulb' or 'fractal'.",effect:"[st_vec2 c_vec2 r_float] -> [glsl_expression]"},examples:[{code:`
# Use a plane as a canvas for the 2D fractal
0 0 1 vec3 0 plane

# --- Create the animated, colorful material ---

# 1. Calculate the Julia set value as a GLSL expression
(p xy) glsl
(t 0.2 * sin 0.7885 * t 0.2 * cos 0.7885 * vec2) glsl # Animated C
(t 0.1 * sin abs) glsl 0.95 * 0.05 +                         # Animated R (deep zoom)
juliaset                                                     # -> [fractal_val_expr]

# 2. Use the fractal value to create a hue, and animate it
3.0 *           # Scale the value for more color range
(t 0.2 *) glsl + # Animate a hue shift over time

# 3. Create the final color
1.0 1.0         # Saturation and Value
hsv             # -> [color_object]

# Apply the final material and render
material
march
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a plane textured with a deeply-zooming, color-cycling Julia set."}]},mandelbrot={definition:{exec:function*(e){const o=e.pop();e.push({type:"color",expression:`vec3(mandelbrotSDF(p.xy, ${toGLSL(o)}))`})},description:"A convenient high-level operator that creates a complete grayscale Mandelbrot set material. It takes an 'r' parameter (a float) which controls the radius/zoom.",effect:"[r_float] -> [color]"},examples:[{code:`
2.0 sphere
  1.5  # radius
  mandelbrot
material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a sphere textured with a classic Mandelbrot set."},{code:`
# A deep, animated zoom into the Mandelbrot set
2.0 sphere
  # Animate the radius 'r' for a zoom effect
  (t 0.1 * sin abs) glsl 0.95 * 0.05 +
  mandelbrot
material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a sphere textured with an animated, zooming Mandelbrot set."}]},mandelbrotset={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=toGLSL(i),u=toGLSL(o);if(!l||!u)throw e.push(i,o),new Error("mandelbrotset expects st (vec2/glsl) and r (float/glsl) on the stack.");const d=`mandelbrotSDF(${l}, ${u})`;e.push({type:"glsl_expression",code:d,returnType:"float"})},description:"Calculates the raw 2D Mandelbrot set fractal value (a float from 0.0 to 1.0) and pushes it to the stack as a GLSL expression. This is the building block for creating custom, animated 2D fractal materials. It requires the surface coordinates ('st') and a radius/zoom 'r'. For a high-level material, see 'mandelbrot'.",effect:"[st_vec2 r_float] -> [glsl_expression]"},examples:[{code:`
# Use a plane as a canvas for the 2D fractal
0 0 1 vec3 0 plane

# --- Create the interactive, colorful material ---

# 1. Calculate the Mandelbrot set value as a GLSL expression
(p xy) glsl
(mousey u_resolution y / 5.0 * neg exp) glsl # Zoom with the mouse
mandelbrotset                                # -> [fractal_val_expr]

# 2. Use the fractal value to create a hue, and animate it
3.0 *           # Scale the value for more color range
(t 0.2 *) glsl + # Animate a hue shift over time

# 3. Create the final color
1.0 1.0         # Saturation and Value
hsv             # -> [color_object]

# Apply the final material and render
material
march
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a plane textured with a color-cycling Mandelbrot set that can be zoomed using the mouse."}]},glsl={definition:{exec:function*(e){const o=e.pop();if(!Array.isArray(o))throw new Error("glsl expects a quotation (list).");const i=transpileGLSL(o);e.push({type:"glsl_expression",code:i})},description:"Transpiles a Yield quotation into a GLSL expression for use in procedural materials. Special operators `p` (position), `t` (time), and swizzlers (`x`, `y`, `xy`, etc.) are available inside the quotation.",effect:"[[Quotation]] -> [glsl_expression]"},examples:[{code:"(t sin 0.5 * 1.5 +) glsl 5.0 2.0 mandelbox 1.0 1.2 1.4 wavecolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"}},{code:"(p x t + sin) glsl",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="glsl_expression"&&e[0].code==="sin((p.x + u_time))"},expectedDescription:"A glsl_expression object"},{code:`
# Use swizzling to create a diagonal color gradient
1 1 1 vec3 box
(
  p x p y + # Sum of x and y coordinates from position p
  2 *       # Scale for more color cycles
  1.0 1.0 hsv # Map value to hue
) glsl material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a box with a diagonal rainbow material."},{code:`
# Use swizzling and fract to create a repeating grid
0 1 0 vec3 0 plane # A horizontal plane
(
  p xy 5 * fract # Create a 5x5 grid of 0-1 coordinates
  dup x          # Use local x for red channel
  swap y         # Use local y for green channel
  0.5            # Static blue channel
  vec3
) glsl material
march
0 2 5 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a plane with a colorful repeating grid pattern."},{code:`
# Use swizzling to create a conditional mask
0.8 0.2 vec2 torus
(
  p y 0.0 >    # Test if the position's y-coord is > 0
  (1 0 0 vec3) # If true, use red
  (0 0 1 vec3) # If false, use blue
  ?            # The 'ifte'/? operator works inside glsl
) glsl material
(t 0.5 *) glsl 1 0 0 vec3 rotatesdf # Rotate to see top/bottom
march
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a torus that is red on top and blue on the bottom."},{code:`
# Use .z for a depth-based gradient
0.2 sphere
2 2 2 vec3 repeat
(
  p z 0.1 * # Use the z-coordinate
  1.0 1.0 hsv
) glsl material
march
0 0 15 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering an infinite grid of spheres that change color with depth."},{code:`
# Use .yz to project stripes onto the side of a cylinder
0.5 1.5 vec2 cylinder
(
  p yz 10 * x sin # Project to YZ plane, scale, get sine
  dup dup vec3    # Make grayscale
) glsl material
(t 0.5 *) glsl 1 0 0 vec3 rotatesdf # Rotate to see the effect
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a cylinder with vertical stripes projected onto its side."},{code:`
# Use .xz to project a checkerboard on top of a torus
0.8 0.2 vec2 torus
(
  p xz 5 * fract # Project to XZ plane and create grid
  x floor
  p xz 5 * fract
  y floor + 2 % # Create checkerboard pattern
  dup dup vec3
) glsl material
(t 0.2 *) glsl 1 0 0 vec3 rotatesdf
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a torus with a checkerboard pattern on its top and bottom faces."},{code:`
# Use .yxz to warp a 3D noise texture
1.0 sphere
(p yxz 2 * t + curl) glsl material
(t 0.3 *) glsl 1 1 0 vec3 rotatesdf
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a sphere with a swirling, warped curl noise texture."},{code:`
# Use .zxy to create a different warped texture
0.8 0.8 0.2 vec3 box
(
  p zxy 3 * t + fbm # fbm returns a float
  dup dup vec3      # convert float to vec3 for color
) glsl material
(t 0.3 *) glsl 1 1 1 vec3 rotatesdf
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a rotating box with an animated, warped FBM noise texture."},{code:`
# Use .zyx to apply a reversed gradient to a mirrored object
0.4 sphere 0.5 0 0 vec3 translate
1 1 1 vec3 mirrorRepeat
(
  p zyx 0.3 * x # hue must be a float
  1.0 1.0 hsv
) glsl material
march
0 0 5 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader showing how swizzling coordinates also mirrors the applied texture."},{code:`
# Use .w swizzles by constructing a vec4
1.0 sphere
(
  # Create a vec4 from (pos.x, pos.y, p.z, time)
  # The RPN for this is p.x, p.y, p.z, t -> vec4
  p x p y p z t vec4
  
  # Use .w (time) and .z (depth) to make a more obvious animation
  dup w 2.0 *         # Get time, speed it up for visibility
  swap z +            # Add depth to create a diagonal wave
  1.0 1.0 hsv         # Use the combined value as the hue
) glsl material
march 
0 0 5 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader showing a sphere whose color changes with both time and depth."},{code:`
# Combine swizzles: radial (.xy) and vertical (.z) patterns
0.1 circle2d # The shape to repeat
5.0 polarRepeat
(
  p xy length 5 * sin # sine wave from center
  p z 5 * sin *       # modulated by vertical sine wave
  0.5 + 0.5 *         # remap to 0-1 range
  dup dup vec3
) glsl material
(t 0.2 *) glsl 1 0 0 vec3 rotatesdf
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader showing a ring of cylinders with a complex, pulsating interference pattern."},{code:`
# Use .xzy to displace a surface
0 1 0 vec3 1.0 plane
(
  p xzy 5 * t + snoise # Use snoise for signed displacement
  0.1 *
) glsl displace
(
  p yzx x 1.0 1.0 hsv
) glsl material
(t 0.2 *) glsl 1 0 0 vec3 rotatesdf
march 
0 2 5 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a plane with a complex, animated displacement and warped coloring."},{code:`
# Rectangular repeat with .xz swizzle
0.1 sphere
2 2 vec2 0.5 rectangularRepeat
(
  p xz 2 * fract # Project grid onto the XZ plane
  dup x swap y * # Correctly get x and y components
  5 *            # Multiply components for interesting pattern
  1.0 1.0 hsv
) glsl material
march 
0 2 5 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a rectangular frame of spheres with a colorful grid pattern."},{code:`
# Another 3D warp with .yzx
0.4 sphere 
0.3 0.3 0.3 vec3 box 0.4 0 0 vec3 translate
0.1 roundUnion
(
  p yzx 3 * t + cnoise dup dup vec3
) glsl material
(t 0.3 *) glsl 1 1 1 vec3 rotatesdf
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a rounded object with a unique warped noise pattern."},{code:`
# Use .wwww swizzle to create a vec4 from a single component
1.0 sphere
(
  # Create a vec4 from (pos.x, pos.y, p.z, time)
  p x p y p z t vec4
  
  # Get time via .w and create a solid color from it.
  w                # get time, discard original vec4
  dup dup dup vec4 # -> vec4(t, t, t, t)
  
  # Take the .xyz for the color, making it flash uniformly
  xyz
) glsl material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a sphere that flashes uniformly based on time using .wwww swizzle."},{code:`
# Use .xx swizzle to create a vec2 from a single component
# This creates horizontal lines from a noise pattern.
1.0 sphere
(
  p xy xx # -> vec2(p.x, p.x)
  5 *     # Scale it
  fbm     # Get noise
  dup dup vec3
) glsl material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a sphere with a horizontal noise pattern using .xx swizzle."},{code:`
# Use .yyy swizzle to create a grayscale vec3 color from one component
0.8 0.2 vec2 torus
(
  p yyy # -> vec3(p.y, p.y, p.y)
  # This creates a grayscale color based on height.
) glsl material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a torus with a grayscale pattern based on the y-coordinate using .yyy swizzle."}]},fbm={definition:{exec:function*(e){const o=e.pop(),i=toGLSL(o);if(!i)throw new Error("fbm expects an input value (e.g., a vec2, vec3, or a glsl_expression object)");e.push({type:"color",expression:`vec3(fbm(${i}))`})},description:"Creates a color from Fractional Brownian Motion noise, which is good for generating natural-looking textures like clouds or terrain. The input should be a vec2, vec3, or a `glsl_expression`, which can be constructed from GLSL variables like `p` (hit position) and `t` (time) for animation, using the `glsl` combinator.",effect:"[vec] -> [color]"},examples:[{code:"1.0 sphere (p 3 * t +) glsl fbm material march render",assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a sphere textured with animated FBM noise."},{code:`1.0 sphere
(
    # Calculate a noise value based on 3D position and time
    p 3 * t + fbm
    
    # Remap the noise value to a 0-1 range with a smooth curve
    # This creates more defined "hot" and "cold" areas
    0.3 0.7 smoothstep
    
    # Define our two colors for the fire gradient
    1.0 0.1 0.0 vec3 # Dark orange
    1.0 0.9 0.0 vec3 # Bright yellow
    
    # Arrange stack for mix: [colorA, colorB, interpolant]
    rolldown
    
    # Blend between the two colors based on the remapped noise
    fuse
) glsl material
march
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a sphere textured with animated fire-like FBM noise."},{code:`
# Demonstrate tri-planar texturing with FBM
0.8 0.8 0.8 vec3 box
(
  # Get noise from 3 planes using swizzling
  p xy 2 * fbm
  p yz 2 * fbm
  p xz 2 * fbm

  # Average the results
  + + 0.333 *
  dup dup vec3 # make it grayscale
) glsl material
# Animate rotation to see all sides
(t 0.2 *) glsl 1 1 1 vec3 rotatesdf
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object showing a box with a seamless FBM texture applied using tri-planar mapping."}]},cloud={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push({type:"color",expression:`cloud_color(p, u_time, ${toGLSL(i)}, ${toGLSL(o)})`})},description:"Creates an animated procedural cloud material. Takes two colors that define the primary palette of the clouds.",effect:"[color1 color2] -> [color]"},examples:[{code:`
# A plane to act as a ground for the clouds
0 1 0 vec3 0 plane

# Define two colors for the clouds and apply as material
0.1 0.2 0.3 rgb
0.8 0.9 1.0 rgb
cloud
material

# Set up the scene
march

# Add fog for atmospheric effect
0.2 # fog strength
0.5 0.6 0.7 rgb # fog color
fog

# Animate the camera to fly through the clouds
(t 0.1 *) glsl (t 0.2 * sin 2 +) glsl (t) glsl vec3 # camera position
0 (t 0.2 * sin 2 +) glsl (t 0.2 *) glsl vec3 # camera target
camera

render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader showing an animated camera flying over a plane with moving cloud textures and fog."},{code:`2 sphere
100 20 0 rgb
1 0 0 rgb
cloud material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with a spehere textured with animated clouds."}]},validTextures=new Set(["dots","stripes","checkers"]),toGLSLFloat=e=>{if(typeof e!="number")return"1.0";const o=e.toString();return Number.isInteger(e)&&!o.includes("e")&&!o.includes(".")?o+".0":o},texture={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();if(!isMarchingObject(l))throw new Error("texture operator expects an SDF object.");if(typeof i!="string"||!validTextures.has(i))throw new Error(`Invalid texture name: "${i}". Valid textures are: ${Array.from(validTextures).join(", ")}.`);if(typeof o!="number")throw new Error("texture operator expects a scale number.");const u=deepClone(l),d=`texture_${i}(p, ${toGLSLFloat(o)})`;u.material={type:"color",expression:d},e.push(u)},description:'Applies a procedural texture to an SDF object. Textures are generated in GLSL based on surface position `p`. Available textures: "dots", "stripes", "checkers".',effect:"[sdf name scale] -> [sdf]"},examples:[{code:'1.0 sphere "dots" 10 texture march render',assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("texture_dots")},expectedDescription:"A shader object with a sphere textured with dots."}]},fuse={definition:{exec:function*(){throw new Error("Operator 'fuse' can only be used inside a 'glsl' quotation.")},description:"Performs linear interpolation between two values. `mix(a, b, t)` is equivalent to `a*(1-t) + b*t`. Must be used inside a `glsl` quotation.",effect:"[a b t] -> [result]"},examples:[{code:`1.0 sphere
(
    # Define two colors
    0.912 0.793 0.486 vec3  # Gold
    1.000 0.351 0.089 vec3  # Orange

    # Create an interpolant that cycles over time
    t sin abs

    # Mix the two colors based on the interpolant
    fuse
) glsl material
march
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a sphere that smoothly transitions between two colors."}]},smoothstep={definition:{exec:function*(){throw new Error("Operator 'smoothstep' can only be used inside a 'glsl' quotation.")},description:"Performs smooth Hermite interpolation between 0 and 1 when `edge0 < x < edge1`. Must be used inside a `glsl` quotation.",effect:"[x edge0 edge1] -> [result]"},examples:[{code:`1.0 sphere
(
    # Use surface position's x-coordinate as input
    p x
    
    # Smoothly transition between 0 and 1 in the range [-0.5, 0.5]
    -0.5 0.5 smoothstep
    
    # Use the result to create a grayscale color
    dup dup vec3
    
) glsl material
march
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a sphere with a smooth black-to-white gradient."}]},color={definition:{exec:function*(e){const o=e.pop(),i=toGLSL(o);if(!i)throw new Error("color operator expects a color name (string/symbol) or a vec3.");e.push({type:"color",expression:i})},description:'Creates a color object from a preset name (e.g., "red", :blue) or a vec3 list.',effect:"[name|vec3] -> [color]"},examples:[{code:'"red" color',assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="color"&&e[0].expression.includes("vec3(1.0, 0.2, 0.2)")},expectedDescription:"A red color object"},{code:"1 0 1 vec3 color",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="color"&&e[0].expression==="vec3(1.0, 0.0, 1.0)"},expectedDescription:"A magenta color object"}]},image={definition:{exec:function*(e){const o=e.pop();if(!Array.isArray(o))throw new Error("image operator expects a quotation.");e.push({type:"image_material",quotation:o})},description:"Creates a 2D image shader definition. When used with 'render', it produces a 2D visual. When used with 'material', it applies the 2D pattern as a 3D texture using tri-planar mapping. Special variables 'p', 'uv', 't', 'u_resolution', and 'mouse' are available inside the quotation.",effect:"[L_quotation] -> [image_material]"},examples:[{code:`# Standalone 2D image: A simple color gradient
(
  uv # use normalized coordinates
  dup x # use uv.x for red
  swap y # use uv.y for green
  0.5    # blue
  1.0    # alpha
  vec4
) image render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("fragColor = vec4(uv.x, uv.y, 0.5, 1.0);")},expectedDescription:"A shader object that creates a color gradient."},{code:`# As a material: Apply a Voronoi pattern to a 3D sphere
1.0 sphere
(
  uv 5.0 * t 0.5 * + # scale and animate coordinates
  worley              # get worley noise
  x                   # get distance to nearest point
  1.0 swap -          # invert for classic cell look
  dup dup 1.0 vec4 # make grayscale and add alpha
) image material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("worley")},expectedDescription:"A shader object with a sphere textured with animated Voronoi noise."},{code:`# As a material: Draw a soft circle on a 3D box
1 1 1 vec3 box
(
  uv 0.5 -
  dup x swap y 0.0 vec3
  0.25 circle2d
  0.0 0.01 smoothstep neg 1.0 +
  dup dup 1.0 vec4
) image material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("sdCircle2d")},expectedDescription:"A shader object with a box textured with a soft circle."},{code:`# As a material: Interactive psychedelic fluid effect on a torus
0.8 0.2 vec2 torus
(
  uv mouse 500.0 / t + +
  dup x sin
  swap y cos
  0.8 1.0 vec4
) image material
(t 0.2 *) glsl 1 1 1 vec3 rotatesdf
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("mouse")},expectedDescription:"A shader object rendering a rotating torus with an interactive fluid material."},{code:["# Composing with glsl: Use a glsl expression as a value","1.0 sphere","(","  # Calculate a grayscale value using a glsl expression","  (p x p y * 5.0 * sin 0.5 * 0.5 +) glsl","","  # Use this value for all three color channels","  dup dup # -> [val, val, val]","  1.0     # alpha","  vec4",") image","material","march render"],assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("sin(((p.x * p.y) * 5.0))")},expectedDescription:"A shader object with a material derived from a nested glsl expression."}]},invert={definition:{exec:function*(e){e.push({op:"invert",type:"postEffect",props:{}})},description:"Creates a invert post-processing effect object.",effect:"[] -> [effect]"},examples:[{code:"1 sphere march  invert post render",assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"}}]},edge={definition:{exec:function*(e){e.push({op:"edge",type:"postEffect",props:{}})},description:"Creates a edge post-processing effect object.",effect:"[] -> [effect]"},examples:[{code:"0.2 0.5 vec2 hexprism march edge post render",assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"}}]},brightness={definition:{exec:function*(e){const o={amount:e.pop()};e.push({op:"brightness",type:"postEffect",props:o})},description:"Creates a brightness post-processing effect object.",effect:"[amount] -> [effect]"},examples:[{code:"1 sphere march 0.5 brightness post render",assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"}}]},contrast={definition:{exec:function*(e){const o={amount:e.pop()};e.push({op:"contrast",type:"postEffect",props:o})},description:"Creates a contrast post-processing effect object.",effect:"[amount] -> [effect]"},examples:[{code:"1 sphere march 0.5 contrast post render",assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"}}]},vec={definition:{exec:function*(e){if(e.length<1)throw new Error("Stack underflow. 'vec' requires a size argument on the stack.");const o=e.pop();if(typeof o=="number"&&Number.isInteger(o)&&o>=0){const i=e.length;if(i<o)throw e.push(o),new Error(`Stack underflow for 'vec'. Needed ${o} items, but only ${i} available.`);const l=e.splice(e.length-o,o);e.push(l)}else Array.isArray(o)?e.push(o):e.push([o])},description:"Creates a vector (list) of size N from the top N elements of the stack. If the argument is not a number, it wraps non-list items in a list, and leaves lists as-is.",effect:"[e1..eN N] -> [[e1..eN]] | [A] -> [L]"},examples:[{code:"1 2 3 3 vec",expected:[[1,2,3]]},{code:'"a" "b" 2 vec',expected:[["a","b"]]},{code:"10 20 0 vec",expected:[10,20,[]]},{code:"1 2 3 4 3 vec",expected:[1,[2,3,4]]},{code:'"hello" vec',expected:[["hello"]]},{code:"(1 2) vec",expected:[[1,2]]},{code:"1 2 3 vec",expectedError:"Stack underflow for 'vec'. Needed 3 items, but only 2 available."},{code:"vec",expectedError:"Stack underflow. 'vec' requires a size argument on the stack."}]},vec2={definition:{exec:function*(e){const o=e.pop(),i=e.pop();e.push([i,o])},description:"Creates a 2D vector [x, y].",effect:"[x y] -> [vec2]"},examples:[{code:"1 2 vec2",expected:[[1,2]]}]},vec3={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();e.push([l,i,o])},description:"Creates a 3D vector [x, y, z].",effect:"[x y z] -> [vec3]"},examples:[{code:"1 2 3 vec3",expected:[[1,2,3]]}]},vec4={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop(),u=e.pop();e.push([u,l,i,o])},description:"Creates a 4D vector [x, y, z, w].",effect:"[x y z w] -> [vec4]"},examples:[{code:"1 2 3 4 vec4",expected:[[1,2,3,4]]}]},box={definition:{exec:function*(e){const o={size:e.pop()};e.push(createMarchingObject("box","geometry",[],o))},description:"Creates a box geometry.",effect:"[size] -> [sdf]"},examples:[{code:"0.5 0.5 0.5 vec3 box march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`
# Animate the box size
(t 0.5 * sin 0.2 * 0.5 +) glsl # sx
(t 0.5 * cos 0.2 * 0.5 +) glsl # sy
(t 0.5 * sin 0.2 * 0.5 +) glsl # sz
vec3 box
:yellow material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated, pulsating box."}]},sphere={definition:{exec:function*(e){const o={radius:e.pop()};e.push(createMarchingObject("sphere","geometry",[],o))},description:"Creates a sphere geometry.",effect:"[radius] -> [sdf]"},examples:[{code:"0.5 sphere march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`
# Animate the sphere's radius
(t sin 0.5 * 0.8 +) glsl
sphere
# Animate the color
1.0 1.2 1.4 wavecolor material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated, pulsating sphere with changing colors."}]},capsule={definition:{exec:function*(e){const o={radius:e.pop(),end:e.pop(),start:e.pop()};e.push(createMarchingObject("capsule","geometry",[],o))},description:"Creates a capsule geometry.",effect:"[start end radius] -> [sdf]"},examples:[{code:"-0.2 0 0 vec3 0.2 0 0 vec3 0.5 capsule march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`
# Animate the endpoints of the capsule
(t sin -0.5 *) glsl 0 0 vec3
(t sin 0.5 *) glsl 0 0 vec3
# Animate the radius
(t cos 0.2 * 0.3 +) glsl
capsule
:cyan material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated capsule that stretches, shrinks, and changes thickness."}]},cone={definition:{exec:function*(e){const o={dimensions:e.pop()};e.push(createMarchingObject("cone","geometry",[],o))},description:"Creates a cone geometry.",effect:"[dimensions] -> [sdf]"},examples:[{code:"0.8 0.5 vec2 cone march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`
# Animate the cone's dimensions
(t 0.5 * sin 0.2 * 0.6 +) glsl # Animate cone angle
(t 0.5 * cos 0.2 * 0.5 +) glsl # Animate cone height
vec2 cone
1.0 1.2 1.4 wavecolor material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated cone."}]},cylinder={definition:{exec:function*(e){const o={dimensions:e.pop()};e.push(createMarchingObject("cylinder","geometry",[],o))},description:"Creates a cylinder geometry.",effect:"[dimensions] -> [sdf]"},examples:[{code:"0.8 0.5 vec2 cylinder march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`
# Animate the cylinder's dimensions
(t 0.5 * sin 0.2 * 0.5 +) glsl # Animate radius
(t 0.5 * cos 0.2 * 0.5 +) glsl # Animate height
vec2 cylinder
:magenta material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated cylinder."}]},hexprism={definition:{exec:function*(e){const o={dimensions:e.pop()};e.push(createMarchingObject("hexprism","geometry",[],o))},description:"Creates a hexprism geometry.",effect:"[dimensions] -> [sdf]"},examples:[{code:"0.2 0.5 vec2 hexprism march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`
# Animate the hexprism's dimensions
(t 0.5 * sin 0.2 * 0.5 +) glsl # Animate radius
(t 0.5 * cos 0.2 * 0.5 +) glsl # Animate height
vec2 hexprism
(p y 2 *) glsl 1.0 1.0 hsv material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated hexprism with a vertical color gradient."}]},mandelbox={definition:{exec:function*(e){const o={folding:e.pop(),iterations:e.pop(),scale:e.pop()};e.push(createMarchingObject("mandelbox","geometry",[],o))},description:"Creates a mandelbox geometry.",effect:"[scale iterations folding] -> [sdf]"},examples:[{code:["(t sin 0.5 * 1.5 +) glsl 5.0 2.0 mandelbox",'"blue" material',"march","render"],assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."}]},mandelbulb={definition:{exec:function*(e){e.push(createMarchingObject("mandelbulb","geometry",[],{}))},description:"Creates a mandelbulb fractal geometry.",effect:"[] -> [sdf]"},examples:[{code:`mandelbulb
(p 2 *) glsl cnoise material
march
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`# Create the mandelbulb geometry
mandelbulb

# Apply an animated rotation around the Y-axis
(t 0.5 *) glsl 0 1 0 vec3 rotatesdf

# Apply an animated curl noise material for a psychedelic effect
(p 2 * t +) glsl curl material

# Create the scene
march

# Render the final image (without lighting)
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"An animated, rotating mandelbulb with a psychedelic material."}]},octahedron={definition:{exec:function*(e){const o={size:e.pop()};e.push(createMarchingObject("octahedron","geometry",[],o))},description:"Creates a octahedron geometry.",effect:"[size] -> [sdf]"},examples:[{code:"1.0 octahedron march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`
# Animate the octahedron's size
(t 0.5 * sin 0.5 * 1.0 +) glsl
octahedron
# Rotate it for a better view
(t 0.5 *) glsl 1 1 1 vec3 rotatesdf
:green material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a rotating, pulsating octahedron."}]},plane={definition:{exec:function*(e){const o={distance:e.pop(),normal:e.pop()};e.push(createMarchingObject("plane","geometry",[],o))},description:"Creates a plane geometry.",effect:"[normal distance] -> [sdf]"},examples:[{code:"0 1 0 vec3 1.0 plane march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`
0 1 0 vec3
# Animate the plane's distance from the origin
(t sin) glsl
plane
# Apply a checkerboard texture
"checkers" 10 texture
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a plane moving up and down with a checkerboard texture."}]},roundbox={definition:{exec:function*(e){const o={radius:e.pop(),size:e.pop()};e.push(createMarchingObject("roundbox","geometry",[],o))},description:"Creates a roundbox geometry.",effect:"[size radius] -> [sdf]"},examples:[{code:"0.4 0.4 0.4 vec3 0.1 roundbox march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`
0.4 0.4 0.4 vec3
# Animate the roundness
(t sin 0.2 * 0.3 +) glsl
roundbox
(p 5 * t +) glsl cnoise material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a box that smoothly transitions to a sphere and back, with a noise texture."}]},torus={definition:{exec:function*(e){const o={radii:e.pop()};e.push(createMarchingObject("torus","geometry",[],o))},description:"Creates a torus geometry.",effect:"[radii] -> [sdf]"},examples:[{code:"0.8 0.2 vec2 torus march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`
# Animate the radii of the torus
0.8
(t 0.5 * sin 0.2 * 0.3 +) glsl
vec2 torus
(p x 5 *) glsl 1.0 1.0 hsv material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a torus with a pulsating tube radius and a colorful material."}]},torus88={definition:{exec:function*(e){const o={radii:e.pop()};e.push(createMarchingObject("torus88","geometry",[],o))},description:"Creates a torus88 geometry.",effect:"[radii] -> [sdf]"},examples:[{code:"0.8 0.2 vec2 torus88 march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`
# Animate the radii of the torus
0.8
(t 0.5 * sin 0.2 * 0.3 +) glsl
vec2 torus88
(p x 5 *) glsl 1.0 1.0 hsv material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a torus88 with a pulsating tube radius and a colorful material."}]},torus82={definition:{exec:function*(e){const o={radii:e.pop()};e.push(createMarchingObject("torus82","geometry",[],o))},description:"Creates a torus82 geometry.",effect:"[radii] -> [sdf]"},examples:[{code:"0.8 0.2 vec2 torus82 march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`
# Animate the radii of the torus
0.8
(t 0.5 * sin 0.2 * 0.3 +) glsl
vec2 torus82
(p y 5 *) glsl 1.0 1.0 hsv material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a torus82 with a pulsating tube radius and a colorful material."}]},triprism={definition:{exec:function*(e){const o={dimensions:e.pop()};e.push(createMarchingObject("triprism","geometry",[],o))},description:"Creates a triprism geometry.",effect:"[dimensions] -> [sdf]"},examples:[{code:"0.2 0.5 vec2 triprism march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the geometry."},{code:`
# Animate the triprism's dimensions
(t 0.5 * sin 0.2 * 0.5 +) glsl # Animate radius
(t 0.5 * cos 0.2 * 0.5 +) glsl # Animate height
vec2 triprism
(p y 2 *) glsl 1.0 1.0 hsv material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated triprism with a vertical color gradient."}]},fractal={definition:{exec:function*(e){const o={scale:e.pop(),iterations:e.pop()};e.push(createMarchingObject("fractal","geometry",[],o))},description:"Creates a Mandelbox-style fractal geometry based on box and sphere folding.",effect:"[iterations scale] -> [sdf]"},examples:[{code:`8 2.2 fractal
"red" material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the fractal geometry."}]},psychobox={definition:{exec:function*(e){const o={iterations:e.pop()};e.push(createMarchingObject("psychobox","geometry",[],o))},description:"Creates a psychedelic repeating fractal geometry.",effect:"[iterations] -> [sdf]"},examples:[{code:`10 psychobox
march
2 2 5 vec3 "white" 0.1 light
0 0 6 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the fractal geometry."},{code:`
# An animated psychobox with a colorful material
8 # iterations
psychobox

# Animate rotation
(t 0.1 *) glsl 0 1 0 vec3 rotatesdf

# Apply a procedural material based on position and time
(p 3 * t +) glsl curl material

# Set up scene
march

# Add a light for better visibility
2 2 4 vec3 "white" 0.1 light

# Set camera and clipping planes for fractal rendering
0 0 5 vec3 0 0 0 vec3 camera
0.0001 near # Use a small near plane for fractal detail
20 far       # Set a reasonable far plane

# Render
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a rotating, psychedelic fractal."}]},arc2d={definition:{exec:function*(e){const o={rb:e.pop(),ra:e.pop(),sc:e.pop()};e.push(createMarchingObject("arc2d","geometry",[],o))},description:"Creates a 2D arc geometry (extruded).",effect:"[sc ra rb] -> [sdf]"},examples:[{code:"0.866 0.5 vec2 0.5 0.1 arc2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the start/end angles of the arc
(t sin) glsl (t cos) glsl vec2
# Animate the radii
(t 0.5 * sin 0.2 * 0.4 +) glsl
(t 0.5 * cos 0.1 * 0.1 +) glsl
arc2d
1.0 1.2 1.4 wavecolor material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a colorful, animated arc."}]},box2d={definition:{exec:function*(e){const o={size:e.pop()};e.push(createMarchingObject("box2d","geometry",[],o))},description:"Creates a 2D box geometry (extruded rectangular prism).",effect:"[size] -> [sdf]"},examples:[{code:"0.5 0.8 vec2 box2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the box size
(t 0.5 * sin 0.2 * 0.5 +) glsl
(t 0.5 * cos 0.2 * 0.8 +) glsl
vec2 box2d
"yellow" material
(t) glsl 0 0 1 vec3 rotatesdf
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a rotating, pulsating 2D box."}]},circle2d={definition:{exec:function*(e){const o={radius:e.pop()};e.push(createMarchingObject("circle2d","geometry",[],o))},description:"Creates a 2D circle geometry (infinite cylinder).",effect:"[radius] -> [sdf]"},examples:[{code:"0.5 circle2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the radius of the circle
(t 0.5 * sin 0.5 * 0.8 +) glsl
circle2d
1.0 1.2 1.4 wavecolor material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated, pulsating circle with changing colors."}]},cross2d={definition:{exec:function*(e){const o={radius:e.pop(),size:e.pop()};e.push(createMarchingObject("cross2d","geometry",[],o))},description:"Creates a 2D cross geometry (extruded).",effect:"[size radius] -> [sdf]"},examples:[{code:"0.5 0.2 vec2 0.1 cross2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the size of the cross
(t 0.5 * sin 0.2 * 0.5 +) glsl
(t 0.5 * cos 0.2 * 0.2 +) glsl
vec2 0.1 cross2d
"cyan" material
(t) glsl 0 0 1 vec3 rotatesdf
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a rotating, pulsating 2D cross."}]},ellipse2d={definition:{exec:function*(e){const o={size:e.pop()};e.push(createMarchingObject("ellipse2d","geometry",[],o))},description:"Creates a 2D ellipse geometry (extruded).",effect:"[size] -> [sdf]"},examples:[{code:"0.5 0.2 vec2 ellipse2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the ellipse's radii
(t 0.5 * sin 0.2 * 0.5 +) glsl
(t 0.5 * cos 0.2 * 0.2 +) glsl
vec2 ellipse2d
"magenta" material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated, pulsating 2D ellipse."}]},equilateralTriangle2d={definition:{exec:function*(e){const o={radius:e.pop()};e.push(createMarchingObject("equilateralTriangle2d","geometry",[],o))},description:"Creates a 2D equilateral triangle geometry (extruded).",effect:"[radius] -> [sdf]"},examples:[{code:"0.5 equilateralTriangle2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the radius of the triangle
(t 0.5 * sin 0.5 * 0.8 +) glsl
equilateralTriangle2d
"green" material
(t) glsl 0 0 1 vec3 rotatesdf
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a rotating, pulsating 2D triangle."}]},heart2d={definition:{exec:function*(e){e.push(createMarchingObject("heart2d","geometry",[],{}))},description:"Creates a 2D heart geometry (extruded).",effect:"[] -> [sdf]"},examples:[{code:`heart2d
:red material
(t) glsl 0 1 0 vec3 rotatesdf
march
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:"heart2d 0.2 scale randomcolor material render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 2D geometry."}]},hexagon2d={definition:{exec:function*(e){const o={radius:e.pop()};e.push(createMarchingObject("hexagon2d","geometry",[],o))},description:"Creates a 2D hexagon geometry (extruded).",effect:"[radius] -> [sdf]"},examples:[{code:"0.5 hexagon2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the radius of the hexagon
(t 0.5 * sin 0.5 * 0.8 +) glsl
hexagon2d
(p x p y + 2 *) glsl 1.0 1.0 hsv material
(t) glsl 0 0 1 vec3 rotatesdf
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a rotating, pulsating 2D hexagon with a colorful material."}]},hexagram2d={definition:{exec:function*(e){const o={radius:e.pop()};e.push(createMarchingObject("hexagram2d","geometry",[],o))},description:"Creates a 2D hexagram geometry (extruded).",effect:"[radius] -> [sdf]"},examples:[{code:"0.5 hexagram2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the radius of the hexagram
(t 0.5 * sin 0.5 * 0.8 +) glsl
hexagram2d
(p x p y * 5 *) glsl 1.0 1.0 hsv material
(t) glsl 0 0 1 vec3 rotatesdf
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a rotating, pulsating 2D hexagram with a colorful material."}]},isoscelesTriangle2d={definition:{exec:function*(e){const o={size:e.pop()};e.push(createMarchingObject("isoscelesTriangle2d","geometry",[],o))},description:"Creates a 2D isosceles triangle geometry (extruded).",effect:"[size] -> [sdf]"},examples:[{code:"0.5 0.8 vec2 isoscelesTriangle2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the triangle's dimensions
(t 0.5 * sin 0.2 * 0.5 +) glsl
(t 0.5 * cos 0.2 * 0.8 +) glsl
vec2 isoscelesTriangle2d
1.0 1.2 1.4 wavecolor material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated 2D isosceles triangle."}]},moon2d={definition:{exec:function*(e){const o={rb:e.pop(),ra:e.pop(),d:e.pop()};e.push(createMarchingObject("moon2d","geometry",[],o))},description:"Creates a 2D moon geometry (extruded).",effect:"[d ra rb] -> [sdf]"},examples:[{code:"0.3 0.4 0.5 moon2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:"0.3 0.4 0.5 moon2d randomcolor material render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 2D geometry."},{code:`# Animate the moon phase by changing the distance 'd' between the circles
(t sin 0.3 * 0.4 +) glsl
# Define the two radii
0.4 0.3
# Create the moon geometry
moon2d

# Apply an animated horizontal rotation around the Y-axis
(t) glsl 0 1 0 vec3 rotatesdf

# Add a material and render the scene
"yellow" material
march
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated, rotating 2D moon."}]},octogon2d={definition:{exec:function*(e){const o={radius:e.pop()};e.push(createMarchingObject("octogon2d","geometry",[],o))},description:"Creates a 2D octogon geometry (extruded).",effect:"[radius] -> [sdf]"},examples:[{code:"0.5 octogon2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the radius of the octogon
(t 0.5 * sin 0.5 * 0.8 +) glsl
octogon2d
:orange material
(t) glsl 0 0 1 vec3 rotatesdf
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a rotating, pulsating 2D octogon."}]},parallelogram2d={definition:{exec:function*(e){const o={skew:e.pop(),height:e.pop(),width:e.pop()};e.push(createMarchingObject("parallelogram2d","geometry",[],o))},description:"Creates a 2D parallelogram geometry (extruded).",effect:"[width height skew] -> [sdf]"},examples:[{code:"0.3 0.2 0.5 parallelogram2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the dimensions and skew
(t 0.5 * sin 0.2 * 0.5 +) glsl
(t 0.5 * cos 0.2 * 0.2 +) glsl
(t sin 0.5 *) glsl
parallelogram2d
1.0 1.2 1.4 wavecolor material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated, morphing 2D parallelogram."}]},pentagon2d={definition:{exec:function*(e){const o={radius:e.pop()};e.push(createMarchingObject("pentagon2d","geometry",[],o))},description:"Creates a 2D pentagon geometry (extruded).",effect:"[radius] -> [sdf]"},examples:[{code:"0.5 pentagon2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the radius of the pentagon
(t 0.5 * sin 0.5 * 0.8 +) glsl
pentagon2d
:purple material
(t) glsl 0 0 1 vec3 rotatesdf
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a rotating, pulsating 2D pentagon."}]},pie2d={definition:{exec:function*(e){const o={radius:e.pop(),c:e.pop()};e.push(createMarchingObject("pie2d","geometry",[],o))},description:"Creates a 2D pie slice geometry (extruded).",effect:"[c radius] -> [sdf]"},examples:[{code:"0.866 0.5 vec2 0.5 pie2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the angle of the pie slice
(t cos) glsl (t sin) glsl vec2
0.5 pie2d
1.0 1.2 1.4 wavecolor material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:'A shader object rendering an animated "pac-man" effect.'}]},rhombus2d={definition:{exec:function*(e){const o={size:e.pop()};e.push(createMarchingObject("rhombus2d","geometry",[],o))},description:"Creates a 2D rhombus geometry (extruded).",effect:"[size] -> [sdf]"},examples:[{code:"0.5 0.2 vec2 rhombus2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the rhombus's dimensions
(t 0.5 * sin 0.2 * 0.5 +) glsl
(t 0.5 * cos 0.2 * 0.2 +) glsl
vec2 rhombus2d
:teal material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated 2D rhombus."}]},roundedbox2d={definition:{exec:function*(e){const o={radii:e.pop(),size:e.pop()};e.push(createMarchingObject("roundedbox2d","geometry",[],o))},description:"Creates a 2D rounded box geometry (extruded). Radii are specified as a vec4 for top-right, bottom-right, top-left, bottom-left corners.",effect:"[size radii] -> [sdf]"},examples:[{code:"0.5 0.8 vec2 0.1 0.2 0.3 0.4 vec4 roundedbox2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the box size
0.5 0.8 vec2
# Animate the corner radii
(t 0.5 * sin 0.1 * 0.4 +) glsl
(t 0.5 * cos 0.1 * 0.4 +) glsl
(t 0.5 * sin 0.1 * 0.4 +) glsl
(t 0.5 * cos 0.1 * 0.4 +) glsl
vec4 roundedbox2d
1.0 1.2 1.4 wavecolor material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a 2D rounded box with animated corner radii."}]},roundedx2d={definition:{exec:function*(e){const o={radius:e.pop(),width:e.pop()};e.push(createMarchingObject("roundedx2d","geometry",[],o))},description:"Creates a 2D rounded X geometry (extruded).",effect:"[width radius] -> [sdf]"},examples:[{code:"0.5 0.1 roundedx2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the width and radius
(t 0.5 * sin 0.2 * 0.5 +) glsl
(t 0.5 * cos 0.1 * 0.2 +) glsl
roundedx2d
1.0 1.2 1.4 wavecolor material
(t) glsl 0 0 1 vec3 rotatesdf
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a rotating, animated 2D rounded X."}]},segment2d={definition:{exec:function*(e){const o={b:e.pop(),a:e.pop()};e.push(createMarchingObject("segment2d","geometry",[],o))},description:"Creates a 2D line segment geometry (extruded plane).",effect:"[a b] -> [sdf]"},examples:[{code:"-0.5 0 vec2 0.5 0 vec2 segment2d 0.1 round randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the endpoints of the line segment
(t sin -0.5 *) glsl 0 vec2
(t sin 0.5 *) glsl 0 vec2
segment2d
0.1 round
1.0 1.2 1.4 wavecolor material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated, rounded line segment."}]},star2d={definition:{exec:function*(e){const o={m:e.pop(),n:e.pop(),radius:e.pop()};e.push(createMarchingObject("star2d","geometry",[],o))},description:"Creates a 2D star geometry (extruded). N is the number of points, M controls the pointiness (must be between 2 and N).",effect:"[radius n m] -> [sdf]"},examples:[{code:"0.5 5.0 2.5 star2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the pointiness (m) of the star
0.5 5
(t 0.5 * sin 1.5 * 2.5 +) glsl
star2d
:yellow material
(t) glsl 0 0 1 vec3 rotatesdf
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a rotating star with animated points."}]},trapezoid2d={definition:{exec:function*(e){const o={height:e.pop(),r2:e.pop(),r1:e.pop()};e.push(createMarchingObject("trapezoid2d","geometry",[],o))},description:"Creates a 2D isosceles trapezoid geometry (extruded).",effect:"[r1 r2 height] -> [sdf]"},examples:[{code:"0.3 0.2 0.5 trapezoid2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the radii of the trapezoid
(t 0.5 * sin 0.2 * 0.5 +) glsl
(t 0.5 * cos 0.2 * 0.2 +) glsl
0.3 trapezoid2d
1.0 1.2 1.4 wavecolor material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated 2D trapezoid."}]},triangle2d={definition:{exec:function*(e){const o={p2:e.pop(),p1:e.pop(),p0:e.pop()};e.push(createMarchingObject("triangle2d","geometry",[],o))},description:"Creates a 2D triangle geometry from three points (extruded).",effect:"[p0 p1 p2] -> [sdf]"},examples:[{code:"0.5 -0.5 vec2 -0.5 -0.5 vec2 0.0 0.5 vec2 triangle2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate one vertex of the triangle
(t sin 0.5 *) glsl 0.0 vec2
-0.5 -0.5 vec2
0.5 -0.5 vec2
triangle2d
"orange" material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated 2D triangle."}]},vesica2d={definition:{exec:function*(e){const o={height:e.pop(),width:e.pop()};e.push(createMarchingObject("vesica2d","geometry",[],o))},description:"Creates a 2D vesica piscis geometry (extruded).",effect:"[width height] -> [sdf]"},examples:[{code:"0.3 0.5 vesica2d randomcolor material march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the 3D geometry."},{code:`
# Animate the dimensions of the vesica
(t 0.5 * sin 0.2 * 0.5 +) glsl
(t 0.5 * cos 0.2 * 0.3 +) glsl
vesica2d
1.0 1.2 1.4 wavecolor material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated 2D vesica piscis."}]},shape={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if((typeof i!="number"||!Number.isInteger(i)||i<1)&&(i==null?void 0:i.type)!=="glsl_expression")throw new Error("shape expects an integer number of points >= 1 or a glsl_expression.");if(typeof o!="number"&&(o==null?void 0:o.type)!=="glsl_expression")throw new Error("shape expects a radius (number or glsl_expression).");if(typeof i=="number"){const l=Math.round(i);let u,d={radius:o};switch(l){case 1:u="circle2d";break;case 2:let h,m,g;typeof o=="number"?(h=[0,-o/2],m=[0,o/2],g=o*.1):(h={type:"glsl_expression",code:`vec2(0.0, -(${o.code})/2.0)`},m={type:"glsl_expression",code:`vec2(0.0, (${o.code})/2.0)`},g={type:"glsl_expression",code:`(${o.code}) * 0.1`});const b=createMarchingObject("segment2d","geometry",[],{a:h,b:m});e.push(createMarchingObject("round","alteration",[b],{amount:g}));return;case 3:u="equilateralTriangle2d";break;case 4:u="box2d",typeof o=="number"?d={size:[o,o]}:d={size:{type:"glsl_expression",code:`vec2(${o.code})`}};break;case 5:u="pentagon2d";break;case 6:u="hexagon2d";break;case 8:u="octogon2d";break;default:u="ngon2d",d={radius:o,n:l};break}e.push(createMarchingObject(u,"geometry",[],d))}else{const l={radius:o,n:i};e.push(createMarchingObject("ngon2d","geometry",[],l))}},description:"Creates a regular 2D shape geometry (extruded). Based on the number of points 'n': 1 is a circle, 2 is a line, 3 is a triangle, 4 is a square, etc.",effect:"[n radius] -> [sdf]"},examples:[{code:'1 0.5 shape "red" material march render',assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"}},{code:'2 0.5 shape "green" material march render',assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"}},{code:'3 0.5 shape "blue" material march render',assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"}},{code:'4 0.5 shape "yellow" material march render',assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"}},{code:'5 0.5 shape "cyan" material march render',assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"}},{code:'6 0.5 shape "magenta" material march render',assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"}},{code:'7 0.5 shape "white" material march render',assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"}},{code:`(t 0.2 * sin 3 * 6 + floor) glsl # Animate number of sides from 3 to 9
0.5 shape
(p x p y + 5 *) glsl 1.0 1.0 hsv material
(t) glsl 0 0 1 vec3 rotatesdf
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an animated, rotating, morphing polygon."}]},isGLSLExpression$1=e=>(e==null?void 0:e.type)==="glsl_expression",pathSDF={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!isGLSLExpression$1(i))throw new Error("pathSDF expects a glsl_expression for the path.");if(typeof o!="number"&&!isGLSLExpression$1(o))throw new Error("pathSDF expects a number or glsl_expression for the radius.");const l={radius:o,path:i};e.push(createMarchingObject("pathSDF","geometry",[],l))},description:"Creates a 3D tube geometry that follows a given path. The path must be a GLSL expression that returns a vec3 based on a float 't'. The radius can be a static float or a dynamic GLSL expression.",effect:"[glsl_path_expr radius] -> [sdf]"},examples:[{code:`
# Define a spiraling path for our "flying snake"
(
    t 0.5 * sin # x
    t 0.5 * cos # y
    t           # z (moves forward over time)
    vec3
) glsl

# Give it a radius
0.2

# Create the path geometry
pathSDF

# Apply a material that changes color along the path's length
(p z 0.5 *) glsl 1.0 1.0 hsv material

# Set up the scene and a camera that follows the snake
march
(
    t 0.5 * sin 2 + # camera x
    t 0.5 * cos 2 + # camera y
    t               # z
    vec3
) glsl
(
    0 0 t vec3
) glsl
camera
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:'A shader object rendering a colorful, spiraling "flying snake" with a moving camera.'},{code:`
# Space Warp Tunnel: A path that looks like a helix
( t 0.2 * sin 2 * t 0.2 * cos 2 * t vec3 ) glsl

# A radius that pulsates over the length of the path
# using p.z (which is the path parameter 't')
(p z 0.5 * sin 0.1 * 0.15 +) glsl

# Create the path geometry
pathSDF

# Hollow it out to make it a tunnel
0.05 onion

# Animate the material inside the tunnel
(p x p y + 5 * t +) glsl 1.0 1.0 hsv material

march
# A camera that flies through the tunnel
(0 0 t vec3) glsl
(0 0 (t 1 +) vec3) glsl
camera
render
`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a flight through a pulsating, colorful, helix-shaped tunnel."},{code:`
# Define a rollercoaster path progressing along the Z axis
(
    (t 2.0 *) sin 2.0 *    # x: go left and right
    (t 4.0 *) cos 0.5 *    # y: go up and down
    t 2.0 *                # z: move forward
    vec3
) glsl

# Give the track a radius
0.2
pathSDF

# Color the track based on its height
(p y 0.5 + 0.5 *) glsl 1.0 1.0 hsv material

march

# Camera follows the path from a "rider's" perspective
# Camera Position (ro) is slightly above the track
(
    (t 2.0 *) sin 2.0 *
    ((t 4.0 *) cos 0.5 * 0.3 +)
    (t 2.0 *)
    vec3
) glsl

# Camera Target (ta) is slightly ahead on the track
(
    ((t 0.1 +) 2.0 *) sin 2.0 *
    ((t 0.1 +) 4.0 *) cos 0.5 *
    ((t 0.1 +) 2.0 *)
    vec3
) glsl
camera

render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a colorful rollercoaster track with a first-person camera."}]},difference={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!isMarchingObject(i)||!isMarchingObject(o))throw new Error("difference expects two SDF objects on the stack.");e.push(createMarchingObject("difference","combinator",[i,o],{}))},description:"Combines two SDFs with the difference operation.",effect:"[sdfA sdfB] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box  difference march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."},{code:`
# A static box
0.5 0.5 0.5 vec3 box

# A sphere whose radius animates, creating a pulsating effect
(t 0.5 * sin 0.2 * 0.4 +) glsl sphere

# Subtract the sphere from the box
difference

# Apply a material
:magenta material

# Set up the scene and render
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a box with a pulsating sphere-shaped hole cut out of it."}]},smoothUnion={definition:{exec:function*(e){const o={smoothness:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("smoothUnion expects two SDF objects on the stack.");e.push(createMarchingObject("smoothUnion","combinator",[l,i],o))},description:"Combines two SDFs with the smoothUnion operation.",effect:"[sdfA sdfB smoothness] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box 0.2 smoothUnion march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."},{code:`
# A triangle
3 0.5 shape
# A square, translated
4 0.5 shape 0.5 0 0 vec3 translate
# Animate the smoothness
(t sin 0.5 * 0.5 +) glsl
smoothUnion
:orange material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a smoothly blended, animated union of a triangle and a square."}]},smoothDifference={definition:{exec:function*(e){const o={smoothness:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("smoothDifference expects two SDF objects on the stack.");e.push(createMarchingObject("smoothDifference","combinator",[l,i],o))},description:"Combines two SDFs with the smoothDifference operation.",effect:"[sdfA sdfB smoothness] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box 0.2 smoothDifference march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."}]},smoothIntersection={definition:{exec:function*(e){const o={smoothness:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("smoothIntersection expects two SDF objects on the stack.");e.push(createMarchingObject("smoothIntersection","combinator",[l,i],o))},description:"Combines two SDFs with the smoothIntersection operation.",effect:"[sdfA sdfB smoothness] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box 0.2 smoothIntersection march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."}]},roundUnion={definition:{exec:function*(e){const o={size:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("roundUnion expects two SDF objects on the stack.");e.push(createMarchingObject("roundUnion","combinator",[l,i],o))},description:"Combines two SDFs with the roundUnion operation.",effect:"[sdfA sdfB size] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box 0.2 roundUnion march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."},{code:`
# A line
2 0.8 shape
# A circle, translated to one end of the line
1 0.3 shape 0.6 0 0 vec3 translate
# Create a rounded union
0.2 roundUnion
:purple material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a rounded union, creating a capsule-like shape."}]},roundIntersection={definition:{exec:function*(e){const o={size:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("roundIntersection expects two SDF objects on the stack.");e.push(createMarchingObject("roundIntersection","combinator",[l,i],o))},description:"Combines two SDFs with the roundIntersection operation.",effect:"[sdfA sdfB size] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box 0.2 roundIntersection march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."}]},roundDifference={definition:{exec:function*(e){const o={size:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("roundDifference expects two SDF objects on the stack.");e.push(createMarchingObject("roundDifference","combinator",[l,i],o))},description:"Combines two SDFs with the roundDifference operation.",effect:"[sdfA sdfB size] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box 0.2 roundDifference march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."}]},chamferUnion={definition:{exec:function*(e){const o={size:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("chamferUnion expects two SDF objects on the stack.");e.push(createMarchingObject("chamferUnion","combinator",[l,i],o))},description:"Combines two SDFs with the chamferUnion operation.",effect:"[sdfA sdfB size] -> [sdfC]"},examples:[{code:"0.2 0.8 0.2 vec3 box 0.8 0.2 0.2 vec3 box 0.1 chamferUnion march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."},{code:`
# A square
4 0.4 shape
# Another square, translated
4 0.4 shape 0.3 0.3 0 vec3 translate
# Create a chamfered union
0.1 chamferUnion
:green material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a chamfered union of two squares."}]},chamferIntersection={definition:{exec:function*(e){const o={size:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("chamferIntersection expects two SDF objects on the stack.");e.push(createMarchingObject("chamferIntersection","combinator",[l,i],o))},description:"Combines two SDFs with the chamferIntersection operation.",effect:"[sdfA sdfB size] -> [sdfC]"},examples:[{code:"0.6 0.6 0.6 vec3 box 0.8 sphere 0.5 0.5 0.5 vec3 translate 0.1 chamferIntersection march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."}]},chamferDifference={definition:{exec:function*(e){const o={size:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("chamferDifference expects two SDF objects on the stack.");e.push(createMarchingObject("chamferDifference","combinator",[l,i],o))},description:"Combines two SDFs with the chamferDifference operation.",effect:"[sdfA sdfB size] -> [sdfC]"},examples:[{code:"0.5 0.5 0.5 vec3 box 0.6 sphere 0.5 0.5 0.5 vec3 translate 0.1 chamferDifference march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."}]},pipe={definition:{exec:function*(e){const o={size:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("pipe expects two SDF objects on the stack.");e.push(createMarchingObject("pipe","combinator",[l,i],o))},description:"Combines two SDFs with the pipe operation.",effect:"[sdfA sdfB size] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box 0.2 pipe march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."}]},engrave={definition:{exec:function*(e){const o={size:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("engrave expects two SDF objects on the stack.");e.push(createMarchingObject("engrave","combinator",[l,i],o))},description:"Combines two SDFs with the engrave operation.",effect:"[sdfA sdfB size] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box 0.2 engrave march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."}]},groove={definition:{exec:function*(e){const o={size:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("groove expects two SDF objects on the stack.");e.push(createMarchingObject("groove","combinator",[l,i],o))},description:"Combines two SDFs with the groove operation.",effect:"[sdfA sdfB size] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box 0.2 groove march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."}]},tongue={definition:{exec:function*(e){const o={size:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("tongue expects two SDF objects on the stack.");e.push(createMarchingObject("tongue","combinator",[l,i],o))},description:"Combines two SDFs with the tongue operation.",effect:"[sdfA sdfB size] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box 0.2 tongue march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."}]},stairsUnion={definition:{exec:function*(e){const o={steps:e.pop(),radius:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("stairsUnion expects two SDF objects on the stack.");e.push(createMarchingObject("stairsUnion","combinator",[l,i],o))},description:"Combines two SDFs with the stairsUnion operation.",effect:"[sdfA sdfB radius steps] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box 0.2 4.0 stairsUnion march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."},{code:`
# A circle
1 0.5 shape
# A pentagon, translated
5 0.5 shape 0.6 0 0 vec3 translate
# Create 8 steps with a radius of 0.1
0.1 8.0 stairsUnion
:cyan material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a stepped union between a circle and a pentagon."}]},stairsIntersection={definition:{exec:function*(e){const o={steps:e.pop(),radius:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("stairsIntersection expects two SDF objects on the stack.");e.push(createMarchingObject("stairsIntersection","combinator",[l,i],o))},description:"Combines two SDFs with the stairsIntersection operation.",effect:"[sdfA sdfB radius steps] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box 0.2 4.0 stairsIntersection march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."}]},stairsDifference={definition:{exec:function*(e){const o={steps:e.pop(),radius:e.pop()},i=e.pop(),l=e.pop();if(!isMarchingObject(l)||!isMarchingObject(i))throw new Error("stairsDifference expects two SDF objects on the stack.");e.push(createMarchingObject("stairsDifference","combinator",[l,i],o))},description:"Combines two SDFs with the stairsDifference operation.",effect:"[sdfA sdfB radius steps] -> [sdfC]"},examples:[{code:"0.5 sphere 0.3 0.3 0.6 vec3 box 0.2 4.0 stairsDifference march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the combination."}]},translate={definition:{exec:function*(e){const o={amount:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("translate expects an SDF object on the stack.");e.push(createMarchingObject("translate","transformation",[i],o))},description:"Applies a translate transformation to an SDF object.",effect:"[sdfA amount] -> [sdfB]"},examples:[{code:"0.5 sphere 0.5 0 0 vec3 translate march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the transformation."},{code:`
# A small sphere to trace the path
0.1 sphere
# Create a dynamic translation vector for a Lissajous curve
(
  (t 2 * sin) glsl # x
  (t 3 * cos) glsl # y
  0.0              # z
  vec3
) glsl translate
:yellow material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a sphere moving in a Lissajous curve."}]},rotatesdf={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop();if(!isMarchingObject(l))throw new Error("rotatesdf expects an SDF object on the stack.");e.push(createMarchingObject("rotate","transformation",[l],{angle:i,axis:o}))},description:"Applies a rotate transformation to an SDF object.",effect:"[sdfA angle axis] -> [sdfB]"},examples:[{code:"1 1 1 vec3 box 2 0 1 0 vec3 rotatesdf march render",assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"}},{code:`
0.2 0.8 vec2 hexprism
(t) glsl # Animate the angle
(
  # Animate the rotation axis itself to create a wobble
  (t cos) glsl # x component of axis
  1.0          # y component of axis
  (t sin) glsl # z component of axis
  vec3
) glsl
rotatesdf
:magenta material
march render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a hexprism with a complex, wobbling rotation."}]},scale={definition:{exec:function*(e){const o={amount:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("scale expects an SDF object on the stack.");e.push(createMarchingObject("scale","transformation",[i],o))},description:"Applies a uniform scale transformation to an SDF object. The amount should be a single number. For non-uniform scaling, construct a scaling matrix and use the 'transform' operator.",effect:"[sdfA F_amount] -> [sdfB]"},examples:[{code:"0.5 sphere 1.5 scale march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the transformation."}]},repeat={definition:{exec:function*(e){const o={spacing:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("repeat expects an SDF object on the stack.");e.push(createMarchingObject("repeat","transformation",[i],o))},description:"Repeats an SDF object at regular intervals along a vector.",effect:"[sdfA spacing] -> [sdfB]"},examples:[{code:"0.5 sphere 1.5 1.5 0.0 vec3 repeat march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the transformation."},{code:`
# A pentagon that pulses in size
5 (t sin 0.1 * 0.3 +) glsl shape
:cyan material

# Repeat it along the X-axis with animated spacing
((t cos 0.5 *) 1.5 + 0 0 vec3) glsl
repeat

# Set up scene and render
march
2 2 4 vec3 :white 0.1 light
0 0 5 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an infinite line of pulsating pentagons that move closer and further apart."}]},mirrorRepeat={definition:{exec:function*(e){const o={spacing:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("mirrorRepeat expects an SDF object on the stack.");e.push(createMarchingObject("mirrorRepeat","transformation",[i],o))},description:"Applies a mirrorRepeat transformation to an SDF object.",effect:"[sdfA spacing] -> [sdfB]"},examples:[{code:"0.5 sphere 1.5 1.5 0.0 vec3 mirrorRepeat march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the transformation."},{code:`
# A line shape, offset from the center
2 0.5 shape
0.5 0.5 0 vec3 translate
:orange material

# Animate the spacing of the mirror repeat to create a breathing, kaleidoscopic pattern
((t sin 1 *) 1.5 + (t cos 1 *) 1.5 + 0 vec3) glsl
mirrorRepeat

# Set up scene and render
march
2 2 4 vec3 :white 0.1 light
0 0 5 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering an intricate, symmetric, animated pattern."}]},limitedRepeat={definition:{exec:function*(e){const o={limits:e.pop(),spacing:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("limitedRepeat expects an SDF object on the stack.");e.push(createMarchingObject("limitedRepeat","transformation",[i],o))},description:"Applies a limitedRepeat transformation to an SDF object.",effect:"[sdfA spacing limits] -> [sdfB]"},examples:[{code:"0.5 sphere 1.5 1.5 1.5 vec3 2 2 2 vec3 limitedRepeat march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the transformation."},{code:`
# Define a single picket
4 0.2 shape 0 0.2 0 vec3 translate # The post
3 0.2 shape 0 0.4 0 vec3 translate # The top
0.01 smoothUnion # Join them smoothly

# Repeat the picket to make a fence
0.5 0 0 vec3  # Spacing along X-axis
5 0 0 vec3    # Repeat 5 times on each side of the origin on X
limitedRepeat

# Give it a white color
:white material

# Set up the scene
march
0.2 0.7 0.8 rgb swap background # Sky blue background
0 0.1 2 vec3 0 0.1 0 vec3 camera
-2 1 3 vec3 :white 0.1 light
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a white picket fence against a blue sky."},{code:`
# Define a tile unit with two shapes and colors
4 0.3 shape :blue material
5 0.3 shape 0.3 0.3 0 vec3 translate :red material
0.1 smoothUnion

# Repeat the tile unit in a 3x3 grid on the XZ plane
# Repeat 3 times along X
0.7 0 0 vec3 1 0 0 vec3 limitedRepeat
# Repeat the row of tiles 3 times along Z
0 0 0.7 vec3 0 0 1 vec3 limitedRepeat

# Set up scene
march
# Add a light orbiting above the floor
((t sin 4 *) 3.0 (t cos 4 *) vec3) glsl :white 0.05 light
# Set camera to look down at the floor
0 4 0.1 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a 3x3 tiled floor with an animated light source."},{code:`
# Create a base hexagonal shape and animate its radius to make it pulse
(t sin 0.2 * 0.4 +) glsl 6 swap shape

# Apply a psychedelic animated material
1.0 1.2 1.4 wavecolor material

# Repeat it 5 times horizontally to create a wall
1.0 0 0 vec3 # spacing
2 0 0 vec3   # limits (2 on each side + origin = 5 total)
limitedRepeat

# Set up scene and render
march
2 2 5 vec3 :white 0.1 light
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a wall of 5 pulsating, color-shifting hexagons."},{code:`
# A simple cube will be our repeated unit
4 0.2 shape
(p 5 * t +) glsl curl material

# Animate the limits of the repetition to make the line of cubes grow
1.0 0 0 vec3 # spacing
((t 0.5 * floor 3 +) 0 0 vec3) glsl # Animate X limit from 0 to 3
limitedRepeat

# Set up the scene with a camera that pulls back
march
((t 0.5 *) 3 4 vec3) glsl 0 0 0 vec3 camera
2 2 5 vec3 :white 0.1 light
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader showing a line of cubes that grows in number over time."},{code:`
# Create a single ring using difference
1 0.25 shape # Outer circle
1 0.2 shape  # Inner circle
difference
:gray material

# Repeat the ring, animating the spacing between links
(t sin 0.1 * 0.5 + 0.6 + 0 0 vec3) glsl
3 0 0 vec3 # limits (7 links total)
limitedRepeat

march
-2 2 4 vec3 :white 0.1 light
2 -2 4 vec3 :white 0.1 light
0 0 5 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader rendering a chain of 7 rings that expands and contracts."}]},polarRepeat={definition:{exec:function*(e){const o={count:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("polarRepeat expects an SDF object on the stack.");e.push(createMarchingObject("polarRepeat","transformation",[i],o))},description:"Repeats an SDF object in a circle around the Z-axis. Uses a two-sample method to ensure correct distances, preventing artifacts with asymmetric shapes.",effect:"[sdfA count] -> [sdfB]"},examples:[{code:"0.1 0.2 0.3 vec3 0.05 roundbox 0.8 0 0 vec3 translate 5.0 polarRepeat march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the transformation."},{code:`
# A triangle shape, made larger
3 0.25 shape
:magenta material
# Also rotate the triangle itself over time
(t) glsl 0 0 1 vec3 rotatesdf

# Translate the shape away from the origin to form a ring
3 0 0 vec3 translate

# Animate the number of repetitions in the circle
(t 0.01 * sin 0.1 * 25 + floor) glsl
polarRepeat

# Set up scene and render
march
1 2 4 vec3 :yellow 0.01 light
0 0 5 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a ring of spinning triangles, where the number of triangles animates over time."}]},rectangularRepeat={definition:{exec:function*(e){const o={spacing:e.pop(),size:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("rectangularRepeat expects an SDF object on the stack.");e.push(createMarchingObject("rectangularRepeat","transformation",[i],o))},description:"Repeats an SDF object along the perimeter of a rectangle. This is a fast, single-sample version that works best for shapes that are symmetric within their repetition cell.",effect:"[sdfA size spacing] -> [sdfB]"},examples:[{code:"0.5 sphere 3 2 vec2 1.0 rectangularRepeat march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the transformation."},{code:`
# A small circle shape
1 0.1 shape
:yellow material

# Animate the size of the rectangular repetition to create a pulsating frame
(
  (t 0.5 * sin 1 * 2 +) # sx
  (t 0.5 * cos 1 * 2 +) # sy
  vec2
) glsl # size
1.0 # spacing
rectangularRepeat

# Set up scene and render
march
2 2 4 vec3 :white 0.1 light
0 0 5 vec3 0 0 0 vec3 camera
render`,assert:e=>{var o;return((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a pulsating rectangular frame of circles."}]},mirror={definition:{exec:function*(e){const o=e.pop();if(!isMarchingObject(o))throw new Error("mirror expects an SDF object on the stack.");e.push(createMarchingObject("mirror","transformation",[o],{}))},description:"Applies a mirror transformation to an SDF object, creating symmetry across the origin planes (x=0, y=0, z=0).",effect:"[sdfA] -> [sdfB]"},examples:[{code:[`# An asymmetric box to better visualize the mirroring
0.2 0.4 0.2 vec3 box

# Animate the box's position in a figure-8 path to ensure it stays in view
(
    t sin 1.2 *        # Animate x-coordinate with radius 1.2
    t 2 * sin 0.5 * 0.5 + # Animate y-coordinate to move up and down
    t cos 1.2 *        # Animate z-coordinate with radius 1.2
    vec3
) glsl
translate

# Mirror the animated box across all axes
mirror

# Set up the scene
march

# Add a camera for a better viewpoint
0 2 6 vec3 0 0 0 vec3 camera

# Add two lights from opposite sides to ensure constant illumination
-3 3 4 vec3 "white" 0.1 light
 3 -1 4 vec3 "white" 0.1 light

# Render
render`],assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object with 8 animated boxes mirrored across all axes, moving in a figure-8 path within view and well-lit."}]},mirrorX={definition:{exec:function*(e){const o=e.pop();if(!isMarchingObject(o))throw new Error("mirrorX expects an SDF object on the stack.");e.push(createMarchingObject("mirrorX","transformation",[o],{}))},description:"Applies a mirrorX transformation to an SDF object.",effect:"[sdfA] -> [sdfB]"},examples:[{code:"0.2 0.3 0.4 vec3 box 0.3 0 0 vec3 translate mirrorX march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the transformation."}]},mirrorY={definition:{exec:function*(e){const o=e.pop();if(!isMarchingObject(o))throw new Error("mirrorY expects an SDF object on the stack.");e.push(createMarchingObject("mirrorY","transformation",[o],{}))},description:"Applies a mirrorY transformation to an SDF object.",effect:"[sdfA] -> [sdfB]"},examples:[{code:"0.2 0.3 0.4 vec3 box 0 0.3 0 vec3 translate mirrorY march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the transformation."}]},mirrorZ={definition:{exec:function*(e){const o=e.pop();if(!isMarchingObject(o))throw new Error("mirrorZ expects an SDF object on the stack.");e.push(createMarchingObject("mirrorZ","transformation",[o],{}))},description:"Applies a mirrorZ transformation to an SDF object.",effect:"[sdfA] -> [sdfB]"},examples:[{code:"0.2 0.3 0.4 vec3 box 0 0 0.3 vec3 translate mirrorZ march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the transformation."}]},bend={definition:{exec:function*(e){const o={amount:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("bend expects an SDF object on the stack.");e.push(createMarchingObject("bend","transformation",[i],o))},description:"Applies a bend transformation to an SDF object.",effect:"[sdfA amount] -> [sdfB]"},examples:[{code:"1 1 1 vec3 box 0.5 bend march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the transformation."},{code:`
# Create a tall box to emphasize the bend
0.2 1.0 0.2 vec3 box

# Animate the bend amount over time
(t sin 2.0 *) glsl
bend

# Apply a colorful material for better visualization
(p y 2.0 *) glsl 1.0 1.0 hsv material

# Set up scene and render
march
2 2 4 vec3 "white" 0.1 light
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a tall box that bends back and forth over time."}]},twist={definition:{exec:function*(e){const o={amount:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("twist expects an SDF object on the stack.");e.push(createMarchingObject("twist","transformation",[i],o))},description:"Applies a twist transformation to an SDF object.",effect:"[sdfA amount] -> [sdfB]"},examples:[{code:"2 2 2 vec3 box 5.0 twist march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the transformation."}]},elongate={definition:{exec:function*(e){const o={h:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("elongate expects an SDF object on the stack.");e.push(createMarchingObject("elongate","transformation",[i],o))},description:"Applies a elongate transformation to an SDF object.",effect:"[sdfA h] -> [sdfB]"},examples:[{code:"0.2 0.3 0.4 vec3 box 0.1 0.1 0.1 vec3 elongate march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the transformation."}]},transform={definition:{exec:function*(e){var l;const o=e.pop(),i=e.pop();if(!isMarchingObject(i))throw new Error("transform expects an SDF object on the stack.");if(isMatrix(o)){const u=o.length,d=((l=o[0])==null?void 0:l.length)??0;if(u!==3&&u!==4||u!==d)throw new Error("transform matrix must be a square 3x3 or 4x4 matrix.")}else if((o==null?void 0:o.type)==="glsl_expression"){if(o.returnType!=="mat3"&&o.returnType!=="mat4")throw new Error("glsl_expression used with transform must have a returnType of 'mat3' or 'mat4'.")}else throw new Error("transform expects a matrix or a matrix-returning glsl_expression on the stack.");e.push(createMarchingObject("transform","transformation",[i],{matrix:o}))},description:"Applies a matrix transformation to an SDF object. The matrix must be 3x3 (for rotations/scaling) or 4x4 (for affine transformations including translation).",effect:"[sdfA matrix] -> [sdfB]"},examples:[{code:`
# Create a box
0.4 0.4 0.4 vec3 box

# Create a dynamic scaling matrix that pulses along the X-axis
(t sin 0.5 * 1 +) glsl # sx: pulses between 0.5 and 1.5
1.0                     # sy: static
1.0                     # sz: static
scalemat

# Apply the dynamic matrix
transform

# Animate the object's rotation as well for a better effect
(t 0.5 *) glsl 0 1 0 vec3 rotatesdf

# Render the scene
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a box that pulses horizontally over time."},{code:`
# A sheared box, impossible with standard operators
1 0.5 0  0 1 0  0 0 1
3 mat

# Apply the shear matrix to a box
0.5 0.5 0.5 vec3 box swap transform

# Render the scene
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a sheared box."},{code:`
# A sphere to be squashed
1 sphere
# Apply non-uniform scaling
1.5 0.5 1.0 scalemat transform
(
  # Use p's length (distance from center) for the material
  p length
  1.0 swap - # Invert: 1 at center, 0 at edge
  dup *      # Sharpen the falloff with an exponential curve
  
  # Map the result to a red-hot glow (hue=0)
  0.0 1.0 swap hsv
) glsl material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a squashed sphere with a glowing core."}]},onion={definition:{exec:function*(e){const o={thickness:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("onion expects an SDF object on the stack.");e.push(createMarchingObject("onion","alteration",[i],o))},description:"Applies a onion alteration to an SDF object.",effect:"[sdfA thickness] -> [sdfB]"},examples:[{code:"0.5 sphere 0.1 onion march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the alteration."}]},round={definition:{exec:function*(e){const o={amount:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("round expects an SDF object on the stack.");e.push(createMarchingObject("round","alteration",[i],o))},description:"Applies a round alteration to an SDF object.",effect:"[sdfA amount] -> [sdfB]"},examples:[{code:"0.4 0.4 0.4 vec3 box 0.1 round march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the alteration."}]},halve={definition:{exec:function*(e){const o={direction:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("halve expects an SDF object on the stack.");e.push(createMarchingObject("halve","alteration",[i],o))},description:"Applies a halve alteration to an SDF object.",effect:"[sdfA direction] -> [sdfB]"},examples:[{code:"0.5 sphere 0.0 halve march render",assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering the alteration."}]},displace={definition:{exec:function*(e){const o={amount:e.pop()},i=e.pop();if(!isMarchingObject(i))throw new Error("displace expects an SDF object on the stack.");e.push(createMarchingObject("displace","alteration",[i],o))},description:"Applies a displacement to the surface of an SDF object. The displacement amount can be a float or a GLSL expression for procedural patterns.",effect:"[sdfA (F|glsl_expression)_amount] -> [sdfB]"},examples:[{code:`1.0 sphere
(
  p x 20 * sin
  p y 20 * sin *
  p z 20 * sin *
  0.1 *
) glsl
displace
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a displaced sphere."},{code:`
1.0 sphere
(
  # Use time 't' to animate the displacement pattern
  p x 10 * t + sin
  p y 10 * t + cos *
  p z 10 * t + sin *
  0.2 * # displacement amount
) glsl
displace
:cyan material
march
2 2 4 vec3 :white 0.1 light
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a sphere with a writhing, animated surface displacement."},{code:`
# A horizontal plane
0 1 0 vec3 0 plane
(
  # Sine wave based only on the p.x coordinate and time
  p x 10 * t + sin
  0.1 * # Control displacement amount
) glsl displace
:cyan material
march
# Use a better camera angle to view the ripples
0 2 5 vec3 0 0 0 vec3 camera
2 2 4 vec3 "white" 0.1 light
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a plane with animated vertical ripples."}]},distEuclidean={definition:{exec:function*(){throw new Error("Operator 'distEuclidean' can only be used inside a 'glsl' quotation.")},description:"Calculates the Euclidean distance between two vectors. Must be used inside a `glsl` quotation.",effect:"[vecA vecB] -> [float]"},examples:[{code:`2 2 2 vec3 box
(
  # Calculate Euclidean distance from the center
  p xy 0 0 vec2 distEuclidean
  
  # Scale distance to create more hue cycles
  5 *
  
  # Create a colorful pattern by mapping distance to hue
  1.0 1.0 hsv
) glsl material
march
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a box with colorful circular ripples."},{code:`2 2 2 vec3 box
(
  # Animate the center of the distance calculation
  p xy
  (t sin) glsl (t cos) glsl vec2
  distEuclidean
  
  # Create ripples
  10 * sin
  
  # Make it grayscale
  dup dup vec3
) glsl material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a box with ripples moving in a circle."}]},distManhattan={definition:{exec:function*(){throw new Error("Operator 'distManhattan' can only be used inside a 'glsl' quotation.")},description:"Calculates the Manhattan (taxicab) distance between two vectors. Must be used inside a `glsl` quotation.",effect:"[vecA vecB] -> [float]"},examples:[{code:`2 2 2 vec3 box
(
  # Calculate Manhattan distance from the center
  p xy 0 0 vec2 distManhattan
  
  # Scale distance to create more hue cycles
  5 *
  
  # Create a colorful pattern by mapping distance to hue
  1.0 1.0 hsv
) glsl material
march
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a box with colorful diamond-shaped ripples."},{code:`2 2 2 vec3 box
(
  # Animate the center of the distance calculation
  p xy
  (t sin) glsl (t cos) glsl vec2
  distManhattan
  
  # Create ripples
  10 * sin
  
  # Make it grayscale
  dup dup vec3
) glsl material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a box with diamond-shaped ripples moving in a circle."}]},distChebychev={definition:{exec:function*(){throw new Error("Operator 'distChebychev' can only be used inside a 'glsl' quotation.")},description:"Calculates the Chebychev (chessboard) distance between two vectors. Must be used inside a `glsl` quotation.",effect:"[vecA vecB] -> [float]"},examples:[{code:`2 2 2 vec3 box
(
  # Calculate Chebychev distance from the center
  p xy 0 0 vec2 distChebychev
  
  # Scale distance to create more hue cycles
  5 *
  
  # Create a colorful pattern by mapping distance to hue
  1.0 1.0 hsv
) glsl material
march
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a box with colorful square-shaped ripples."},{code:`2 2 2 vec3 box
(
  # Animate the center of the distance calculation
  p xy
  (t sin) glsl (t cos) glsl vec2
  distChebychev
  
  # Create ripples
  10 * sin
  
  # Make it grayscale
  dup dup vec3
) glsl material
march render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a box with square-shaped ripples moving in a circle."}]},distMinkowski={definition:{exec:function*(){throw new Error("Operator 'distMinkowski' can only be used inside a 'glsl' quotation.")},description:"Calculates the Minkowski distance between two vectors with an exponent p. Must be used inside a `glsl` quotation.",effect:"[vecA vecB p] -> [float]"},examples:[{code:`2 2 2 vec3 box
(
  # Calculate Minkowski distance with an exponent of 4.0
  p xy 0 0 vec2 4.0 distMinkowski
  
  # Scale distance to create more hue cycles
  5 *
  
  # Create a colorful pattern by mapping distance to hue
  1.0 1.0 hsv
) glsl material
march
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a box with colorful 'squircle'-shaped ripples."},{code:`2 2 2 vec3 box
(
  # Animate the exponent 'p' over time to morph the shape
  p xy 0 0 vec2
  t 0.5 * sin 3.0 * 2.5 +
  
  # Stack is now [vec_a, vec_b, p_val], which is the correct order
  distMinkowski
  
  # Scale distance to create more hue cycles
  5 *
  
  # Create a colorful pattern by mapping distance to hue
  1.0 1.0 hsv
) glsl material
march
render`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader object rendering a box with an animated, colorful morphing ripple pattern."}]},isSceneObject=e=>e&&typeof e=="object"&&e.type==="scene",isGLSLExpression=e=>(e==null?void 0:e.type)==="glsl_expression",path={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.length>0?e[e.length-1]:void 0;let u,d,h;if(isGLSLExpression(o)&&isSceneObject(i))d=o,u=i;else if(isGLSLExpression(o)&&isGLSLExpression(i)&&isSceneObject(l))h=o,d=i,u=e.pop();else throw e.push(i,o),new Error("path expects [scene (path_glsl)] or [scene (path_glsl) (look_glsl)].");const m=generatePathShader(u,d,h);e.push({type:"shader",code:m})},description:`Creates a cinematic fly-through of a scene. Takes a scene object and a path quotation. An optional third GLSL quotation can be provided for interactive "look-around" control. The path quotation must be a GLSL expression that takes a float 't' and returns a 'vec3' position. The look-around quotation should return a 'vec2' to offset the view. The operator automatically carves a tunnel through the scene to avoid camera collisions.`,effect:"[scene (path_glsl) (look_glsl)?] -> [shader]"},examples:[{code:`
# 1. Define the world (a psychedelic fractal)
2 psychobox
(p 1 *) glsl curl material
march

# 2. Define a rollercoaster-like path
(
    t 0.25 * # scale time
    dup 2.5 * sin 0.1 * # x
    swap dup cos 0.5 * swap 0.2 * sin 1 * + # y
    t 0.5 * # z
    vec3
) glsl

# 3. Create the tour
path
`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"An animated shader that flies through a psychedelic fractal."},{code:`
# 1. Define the world: a tunnel of rotating, colorful rings
0.8 0.1 vec2 torus # A thin ring
(p z 2 *) glsl 1.0 1.0 hsv material # Color changes with depth
(t) glsl 0 1 0 vec3 rotatesdf # Rotate rings around Y axis
0 0 1.5 vec3 repeat # Repeat every 1.5 units along Z axis
march

# 2. Define a straight path forward for a "warp speed" effect
(
    0 0 t vec3
) glsl

# 3. Create the tour
path
`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader that flies through a tunnel of rotating rings."},{code:`
# 1. Define the world: repeating mandelbulbs
mandelbulb
(p z 2 *) glsl 1.0 1.0 hsv material
0 0 4.0 vec3 repeat
march

# 2. Define a straight path for a cinematic fly-through
(0 0 t vec3) glsl

# 3. Create the wormhole-like tour
path
`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"},expectedDescription:"A shader that flies through a repeating scene of colorful mandelbulbs."},{code:`
# 1. A world of repeating, rotating spheres
0.2 sphere
(t 0.5 *) glsl 1 1 0 vec3 rotatesdf
2 2 2 vec3 repeat
(p z 2 *) glsl 1.0 1.0 hsv material
march

# 2. A simple path moving forward
(0 0 t vec3) glsl

# 3. A GLSL expression to control the view with the mouse
# Normalizes mouse coords to [-1, 1] range to be used as view offsets
(
  mouse u_resolution / 0.5 - 2.0 *
) glsl

# 4. Create the interactive tour
path
`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("vec2 look =")},expectedDescription:"An interactive shader that lets you look around with the mouse while flying through a field of spheres."},{code:`
# 1. A world of repeating, rotating spheres
0.2 sphere
(t 0.5 *) glsl 1 1 0 vec3 rotatesdf
2 2 2 vec3 repeat
(p z 2 *) glsl 1.0 1.0 hsv material
march

# 2. A simple path moving forward
(0 0 t vec3) glsl

# 3. A GLSL expression to control the view with the mouse when held down
# Normalizes mouse coords to [-1, 1] range to be used as view offsets
(
  moused u_resolution / 0.5 - 2.0 *
  u_moused.z # Only apply lookaround when mouse is down
  *
) glsl

# 4. Create the interactive tour
path
`,assert:e=>{var o;return e.length===1&&((o=e[0])==null?void 0:o.type)==="shader"&&e[0].code.includes("u_moused.z")},expectedDescription:"An interactive shader where you can look around by clicking and dragging the mouse while flying through a field of spheres."}]},shaders={name:"Shaders",description:"Operators for creating 3D scenes with Signed Distance Fields.",definitions:{march,smoothmarch,render,light,background,camera,fog,shadow,material,post,iterations,near,far,cloud,cnoise,color,curl,fbm,glsl,hsv,image,julia,juliaset,mandelbrot,mandelbrotset,randomcolor,rgb,texture,wavecolor,worley,voronoi,fuse,smoothstep,invert,edge,brightness,contrast,vec,vec2,vec3,vec4,box,sphere,capsule,cone,cylinder,hexprism,mandelbox,mandelbulb,octahedron,plane,roundbox,torus,torus88,torus82,triprism,fractal,psychobox,pathSDF,arc2d,box2d,circle2d,cross2d,ellipse2d,equilateralTriangle2d,heart2d,hexagon2d,hexagram2d,isoscelesTriangle2d,moon2d,octogon2d,parallelogram2d,pentagon2d,pie2d,rhombus2d,roundedbox2d,roundedx2d,segment2d,shape,star2d,trapezoid2d,triangle2d,vesica2d,difference,smoothUnion,smoothDifference,smoothIntersection,roundUnion,roundIntersection,roundDifference,chamferUnion,chamferIntersection,chamferDifference,pipe,engrave,groove,tongue,stairsUnion,stairsIntersection,stairsDifference,translate,rotatesdf,scale,repeat,mirrorRepeat,limitedRepeat,polarRepeat,rectangularRepeat,mirror,mirrorX,mirrorY,mirrorZ,bend,twist,elongate,transform,displace,halve,onion,round,distEuclidean,distManhattan,distChebychev,distMinkowski,path}},tempo={definition:{exec:function*(e,o,i,l){if(e.length<1)return;const u=e.pop();if(typeof u!="number"||u<=0)throw e.push(u),new Error("tempo expects a positive number for BPM.");audioEngine.setTempo(u),l[":tempo"]={body:u,description:"Global tempo in BPM.",example:"120 tempo"}},description:"Sets the global tempo in Beats Per Minute (BPM), consuming the value from the stack. Also sets the global `:tempo` variable.",effect:"[N_bpm] -> []"},examples:[{replCode:["120 tempo",":tempo"],expected:[120]}]},origin={definition:{exec:function*(e){e.push(audioEngine.getStartTime())},description:"Pushes the start time of the master audio clock (in seconds).",effect:"-> [N_seconds]"},examples:[{code:"origin",assert:e=>typeof e[0]=="number",expectedDescription:"A number representing the start time."}]},elapsed={definition:{exec:function*(e){e.push(audioEngine.getElapsedTime())},description:"Pushes the elapsed time since the master audio clock started (in seconds).",effect:"-> [N_seconds]"},examples:[{code:"elapsed",assert:e=>typeof e[0]=="number",expectedDescription:"A number representing the elapsed time."}]},live$1={definition:{exec:function*(e){const o=e.pop(),i=e.pop();if(!Array.isArray(i))throw e.push(i,o),new Error("live expects a quotation.");if(typeof o!="number"||o<=0)throw e.push(i,o),new Error("live expects a positive number for beat duration.");const l={type:"live-loop-def",quotation:deepClone(i),beatValue:o,sourceCode:[i,o,"live"]};e.push(l)},description:"Creates a live loop definition. When the assigned name is called (or if left on the stack), the loop starts. The loop executes the quotation directly on the main REPL stack every N beats, allowing it to consume values from and push values to the live coding environment.",effect:"[L_quotation N_beats] -> [live-loop-def]"},examples:[{replCode:["120 tempo","() mylist =","(1 mylist <-) 0.25 live myloop ="],assert:(e,o)=>{var i,l;return((l=(i=o.myloop)==null?void 0:i.body)==null?void 0:l.type)==="live-loop-def"},expectedDescription:"A live-loop-def in the dictionary."},{replCode:["120 tempo","(42) 0.25 live"],async:{duration:1050,assert:(e,o)=>e.length>=8&&e.every(i=>i===42),assertDescription:"A nameless live loop should push its results back to the main stack over time."}}]},stop={definition:{exec:function*(e,o,i,l){if(e.length<1)throw new Error("stop expects a name on the stack.");const u=e.pop();let d;if(typeof u=="symbol"){const w=Symbol.keyFor(u);if(!w)throw new Error("stop: Invalid symbol for patch or loop name.");d=`:${w}`}else if(typeof u=="string")d=u;else throw e.push(u),new Error("stop expects a name or symbol for the patch or live loop to stop.");const h=d.startsWith(":")?d.slice(1):d,m=audioEngine.stop(h);o.onVoiceDestroyed&&m.forEach(w=>o.onVoiceDestroyed(w)),audioEngine.cancel(d);const b=l[":loops"],v=b&&"body"in b?b.body:void 0;if(Array.isArray(v)){const w=v.indexOf(d);w>-1&&v.splice(w,1)}},description:"Stops a playing audio patch or a running live loop by its name. For live loops, it removes the loop name from the global `:loops` list, causing it to terminate on its next tick.",effect:"[S_name] -> []"},examples:[{replCode:["120 tempo","(() 1 live) myloop =>","myloop"],async:{duration:300,assert:(e,o,i)=>{var u;const l=(u=o[":loops"])==null?void 0:u.body;return Array.isArray(l)&&l.includes("myloop")},assertDescription:"myloop should be in :loops after starting."}},{replCode:["120 tempo","(() 1 live) myloop =>","myloop","myloop stop"],async:{duration:300,assert:(e,o,i)=>{var u;const l=(u=o[":loops"])==null?void 0:u.body;return Array.isArray(l)&&!l.includes("myloop")},assertDescription:"myloop should not be in :loops after being stopped."}},{replCode:["120 tempo","(() 1 live) :myloop =>",":myloop",":myloop stop"],async:{duration:300,assert:(e,o,i)=>{var u;const l=(u=o[":loops"])==null?void 0:u.body;return Array.isArray(l)&&!l.includes(":myloop")},assertDescription:":myloop should not be in :loops after being stopped."}}]},wait={definition:{exec:function*(e,o,i,l){const u=e.pop(),d=e.pop();if(typeof u!="number"||u<0)throw e.push(d,u),new Error("wait expects a non-negative number for beat duration.");if(!Array.isArray(d))throw e.push(d,u),new Error("wait expects a quotation.");const h=l[":tempo"],g=60/(h&&"body"in h&&typeof h.body=="number"?h.body:120),b=u*g,v=audioEngine.getContextTime()+b,w=async()=>{const O=o.mainStack;if(!O){const k="Error in scheduled 'wait': Could not find main stack.";o.onAsyncOutput?o.onAsyncOutput(k,!0):console.error(k);return}try{await o.run(d,O,{...o,onOutput:o.onAsyncOutput}),o.onAsyncOutput&&o.onAsyncOutput("YIELD_TICK",!1)}catch(k){o.onAsyncOutput?o.onAsyncOutput(`Error in scheduled 'wait' execution: ${k.message}`,!0):console.error("Error in scheduled 'wait' execution:",k)}},D=`wait_${Date.now()}_${Math.random()}`;audioEngine.schedule(D,v,w)},description:"Waits for a specified number of beats, then executes a quotation on the main stack. The main program continues without pausing.",effect:"[L_quotation N_beats] -> []"},examples:[{replCode:["120 tempo","(hush) 0.5 wait"],assert:e=>!0,expectedDescription:"Schedules `hush` to run after 0.5 beats (250ms at 120bpm)."},{replCode:["240 tempo","0 myvar =","(100 myvar =) 0.125 wait"],async:{duration:50,assert:(e,o)=>{var l;return((l=o.myvar)==null?void 0:l.body)===100},assertDescription:"The scheduled program should modify the variable after the wait period."}}]},sleep={definition:{exec:function*(e,o,i,l){const u=e.pop();if(typeof u!="number"||u<0)throw e.push(u),new Error("sleep expects a non-negative number for beat duration.");const d=l[":tempo"],m=60/(d&&"body"in d&&typeof d.body=="number"?d.body:120),g=u*m*1e3;g>0&&(yield new Promise(b=>setTimeout(b,g)))},description:"Pauses the execution of the current program for a specified number of beats. The main program execution is halted during the sleep period.",effect:"[N_beats] -> []"},examples:[{replCode:["120 tempo","1","0.5 sleep","2"],async:{duration:600,assert:e=>e.length===2&&e[0]===1&&e[1]===2,assertDescription:"The stack should contain [1 2] after the sleep."}},{replCode:["120 tempo","(0.25 sleep 1 +) inc =>","0","inc"],async:{duration:200,assert:e=>e.length===1&&e[0]===1,assertDescription:"The stack should contain [1] after the program with sleep executes."}}]},until={definition:{exec:function*(e){const o=e.pop(),i=e.pop(),l=e.pop(),u=e.pop();if(typeof o!="number"||o<0)throw new Error("until expects a non-negative number for end_beats.");if(typeof i!="number"||i<=0)throw new Error("until expects a positive number for interval_beats.");if(!Array.isArray(l))throw new Error("until expects a quotation.");const d={type:"until-def",initialValue:u,quotation:l,intervalBeats:i,endBeats:o,sourceCode:[deepClone(u),deepClone(l),i,o,"until"]};e.push(d)},description:"Creates an 'until' loop definition. When executed (either by name or as a nameless loop), it runs a program at a regular interval for a set duration, directly manipulating the main stack. `initial_value (program) interval_beats end_beats until`. A temporary word `untilN` is created to store the results of each execution; this word is removed when the loop finishes.",effect:"[V [P] I_beats E_beats] -> [until-def]"},examples:[{replCode:["600 tempo","(1 (1 +) 0.125 0.25 until) myloop =>"],assert:(e,o)=>{var l;const i=(l=o.myloop)==null?void 0:l.body;return Array.isArray(i)&&i[1]==="iterate"},expectedDescription:"A function named myloop is created in the dictionary."},{replCode:["600 tempo","1 (1 +) 0.125 0.25 until"],async:{duration:300,assert:(e,o)=>{const i=!Object.keys(o).some(u=>/^until\d+/.test(u)),l=e.length===1&&e[0]===3;return i&&l},assertDescription:"Temporary loop runs, modifies the stack, and removes itself from the dictionary."}},{replCode:["600 tempo","(1 (1 +) 0.125 0.25 until) myloop =>","myloop"],async:{duration:300,assert:(e,o)=>{var h;const i=o.hasOwnProperty("myloop"),l=e.length===1&&e[0]===3,u=(h=o.myloop)==null?void 0:h.body,d=Array.isArray(u)&&u[1]==="iterate";return i&&d&&l},assertDescription:"Named loop runs, modifies the stack, and the function definition persists."}}]},kill={definition:{exec:function*(e,o,i,l){if(e.length<1)throw new Error("kill expects a name on the stack.");const u=e.pop();let d,h;if(typeof u=="symbol"){const O=Symbol.keyFor(u);if(!O)throw new Error("kill: Invalid symbol.");d=`:${O}`,h=`:${O}`}else if(typeof u=="string"||typeof u=="number")d=String(u),h=String(u);else throw e.push(u),new Error(`kill expects a name, symbol, or number, but got ${typeof u}.`);const m=h.startsWith(":")?h.slice(1):h,g=audioEngine.stop(m);o.onVoiceDestroyed&&g.forEach(O=>o.onVoiceDestroyed(O)),audioEngine.cancel(d);const v=l[":loops"],w=v&&"body"in v?v.body:void 0;if(Array.isArray(w)){const O=w.indexOf(d);O>-1&&w.splice(O,1)}if(!l[d])throw new Error(`Cannot kill '${h}': word not found.`);if(o.builtInKeys.has(d))throw new Error(`Cannot kill built-in operator '${h}'.`);delete l[d]},description:"Stops any active process (audio patch or live loop) associated with a name and removes that word from the user dictionary.",effect:"[S_name] -> []"},examples:[{replCode:["10 myvar =","myvar kill","myvar"],expected:["myvar"]},{code:"10 myvar = myvar myvar kill myvar = myvar",expected:[10]},{replCode:["(1 +) inc =>","inc kill","1 inc"],expected:[1,"inc"]},{replCode:["120 tempo","(() 1 live) myloop =>","myloop","myloop kill"],async:{duration:300,assert:(e,o)=>{var d;const i=(d=o[":loops"])==null?void 0:d.body,l=Array.isArray(i)&&!i.includes("myloop"),u=!o.hasOwnProperty("myloop");return l&&u},assertDescription:"The loop should be stopped and the 'myloop' definition removed."}},{replCode:["not_found kill"],expectedError:"Cannot kill 'not_found': word not found."},{replCode:["+ kill"],expectedError:"Cannot kill built-in operator '+'."},{replCode:["() :mydata =",":mydata kill",":mydata"],expected:[Symbol.for("mydata")]}]},live={name:"Live Coding",description:"Operators for timing, scheduling, and live-looping.",definitions:{tempo,origin,elapsed,live:live$1,stop,kill,wait,sleep,until}},mergedMathCategory={name:"Mathematical & Bitwise Operators",description:"Performing arithmetic, bitwise, and common mathematical functions.",definitions:{...math.definitions,...jsMath.definitions}},mergedTypesCategory={name:"Type, Conversion & Regex",description:"Operators for type casting, conversion, and regular expression operations.",definitions:{...jsString.definitions,...types.definitions,...advancedTypes.definitions}},mergedStackCategory={name:"Stack Operations",description:"Operators for directly manipulating the stack, from simple primitives to advanced metaprogramming.",definitions:{...stack.definitions,...advancedStack.definitions}},operatorModules={literals,input,stack:mergedStackCategory,logic,math:mergedMathCategory,matrix,types:mergedTypesCategory,lists,functional,utils,predicates,combinators,recursion,repl,history,audio,shaders,live},Yield=(()=>{const e={},o={},i=new Set,l={},u={"=":"popto","=>":"quote","<-":"appendTo","?":"ifte","@":"matmul","++":"succ","--":"pred",avg:"average","..":"range"};let d=1;for(const O in operatorModules){const k=operatorModules[O],N={};for(const C in k.definitions)N[C]=k.definitions[C];Object.assign(e,N),Object.assign(l,N),o[O]={name:k.name,description:k.description,definitions:N}}Object.keys(e).forEach(O=>i.add(O)),[...Object.keys(operatorModules.combinators.definitions),...Object.keys(operatorModules.recursion.definitions)];const h=()=>{Object.keys(e).forEach(O=>delete e[O]),Object.assign(e,l),w=1,d=1},m=O=>{const k=O.replace(/#.*/g,""),N=/\(|\)|\{|\}|"[^"]*"|:[^\s\(\){}"]+|[^\(\){}\s]+/g,C=k.match(N)||[],V=()=>{const U=[];for(;C.length>0;){const Y=C.shift();if(Y===")")return U;if(Y==="(")U.push(V());else if(Y.startsWith('"')&&Y.endsWith('"'))U.push(`\0${Y.slice(1,-1)}`);else if(Y.startsWith(":"))U.push(Symbol.for(Y.slice(1)));else{const W=parseFloat(Y);U.push(!isNaN(W)&&isFinite(Y)?W:Y)}}return U};return V()},g=(O,k,N,C)=>{const{beatValue:V}=k;if(O){const ee=N[O];N[O]={...ee,body:k}}const U=":loops",Y=N[U];(!Y||!("body"in Y)||!Array.isArray(Y.body))&&(N[U]={body:[],description:"List of active live loops.",example:""});const W=N[U].body;if(!Array.isArray(W))throw new Error(":loops variable has been overwritten with a non-list value.");const P=W;P.includes(O)||P.push(O),audioEngine.cancel(O);let F=audioEngine.getContextTime();const H=async ee=>{var L;const Q=N[U],te=Q&&"body"in Q?Q.body:[];if(!Array.isArray(te)||!te.includes(O))return;const ae=ne=>{if(ne&&C.onAsyncOutput){const $=O.startsWith(":")?O:`:${O}`;C.onAsyncOutput(`
Error in live loop ${$}: ${ne}. Loop stopped.
`,!0)}const S=N[U].body.indexOf(O);S>-1&&N[U].body.splice(S,1)},K=N[O];if(!K||!("body"in K)||((L=K.body)==null?void 0:L.type)!=="live-loop-def"){C.onAsyncOutput&&C.onAsyncOutput(`Live loop '${O}' stopped because its definition changed to a non-loop value.`,!1),ae();return}const I=K.body.quotation;if(!Array.isArray(I)){ae(`Live loop '${O}' has an invalid quotation body.`);return}const me=C.mainStack;if(!me){ae("Live loop cannot run without a main stack context.");return}try{await C.run(I,me,{...C,onOutput:C.onAsyncOutput,isDebug:!1}),C.onAsyncOutput&&C.onAsyncOutput("YIELD_TICK",!1)}catch(ne){ae(ne.message);return}const ce=N[":tempo"],Z=60/(ce&&"body"in ce&&typeof ce.body=="number"?ce.body:120)*V;F+=Z,F<audioEngine.getContextTime()&&(F=audioEngine.getContextTime()+Z),N[U].body.includes(O)&&audioEngine.schedule(O,F,H)};audioEngine.schedule(O,F,H)},b=(O,k,N,C)=>{const V=N[":tempo"],Y=60/(V&&"body"in V&&typeof V.body=="number"?V.body:120),W=k.intervalBeats*Y,P=k.endBeats*Y,F=audioEngine.getContextTime(),H={type:"until-process",quotation:k.quotation,intervalBeats:k.intervalBeats,endBeats:k.endBeats,results:[],isTemporary:!!k.isTemporary},ee=N[O];N[O]={...ee,body:H};const Q=C.mainStack;if(!Q){C.onAsyncOutput&&C.onAsyncOutput(`Error in 'until' loop ${O}: Could not find main stack.`,!0);return}Q.push(k.initialValue),C.onAsyncOutput&&C.onAsyncOutput("YIELD_TICK",!1);const te=async ae=>{if(ae-F>=P){H.isTemporary?delete N[O]:N[O]=ee,C.onAsyncOutput&&C.onAsyncOutput("YIELD_TICK",!1);return}try{await C.run([...k.quotation],Q,{...C,onOutput:C.onAsyncOutput,isDebug:!1}),Q.length>0&&H.results.push(Q[Q.length-1]),C.onAsyncOutput&&C.onAsyncOutput("YIELD_TICK",!1)}catch(I){C.onAsyncOutput&&C.onAsyncOutput(`Error in 'until' loop ${O}: ${I.message}. Loop stopped.`,!0),H.isTemporary&&delete N[O];return}audioEngine.schedule(O,ae+W,te)};audioEngine.schedule(O,F,te)},v=function*(O,k,N={},C=0){O=Array.isArray(O)?[...O]:[O];const V=(U,Y,W)=>v(U,Y,W||N,C+1);for(;O.length>0;){let U=O.shift();if(N.isDebug&&N.onToken&&N.onToken(U,deepClone(k),deepClone(O),C),typeof U=="string"&&u[U]&&(U=u[U]),typeof U=="string"&&U.startsWith("\0")){k.push(U.slice(1)),yield;continue}let Y;if(typeof U=="string"||typeof U=="number")Y=String(U);else if(typeof U=="symbol"){const F=Symbol.keyFor(U);F&&(Y=`:${F}`)}const W=Y?e[Y]:void 0;let P=!1;if(W){P=!0;const F=new Set(["popto","appendTo","yield","body","popstackto","stop","kill","quote"]);if(O.length>0){let H=O[0],ee=typeof H=="string"&&u[H]?u[H]:H;F.has(ee)&&(P=!1)}if(P&&O.length>1){let H=O[1];(typeof H=="string"&&u[H]?u[H]:H)==="yield"&&(P=!1)}}if(P)if("definition"in W)yield*W.definition.exec(k,N,V,e);else{const F=W.body;if((F==null?void 0:F.type)==="live-loop-def"){g(Y,F,e,N),yield;continue}if((F==null?void 0:F.type)==="until-def"){b(Y,F,e,N),yield;continue}if(Array.isArray(F)&&F.length>0&&F[F.length-1]==="iterate"){const te=F[0];if(Y&&Array.isArray(te)&&te.length===1){const ae=te[0];if((ae==null?void 0:ae.type)==="live-loop-def"){g(Y,ae,e,N),yield;continue}if((ae==null?void 0:ae.type)==="until-def"){b(Y,ae,e,N),yield;continue}}if(Array.isArray(te)&&te.length>0&&te[te.length-1]==="yield"&&te.length>=2){const K=te[0],I=te[1];if(!(typeof K=="symbol"||Array.isArray(K)&&K.length===2&&typeof K[1]=="symbol")){W._generator_state===void 0&&(W._generator_state=deepClone(K));const ce=Array.isArray(W._generator_state)?[...W._generator_state]:[W._generator_state];yield*V(I,ce,N),W._generator_state=ce.length===1?ce[0]:ce,ce.length>0&&k.push(ce[ce.length-1]),yield;continue}}O.unshift(...F),yield;continue}const H=deepClone(F),ee=te=>Array.isArray(te)?te.map(ee):typeof te=="string"&&te.startsWith("\0")?te.slice(1):te,Q=ee(H);k.push(Q)}else if(Array.isArray(U)){const F=H=>Array.isArray(H)?H.map(F):typeof H=="string"&&H.startsWith("\0")?H.slice(1):H;k.push(F(U))}else k.push(U);yield}};let w=1;const D=(O,k,N={})=>{const C={...N,parse:m,builtInKeys:i,run:D,mainStack:k,dictionary:e},{stopSignal:V={stopped:!1},pauseSignal:U={paused:!1},onStep:Y=()=>{},getDelay:W=()=>C.delay||0,isDebug:P=!1}=C;return new Promise((F,H)=>{const ee=v(O,k,C,0),Q=5e3,te=async()=>{try{if(V.stopped)return F();if(U.paused){C.setResume&&C.setResume(te);return}const ae=W();if(ae>0&&P){const{value:I,done:me}=ee.next();if(me){for(let ce=k.length-1;ce>=0;ce--){const z=k[ce];if((z==null?void 0:z.type)==="live-loop-def"){const Z=z,L=`live${d++}`;e[L]={body:Z,description:"Nameless live loop",example:""},g(L,Z,e,C),k.splice(ce,1)}else if((z==null?void 0:z.type)==="until-def"){const Z=z;Z.isTemporary=!0;const L=`until${w++}`;e[L]={body:Z,description:"Nameless until loop",example:""},b(L,Z,e,C),k.splice(ce,1)}}return F()}I instanceof Promise&&await I,P&&Y(k),setTimeout(te,ae);return}let K=0;for(;K<Q;){const{value:I,done:me}=ee.next();if(me){for(let ce=k.length-1;ce>=0;ce--){const z=k[ce];if((z==null?void 0:z.type)==="live-loop-def"){const Z=z,L=`live${d++}`;e[L]={body:Z,description:"Nameless live loop",example:""},g(L,Z,e,C),k.splice(ce,1)}else if((z==null?void 0:z.type)==="until-def"){const Z=z;Z.isTemporary=!0;const L=`until${w++}`;e[L]={body:Z,description:"Nameless until loop",example:""},b(L,Z,e,C),k.splice(ce,1)}}return F()}if(I instanceof Promise){await I,setTimeout(te,0);return}K++}setTimeout(te,0)}catch(ae){H(ae)}};te()})};return{dictionary:e,dictionaryCategories:o,builtInKeys:i,aliases:u,parse:m,run:D,reset:h}})();class HistoryManager{constructor(o){this.history=[],this.currentIndex=-1,this.builtInKeys=o}getUserDictionary(o){const i={};for(const l in o)this.builtInKeys.has(l)||(i[l]=o[l]);return i}createSnapshot(o,i){return{stack:deepClone(o),userDictionary:deepClone(this.getUserDictionary(i))}}add(o){this.currentIndex>-1&&deepEqual(this.history[this.currentIndex],o)||(this.currentIndex<this.history.length-1&&this.history.splice(this.currentIndex+1),this.history.push(o),this.currentIndex=this.history.length-1)}undo(){return this.currentIndex>0?(this.currentIndex--,deepClone(this.history[this.currentIndex])):null}redo(){return this.currentIndex<this.history.length-1?(this.currentIndex++,deepClone(this.history[this.currentIndex])):null}clear(){this.history=[],this.currentIndex=-1}}const VERTEX_SHADER=`#version 300 es
in vec2 a_position;
void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
}
`,ShaderCanvas=({shaderCode:e,className:o,isBackground:i=!1})=>{const l=reactExports.useRef(null),u=reactExports.useRef(null),d=reactExports.useRef(null),h=reactExports.useRef({x:0,y:0}),m=reactExports.useRef({x:0,y:0,down:0}),g=reactExports.useRef(0),[b,v]=reactExports.useState(null);return reactExports.useEffect(()=>{var ae;const w=l.current;if(!w)return;const D=new ResizeObserver(K=>{for(let I of K){const{width:me,height:ce}=I.contentRect;w.width=me,w.height=ce,u.current&&u.current.viewport(0,0,me,ce)}});D.observe(w);const O=w.getContext("webgl2");if(!O){v("WebGL2 not supported");return}u.current=O;const k=(K,I)=>{const me=O.createShader(K);if(!me)return null;if(O.shaderSource(me,I),O.compileShader(me),!O.getShaderParameter(me,O.COMPILE_STATUS)){const ce=O.getShaderInfoLog(me);return v(`Shader compile error: ${ce}`),O.deleteShader(me),null}return me},N=k(O.VERTEX_SHADER,VERTEX_SHADER),C=k(O.FRAGMENT_SHADER,e);if(!N||!C)return;const V=O.createProgram();if(!V)return;if(O.attachShader(V,N),O.attachShader(V,C),O.linkProgram(V),!O.getProgramParameter(V,O.LINK_STATUS)){const K=O.getProgramInfoLog(V);v(`Program link error: ${K}`),O.deleteProgram(V);return}d.current=V;const U=O.createBuffer();O.bindBuffer(O.ARRAY_BUFFER,U);const Y=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1];O.bufferData(O.ARRAY_BUFFER,new Float32Array(Y),O.STATIC_DRAW);const W=O.getAttribLocation(V,"a_position");O.enableVertexAttribArray(W),O.vertexAttribPointer(W,2,O.FLOAT,!1,0,0),v(null);const P=K=>{const I=w.getBoundingClientRect();m.current={x:K.clientX-I.left,y:I.height-(K.clientY-I.top),down:1}},F=K=>{m.current.down=0},H=K=>{const I=w.getBoundingClientRect();h.current={x:K.clientX-I.left,y:I.height-(K.clientY-I.top)},m.current.down>.5&&(m.current.x=K.clientX-I.left,m.current.y=I.height-(K.clientY-I.top))},ee=i?((ae=w.parentElement)==null?void 0:ae.parentElement)||document:w;ee.addEventListener("mousedown",P),ee.addEventListener("mouseup",F),ee.addEventListener("mousemove",H);let Q=performance.now();const te=K=>{const I=u.current,me=d.current;if(!I||!me)return;const ce=I.getUniformLocation(me,"u_time"),z=I.getUniformLocation(me,"u_resolution"),Z=I.getUniformLocation(me,"u_mouse"),L=I.getUniformLocation(me,"u_moused");I.viewport(0,0,I.canvas.width,I.canvas.height),I.clear(I.COLOR_BUFFER_BIT),I.useProgram(me),ce&&I.uniform1f(ce,(K-Q)*.001),z&&I.uniform2f(z,I.canvas.width,I.canvas.height),Z&&I.uniform2f(Z,h.current.x,h.current.y),L&&I.uniform3f(L,m.current.x,m.current.y,m.current.down),I.drawArrays(I.TRIANGLES,0,6),g.current=requestAnimationFrame(te)};return g.current=requestAnimationFrame(te),()=>{D.disconnect(),cancelAnimationFrame(g.current),O&&d.current&&O.deleteProgram(d.current),O&&N&&O.deleteShader(N),O&&C&&O.deleteShader(C),ee.removeEventListener("mousedown",P),ee.removeEventListener("mouseup",F),ee.removeEventListener("mousemove",H)}},[e,i]),jsxRuntimeExports.jsxs("div",{className:`relative ${o||""}`,children:[jsxRuntimeExports.jsx("canvas",{ref:l,className:"block w-full h-full"}),b&&jsxRuntimeExports.jsx("pre",{className:"absolute top-0 left-0 bg-red-500/80 text-white p-2 font-mono text-xs max-h-full overflow-auto",children:b})]})};let sessionStack=[];const DictionaryView=({dictionary:e,builtInKeys:o,version:i,onUpdate:l})=>{const u=reactExports.useMemo(()=>Object.entries(e).filter(([v])=>!o.has(v)&&"body"in e[v]),[e,o,i]),[d,h]=reactExports.useState(null);reactExports.useEffect(()=>{h(null)},[i]);const m=v=>{if((v==null?void 0:v.type)==="until-process"){const{quotation:D,intervalBeats:O,endBeats:k}=v;return`${yieldFormatter(D)} ${O} ${k} until`}const w=yieldFormatter(v);return Array.isArray(v)&&w.startsWith("(")&&w.endsWith(")")?w.slice(1,-1):w},g=(v,w)=>{var C;const D=w.currentTarget.innerText,O=e[v];if(!O||typeof O!="object"||!("body"in O)||((C=O.body)==null?void 0:C.type)==="until-process")return;const k=m(O.body);if(D.trim()===k.trim()){d===v&&h(null);return}l(v,D)?d===v&&h(null):(h(v),w.currentTarget.innerText=k)},b=v=>{d===v&&h(null)};return jsxRuntimeExports.jsxs("div",{className:"h-full bg-gray-900 text-white rounded-lg shadow-xl overflow-hidden flex flex-col fira-code",children:[jsxRuntimeExports.jsx("header",{className:"p-3 border-b border-gray-700 bg-gray-800/70",children:jsxRuntimeExports.jsx("h2",{className:"font-bold text-gray-300",children:"GODMODE"})}),jsxRuntimeExports.jsx("div",{className:"p-4 overflow-y-auto flex-grow bg-black/30 text-sm",children:u.length===0?jsxRuntimeExports.jsx("p",{className:"text-gray-500 italic",children:"No user-defined words yet."}):jsxRuntimeExports.jsx("div",{children:u.map(([v,w])=>{var D;return"body"in w&&jsxRuntimeExports.jsxs("div",{className:"flex items-baseline mb-1",children:[jsxRuntimeExports.jsx("span",{className:`font-semibold mr-2 ${d===v?"text-red-500":"text-cyan-400"}`,children:v}),jsxRuntimeExports.jsx("span",{className:"text-gray-500 mr-2",children:"="}),jsxRuntimeExports.jsx("span",{className:"text-gray-300 whitespace-pre-wrap flex-grow outline-none focus:bg-gray-700/50 rounded px-1",contentEditable:typeof w.body=="object"&&((D=w.body)==null?void 0:D.type)!=="until-process",suppressContentEditableWarning:!0,onBlur:O=>g(v,O),onFocus:()=>b(v),onKeyDown:O=>{O.key==="Enter"&&!O.shiftKey&&(O.preventDefault(),O.currentTarget.blur())},children:m(w.body)})]},`${v}-${i}`)})})})]})},Repl=()=>{const[e,o]=reactExports.useState([]),[i,l]=reactExports.useState(""),[u,d]=reactExports.useState(!1),[h,m]=reactExports.useState(!0),[g,b]=reactExports.useState(null),[v,w]=reactExports.useState(null),[D,O]=reactExports.useState(!1),[k,N]=reactExports.useState(0),C=reactExports.useRef(null),V=reactExports.useRef(null),[U,Y]=reactExports.useState([]),[W,P]=reactExports.useState(-1),F=reactExports.useRef(null),H=reactExports.useRef(0),ee=reactExports.useRef(!1);reactExports.useEffect(()=>{var ne;Yield.reset(),sessionStack=[],F.current=new HistoryManager(Yield.builtInKeys);const L=F.current.createSnapshot(sessionStack,Yield.dictionary);F.current.add(L),o([]),(ne=V.current)==null||ne.focus()},[]),reactExports.useEffect(()=>{var L;(L=C.current)==null||L.scrollIntoView({behavior:"smooth"})},[e,h]),reactExports.useEffect(()=>{if(V.current){V.current.style.height="auto";const L=V.current.scrollHeight;V.current.style.height=`${L}px`}},[i]);const Q=reactExports.useCallback((L,ne=!1)=>{const S=L.trim();if(!S)return;if(!ne&&S==="YIELD_TICK"){ee.current||w(`( ${sessionStack.map(yieldFormatter).join(" ")} )`),N(X=>X+1),ee.current=!1;return}let $=S;if(ne){const X=`( ${sessionStack.map(yieldFormatter).join(" ")} )`;$=`${S}
${X}`}else ee.current=!0;const J={type:"async",output:$,isError:ne,id:H.current++};o(X=>[...X,J]),ne&&w(null)},[]),te=()=>{if(Yield.reset(),sessionStack=[],F.current){F.current.clear();const L=F.current.createSnapshot(sessionStack,Yield.dictionary);F.current.add(L)}o([]),l(""),b(null),w(null),m(!0),N(L=>L+1)},ae=reactExports.useCallback((L,ne)=>{var S;try{if(L===":loops")throw new Error("Cannot directly modify the reserved ':loops' variable.");const $=Yield.parse(ne),J=Yield.dictionary[L];if(J&&"body"in J){if(((S=J.body)==null?void 0:S.type)==="until-process")throw new Error("Cannot directly modify a running 'until' process.");J.body=$}else throw new Error(`Cannot update body of non-user-defined word: '${L}'.`);if(N(X=>X+1),F.current){const X=F.current.createSnapshot(sessionStack,Yield.dictionary);F.current.add(X)}return!0}catch($){return Q(`Error updating '${L}': ${$.message}`,!0),!1}},[Q]),K=async L=>{var X,re;if(!L.trim()){const le=`( ${sessionStack.map(yieldFormatter).join(" ")} )`,se={type:"command",command:L,output:le,isError:!1,id:H.current++};o(Le=>[...Le,se]);return}const ne=L.trim().toLowerCase();if(ne==="cls"){o([]);return}if(ne==="godmode"){const le=!D;O(le);const Le={type:"command",command:L,output:`Godmode ${le?"activated":"deactivated"}.`,isError:!1,id:H.current++};o(ve=>[...ve,Le]);return}const S=[...U];S[S.length-1]!==L&&S.push(L),Y(S),P(-1);const $=[],J=le=>{$.push(le)};try{if(ne==="help"||ne.endsWith(" help")){let Oe="",Re=!1;if(ne==="help")Oe=Object.keys(Yield.dictionaryCategories).map($t=>{const kt=Yield.dictionaryCategories[$t];return`${$t}: ${kt.name}`}).join(`
`)+"\n\nUse `<category> help` to see commands in a category.\nTry `godmode` to see the live dictionary.";else{const Ct=ne.slice(0,-5).trim(),$t=Yield.dictionary[Ct],kt=Yield.dictionaryCategories[Ct];if($t&&"definition"in $t){const Kn=(re=(X=$t.examples)==null?void 0:X[0])==null?void 0:re.code,La=Kn?Array.isArray(Kn)?Kn.join(`
`):Kn:null;Oe=`${$t.definition.description}${La?`

Example:
  ${La}`:""}`}else kt?Oe=`--- ${kt.name} ---
${kt.description}

Commands: ${Object.keys(kt.definitions).join(", ")}`:(Oe=`Error: Unknown command or category '${Ct}'.`,Re=!0)}const Rt={type:"command",command:L,output:Oe,isError:Re,id:H.current++};o(Ct=>[...Ct,Rt]);return}const le=["undo","redo"].includes(ne),se=le?F.current.createSnapshot(sessionStack,Yield.dictionary):null,Le=Yield.parse(L),ve=Yield.dictionary[":loops"],fe=ve&&"body"in ve&&Array.isArray(ve.body)?ve.body.length:0;await Yield.run(Le,sessionStack,{onOutput:J,onAsyncOutput:Q,historyManager:F.current,commandHistory:S});const _e=Yield.dictionary[":loops"],Ae=(_e&&"body"in _e&&Array.isArray(_e.body)?_e.body.length:0)>fe;if(le){const Oe=F.current.createSnapshot(sessionStack,Yield.dictionary);if(deepEqual(se,Oe)){const Re={type:"command",command:L,output:`( ${sessionStack.map(yieldFormatter).join(" ")} )`,isError:!1,id:H.current++};o(Rt=>[...Rt,Re]);return}}if(ne==="reset"){Yield.reset(),sessionStack=[],F.current.clear();const Oe=F.current.createSnapshot(sessionStack,Yield.dictionary);F.current.add(Oe)}if(ne!=="undo"&&ne!=="redo"&&ne!=="again"){const Oe=F.current.createSnapshot(sessionStack,Yield.dictionary);F.current.add(Oe)}const Ee=sessionStack.length>0?sessionStack[sessionStack.length-1]:null;Ee&&Ee.type==="shader"?b(Ee):b(null);let et="";if(!Ae){let Re=`( ${sessionStack.map(yieldFormatter).join(" ")} )`;$.length>0&&(Re+=`
`+$.join("")),et=Re}const tt={type:"command",command:L,output:et,isError:!1,id:H.current++};o(Oe=>[...Oe,tt])}catch(le){const se={type:"command",command:L,output:le.message,isError:!0,id:H.current++};o(Le=>[...Le,se])}finally{if(ne==="reset"){const le={type:"command",command:L,output:"Interpreter state, stack, and history cleared.",isError:!1,id:H.current++};o(se=>[...se,le])}N(le=>le+1)}},I=async L=>{h&&m(!1),w(null);const ne=L.split(`
`);d(!0);for(const S of ne)await K(S);d(!1),w(null),setTimeout(()=>{var S;return(S=V.current)==null?void 0:S.focus()},0)},me=L=>{l(L.target.value)},ce=L=>{if(!u){if(L.key==="Escape"){L.preventDefault(),te();return}if(L.key==="Enter"&&!L.shiftKey){L.preventDefault();const ne=i;l(""),I(ne);return}if(L.key==="ArrowUp"){const ne=L.currentTarget,S=ne.selectionStart;ne.value.substring(0,S).split(`
`).length===1&&(L.preventDefault(),P(X=>{const re=X===-1?U.length-1:Math.max(0,X-1);return l(U[re]||""),re}))}if(L.key==="ArrowDown"){const ne=L.currentTarget,S=ne.selectionStart,$=ne.value.split(`
`).length;ne.value.substring(0,S).split(`
`).length===$&&(L.preventDefault(),P(re=>{const le=re===-1?-1:Math.min(U.length,re+1);return l(U[le]||""),le}))}L.key==="ArrowLeft"&&i===""&&(L.preventDefault(),I("undo")),L.key==="ArrowRight"&&i===""&&(L.preventDefault(),I("redo"))}},z=g||D,Z=v||(D?`( ${sessionStack.map(yieldFormatter).join(" ")} )`:null);return jsxRuntimeExports.jsxs("div",{className:"flex h-[70vh] gap-4",children:[jsxRuntimeExports.jsxs("div",{className:`repl-terminal fira-code bg-gray-900 text-white rounded-lg shadow-xl overflow-hidden flex flex-col transition-all duration-300 ${z?"w-2/3":"w-full"}`,onClick:()=>{var L;return(L=V.current)==null?void 0:L.focus()},children:[jsxRuntimeExports.jsxs("div",{className:"repl-history p-4 overflow-y-auto flex-grow bg-black/30 backdrop-blur-sm",children:[h&&jsxRuntimeExports.jsx("div",{className:"mb-2 whitespace-pre-wrap",children:jsxRuntimeExports.jsxs("div",{className:"output-area text-gray-100",children:["World Hello!",jsxRuntimeExports.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Try typing `help` to see available commands. Press left and right to undo and redo."})]})}),e.map(L=>L.type==="async"?jsxRuntimeExports.jsx("div",{className:"whitespace-pre-wrap",children:jsxRuntimeExports.jsx("div",{className:`output-area ml-6 ${L.isError?"text-red-400":"text-cyan-400"}`,children:L.output})},L.id):jsxRuntimeExports.jsxs("div",{className:"mb-2 whitespace-pre-wrap",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start",children:[jsxRuntimeExports.jsx("span",{className:"text-green-400 mr-2 flex-shrink-0",children:">"}),jsxRuntimeExports.jsx("span",{className:"text-gray-300",children:L.command})]}),jsxRuntimeExports.jsx("div",{className:`output-area ${L.isError?"text-red-400":"text-gray-100"}`,children:L.output})]},L.id)),jsxRuntimeExports.jsx("div",{ref:C})]}),jsxRuntimeExports.jsxs("div",{className:"repl-input-area p-4 border-t border-gray-700 bg-gray-800/70 backdrop-blur-sm",children:[Z&&jsxRuntimeExports.jsx("div",{className:"live-output-area pb-3 mb-3 border-b border-gray-600",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-400 mr-2 font-sans text-xs uppercase flex-shrink-0",children:"Live Stack:"}),jsxRuntimeExports.jsx("div",{className:"output-area text-cyan-400 whitespace-pre-wrap",children:Z})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-start",children:[jsxRuntimeExports.jsx("span",{className:"text-green-400 mr-2 flex-shrink-0",children:">"}),jsxRuntimeExports.jsx("textarea",{ref:V,value:i,onChange:me,onKeyDown:ce,className:"repl-textarea fira-code bg-transparent text-gray-300 w-full resize-none focus:outline-none placeholder-gray-500",placeholder:"Type a command...",rows:1,spellCheck:"false",autoCapitalize:"off",autoComplete:"off",autoCorrect:"off","aria-label":"REPL input"})]})]})]}),z&&jsxRuntimeExports.jsxs("div",{className:"w-1/3 transition-all duration-300 flex flex-col gap-4",children:[g&&jsxRuntimeExports.jsx("div",{className:"flex-1 min-h-0",children:jsxRuntimeExports.jsx(ShaderCanvas,{shaderCode:g.code,className:"w-full h-full rounded-lg"})}),D&&jsxRuntimeExports.jsx("div",{className:"flex-1 min-h-0",children:jsxRuntimeExports.jsx(DictionaryView,{dictionary:Yield.dictionary,builtInKeys:Yield.builtInKeys,version:k,onUpdate:ae})})]})]})},PlayIcon$1=()=>jsxRuntimeExports.jsx("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})}),PauseIcon=()=>jsxRuntimeExports.jsx("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),StopIcon=()=>jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:jsxRuntimeExports.jsx("path",{d:"M6 6h12v12H6z"})}),DebugIcon=()=>jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 10c0-1.657 1.343-3 3-3s3 1.343 3 3-1.343 3-3 3v-1.5M12 17h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),debugFormatter=e=>{if(typeof e=="string")return e.startsWith("\0")?e.slice(1):e;if(Array.isArray(e))return`(${e.map(debugFormatter).join(" ")})`;if(e===!0)return"true";if(e===!1)return"false";if(typeof e=="object"&&e!==null){if(e.type==="shader")return"<shader>";if(e.type==="scene")return"<scene>";if(e.type==="light")return"<light>";if(e.type==="color")return"<color>";if(e.type==="glsl_expression")return"<glsl_expression>";if(e.type==="postEffect")return`<${e.op} effect>`;if(["geometry","combinator","transformation","alteration"].includes(e.type))return"<sdf>";if(typeof e.next=="function")return"<generator>"}if(typeof e=="symbol"){const o=Symbol.keyFor(e);return o!==void 0?`:${o}`:e.toString()}return String(e)},formatDebugLog=e=>{if(e.length===0)return"";const o=e.map(l=>l.stack.length+l.depth*2),i=Math.max(...o);return e.map(l=>`${`${"  ".repeat(l.depth)}${l.stack}`.padEnd(i)} <- ${l.program}`).join(`
`)},NotebookCell=({cellData:e,compact:o=!1})=>{const i=reactExports.useMemo(()=>e.examples&&e.examples.length>0?e.examples:e.example?[{code:e.example,expected:e.expected,assert:e.assert,expectedError:e.expectedError,expectedDescription:e.expectedDescription,replCode:e.replCode}]:[],[e]),l=reactExports.useCallback(fe=>{if(!fe)return"";const _e=fe.replCode||fe.code;return Array.isArray(_e)?_e.join(`
`):String(_e||"")},[]),[u,d]=reactExports.useState(0),[h,m]=reactExports.useState(l(i[0])),[g,b]=reactExports.useState(null),[v,w]=reactExports.useState(null),[D,O]=reactExports.useState([]),[k,N]=reactExports.useState("idle"),[C,V]=reactExports.useState(!1),[U,Y]=reactExports.useState(!1),[W,P]=reactExports.useState(0),F=reactExports.useMemo(()=>i[u]||null,[i,u]),H=reactExports.useRef(null),ee=reactExports.useRef(""),Q=reactExports.useRef([]),[te,ae]=reactExports.useState(new Set),[K,I]=reactExports.useState(!1),me=reactExports.useMemo(()=>`cell_${Math.random().toString(36).substr(2,9)}`,[]),ce=reactExports.useRef(!1),z=reactExports.useRef([]);reactExports.useEffect(()=>{d(0)},[i]),reactExports.useEffect(()=>{const fe=i[u];fe!==void 0&&(m(l(fe)),b(null),w(null),N("idle"))},[u,i,l]);const Z=()=>{d(fe=>(fe+1)%i.length)},L=()=>{d(fe=>(fe-1+i.length)%i.length)},ne=()=>{var Je,Ae;(Je=H.current)!=null&&Je.stopSignal&&(H.current.stopSignal.stopped=!0),U&&((Ae=H.current)!=null&&Ae.resumeFn)&&(H.current.pauseSignal&&(H.current.pauseSignal.paused=!1),Y(!1),H.current.resumeFn()),audioEngine.stopAll();const _e=Yield.dictionary[":loops"];_e&&"body"in _e&&Array.isArray(_e.body)&&(_e.body.length=0),ae(new Set),I(!1)},S=()=>{var _e,Je;if(k!=="running"||!C)return;const fe=!U;Y(fe),(_e=H.current)!=null&&_e.pauseSignal&&(H.current.pauseSignal.paused=fe),!fe&&((Je=H.current)!=null&&Je.resumeFn)&&H.current.resumeFn()},$=reactExports.useCallback((fe,_e=!1)=>{const Je=fe.trim();if(Je)if(!_e&&Je==="YIELD_TICK"){const Ae=z.current;let Ee;Ae.length===1?Ee=yieldFormatter(Ae[0]):Ee=`${Ae.map(yieldFormatter).join(" ")}`,b(Ee)}else O(Ae=>[...Ae,{text:Je,isError:_e}])},[]),J=reactExports.useCallback(async()=>{N("running"),Y(!1),b(null),w(null),O([]),ee.current="",ae(new Set),I(!1),Q.current=[];const fe={stopped:!1},_e={paused:!1};H.current={stopSignal:fe,pauseSignal:_e,resumeFn:void 0};const Je={stopSignal:fe,pauseSignal:_e,isDebug:C,getDelay:()=>C?W:0,setResume:Ae=>{H.current&&(H.current.resumeFn=Ae)},onToken:(Ae,Ee,et,tt)=>{if(!C)return;const Oe=Ee.map(debugFormatter).join(" "),Re=[debugFormatter(Ae),...et.map(debugFormatter)].join(" ");if(W>0){const Ct=`${"  ".repeat(tt)}${Oe} <- ${Re}`;b(Ct)}else Q.current.push({stack:Oe,program:Re,depth:tt})},onOutput:Ae=>{ee.current+=Ae},onAsyncOutput:$,onVoiceCreated:Ae=>{Ae&&ae(Ee=>new Set(Ee).add(Ae))},onVoiceDestroyed:Ae=>{Ae&&ae(Ee=>{const et=new Set(Ee);return et.delete(Ae),et})},sourceId:me};try{Yield.reset();const Ae=Yield.parse(h),Ee=[];z.current=Ee,await Yield.run(Ae,Ee,Je);const et=Yield.dictionary[":loops"];if(et&&"body"in et&&Array.isArray(et.body)&&et.body.length>0&&I(!0),fe.stopped){const tt=Ee.map(debugFormatter).join(" ");b(`${tt}
(Execution stopped by user)`),N("stopped")}else{if(C)if(W===0){const tt=Q.current,Oe=tt.length>0?formatDebugLog(tt):"",Re=Ee.map(debugFormatter).join(" ");let Rt=Oe;Oe?Rt+=`
`+Re:Rt=Re,ee.current&&(Rt+=`
`+ee.current),b(Rt)}else{let Oe=Ee.map(debugFormatter).join(" ");ee.current&&(Oe+=`
`+ee.current),b(Oe)}else{const tt=Ee.length>0?Ee[Ee.length-1]:null;if(tt&&tt.type==="shader")b(tt);else{let Oe;Ee.length===1?Oe=yieldFormatter(Ee[0]):Oe=`${Ee.map(yieldFormatter).join(" ")}`;let Re=Oe;ee.current&&(Re+=`
`+ee.current),b(Re)}}N("success")}}catch(Ae){console.error(Ae),w(Ae.message),b(null),N("error")}finally{H.current=null,Y(!1)}},[h,C,W,me,$]),X=k==="running",re=()=>{if(X){V(!C);return}C||(ce.current=!0),V(!C)};reactExports.useEffect(()=>{ce.current&&(ce.current=!1,J())},[C,J]);const le=X||te.size>0||K;let se="bg-gray-800 text-white";k==="error"&&(se="text-red-600 bg-red-100"),k==="success"&&C&&(se="bg-gray-900 text-gray-200");const Le=g||v,ve=F&&(Array.isArray(F.expected)||F.assert||F.expectedType||F.expectedDescription);return jsxRuntimeExports.jsxs("div",{className:"cell bg-white p-4 rounded-lg shadow mb-6 border border-gray-200 relative",children:[!o&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-baseline flex-wrap gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-baseline space-x-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold font-mono text-indigo-600",children:e.name}),e.aliases&&e.aliases.length>0&&jsxRuntimeExports.jsxs("span",{className:"font-mono text-gray-500 text-sm",children:["(",e.aliases.length>1?"aliases":"alias",": ",e.aliases.join(", "),")"]}),i.length>1&&jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-1 text-gray-500",children:[jsxRuntimeExports.jsx("button",{onClick:L,title:"Previous Example",className:"p-1 rounded-full hover:bg-gray-200","aria-label":"Previous example",children:"<"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-mono select-none","aria-live":"polite",children:[u+1,"/",i.length]}),jsxRuntimeExports.jsx("button",{onClick:Z,title:"Next Example",className:"p-1 rounded-full hover:bg-gray-200","aria-label":"Next example",children:">"})]})]}),jsxRuntimeExports.jsx("span",{className:"font-mono text-sm bg-gray-100 p-1 rounded whitespace-nowrap",children:e.effect})]}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-gray-700",children:e.description})]}),jsxRuntimeExports.jsxs("div",{className:`code-block bg-gray-50 p-3 rounded-md border ${o?"mt-0":"mt-4"}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-1",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:"Example:"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("button",{onClick:X&&C?S:J,disabled:X&&!C,className:"control-btn p-1 rounded-full hover:bg-gray-200 text-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed","aria-label":X?C?U?"Resume":"Pause":"Running...":"Run",title:X?C?U?"Resume":"Pause":"Running...":"Run",children:X?C?U?jsxRuntimeExports.jsx(PlayIcon$1,{}):jsxRuntimeExports.jsx(PauseIcon,{}):jsxRuntimeExports.jsx("span",{className:"text-xs px-1 animate-pulse",children:"..."}):jsxRuntimeExports.jsx(PlayIcon$1,{})}),jsxRuntimeExports.jsx("button",{onClick:ne,disabled:!le,className:"control-btn p-1 rounded-full text-gray-600 hover:bg-red-100 hover:text-red-600 disabled:text-gray-400 disabled:cursor-not-allowed","aria-label":"Stop example",title:"Stop example",children:jsxRuntimeExports.jsx(StopIcon,{})}),jsxRuntimeExports.jsx("button",{onClick:re,className:`control-btn p-1 rounded-full hover:bg-gray-200 ${C?"text-indigo-600 bg-indigo-100":"text-gray-600"}`,"aria-label":"Toggle Debug Mode",title:"Toggle Debug Mode",children:jsxRuntimeExports.jsx(DebugIcon,{})})]})]}),jsxRuntimeExports.jsx("pre",{className:"fira-code whitespace-pre-wrap text-sm",children:jsxRuntimeExports.jsx("code",{contentEditable:!X,onBlur:fe=>m(fe.currentTarget.innerText),suppressContentEditableWarning:!0,className:"block outline-none",children:h})})]}),C&&jsxRuntimeExports.jsxs("div",{className:"debug-controls mt-2",children:[jsxRuntimeExports.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Debug delay: ",jsxRuntimeExports.jsx("span",{className:"delay-value font-mono",children:W}),"ms"]}),jsxRuntimeExports.jsx("input",{type:"range",min:"0",max:"2000",value:W,onChange:fe=>P(Number(fe.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(Le||k==="idle"&&ve||D.length>0)&&jsxRuntimeExports.jsxs("div",{className:"output mt-3 rounded-md overflow-hidden",children:[(()=>{if(Le)return g&&typeof g=="object"&&g.type==="shader"?jsxRuntimeExports.jsx("div",{className:"h-96",children:jsxRuntimeExports.jsx(ShaderCanvas,{shaderCode:g.code,className:"w-full h-full"})}):jsxRuntimeExports.jsxs("div",{className:`p-3 fira-code text-sm ${se} overflow-x-auto`,children:[jsxRuntimeExports.jsx("p",{className:`text-sm mb-1 font-semibold ${k==="error"?"text-red-700":"text-gray-400"}`,children:v?"Error:":C?"Debug Log:":"Result:"}),jsxRuntimeExports.jsx("pre",{children:v||(typeof g=="object"?null:g)})]});if(k==="idle"&&F){if(Array.isArray(F.expected)){let fe;return F.expected.length===1?fe=yieldFormatter(F.expected[0]):fe=`[ ${F.expected.map(yieldFormatter).join(" ")} ]`,jsxRuntimeExports.jsxs("div",{className:"p-3 fira-code text-sm bg-gray-100 text-gray-500 overflow-x-auto",children:[jsxRuntimeExports.jsx("p",{className:"text-sm mb-1 font-semibold text-gray-400",children:"Expected:"}),jsxRuntimeExports.jsx("pre",{children:fe})]})}return jsxRuntimeExports.jsx("div",{className:"p-3 fira-code text-sm bg-gray-100 text-gray-500 italic overflow-x-auto",children:jsxRuntimeExports.jsx("p",{children:"Press play to see the result."})})}return null})(),D.length>0&&jsxRuntimeExports.jsxs("div",{className:`p-3 fira-code text-sm bg-gray-800 text-white overflow-x-auto ${Le?"border-t border-gray-700":""}`,children:[jsxRuntimeExports.jsx("p",{className:"text-sm mb-1 font-semibold text-gray-400",children:"Async Output:"}),jsxRuntimeExports.jsx("pre",{className:"whitespace-pre-wrap",children:D.map((fe,_e)=>jsxRuntimeExports.jsx("div",{className:fe.isError?"text-red-400":"text-cyan-400",children:fe.text},_e))})]})]})]})},expectedToString=e=>e===void 0?"":e.map(yieldFormatter).join(" "),stringToExpected=e=>{if(e.trim()==="")return[];try{return Yield.parse(e)}catch(o){return console.error("Error parsing expected output string:",o),[e]}},formatDictionaryState=e=>{const o=Object.entries(e).filter(([l])=>!Yield.builtInKeys.has(l));return o.length===0?"Dictionary: (empty)":`Dictionary State:
${o.map(([l,u])=>u&&"body"in u?`  ${l}: ${yieldFormatter(u.body)}`:`  ${l}: (unknown format)`).join(`
`)}`},formatFailedTest=e=>{var u;const o=e.currentTest.replCode?Array.isArray(e.currentTest.replCode)?e.currentTest.replCode.join(`
`):e.currentTest.replCode:Array.isArray(e.currentTest.code)?e.currentTest.code.join(`
`):String(e.currentTest.code);let i="";e.currentTest.expected!==void 0?i=`( ${expectedToString(e.currentTest.expected)} )`:e.currentTest.assertString!==void 0?i=`(assert) ${e.currentTest.assertString}`:e.currentTest.assert?i=`(assert) ${e.currentTest.assert.toString()}`:e.currentTest.async?i=`(async assert) ${e.currentTest.async.assertDescription||e.currentTest.async.assert.toString()}`:e.currentTest.expectedDescription?i=e.currentTest.expectedDescription:e.currentTest.expectedType?i=`A value of type: ${e.currentTest.expectedType}`:e.currentTest.expectedError&&(i=`(error) ${e.currentTest.expectedError}`);let l=`# --- TEST FAILED: ${e.description} ---`;return(u=e.result.errorMessage)!=null&&u.includes("--- GLSL Source ---")?l+=`
# Reason: ${e.result.errorMessage}`:(l+=`
# Code:
# ${o.replace(/\n/g,`
# `)}`,l+=`
# Reason: ${e.result.errorMessage||"N/A"}`,l+=`
# Expected: ${i}
# Got:   ${e.result.actualOutput||"N/A"}`,e.result.dictionaryState&&(l+=`
# ${e.result.dictionaryState.replace(/\n/g,`
# `)}`)),l},compileShaderHeadless=e=>{if(typeof document>"u")return{success:!0,error:null};const i=document.createElement("canvas").getContext("webgl2");if(!i)return console.warn("Could not create WebGL2 context for shader validation."),{success:!0,error:null};const l=`#version 300 es
in vec4 a_position;
void main() {
    gl_Position = a_position;
}`,u=(g,b)=>{const v=i.createShader(g);return v?(i.shaderSource(v,b),i.compileShader(v),v):null},d=u(i.VERTEX_SHADER,l),h=u(i.FRAGMENT_SHADER,e);if(!d||!h)return{success:!1,error:"Could not create shader objects."};let m=null;return i.getShaderParameter(h,i.COMPILE_STATUS)||(m=i.getShaderInfoLog(h)),i.deleteShader(d),i.deleteShader(h),m?{success:!1,error:m}:{success:!0,error:null}},ChevronDownIcon=()=>jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),ChevronRightIcon=()=>jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),CopyIcon=()=>jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),PlayIcon=()=>jsxRuntimeExports.jsx("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})}),WarningIcon=()=>jsxRuntimeExports.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})});let cachedTestItems=[],cachedSummaryStatus="idle",hasRunOnce=!1;const runTestLogic=async(testCase,stopSignal)=>{try{await audioEngine.init()}catch(e){console.warn("Could not initialize audio engine for test run.")}try{await Yield.run(Yield.parse("hush"),[],{})}catch(e){console.error("Error during pre-test cleanup:",e)}Yield.reset(),audioEngine.setMuted(!0);const stack=[],historyManager=new HistoryManager(Yield.builtInKeys),initialSnapshot=historyManager.createSnapshot(stack,Yield.dictionary);historyManager.add(initialSnapshot);const commandHistory=[],asyncOutput=[],handleAsyncOutput=e=>{const o=e.trim();o&&asyncOutput.push(o)};try{const runOptions={stopSignal,historyManager,commandHistory,parse:Yield.parse,onAsyncOutput:handleAsyncOutput};if(testCase.replCode){const e=Array.isArray(testCase.replCode)?testCase.replCode:testCase.replCode.split(`
`);for(const o of e){if(!o.trim()||stopSignal.stopped)continue;commandHistory.push(o);const i=Yield.parse(o),l=["undo","redo"].includes(o.trim().toLowerCase());if(await Yield.run(i,stack,runOptions),!l&&o.trim().toLowerCase()!=="again"){const u=historyManager.createSnapshot(stack,Yield.dictionary);historyManager.add(u)}}}else if(testCase.code){const e=Yield.parse(Array.isArray(testCase.code)?testCase.code.join(`
`):testCase.code);await Yield.run(e,stack,runOptions)}if(stopSignal.stopped)return{status:"failed",errorMessage:"Test run stopped by user."};if(testCase.async)return new Promise(e=>{const o=async()=>{const u=formatDictionaryState(Yield.dictionary);try{const d=testCase.async.assert(stack,Yield.dictionary,asyncOutput);e(d?{status:"passed"}:{status:"failed",errorMessage:`Async assertion failed: ${testCase.async.assertDescription||testCase.async.assert.toString()}`,actualOutput:`( ${stack.map(yieldFormatter).join(" ")} )`,dictionaryState:u})}catch(d){e({status:"failed",errorMessage:`Error during async test: ${d.message}`,dictionaryState:u})}},i=audioEngine.getContextTime()+testCase.async.duration/1e3,l=`test_assert_${Date.now()}_${Math.random()}`;audioEngine.schedule(l,i,o)});const dictionaryState=formatDictionaryState(Yield.dictionary),lastItem=stack.length>0?stack[stack.length-1]:null;if(lastItem&&lastItem.type==="shader"){const e=compileShaderHeadless(lastItem.code);if(!e.success)return{status:"failed",errorMessage:`Shader compilation failed: ${e.error}

--- GLSL Source ---
${lastItem.code}`,actualOutput:"N/A",dictionaryState}}if(testCase.expectedError)return{status:"failed",errorMessage:"Expected an error but none was thrown.",actualOutput:`( ${stack.map(yieldFormatter).join(" ")} )`,dictionaryState};if(testCase.assertString){const assertFn=eval(testCase.assertString);return assertFn(stack,Yield.dictionary)?{status:"passed"}:{status:"failed",errorMessage:`Assertion failed: ${testCase.assertString}`,actualOutput:`( ${stack.map(yieldFormatter).join(" ")} )`,dictionaryState}}return testCase.assert?testCase.assert(stack,Yield.dictionary)?{status:"passed"}:{status:"failed",errorMessage:`Assertion failed: ${testCase.assert.toString()}`,actualOutput:`( ${stack.map(yieldFormatter).join(" ")} )`,dictionaryState}:testCase.expected!==void 0?deepEqual(stack,testCase.expected)?{status:"passed"}:{status:"failed",errorMessage:"Stack did not match expected output.",actualOutput:`( ${stack.map(yieldFormatter).join(" ")} )`,dictionaryState}:{status:"passed"}}catch(e){const o=formatDictionaryState(Yield.dictionary);return testCase.expectedError?e.message.includes(testCase.expectedError)?{status:"passed"}:{status:"failed",errorMessage:`Error message mismatch. Expected to find "${testCase.expectedError}"`,actualOutput:e.message,dictionaryState:o}:{status:"failed",errorMessage:`${e.message}`,actualOutput:"N/A",dictionaryState:o}}finally{audioEngine.setMuted(!1)}},loadTestsLogic=()=>{const e=[];let o=0;for(const i of Object.values(operatorModules))for(const l in i.definitions){const u=i.definitions[l];u.examples&&u.examples.forEach((d,h)=>{e.push({id:`op-${o}`,description:`${o}: ${i.name}: ${l}`,originalTest:d,currentTest:d,result:{status:"idle"},isExpanded:!1}),o++})}for(const i of documentation)for(const l of i.cells)if(l.expected!==void 0||l.assert!==void 0||l.expectedError!==void 0||l.replCode!==void 0){const u={code:Array.isArray(l.example)?l.example.join(`
`):l.example,replCode:l.replCode,expected:l.expected,assert:l.assert,expectedDescription:l.expectedDescription,expectedError:l.expectedError};e.push({id:`doc-${o}`,description:`${o}: Docs: ${i.name}: ${l.name}`,originalTest:u,currentTest:u,result:{status:"idle"},isExpanded:!1}),o++}return e},getInitialExpectationType=e=>e.async?"async":e.expectedError?"error":e.assert||e.assertString?"assert":"stack",TestCaseRunner=({item:e,onRun:o,onToggleExpand:i})=>{const l=e.currentTest.replCode?Array.isArray(e.currentTest.replCode)?e.currentTest.replCode.join(`
`):e.currentTest.replCode:Array.isArray(e.currentTest.code)?e.currentTest.code.join(`
`):String(e.currentTest.code),[u,d]=reactExports.useState(l),[h,m]=reactExports.useState(()=>getInitialExpectationType(e.currentTest)),[g,b]=reactExports.useState(()=>expectedToString(e.currentTest.expected)),[v,w]=reactExports.useState(()=>e.currentTest.expectedError||""),[D,O]=reactExports.useState(()=>{var Q;return((Q=e.currentTest.assert)==null?void 0:Q.toString())||e.currentTest.assertString||""}),[k,N]=reactExports.useState(()=>{var Q,te;return((Q=e.currentTest.async)==null?void 0:Q.assertDescription)||((te=e.currentTest.async)==null?void 0:te.assert.toString())||""}),[C,V]=reactExports.useState(""),[U,Y]=reactExports.useState("Copy Issue");reactExports.useEffect(()=>{var te,ae,K;const Q=e.currentTest.replCode?Array.isArray(e.currentTest.replCode)?e.currentTest.replCode.join(`
`):e.currentTest.replCode:Array.isArray(e.currentTest.code)?e.currentTest.code.join(`
`):String(e.currentTest.code);d(Q),m(getInitialExpectationType(e.currentTest)),b(expectedToString(e.currentTest.expected)),w(e.currentTest.expectedError||""),O(((te=e.currentTest.assert)==null?void 0:te.toString())||e.currentTest.assertString||""),N(((ae=e.currentTest.async)==null?void 0:ae.assertDescription)||((K=e.currentTest.async)==null?void 0:K.toString())||"")},[e.currentTest]);const W=()=>{const Q={...e.currentTest,expected:void 0,expectedError:void 0,assert:void 0,assertString:void 0,async:void 0,expectedDescription:void 0,expectedType:void 0};switch(e.currentTest.replCode?Q.replCode=u:Q.code=u,h){case"stack":Q.expected=stringToExpected(g);break;case"error":Q.expectedError=v;break;case"assert":Q.assertString=D;break;case"async":Q.async=e.originalTest.async;break}o(e.id,Q)},P=Q=>{Q.stopPropagation();const te=Array.isArray(e.currentTest.code)?e.currentTest.code.join(`
`):String(e.currentTest.code);let ae="";e.currentTest.expected!==void 0?ae=`( ${e.currentTest.expected.map(yieldFormatter).join(" ")} )`:e.currentTest.expectedDescription?ae=e.currentTest.expectedDescription:e.currentTest.expectedType?ae=`A value of type: ${e.currentTest.expectedType}`:e.currentTest.assertString?ae=`Custom assertion: ${e.currentTest.assertString}`:e.currentTest.assert&&(ae=`Custom assertion: ${e.currentTest.assert.toString()}`);const K=`Implement this test for ${e.description}

Code:
${te}

Expected:
${ae}`;navigator.clipboard.writeText(K).then(()=>{V("Copied!"),setTimeout(()=>V(""),2e3)})},F=Q=>{Q.stopPropagation(),navigator.clipboard.writeText(formatFailedTest(e)).then(()=>{Y("Copied!"),setTimeout(()=>Y("Copy Issue"),2e3)})},ee={passed:{border:"border-green-200",bg:"bg-green-50/50",headerBg:"hover:bg-green-100",text:"text-green-500",title:"text-gray-700"},failed:{border:"border-red-200",bg:"bg-red-50",headerBg:"hover:bg-red-100",text:"text-red-500",title:"text-gray-800"},idle:{border:"border-gray-200",bg:"bg-white",headerBg:"hover:bg-gray-100",text:"text-gray-400",title:"text-gray-600"}}[e.result.status];return jsxRuntimeExports.jsxs("div",{className:`test-case-runner p-3 rounded-md border ${ee.border} ${ee.bg}`,children:[jsxRuntimeExports.jsxs("div",{className:`flex items-center cursor-pointer p-1 -m-1 rounded ${ee.headerBg}`,onClick:i,children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0 w-6",children:e.isExpanded?jsxRuntimeExports.jsx(ChevronDownIcon,{}):jsxRuntimeExports.jsx(ChevronRightIcon,{})}),jsxRuntimeExports.jsxs("span",{className:`${ee.text} font-bold mr-3 uppercase text-sm`,children:["[",e.result.status,"]"]}),jsxRuntimeExports.jsx("p",{className:`${ee.title} flex-grow`,children:e.description}),jsxRuntimeExports.jsx("button",{onClick:P,className:"repl-btn text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 p-1.5 h-auto rounded-md",title:"Copy Code",children:C||jsxRuntimeExports.jsx(CopyIcon,{})})]}),e.isExpanded&&jsxRuntimeExports.jsxs("div",{className:"mt-3 pt-3 border-t pl-6",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Code:"}),jsxRuntimeExports.jsx("textarea",{value:u,onChange:Q=>d(Q.target.value),className:"w-full p-2 rounded text-sm fira-code border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 bg-gray-900 text-gray-100",rows:Math.max(3,u.split(`
`).length)})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Expectation Type:"}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-4 mb-2",children:[jsxRuntimeExports.jsxs("label",{className:"flex items-center text-sm",children:[jsxRuntimeExports.jsx("input",{type:"radio",value:"stack",checked:h==="stack",onChange:()=>m("stack"),className:"mr-1 h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"}),"Stack"]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center text-sm",children:[jsxRuntimeExports.jsx("input",{type:"radio",value:"error",checked:h==="error",onChange:()=>m("error"),className:"mr-1 h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"}),"Error"]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center text-sm",children:[jsxRuntimeExports.jsx("input",{type:"radio",value:"assert",checked:h==="assert",onChange:()=>m("assert"),className:"mr-1 h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"}),"Assert"]}),jsxRuntimeExports.jsxs("label",{className:"flex items-center text-sm",children:[jsxRuntimeExports.jsx("input",{type:"radio",value:"async",checked:h==="async",onChange:()=>m("async"),className:"mr-1 h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"}),"Async"]})]}),h==="stack"&&jsxRuntimeExports.jsx("input",{type:"text",value:g,onChange:Q=>b(Q.target.value),placeholder:'e.g., 10 "hello"',className:"w-full p-2 rounded text-sm fira-code border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 bg-gray-900 text-gray-100"}),h==="error"&&jsxRuntimeExports.jsx("input",{type:"text",value:v,onChange:Q=>w(Q.target.value),placeholder:"e.g., Stack underflow",className:"w-full p-2 rounded text-sm fira-code border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 bg-gray-900 text-gray-100"}),h==="assert"&&jsxRuntimeExports.jsx("textarea",{value:D,onChange:Q=>O(Q.target.value),placeholder:"for example: s => s.length === 1",className:"w-full p-2 rounded text-sm fira-code border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 bg-gray-900 text-gray-100",rows:3}),h==="async"&&jsxRuntimeExports.jsx("textarea",{value:k,readOnly:!0,className:"w-full p-2 rounded text-sm fira-code border border-gray-400 bg-gray-700 text-gray-300 cursor-not-allowed",rows:3}),e.result.status!=="passed"&&e.result.status!=="idle"&&jsxRuntimeExports.jsxs("div",{className:"mt-2 text-sm",children:[jsxRuntimeExports.jsxs("p",{className:"fira-code text-gray-700 whitespace-pre-wrap",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Reason:"})," ",e.result.errorMessage]}),jsxRuntimeExports.jsxs("p",{className:`fira-code ${ee.text}`,children:[jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"Actual:"})," ",e.result.actualOutput||"N/A"]}),e.result.dictionaryState&&jsxRuntimeExports.jsx("pre",{className:"fira-code text-gray-500 mt-2 p-2 bg-gray-900 text-xs rounded whitespace-pre-wrap",children:e.result.dictionaryState})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"mt-4 flex justify-end items-center space-x-2",children:[e.result.status==="failed"&&jsxRuntimeExports.jsxs("button",{onClick:F,className:"repl-btn bg-amber-500 hover:bg-amber-600 text-white text-sm flex items-center space-x-2",children:[jsxRuntimeExports.jsx(WarningIcon,{}),jsxRuntimeExports.jsx("span",{children:U})]}),jsxRuntimeExports.jsxs("button",{onClick:W,className:"repl-btn repl-btn-primary text-sm flex items-center space-x-2",children:[jsxRuntimeExports.jsx(PlayIcon,{}),jsxRuntimeExports.jsx("span",{children:"Re-run This Test"})]})]})]})]})},TestRunner=()=>{const[e,o]=reactExports.useState(cachedTestItems),[i,l]=reactExports.useState(!1),[u,d]=reactExports.useState(cachedSummaryStatus),[h,m]=reactExports.useState("all"),[g,b]=reactExports.useState({completed:0,total:0}),[v,w]=reactExports.useState("Copy Issues"),D=reactExports.useRef({stopped:!1}),O=reactExports.useCallback(async H=>runTestLogic(H,D.current),[]),k=reactExports.useCallback(async()=>{l(!0),d("running"),D.current.stopped=!1;const H=loadTestsLogic();o(H),b({completed:0,total:H.length});let ee=!0;const Q=[...H];for(let te=0;te<Q.length&&!D.current.stopped;te++){const ae=Q[te],K=await O(ae.currentTest);K.status==="failed"&&(ee=!1),Q[te]={...ae,result:K,isExpanded:K.status==="failed"},b({completed:te+1,total:Q.length}),(te%5===0||te===Q.length-1)&&(o([...Q]),await new Promise(I=>setTimeout(I,0)))}Q.sort((te,ae)=>te.result.status==="failed"&&ae.result.status!=="failed"?-1:te.result.status!=="failed"&&ae.result.status==="failed"?1:0),o(Q),cachedTestItems=Q,d(ee?"success":"failure"),cachedSummaryStatus=ee?"success":"failure",l(!1),hasRunOnce=!0},[O]);reactExports.useEffect(()=>{const H=()=>{hasRunOnce||k()};if(audioEngine.isReady()){H();return}if(hasRunOnce)o(cachedTestItems),d(cachedSummaryStatus);else{const ee=loadTestsLogic();o(ee),b({completed:0,total:ee.length})}return audioEngine.onReady(H),()=>{audioEngine.offReady(H)}},[k]);const N=reactExports.useCallback(async(H,ee)=>{const Q=e.findIndex(ae=>ae.id===H);if(Q===-1)return;const te=await runTestLogic(ee,{stopped:!1});o(ae=>{const K=[...ae];return K[Q]={...K[Q],currentTest:ee,result:te},cachedTestItems=K,K})},[e]),C=()=>{const H=e.filter(Q=>Q.result.status==="failed");if(H.length===0)return;const ee=H.map(formatFailedTest).join(`


`);navigator.clipboard.writeText(ee).then(()=>{w("Copied!"),setTimeout(()=>w("Copy Issues"),2e3)})},V=H=>{o(ee=>{const Q=ee.map(te=>te.id===H?{...te,isExpanded:!te.isExpanded}:te);return cachedTestItems=Q,Q})},U=()=>{D.current.stopped=!0,l(!1)},Y=e.filter(H=>h==="all"?!0:H.result.status===h),W=e.filter(H=>H.result.status==="passed").length,P=e.filter(H=>H.result.status==="failed").length,F=e.filter(H=>H.result.status==="idle").length;return jsxRuntimeExports.jsxs("div",{className:"test-runner-container bg-gray-50 p-4 rounded-lg shadow-inner",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-4 sticky top-0 bg-gray-50/80 backdrop-blur-sm z-10 py-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[i?jsxRuntimeExports.jsx("button",{onClick:U,className:"repl-btn bg-red-500 hover:bg-red-600 text-white",children:"Stop"}):jsxRuntimeExports.jsx("button",{onClick:k,disabled:i,className:"repl-btn repl-btn-primary",children:"Run All Tests"}),P>0&&!i&&jsxRuntimeExports.jsxs("button",{onClick:C,className:"repl-btn bg-amber-500 hover:bg-amber-600 text-white flex items-center space-x-2",children:[jsxRuntimeExports.jsx(WarningIcon,{}),jsxRuntimeExports.jsx("span",{children:v})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>m("all"),className:`px-2 py-1 rounded ${h==="all"?"bg-indigo-100 text-indigo-700":"text-gray-600"}`,children:["All (",e.length,")"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>m("passed"),className:`px-2 py-1 rounded ${h==="passed"?"bg-green-100 text-green-700":"text-gray-600"}`,children:["Passed (",W,")"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>m("failed"),className:`px-2 py-1 rounded ${h==="failed"?"bg-red-100 text-red-700":"text-gray-600"}`,children:["Failed (",P,")"]}),F>0&&jsxRuntimeExports.jsxs("button",{onClick:()=>m("idle"),className:`px-2 py-1 rounded ${h==="idle"?"bg-gray-200 text-gray-700":"text-gray-600"}`,children:["Idle (",F,")"]})]}),jsxRuntimeExports.jsxs("div",{className:`summary-status text-lg font-bold ${u==="running"?"text-gray-500":u==="success"?"text-green-500":u==="failure"?"text-red-500":"text-gray-700"}`,children:[i&&jsxRuntimeExports.jsxs("span",{className:"animate-pulse",children:["Running... (",g.completed," / ",g.total||e.length,")"]}),!i&&u==="success"&&"All Tests Passed!",!i&&u==="failure"&&`${P} / ${e.length} Tests Failed`,!i&&u==="idle"&&"Ready to run tests."]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:Y.map(H=>jsxRuntimeExports.jsx(TestCaseRunner,{item:H,onRun:N,onToggleExpand:()=>V(H.id)},H.id))})]})},ReferencePage=()=>{const[e,o]=reactExports.useState(""),[i,l]=reactExports.useState(new Set(["all"])),u=reactExports.useMemo(()=>{const w=new Map;if(Yield.aliases)for(const k in Yield.aliases){const N=Yield.aliases[k];w.has(N)||w.set(N,[]),w.get(N).push(k)}const D=new Map;for(const[k,N]of Object.entries(operatorModules))for(const[C,V]of Object.entries(N.definitions))D.has(V)?D.get(V).names.push(C):D.set(V,{names:[C],category:k,description:V.definition.description,effect:V.definition.effect,examples:V.examples.filter(U=>!U.expectedError)});return Array.from(D.values()).map(k=>{k.names.sort((Y,W)=>W.length-Y.length||Y.localeCompare(W));const N=k.names[0],C=k.names.slice(1),V=w.get(N)||[],U=[...new Set([...C,...V])];return{name:N,aliases:U,category:k.category,description:k.description,effect:k.effect,examples:k.examples}}).sort((k,N)=>k.name.localeCompare(N.name))},[]),d=reactExports.useMemo(()=>u.filter(w=>{const D=i.has("all")||i.has(w.category),O=e.toLowerCase();if(!O)return D;const k=w.name.toLowerCase().includes(O),N=w.aliases.some(V=>V.toLowerCase().includes(O));return D&&(k||N)}),[u,e,i]),h=reactExports.useMemo(()=>["all",...Object.keys(operatorModules)],[]),m=(w,D)=>{D.shiftKey?l(O=>{const k=new Set(O);return w==="all"?new Set(["all"]):(k.delete("all"),k.has(w)?k.delete(w):k.add(w),k.size===0?new Set(["all"]):k)}):l(new Set([w]))},g=()=>{o(""),l(new Set(["all"]))},b=!i.has("all")||i.size>1,v=e!==""||b;return jsxRuntimeExports.jsxs("div",{id:"reference-container",children:[jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-gray-100/80 backdrop-blur-sm z-10 py-4 mb-6",children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search for an operator...",value:e,onChange:w=>o(w.target.value),className:"w-full p-3 mb-4 rounded-md border border-gray-600 bg-gray-800 text-white placeholder-gray-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm","aria-label":"Search operators"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[h.map(w=>jsxRuntimeExports.jsx("button",{onClick:D=>m(w,D),className:`repl-btn text-sm capitalize ${i.has(w)?"repl-btn-primary":"bg-white text-gray-700 hover:bg-gray-200 border-gray-300 border"}`,children:w.replace(/([A-Z])/g," $1")},w)),v&&jsxRuntimeExports.jsx("button",{onClick:g,className:"text-sm text-indigo-600 hover:underline ml-auto px-2","aria-label":"Clear all filters",children:"Clear filters"})]})]}),jsxRuntimeExports.jsx("div",{className:"operator-list",children:d.length>0?d.map(w=>jsxRuntimeExports.jsx(NotebookCell,{cellData:w},w.name)):jsxRuntimeExports.jsx("p",{className:"text-center text-gray-500 mt-8",children:e?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:['No operators found matching "',jsxRuntimeExports.jsx("strong",{children:e}),'"',b?" in the selected categories":"","."]}):b?"No operators found in the selected categories.":"No operators found matching your criteria."})})]})},InlineCode=({children:e})=>jsxRuntimeExports.jsx("code",{className:"bg-gray-200 text-gray-800 p-1 rounded-sm fira-code text-sm font-semibold",children:e}),SectionTitle=({children:e})=>jsxRuntimeExports.jsx("h2",{className:"text-3xl font-bold text-gray-800 mt-8 mb-4 border-b pb-2",children:e}),SubTitle=({children:e})=>jsxRuntimeExports.jsx("h3",{className:"text-2xl font-bold text-gray-700 mt-6 mb-3",children:e}),parseMarkdown=e=>{const o=e.split(`
`),i=[];let l=!1,u=[],d=0;const h=m=>m.split(/(`[^`]+`|\*\*[^*]+\*\*)/g).map((b,v)=>b.startsWith("`")&&b.endsWith("`")?jsxRuntimeExports.jsx(InlineCode,{children:b.slice(1,-1)},v):b.startsWith("**")&&b.endsWith("**")?jsxRuntimeExports.jsx("strong",{children:b.slice(2,-2)},v):b);for(let m=0;m<o.length;m++){const g=o[m];if(g.startsWith("```")){if(l){const v={name:"Synopsis Example",description:"",effect:"",example:u.join(`
`)};i.push(jsxRuntimeExports.jsx(NotebookCell,{cellData:v,compact:!0},`cell-${d++}`)),u=[]}l=!l;continue}if(l){u.push(g);continue}if(g.startsWith("# "))i.push(jsxRuntimeExports.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:h(g.substring(2))},`h1-${d++}`));else if(g.startsWith("## "))i.push(jsxRuntimeExports.jsx(SectionTitle,{children:h(g.substring(3))},`h2-${d++}`));else if(g.startsWith("### "))i.push(jsxRuntimeExports.jsx(SubTitle,{children:h(g.substring(4))},`h3-${d++}`));else if(g.startsWith("> ")){let b=[g.substring(2)];for(;m+1<o.length&&o[m+1].startsWith("> ");)m++,b.push(o[m].substring(2));i.push(jsxRuntimeExports.jsx("pre",{className:"bg-gray-100 border p-4 rounded-md my-4 text-sm",children:jsxRuntimeExports.jsx("code",{children:b.join(`
`)})},`bq-${d++}`))}else g.trim()!==""&&i.push(jsxRuntimeExports.jsx("p",{className:"mb-4 text-gray-700",children:h(g)},`p-${d++}`))}if(l&&u.length>0){const g={name:"Synopsis Example",description:"",effect:"",example:u.join(`
`)};i.push(jsxRuntimeExports.jsx(NotebookCell,{cellData:g,compact:!0},`cell-${d++}`))}return i},SynopsisPage=()=>{const[e,o]=reactExports.useState(null),[i,l]=reactExports.useState(null);return reactExports.useEffect(()=>{fetch("./synopsis.md").then(u=>{if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return u.text()}).then(u=>{o(parseMarkdown(u))}).catch(u=>{console.error("Failed to load synopsis.md:",u),l("Failed to load synopsis content.")})},[]),i?jsxRuntimeExports.jsx("div",{className:"bg-white p-6 md:p-8 rounded-lg shadow text-red-500",children:i}):e?jsxRuntimeExports.jsx("div",{className:"bg-white p-6 md:p-8 rounded-lg shadow",children:e}):jsxRuntimeExports.jsx("div",{className:"bg-white p-6 md:p-8 rounded-lg shadow",children:"Loading..."})},ChevronIcon=({isExpanded:e})=>jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-6 w-6 transition-transform duration-200 text-gray-500 ${e?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),CollapsibleSection=({section:e})=>{const[o,i]=reactExports.useState(!1),l=`section-content-${e.name.replace(/\s+/g,"-")}`;return jsxRuntimeExports.jsxs("div",{className:"mb-4 border rounded-lg overflow-hidden shadow-sm bg-white",children:[jsxRuntimeExports.jsxs("button",{className:"w-full text-left p-4 flex justify-between items-center bg-gray-50 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500",onClick:()=>i(!o),"aria-expanded":o,"aria-controls":l,children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:e.name}),jsxRuntimeExports.jsx(ChevronIcon,{isExpanded:o})]}),o&&jsxRuntimeExports.jsxs("div",{id:l,className:"p-4 border-t border-gray-200",children:[e.description&&jsxRuntimeExports.jsx("p",{className:"mb-4 text-gray-600",children:e.description}),e.cells.map(u=>jsxRuntimeExports.jsx(NotebookCell,{cellData:u},u.name))]})]})},TutorialPage=()=>jsxRuntimeExports.jsx("div",{id:"notebook-container",children:documentation.map(e=>jsxRuntimeExports.jsx(CollapsibleSection,{section:e},e.name))}),App=()=>{const[e,o]=reactExports.useState(window.location.hash);reactExports.useEffect(()=>{const b=()=>{o(window.location.hash)};return window.addEventListener("hashchange",b),()=>{window.removeEventListener("hashchange",b)}},[]),reactExports.useEffect(()=>{const b=()=>{audioEngine.init()};window.addEventListener("click",b,{once:!0}),window.addEventListener("keydown",b,{once:!0})},[]),reactExports.useEffect(()=>{const b=D=>{isMouseDownState.down=!0,mouseDownState.x=D.clientX,mouseDownState.y=D.clientY,audioEngine.setMouseDown(D.clientX,D.clientY,!0)},v=D=>{isMouseDownState.down=!1,audioEngine.setMouseDown(D.clientX,D.clientY,!1)},w=D=>{audioEngine.setMouse(D.clientX,D.clientY),mouseState.x=D.clientX,mouseState.y=D.clientY,isMouseDownState.down&&(mouseDownState.x=D.clientX,mouseDownState.y=D.clientY,audioEngine.setMouseDown(D.clientX,D.clientY,!0))};return window.addEventListener("mousedown",b),window.addEventListener("mouseup",v),window.addEventListener("mousemove",w),()=>{window.removeEventListener("mousedown",b),window.removeEventListener("mouseup",v),window.removeEventListener("mousemove",w)}},[]);const i=(b,v)=>{b.preventDefault(),window.location.hash=v,o(v)},l=()=>{switch(e){case"#/synopsis":return jsxRuntimeExports.jsx(SynopsisPage,{});case"#/reference":return jsxRuntimeExports.jsx(ReferencePage,{});case"#/tutorial":return jsxRuntimeExports.jsx(TutorialPage,{});case"#/tests":return jsxRuntimeExports.jsx(TestRunner,{});case"#/repl":case"#":case"#/":case"":default:return jsxRuntimeExports.jsx(Repl,{})}},u=["#/repl","#","#/",""].includes(e),d=e==="#/synopsis",h=e==="#/reference",m=e==="#/tests",g=e==="#/tutorial";return jsxRuntimeExports.jsxs("div",{className:`mx-auto ${u?"max-w-full":"max-w-4xl"}`,children:[jsxRuntimeExports.jsxs("header",{className:"mb-8 text-center",children:[jsxRuntimeExports.jsx("h1",{className:"text-5xl font-bold text-gray-900",children:"Yield"}),jsxRuntimeExports.jsx("p",{className:"mt-2 text-lg text-gray-600",children:"Concatenative live coding language that yields"}),jsxRuntimeExports.jsxs("nav",{className:"mt-4 space-x-4",children:[jsxRuntimeExports.jsx("a",{href:"#/repl",onClick:b=>i(b,"#/repl"),className:`text-indigo-600 hover:underline ${u?"font-bold":""}`,children:"REPL"}),jsxRuntimeExports.jsx("a",{href:"#/synopsis",onClick:b=>i(b,"#/synopsis"),className:`text-indigo-600 hover:underline ${d?"font-bold":""}`,children:"Synopsis"}),jsxRuntimeExports.jsx("a",{href:"#/reference",onClick:b=>i(b,"#/reference"),className:`text-indigo-600 hover:underline ${h?"font-bold":""}`,children:"Reference"}),jsxRuntimeExports.jsx("a",{href:"#/tutorial",onClick:b=>i(b,"#/tutorial"),className:`text-indigo-600 hover:underline ${g?"font-bold":""}`,children:"Tutorial"}),jsxRuntimeExports.jsx("a",{href:"#/tests",onClick:b=>i(b,"#/tests"),className:`text-indigo-600 hover:underline ${m?"font-bold":""}`,children:"Test Suite"})]})]}),jsxRuntimeExports.jsx("main",{children:l()})]})},container=document.getElementById("root"),root=clientExports.createRoot(container);root.render(jsxRuntimeExports.jsx(App,{}));
